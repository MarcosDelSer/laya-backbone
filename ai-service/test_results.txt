============================= test session starts ==============================
platform darwin -- Python 3.9.6, pytest-8.4.2, pluggy-1.6.0 -- /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/bin/python
cachedir: .pytest_cache
rootdir: /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service
plugins: anyio-4.12.1, asyncio-1.2.0
asyncio: mode=strict, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 1796 items

ai-service/tests/test_idor_protection_integration.py::TestDocumentIDORProtection::test_get_document_by_id_idor_protection ERROR [  0%]
ai-service/tests/test_idor_protection_integration.py::TestDocumentIDORProtection::test_update_document_idor_protection ERROR [  0%]
ai-service/tests/test_idor_protection_integration.py::TestDocumentIDORProtection::test_document_access_isolation_between_users ERROR [  0%]
ai-service/tests/test_idor_protection_integration.py::TestDocumentIDORProtection::test_cross_resource_idor_protection ERROR [  0%]
tests/auth/test_dependencies.py::TestGetCurrentUser::test_get_current_user_valid_token PASSED [  0%]
tests/auth/test_dependencies.py::TestGetCurrentUser::test_get_current_user_expired_token PASSED [  0%]
tests/auth/test_dependencies.py::TestGetCurrentUser::test_get_current_user_invalid_token PASSED [  0%]
tests/auth/test_dependencies.py::TestGetCurrentUser::test_get_current_user_blacklisted_token PASSED [  0%]
tests/auth/test_dependencies.py::TestGetCurrentUser::test_get_current_user_wrong_signature PASSED [  0%]
tests/auth/test_dependencies.py::TestGetCurrentUser::test_get_current_user_all_roles PASSED [  0%]
tests/auth/test_dependencies.py::TestRequireRole::test_require_role_returns_callable PASSED [  0%]
tests/auth/test_dependencies.py::TestRequireRole::test_require_role_accepts_multiple_roles PASSED [  0%]
tests/auth/test_dependencies.py::TestRequireRole::test_require_role_admin_access_allowed PASSED [  0%]
tests/auth/test_dependencies.py::TestRequireRole::test_require_role_teacher_access_denied PASSED [  0%]
tests/auth/test_dependencies.py::TestRequireRole::test_require_role_multiple_roles_allowed PASSED [  0%]
tests/auth/test_dependencies.py::TestRequireRole::test_require_role_missing_role_claim PASSED [  0%]
tests/auth/test_dependencies.py::TestRequireRole::test_require_role_none_role_value PASSED [  0%]
tests/auth/test_dependencies.py::TestRequireRole::test_require_role_empty_role_value PASSED [  1%]
tests/auth/test_dependencies.py::TestRequireRole::test_require_role_all_roles PASSED [  1%]
tests/auth/test_dependencies.py::TestRequireRole::test_require_role_wrong_role_shows_message PASSED [  1%]
tests/auth/test_dependencies.py::TestRequireRoleIntegration::test_full_auth_flow_admin_allowed PASSED [  1%]
tests/auth/test_dependencies.py::TestRequireRoleIntegration::test_full_auth_flow_teacher_denied_admin PASSED [  1%]
tests/auth/test_dependencies.py::TestRequireRoleIntegration::test_full_auth_flow_multi_role_access PASSED [  1%]
tests/auth/test_dependencies.py::TestRequireRoleIntegration::test_blacklisted_token_fails_before_role_check PASSED [  1%]
tests/auth/test_dependencies.py::TestRequireRoleEdgeCases::test_require_role_preserves_all_claims PASSED [  1%]
tests/auth/test_dependencies.py::TestRequireRoleEdgeCases::test_require_role_case_sensitive PASSED [  1%]
tests/auth/test_dependencies.py::TestRequireRoleEdgeCases::test_require_role_unknown_role PASSED [  1%]
tests/auth/test_dependencies.py::TestRequireRoleEdgeCases::test_require_role_single_role_exact_match PASSED [  1%]
tests/auth/test_dependencies.py::TestDependencyChaining::test_role_checker_can_be_reused PASSED [  1%]
tests/auth/test_dependencies.py::TestDependencyChaining::test_different_checkers_independent PASSED [  1%]
tests/auth/test_dependencies.py::TestMockedDependencies::test_get_current_user_calls_verify_token PASSED [  1%]
tests/auth/test_dependencies.py::TestMockedDependencies::test_require_role_factory_creates_new_checker PASSED [  1%]
tests/auth/test_dependencies.py::TestMockedDependencies::test_require_role_uses_role_values PASSED [  1%]
tests/auth/test_jwt.py::TestCreateToken::test_create_token_returns_string PASSED [  1%]
tests/auth/test_jwt.py::TestCreateToken::test_create_token_is_valid_jwt PASSED [  1%]
tests/auth/test_jwt.py::TestCreateToken::test_create_token_contains_subject PASSED [  2%]
tests/auth/test_jwt.py::TestCreateToken::test_create_token_contains_iat PASSED [  2%]
tests/auth/test_jwt.py::TestCreateToken::test_create_token_contains_exp PASSED [  2%]
tests/auth/test_jwt.py::TestCreateToken::test_create_token_custom_expiration PASSED [  2%]
tests/auth/test_jwt.py::TestCreateToken::test_create_token_with_additional_claims PASSED [  2%]
tests/auth/test_jwt.py::TestCreateToken::test_create_token_additional_claims_do_not_override_standard PASSED [  2%]
tests/auth/test_jwt.py::TestCreateToken::test_create_token_empty_additional_claims PASSED [  2%]
tests/auth/test_jwt.py::TestCreateToken::test_create_token_none_additional_claims PASSED [  2%]
tests/auth/test_jwt.py::TestCreateToken::test_create_token_different_subjects_different_tokens PASSED [  2%]
tests/auth/test_jwt.py::TestDecodeToken::test_decode_token_valid_token PASSED [  2%]
tests/auth/test_jwt.py::TestDecodeToken::test_decode_token_returns_all_claims PASSED [  2%]
tests/auth/test_jwt.py::TestDecodeToken::test_decode_token_expired_token_raises_401 PASSED [  2%]
tests/auth/test_jwt.py::TestDecodeToken::test_decode_token_invalid_token_raises_401 PASSED [  2%]
tests/auth/test_jwt.py::TestDecodeToken::test_decode_token_wrong_signature_raises_401 PASSED [  2%]
tests/auth/test_jwt.py::TestDecodeToken::test_decode_token_empty_string_raises_401 PASSED [  2%]
tests/auth/test_jwt.py::TestDecodeToken::test_decode_token_none_raises_401 PASSED [  2%]
tests/auth/test_jwt.py::TestDecodeToken::test_decode_token_www_authenticate_header PASSED [  2%]
tests/auth/test_jwt.py::TestDecodeToken::test_decode_token_with_test_token PASSED [  2%]
tests/auth/test_jwt.py::TestVerifyToken::test_verify_token_valid_not_blacklisted PASSED [  3%]
tests/auth/test_jwt.py::TestVerifyToken::test_verify_token_blacklisted_raises_401 PASSED [  3%]
tests/auth/test_jwt.py::TestVerifyToken::test_verify_token_expired_raises_401 PASSED [  3%]
tests/auth/test_jwt.py::TestVerifyToken::test_verify_token_invalid_raises_401 PASSED [  3%]
tests/auth/test_jwt.py::TestVerifyToken::test_verify_token_extracts_credentials PASSED [  3%]
tests/auth/test_jwt.py::TestVerifyToken::test_verify_token_checks_blacklist_with_correct_token PASSED [  3%]
tests/auth/test_jwt.py::TestVerifyTokenIntegration::test_verify_token_with_db_not_blacklisted PASSED [  3%]
tests/auth/test_jwt.py::TestVerifyTokenIntegration::test_verify_token_with_db_blacklisted PASSED [  3%]
tests/auth/test_jwt.py::TestVerifyTokenIntegration::test_verify_token_different_token_not_affected PASSED [  3%]
tests/auth/test_jwt.py::TestJWTSecurityProperties::test_token_cannot_be_tampered PASSED [  3%]
tests/auth/test_jwt.py::TestJWTSecurityProperties::test_token_algorithm_enforced PASSED [  3%]
tests/auth/test_jwt.py::TestJWTSecurityProperties::test_expiration_is_required PASSED [  3%]
tests/auth/test_jwt.py::TestJWTSecurityProperties::test_token_contains_all_standard_claims PASSED [  3%]
tests/auth/test_jwt.py::TestJWTSecurityProperties::test_iat_is_current_time PASSED [  3%]
tests/auth/test_models.py::TestUserRole::test_user_role_values PASSED    [  3%]
tests/auth/test_models.py::TestUserRole::test_user_role_count PASSED     [  3%]
tests/auth/test_models.py::TestUserRole::test_user_role_inherits_from_str PASSED [  3%]
tests/auth/test_models.py::TestUserRole::test_user_role_string_comparison PASSED [  3%]
tests/auth/test_models.py::TestUserRole::test_user_role_from_string PASSED [  4%]
tests/auth/test_models.py::TestUserRole::test_user_role_invalid_value PASSED [  4%]
tests/auth/test_models.py::TestUserRole::test_user_role_iteration PASSED [  4%]
tests/auth/test_models.py::TestUserModel::test_user_tablename PASSED     [  4%]
tests/auth/test_models.py::TestUserModel::test_user_has_required_columns PASSED [  4%]
tests/auth/test_models.py::TestUserModel::test_user_id_column PASSED     [  4%]
tests/auth/test_models.py::TestUserModel::test_user_email_column PASSED  [  4%]
tests/auth/test_models.py::TestUserModel::test_user_password_hash_column PASSED [  4%]
tests/auth/test_models.py::TestUserModel::test_user_first_name_column PASSED [  4%]
tests/auth/test_models.py::TestUserModel::test_user_last_name_column PASSED [  4%]
tests/auth/test_models.py::TestUserModel::test_user_role_column PASSED   [  4%]
tests/auth/test_models.py::TestUserModel::test_user_is_active_column PASSED [  4%]
tests/auth/test_models.py::TestUserModel::test_user_repr PASSED          [  4%]
tests/auth/test_models.py::TestTokenBlacklistModel::test_token_blacklist_tablename PASSED [  4%]
tests/auth/test_models.py::TestTokenBlacklistModel::test_token_blacklist_has_required_columns PASSED [  4%]
tests/auth/test_models.py::TestTokenBlacklistModel::test_token_blacklist_id_column PASSED [  4%]
tests/auth/test_models.py::TestTokenBlacklistModel::test_token_blacklist_token_column PASSED [  4%]
tests/auth/test_models.py::TestTokenBlacklistModel::test_token_blacklist_user_id_column PASSED [  4%]
tests/auth/test_models.py::TestTokenBlacklistModel::test_token_blacklist_expires_at_column PASSED [  5%]
tests/auth/test_models.py::TestTokenBlacklistModel::test_token_blacklist_repr PASSED [  5%]
tests/auth/test_models.py::TestPasswordResetTokenModel::test_password_reset_token_tablename PASSED [  5%]
tests/auth/test_models.py::TestPasswordResetTokenModel::test_password_reset_token_has_required_columns PASSED [  5%]
tests/auth/test_models.py::TestPasswordResetTokenModel::test_password_reset_token_id_column PASSED [  5%]
tests/auth/test_models.py::TestPasswordResetTokenModel::test_password_reset_token_token_column PASSED [  5%]
tests/auth/test_models.py::TestPasswordResetTokenModel::test_password_reset_token_user_id_column PASSED [  5%]
tests/auth/test_models.py::TestPasswordResetTokenModel::test_password_reset_token_email_column PASSED [  5%]
tests/auth/test_models.py::TestPasswordResetTokenModel::test_password_reset_token_is_used_column PASSED [  5%]
tests/auth/test_models.py::TestPasswordResetTokenModel::test_password_reset_token_expires_at_column PASSED [  5%]
tests/auth/test_models.py::TestPasswordResetTokenModel::test_password_reset_token_repr PASSED [  5%]
tests/auth/test_models.py::TestPasswordResetTokenModel::test_password_reset_token_repr_used PASSED [  5%]
tests/auth/test_routes.py::TestLoginEndpoint::test_login_success ERROR   [  5%]
tests/auth/test_routes.py::TestLoginEndpoint::test_login_wrong_password ERROR [  5%]
tests/auth/test_routes.py::TestLoginEndpoint::test_login_nonexistent_user ERROR [  5%]
tests/auth/test_routes.py::TestLoginEndpoint::test_login_inactive_user ERROR [  5%]
tests/auth/test_routes.py::TestLoginEndpoint::test_login_missing_email ERROR [  5%]
tests/auth/test_routes.py::TestLoginEndpoint::test_login_missing_password ERROR [  5%]
tests/auth/test_routes.py::TestLoginEndpoint::test_login_invalid_email_format ERROR [  6%]
tests/auth/test_routes.py::TestLoginEndpoint::test_login_empty_password ERROR [  6%]
tests/auth/test_routes.py::TestLoginEndpoint::test_login_all_roles ERROR [  6%]
tests/auth/test_routes.py::TestRefreshEndpoint::test_refresh_success ERROR [  6%]
tests/auth/test_routes.py::TestRefreshEndpoint::test_refresh_with_access_token_fails ERROR [  6%]
tests/auth/test_routes.py::TestRefreshEndpoint::test_refresh_expired_token ERROR [  6%]
tests/auth/test_routes.py::TestRefreshEndpoint::test_refresh_invalid_token ERROR [  6%]
tests/auth/test_routes.py::TestRefreshEndpoint::test_refresh_blacklisted_token ERROR [  6%]
tests/auth/test_routes.py::TestRefreshEndpoint::test_refresh_nonexistent_user ERROR [  6%]
tests/auth/test_routes.py::TestRefreshEndpoint::test_refresh_inactive_user ERROR [  6%]
tests/auth/test_routes.py::TestRefreshEndpoint::test_refresh_missing_token ERROR [  6%]
tests/auth/test_routes.py::TestLogoutEndpoint::test_logout_success_access_only ERROR [  6%]
tests/auth/test_routes.py::TestLogoutEndpoint::test_logout_success_both_tokens ERROR [  6%]
tests/auth/test_routes.py::TestLogoutEndpoint::test_logout_invalid_access_token ERROR [  6%]
tests/auth/test_routes.py::TestLogoutEndpoint::test_logout_refresh_as_access_fails ERROR [  6%]
tests/auth/test_routes.py::TestLogoutEndpoint::test_logout_missing_access_token ERROR [  6%]
tests/auth/test_routes.py::TestLogoutEndpoint::test_logout_expired_access_token ERROR [  6%]
tests/auth/test_routes.py::TestLogoutEndpoint::test_logout_ignores_invalid_refresh ERROR [  6%]
tests/auth/test_routes.py::TestPasswordResetRequestEndpoint::test_password_reset_request_existing_user ERROR [  7%]
tests/auth/test_routes.py::TestPasswordResetRequestEndpoint::test_password_reset_request_nonexistent_user ERROR [  7%]
tests/auth/test_routes.py::TestPasswordResetRequestEndpoint::test_password_reset_request_inactive_user ERROR [  7%]
tests/auth/test_routes.py::TestPasswordResetRequestEndpoint::test_password_reset_request_missing_email ERROR [  7%]
tests/auth/test_routes.py::TestPasswordResetRequestEndpoint::test_password_reset_request_invalid_email ERROR [  7%]
tests/auth/test_routes.py::TestPasswordResetRequestEndpoint::test_password_reset_email_masking ERROR [  7%]
tests/auth/test_routes.py::TestPasswordResetConfirmEndpoint::test_password_reset_confirm_success ERROR [  7%]
tests/auth/test_routes.py::TestPasswordResetConfirmEndpoint::test_password_reset_confirm_invalid_token ERROR [  7%]
tests/auth/test_routes.py::TestPasswordResetConfirmEndpoint::test_password_reset_confirm_used_token ERROR [  7%]
tests/auth/test_routes.py::TestPasswordResetConfirmEndpoint::test_password_reset_confirm_expired_token ERROR [  7%]
tests/auth/test_routes.py::TestPasswordResetConfirmEndpoint::test_password_reset_confirm_missing_token ERROR [  7%]
tests/auth/test_routes.py::TestPasswordResetConfirmEndpoint::test_password_reset_confirm_missing_password ERROR [  7%]
tests/auth/test_routes.py::TestPasswordResetConfirmEndpoint::test_password_reset_confirm_empty_password ERROR [  7%]
tests/auth/test_routes.py::TestGetMeEndpoint::test_get_me_success ERROR  [  7%]
tests/auth/test_routes.py::TestGetMeEndpoint::test_get_me_admin ERROR    [  7%]
tests/auth/test_routes.py::TestGetMeEndpoint::test_get_me_no_token ERROR [  7%]
tests/auth/test_routes.py::TestGetMeEndpoint::test_get_me_invalid_token ERROR [  7%]
tests/auth/test_routes.py::TestGetMeEndpoint::test_get_me_expired_token ERROR [  7%]
tests/auth/test_routes.py::TestGetMeEndpoint::test_get_me_blacklisted_token ERROR [  8%]
tests/auth/test_routes.py::TestAdminTestEndpoint::test_admin_endpoint_with_admin ERROR [  8%]
tests/auth/test_routes.py::TestAdminTestEndpoint::test_admin_endpoint_with_teacher_forbidden ERROR [  8%]
tests/auth/test_routes.py::TestAdminTestEndpoint::test_admin_endpoint_with_parent_forbidden ERROR [  8%]
tests/auth/test_routes.py::TestAdminTestEndpoint::test_admin_endpoint_with_accountant_forbidden ERROR [  8%]
tests/auth/test_routes.py::TestAdminTestEndpoint::test_admin_endpoint_no_token ERROR [  8%]
tests/auth/test_routes.py::TestFinancialTestEndpoint::test_financial_endpoint_with_admin ERROR [  8%]
tests/auth/test_routes.py::TestFinancialTestEndpoint::test_financial_endpoint_with_accountant ERROR [  8%]
tests/auth/test_routes.py::TestFinancialTestEndpoint::test_financial_endpoint_with_teacher_forbidden ERROR [  8%]
tests/auth/test_routes.py::TestFinancialTestEndpoint::test_financial_endpoint_with_parent_forbidden ERROR [  8%]
tests/auth/test_routes.py::TestFinancialTestEndpoint::test_financial_endpoint_no_token ERROR [  8%]
tests/auth/test_routes.py::TestAuthFlowIntegration::test_login_then_access_protected_endpoint ERROR [  8%]
tests/auth/test_routes.py::TestAuthFlowIntegration::test_login_logout_then_access_fails ERROR [  8%]
tests/auth/test_routes.py::TestAuthFlowIntegration::test_login_refresh_then_access ERROR [  8%]
tests/auth/test_routes.py::TestAuthFlowIntegration::test_admin_login_access_admin_endpoint ERROR [  8%]
tests/auth/test_routes.py::TestAuthFlowIntegration::test_password_reset_flow ERROR [  8%]
tests/auth/test_routes.py::TestAuthFlowIntegration::test_teacher_cannot_access_admin_endpoint ERROR [  8%]
tests/auth/test_routes.py::TestSecurityEdgeCases::test_sql_injection_in_email ERROR [  8%]
tests/auth/test_routes.py::TestSecurityEdgeCases::test_very_long_password ERROR [  9%]
tests/auth/test_routes.py::TestSecurityEdgeCases::test_unicode_in_password ERROR [  9%]
tests/auth/test_routes.py::TestSecurityEdgeCases::test_case_sensitivity_email ERROR [  9%]
tests/auth/test_routes.py::TestSecurityEdgeCases::test_token_tampering ERROR [  9%]
tests/auth/test_routes.py::TestSecurityEdgeCases::test_malformed_authorization_header ERROR [  9%]
tests/auth/test_routes.py::TestSecurityEdgeCases::test_empty_authorization_header ERROR [  9%]
tests/auth/test_routes.py::TestSecurityEdgeCases::test_bearer_only_no_token ERROR [  9%]
tests/auth/test_routes.py::TestSecurityEdgeCases::test_multiple_rapid_login_attempts ERROR [  9%]
tests/auth/test_schemas.py::TestLoginRequest::test_valid_login_request PASSED [  9%]
tests/auth/test_schemas.py::TestLoginRequest::test_login_request_email_required PASSED [  9%]
tests/auth/test_schemas.py::TestLoginRequest::test_login_request_password_required PASSED [  9%]
tests/auth/test_schemas.py::TestLoginRequest::test_login_request_invalid_email PASSED [  9%]
tests/auth/test_schemas.py::TestLoginRequest::test_login_request_password_min_length PASSED [  9%]
tests/auth/test_schemas.py::TestLoginRequest::test_login_request_password_max_length PASSED [  9%]
tests/auth/test_schemas.py::TestLoginRequest::test_login_request_email_normalized PASSED [  9%]
tests/auth/test_schemas.py::TestLoginRequest::test_login_request_whitespace_stripped PASSED [  9%]
tests/auth/test_schemas.py::TestRefreshRequest::test_valid_refresh_request PASSED [  9%]
tests/auth/test_schemas.py::TestRefreshRequest::test_refresh_request_token_required PASSED [  9%]
tests/auth/test_schemas.py::TestRefreshRequest::test_refresh_request_token_min_length PASSED [ 10%]
tests/auth/test_schemas.py::TestRefreshRequest::test_refresh_request_long_token PASSED [ 10%]
tests/auth/test_schemas.py::TestTokenResponse::test_valid_token_response PASSED [ 10%]
tests/auth/test_schemas.py::TestTokenResponse::test_token_response_default_token_type PASSED [ 10%]
tests/auth/test_schemas.py::TestTokenResponse::test_token_response_custom_token_type PASSED [ 10%]
tests/auth/test_schemas.py::TestTokenResponse::test_token_response_access_token_required PASSED [ 10%]
tests/auth/test_schemas.py::TestTokenResponse::test_token_response_refresh_token_required PASSED [ 10%]
tests/auth/test_schemas.py::TestTokenResponse::test_token_response_expires_in_required PASSED [ 10%]
tests/auth/test_schemas.py::TestTokenResponse::test_token_response_expires_in_must_be_positive PASSED [ 10%]
tests/auth/test_schemas.py::TestTokenResponse::test_token_response_expires_in_negative PASSED [ 10%]
tests/auth/test_schemas.py::TestLogoutRequest::test_valid_logout_request_with_both_tokens PASSED [ 10%]
tests/auth/test_schemas.py::TestLogoutRequest::test_valid_logout_request_access_token_only PASSED [ 10%]
tests/auth/test_schemas.py::TestLogoutRequest::test_logout_request_access_token_required PASSED [ 10%]
tests/auth/test_schemas.py::TestLogoutRequest::test_logout_request_refresh_token_optional PASSED [ 10%]
tests/auth/test_schemas.py::TestLogoutRequest::test_logout_request_access_token_min_length PASSED [ 10%]
tests/auth/test_schemas.py::TestLogoutResponse::test_valid_logout_response PASSED [ 10%]
tests/auth/test_schemas.py::TestLogoutResponse::test_logout_response_message_required PASSED [ 10%]
tests/auth/test_schemas.py::TestLogoutResponse::test_logout_response_tokens_invalidated_required PASSED [ 10%]
tests/auth/test_schemas.py::TestLogoutResponse::test_logout_response_tokens_invalidated_must_be_non_negative PASSED [ 11%]
tests/auth/test_schemas.py::TestLogoutResponse::test_logout_response_zero_tokens_invalidated PASSED [ 11%]
tests/auth/test_schemas.py::TestPasswordResetRequest::test_valid_password_reset_request PASSED [ 11%]
tests/auth/test_schemas.py::TestPasswordResetRequest::test_password_reset_request_email_required PASSED [ 11%]
tests/auth/test_schemas.py::TestPasswordResetRequest::test_password_reset_request_invalid_email PASSED [ 11%]
tests/auth/test_schemas.py::TestPasswordResetRequest::test_password_reset_request_email_whitespace_stripped PASSED [ 11%]
tests/auth/test_schemas.py::TestPasswordResetRequestResponse::test_valid_password_reset_request_response PASSED [ 11%]
tests/auth/test_schemas.py::TestPasswordResetRequestResponse::test_password_reset_request_response_message_required PASSED [ 11%]
tests/auth/test_schemas.py::TestPasswordResetRequestResponse::test_password_reset_request_response_email_required PASSED [ 11%]
tests/auth/test_schemas.py::TestPasswordResetConfirm::test_valid_password_reset_confirm PASSED [ 11%]
tests/auth/test_schemas.py::TestPasswordResetConfirm::test_password_reset_confirm_token_required PASSED [ 11%]
tests/auth/test_schemas.py::TestPasswordResetConfirm::test_password_reset_confirm_password_required PASSED [ 11%]
tests/auth/test_schemas.py::TestPasswordResetConfirm::test_password_reset_confirm_token_min_length PASSED [ 11%]
tests/auth/test_schemas.py::TestPasswordResetConfirm::test_password_reset_confirm_password_min_length PASSED [ 11%]
tests/auth/test_schemas.py::TestPasswordResetConfirm::test_password_reset_confirm_password_max_length PASSED [ 11%]
tests/auth/test_schemas.py::TestPasswordResetConfirm::test_password_reset_confirm_password_8_chars PASSED [ 11%]
tests/auth/test_schemas.py::TestPasswordResetConfirm::test_password_reset_confirm_password_100_chars PASSED [ 11%]
tests/auth/test_schemas.py::TestPasswordResetConfirmResponse::test_valid_password_reset_confirm_response PASSED [ 11%]
tests/auth/test_schemas.py::TestPasswordResetConfirmResponse::test_password_reset_confirm_response_message_required PASSED [ 12%]
tests/auth/test_schemas.py::TestSchemaFromAttributes::test_login_request_from_dict PASSED [ 12%]
tests/auth/test_schemas.py::TestSchemaFromAttributes::test_token_response_model_dump PASSED [ 12%]
tests/auth/test_schemas.py::TestSchemaFromAttributes::test_logout_response_model_dump_json PASSED [ 12%]
tests/auth/test_security.py::TestHashPassword::test_hash_password_returns_string FAILED [ 12%]
tests/auth/test_security.py::TestHashPassword::test_hash_password_returns_bcrypt_hash FAILED [ 12%]
tests/auth/test_security.py::TestHashPassword::test_hash_password_different_passwords_produce_different_hashes FAILED [ 12%]
tests/auth/test_security.py::TestHashPassword::test_hash_password_same_password_different_hashes FAILED [ 12%]
tests/auth/test_security.py::TestHashPassword::test_hash_password_empty_string FAILED [ 12%]
tests/auth/test_security.py::TestHashPassword::test_hash_password_special_characters FAILED [ 12%]
tests/auth/test_security.py::TestHashPassword::test_hash_password_unicode_characters FAILED [ 12%]
tests/auth/test_security.py::TestHashPassword::test_hash_password_long_password FAILED [ 12%]
tests/auth/test_security.py::TestHashPassword::test_hash_password_hash_length FAILED [ 12%]
tests/auth/test_security.py::TestVerifyPassword::test_verify_password_correct_password FAILED [ 12%]
tests/auth/test_security.py::TestVerifyPassword::test_verify_password_incorrect_password FAILED [ 12%]
tests/auth/test_security.py::TestVerifyPassword::test_verify_password_empty_password_mismatch FAILED [ 12%]
tests/auth/test_security.py::TestVerifyPassword::test_verify_password_empty_password_match FAILED [ 12%]
tests/auth/test_security.py::TestVerifyPassword::test_verify_password_case_sensitive FAILED [ 12%]
tests/auth/test_security.py::TestVerifyPassword::test_verify_password_special_characters FAILED [ 13%]
tests/auth/test_security.py::TestVerifyPassword::test_verify_password_unicode_characters FAILED [ 13%]
tests/auth/test_security.py::TestVerifyPassword::test_verify_password_whitespace_significant FAILED [ 13%]
tests/auth/test_security.py::TestVerifyPassword::test_verify_password_with_precomputed_hash FAILED [ 13%]
tests/auth/test_security.py::TestHashToken::test_hash_token_returns_string PASSED [ 13%]
tests/auth/test_security.py::TestHashToken::test_hash_token_returns_64_hex_chars PASSED [ 13%]
tests/auth/test_security.py::TestHashToken::test_hash_token_is_deterministic PASSED [ 13%]
tests/auth/test_security.py::TestHashToken::test_hash_token_different_tokens_different_hashes PASSED [ 13%]
tests/auth/test_security.py::TestHashToken::test_hash_token_empty_string PASSED [ 13%]
tests/auth/test_security.py::TestHashToken::test_hash_token_special_characters PASSED [ 13%]
tests/auth/test_security.py::TestHashToken::test_hash_token_unicode_characters PASSED [ 13%]
tests/auth/test_security.py::TestHashToken::test_hash_token_long_token PASSED [ 13%]
tests/auth/test_security.py::TestHashToken::test_hash_token_matches_manual_sha256 PASSED [ 13%]
tests/auth/test_security.py::TestHashToken::test_hash_token_lowercase_hex PASSED [ 13%]
tests/auth/test_security.py::TestHashToken::test_hash_token_consistent_across_calls PASSED [ 13%]
tests/auth/test_security.py::TestSecurityIntegration::test_password_roundtrip FAILED [ 13%]
tests/auth/test_security.py::TestSecurityIntegration::test_token_vs_password_hashing FAILED [ 13%]
tests/auth/test_security.py::TestSecurityIntegration::test_hash_formats_are_different FAILED [ 13%]
tests/auth/test_service.py::TestAuthServiceInit::test_init_stores_db_session PASSED [ 14%]
tests/auth/test_service.py::TestAuthServiceInit::test_init_has_correct_token_expiration_times PASSED [ 14%]
tests/auth/test_service.py::TestAuthenticateUser::test_authenticate_user_success ERROR [ 14%]
tests/auth/test_service.py::TestAuthenticateUser::test_authenticate_user_wrong_password ERROR [ 14%]
tests/auth/test_service.py::TestAuthenticateUser::test_authenticate_user_nonexistent_email PASSED [ 14%]
tests/auth/test_service.py::TestAuthenticateUser::test_authenticate_user_inactive_user ERROR [ 14%]
tests/auth/test_service.py::TestGetUserById::test_get_user_by_id_found PASSED [ 14%]
tests/auth/test_service.py::TestGetUserById::test_get_user_by_id_not_found PASSED [ 14%]
tests/auth/test_service.py::TestLogin::test_login_success ERROR          [ 14%]
tests/auth/test_service.py::TestLogin::test_login_wrong_password_raises_401 ERROR [ 14%]
tests/auth/test_service.py::TestLogin::test_login_nonexistent_user_raises_401 PASSED [ 14%]
tests/auth/test_service.py::TestLogin::test_login_inactive_user_raises_401 ERROR [ 14%]
tests/auth/test_service.py::TestLogin::test_login_includes_www_authenticate_header PASSED [ 14%]
tests/auth/test_service.py::TestLogin::test_login_access_token_contains_user_info ERROR [ 14%]
tests/auth/test_service.py::TestLogin::test_login_refresh_token_has_correct_type ERROR [ 14%]
tests/auth/test_service.py::TestIsTokenBlacklisted::test_is_token_blacklisted_not_in_list PASSED [ 14%]
tests/auth/test_service.py::TestIsTokenBlacklisted::test_is_token_blacklisted_in_list PASSED [ 14%]
tests/auth/test_service.py::TestRefreshTokens::test_refresh_tokens_success PASSED [ 14%]
tests/auth/test_service.py::TestRefreshTokens::test_refresh_tokens_blacklisted_raises_401 PASSED [ 15%]
tests/auth/test_service.py::TestRefreshTokens::test_refresh_tokens_access_token_type_raises_401 PASSED [ 15%]
tests/auth/test_service.py::TestRefreshTokens::test_refresh_tokens_expired_raises_401 PASSED [ 15%]
tests/auth/test_service.py::TestRefreshTokens::test_refresh_tokens_nonexistent_user_raises_401 PASSED [ 15%]
tests/auth/test_service.py::TestRefreshTokens::test_refresh_tokens_inactive_user_raises_401 PASSED [ 15%]
tests/auth/test_service.py::TestRefreshTokens::test_refresh_tokens_missing_subject_raises_401 PASSED [ 15%]
tests/auth/test_service.py::TestRefreshTokens::test_refresh_tokens_invalid_uuid_raises_401 PASSED [ 15%]
tests/auth/test_service.py::TestLogout::test_logout_success_access_token_only PASSED [ 15%]
tests/auth/test_service.py::TestLogout::test_logout_success_both_tokens PASSED [ 15%]
tests/auth/test_service.py::TestLogout::test_logout_invalid_access_token_raises_401 PASSED [ 15%]
tests/auth/test_service.py::TestLogout::test_logout_refresh_token_type_raises_401 PASSED [ 15%]
tests/auth/test_service.py::TestLogout::test_logout_ignores_invalid_refresh_token PASSED [ 15%]
tests/auth/test_service.py::TestLogout::test_logout_missing_subject_raises_401 PASSED [ 15%]
tests/auth/test_service.py::TestRequestPasswordReset::test_request_password_reset_existing_user PASSED [ 15%]
tests/auth/test_service.py::TestRequestPasswordReset::test_request_password_reset_nonexistent_user PASSED [ 15%]
tests/auth/test_service.py::TestRequestPasswordReset::test_request_password_reset_inactive_user PASSED [ 15%]
tests/auth/test_service.py::TestRequestPasswordReset::test_request_password_reset_email_masking PASSED [ 15%]
tests/auth/test_service.py::TestConfirmPasswordReset::test_confirm_password_reset_success ERROR [ 15%]
tests/auth/test_service.py::TestConfirmPasswordReset::test_confirm_password_reset_invalid_token PASSED [ 16%]
tests/auth/test_service.py::TestConfirmPasswordReset::test_confirm_password_reset_already_used ERROR [ 16%]
tests/auth/test_service.py::TestConfirmPasswordReset::test_confirm_password_reset_expired_token ERROR [ 16%]
tests/auth/test_service.py::TestConfirmPasswordReset::test_confirm_password_reset_user_not_found PASSED [ 16%]
tests/auth/test_service.py::TestConfirmPasswordReset::test_confirm_password_reset_inactive_user PASSED [ 16%]
tests/auth/test_service.py::TestAuthServiceIntegration::test_login_logout_flow ERROR [ 16%]
tests/auth/test_service.py::TestAuthServiceIntegration::test_login_refresh_flow ERROR [ 16%]
tests/auth/test_service.py::TestAuthServiceIntegration::test_all_user_roles_can_login FAILED [ 16%]
tests/core/test_connection_pooling.py::test_check_pool_status PASSED     [ 16%]
tests/core/test_connection_pooling.py::test_get_pool_health_normal_utilization PASSED [ 16%]
tests/core/test_connection_pooling.py::test_get_pool_health_high_utilization PASSED [ 16%]
tests/core/test_connection_pooling.py::test_get_pool_health_high_overflow PASSED [ 16%]
tests/core/test_connection_pooling.py::test_get_pool_health_all_connections_checked_out PASSED [ 16%]
tests/core/test_connection_pooling.py::test_get_pool_health_configuration_values PASSED [ 16%]
tests/core/test_connection_pooling.py::test_get_active_connections PASSED [ 16%]
tests/core/test_connection_pooling.py::test_get_active_connections_empty_result PASSED [ 16%]
tests/core/test_connection_pooling.py::test_optimize_pool_settings_low_usage PASSED [ 16%]
tests/core/test_connection_pooling.py::test_optimize_pool_settings_high_usage PASSED [ 16%]
tests/core/test_connection_pooling.py::test_optimize_pool_settings_idle_in_transaction PASSED [ 17%]
tests/core/test_connection_pooling.py::test_optimize_pool_settings_long_running_query PASSED [ 17%]
tests/core/test_connection_pooling.py::test_optimize_pool_settings_oversized_pool PASSED [ 17%]
tests/core/test_connection_pooling.py::test_pool_health_zero_max_connections PASSED [ 17%]
tests/core/test_connection_pooling.py::test_pool_recommendations_format PASSED [ 17%]
tests/core/test_database.py::test_explain_query_with_analyze PASSED      [ 17%]
tests/core/test_database.py::test_explain_query_without_analyze PASSED   [ 17%]
tests/core/test_database.py::test_find_slow_queries PASSED               [ 17%]
tests/core/test_database.py::test_find_missing_indexes PASSED            [ 17%]
tests/core/test_database.py::test_get_table_index_usage PASSED           [ 17%]
tests/core/test_database.py::test_analyze_query_plan PASSED              [ 17%]
tests/core/test_database.py::test_get_cache_hit_ratio PASSED             [ 17%]
tests/core/test_database.py::test_get_database_size_stats PASSED         [ 17%]
tests/core/test_database.py::test_analyze_query_plan_with_joins PASSED   [ 17%]
tests/core/test_database.py::test_cache_hit_ratio_with_no_data PASSED    [ 17%]
tests/middleware/test_cache_headers.py::test_api_json_response_no_cache PASSED [ 17%]
tests/middleware/test_cache_headers.py::test_static_image_cache PASSED   [ 17%]
tests/middleware/test_cache_headers.py::test_versioned_css_immutable PASSED [ 17%]
tests/middleware/test_cache_headers.py::test_versioned_js_immutable PASSED [ 18%]
tests/middleware/test_cache_headers.py::test_font_file_cache PASSED      [ 18%]
tests/middleware/test_cache_headers.py::test_video_file_cache PASSED     [ 18%]
tests/middleware/test_cache_headers.py::test_pdf_document_cache PASSED   [ 18%]
tests/middleware/test_cache_headers.py::test_html_page_no_cache PASSED   [ 18%]
tests/middleware/test_cache_headers.py::test_existing_cache_headers_preserved PASSED [ 18%]
tests/middleware/test_cache_headers.py::test_middleware_is_static_path PASSED [ 18%]
tests/middleware/test_cache_headers.py::test_middleware_is_immutable_asset PASSED [ 18%]
tests/middleware/test_cache_headers.py::test_middleware_get_cache_control PASSED [ 18%]
tests/middleware/test_cache_headers.py::test_create_cache_middleware_factory PASSED [ 18%]
tests/middleware/test_cache_headers.py::test_custom_cache_rules PASSED   [ 18%]
tests/middleware/test_cache_headers.py::test_middleware_initialization_defaults PASSED [ 18%]
tests/middleware/test_cache_headers.py::test_middleware_initialization_custom PASSED [ 18%]
tests/middleware/test_compression.py::test_json_compression_with_gzip_header PASSED [ 18%]
tests/middleware/test_compression.py::test_json_no_compression_without_gzip_header PASSED [ 18%]
tests/middleware/test_compression.py::test_small_response_not_compressed PASSED [ 18%]
tests/middleware/test_compression.py::test_html_compression PASSED       [ 18%]
tests/middleware/test_compression.py::test_text_compression PASSED       [ 18%]
tests/middleware/test_compression.py::test_css_compression PASSED        [ 19%]
tests/middleware/test_compression.py::test_javascript_compression PASSED [ 19%]
tests/middleware/test_compression.py::test_image_not_compressed PASSED   [ 19%]
tests/middleware/test_compression.py::test_video_not_compressed PASSED   [ 19%]
tests/middleware/test_compression.py::test_pdf_not_compressed PASSED     [ 19%]
tests/middleware/test_compression.py::test_already_compressed_not_recompressed PASSED [ 19%]
tests/middleware/test_compression.py::test_compression_reduces_size PASSED [ 19%]
tests/middleware/test_compression.py::test_compression_preserves_data_integrity PASSED [ 19%]
tests/middleware/test_compression.py::test_middleware_initialization_defaults PASSED [ 19%]
tests/middleware/test_compression.py::test_middleware_initialization_custom PASSED [ 19%]
tests/middleware/test_compression.py::test_middleware_compresslevel_clamping PASSED [ 19%]
tests/middleware/test_compression.py::test_should_compress_content_type PASSED [ 19%]
tests/middleware/test_compression.py::test_create_compression_middleware_factory PASSED [ 19%]
tests/middleware/test_compression.py::test_custom_minimum_size PASSED    [ 19%]
tests/middleware/test_compression.py::test_vary_header_added PASSED      [ 19%]
tests/middleware/test_compression.py::test_content_length_updated PASSED [ 19%]
tests/middleware/test_compression.py::test_compression_level_affects_size PASSED [ 19%]
tests/test_activities.py::TestActivityModel::test_create_activity_with_all_fields PASSED [ 19%]
tests/test_activities.py::TestActivityModel::test_activity_repr PASSED   [ 20%]
tests/test_activities.py::TestActivityModel::test_activity_default_values PASSED [ 20%]
tests/test_activities.py::TestActivityRecommendationModel::test_create_recommendation PASSED [ 20%]
tests/test_activities.py::TestActivityRecommendationModel::test_recommendation_activity_relationship PASSED [ 20%]
tests/test_activities.py::TestActivityRecommendationModel::test_recommendation_repr PASSED [ 20%]
tests/test_activities.py::TestActivityParticipationModel::test_create_participation PASSED [ 20%]
tests/test_activities.py::TestActivityParticipationModel::test_participation_repr PASSED [ 20%]
tests/test_activities.py::TestActivityServiceRecommendations::test_get_recommendations_returns_response PASSED [ 20%]
tests/test_activities.py::TestActivityServiceRecommendations::test_get_recommendations_respects_max_limit PASSED [ 20%]
tests/test_activities.py::TestActivityServiceRecommendations::test_recommendations_only_include_active_activities PASSED [ 20%]
tests/test_activities.py::TestActivityServiceRecommendations::test_recommendation_scoring_within_valid_range PASSED [ 20%]
tests/test_activities.py::TestActivityServiceRecommendations::test_recommendations_sorted_by_score_descending PASSED [ 20%]
tests/test_activities.py::TestActivityServiceRecommendations::test_recommendations_include_reasoning PASSED [ 20%]
tests/test_activities.py::TestAgeFiltering::test_age_filtering_excludes_out_of_range PASSED [ 20%]
tests/test_activities.py::TestAgeFiltering::test_age_filtering_for_toddler PASSED [ 20%]
tests/test_activities.py::TestAgeFiltering::test_age_filtering_for_school_age PASSED [ 20%]
tests/test_activities.py::TestAgeFiltering::test_age_match_affects_score PASSED [ 20%]
tests/test_activities.py::TestActivityTypeFiltering::test_filter_by_single_activity_type PASSED [ 20%]
tests/test_activities.py::TestActivityTypeFiltering::test_filter_by_multiple_activity_types PASSED [ 21%]
tests/test_activities.py::TestParticipationTracking::test_participation_history_affects_recommendations PASSED [ 21%]
tests/test_activities.py::TestParticipationTracking::test_record_participation_creates_record PASSED [ 21%]
tests/test_activities.py::TestParticipationTracking::test_multiple_participations_increase_penalty PASSED [ 21%]
tests/test_activities.py::TestEmptyRecommendations::test_empty_recommendations_for_no_activities PASSED [ 21%]
tests/test_activities.py::TestEmptyRecommendations::test_empty_recommendations_for_no_age_match PASSED [ 21%]
tests/test_activities.py::TestWeatherScoring::test_weather_affects_scoring PASSED [ 21%]
tests/test_activities.py::TestGroupSizeScoring::test_group_size_affects_social_activity_score PASSED [ 21%]
tests/test_activities.py::TestActivityServiceOtherMethods::test_get_activity_by_id PASSED [ 21%]
tests/test_activities.py::TestActivityServiceOtherMethods::test_get_activity_by_id_not_found PASSED [ 21%]
tests/test_activities.py::TestActivityServiceOtherMethods::test_list_activities PASSED [ 21%]
tests/test_activities.py::TestActivityServiceOtherMethods::test_list_activities_with_type_filter PASSED [ 21%]
tests/test_activities.py::TestActivityServiceOtherMethods::test_list_activities_pagination PASSED [ 21%]
tests/test_activities.py::TestActivityServiceOtherMethods::test_save_recommendation PASSED [ 21%]
tests/test_activities.py::TestRecommendationsEndpoint::test_recommendations_endpoint_returns_200 ERROR [ 21%]
tests/test_activities.py::TestRecommendationsEndpoint::test_recommendations_endpoint_requires_auth ERROR [ 21%]
tests/test_activities.py::TestRecommendationsEndpoint::test_recommendations_endpoint_with_parameters ERROR [ 21%]
tests/test_activities.py::TestRecommendationsEndpoint::test_recommendations_endpoint_validates_max_recommendations ERROR [ 21%]
tests/test_activities.py::TestRecommendationsEndpoint::test_recommendations_endpoint_validates_age_range ERROR [ 22%]
tests/test_activities.py::TestGetActivityEndpoint::test_get_activity_returns_200 ERROR [ 22%]
tests/test_activities.py::TestGetActivityEndpoint::test_get_activity_requires_auth ERROR [ 22%]
tests/test_activities.py::TestGetActivityEndpoint::test_get_activity_not_found ERROR [ 22%]
tests/test_activities.py::TestListActivitiesEndpoint::test_list_activities_returns_200 ERROR [ 22%]
tests/test_activities.py::TestListActivitiesEndpoint::test_list_activities_requires_auth ERROR [ 22%]
tests/test_activities.py::TestListActivitiesEndpoint::test_list_activities_pagination ERROR [ 22%]
tests/test_activities.py::TestListActivitiesEndpoint::test_list_activities_type_filter ERROR [ 22%]
tests/test_activities.py::TestEdgeCases::test_invalid_uuid_format ERROR  [ 22%]
tests/test_activities.py::TestEdgeCases::test_invalid_activity_type_filter ERROR [ 22%]
tests/test_activities.py::TestEdgeCases::test_negative_group_size_rejected ERROR [ 22%]
tests/test_activities.py::TestEdgeCases::test_boundary_age_values PASSED [ 22%]
tests/test_activities.py::TestEdgeCases::test_special_needs_flag PASSED  [ 22%]
tests/test_auth_audit_logger.py::TestTokenVerificationEvent::test_event_creation_success PASSED [ 22%]
tests/test_auth_audit_logger.py::TestTokenVerificationEvent::test_event_creation_failed PASSED [ 22%]
tests/test_auth_audit_logger.py::TestTokenVerificationEvent::test_event_creation_expired PASSED [ 22%]
tests/test_auth_audit_logger.py::TestTokenVerificationEvent::test_event_with_claims PASSED [ 22%]
tests/test_auth_audit_logger.py::TestTokenAuditLogger::test_log_verification_success PASSED [ 22%]
tests/test_auth_audit_logger.py::TestTokenAuditLogger::test_log_verification_failed PASSED [ 23%]
tests/test_auth_audit_logger.py::TestTokenAuditLogger::test_log_token_expired PASSED [ 23%]
tests/test_auth_audit_logger.py::TestTokenAuditLogger::test_log_invalid_token PASSED [ 23%]
tests/test_auth_audit_logger.py::TestTokenAuditLogger::test_log_missing_claims PASSED [ 23%]
tests/test_auth_audit_logger.py::TestTokenAuditLogger::test_extract_relevant_claims PASSED [ 23%]
tests/test_auth_audit_logger.py::TestHelperFunctions::test_get_client_ip_direct PASSED [ 23%]
tests/test_auth_audit_logger.py::TestHelperFunctions::test_get_client_ip_cloudflare PASSED [ 23%]
tests/test_auth_audit_logger.py::TestHelperFunctions::test_get_client_ip_proxy PASSED [ 23%]
tests/test_auth_audit_logger.py::TestHelperFunctions::test_get_client_ip_forwarded PASSED [ 23%]
tests/test_auth_audit_logger.py::TestHelperFunctions::test_get_client_ip_no_client FAILED [ 23%]
tests/test_auth_audit_logger.py::TestHelperFunctions::test_get_user_agent PASSED [ 23%]
tests/test_auth_audit_logger.py::TestHelperFunctions::test_get_user_agent_missing PASSED [ 23%]
tests/test_auth_audit_logger.py::TestHelperFunctions::test_get_endpoint PASSED [ 23%]
tests/test_auth_audit_logger.py::TestHelperFunctions::test_get_endpoint_post PASSED [ 23%]
tests/test_auth_audit_logger.py::TestHelperFunctions::test_get_endpoint_no_url FAILED [ 23%]
tests/test_auth_audit_logger.py::TestAuditLoggerIntegration::test_full_success_flow PASSED [ 23%]
tests/test_auth_audit_logger.py::TestAuditLoggerIntegration::test_full_failure_flow PASSED [ 23%]
tests/test_auth_audit_logger.py::TestAuditLoggerIntegration::test_gibbon_token_flow PASSED [ 23%]
tests/test_auth_bridges.py::TestGibbonToAIRoleMapping::test_administrator_maps_to_admin PASSED [ 24%]
tests/test_auth_bridges.py::TestGibbonToAIRoleMapping::test_teacher_maps_to_teacher PASSED [ 24%]
tests/test_auth_bridges.py::TestGibbonToAIRoleMapping::test_student_maps_to_student PASSED [ 24%]
tests/test_auth_bridges.py::TestGibbonToAIRoleMapping::test_parent_maps_to_parent PASSED [ 24%]
tests/test_auth_bridges.py::TestGibbonToAIRoleMapping::test_support_staff_maps_to_staff PASSED [ 24%]
tests/test_auth_bridges.py::TestGibbonToAIRoleMapping::test_unknown_role_maps_to_user PASSED [ 24%]
tests/test_auth_bridges.py::TestGibbonToAIRoleMapping::test_empty_role_maps_to_user PASSED [ 24%]
tests/test_auth_bridges.py::TestAIToGibbonRoleMapping::test_admin_maps_to_administrator PASSED [ 24%]
tests/test_auth_bridges.py::TestAIToGibbonRoleMapping::test_teacher_maps_to_teacher PASSED [ 24%]
tests/test_auth_bridges.py::TestAIToGibbonRoleMapping::test_student_maps_to_student PASSED [ 24%]
tests/test_auth_bridges.py::TestAIToGibbonRoleMapping::test_parent_maps_to_parent PASSED [ 24%]
tests/test_auth_bridges.py::TestAIToGibbonRoleMapping::test_staff_maps_to_support_staff PASSED [ 24%]
tests/test_auth_bridges.py::TestAIToGibbonRoleMapping::test_user_role_has_no_gibbon_mapping PASSED [ 24%]
tests/test_auth_bridges.py::TestAIToGibbonRoleMapping::test_unknown_ai_role_returns_none PASSED [ 24%]
tests/test_auth_bridges.py::TestRoleValidation::test_valid_gibbon_roles PASSED [ 24%]
tests/test_auth_bridges.py::TestRoleValidation::test_invalid_gibbon_roles PASSED [ 24%]
tests/test_auth_bridges.py::TestRoleValidation::test_valid_ai_roles PASSED [ 24%]
tests/test_auth_bridges.py::TestRoleValidation::test_invalid_ai_roles PASSED [ 25%]
tests/test_auth_bridges.py::TestRoleValidation::test_validate_correct_mapping PASSED [ 25%]
tests/test_auth_bridges.py::TestRoleValidation::test_validate_incorrect_mapping PASSED [ 25%]
tests/test_auth_bridges.py::TestRoleValidation::test_validate_unknown_gibbon_role_maps_to_user PASSED [ 25%]
tests/test_auth_bridges.py::TestRoleMappingComplete::test_get_all_mappings_returns_dict PASSED [ 25%]
tests/test_auth_bridges.py::TestRoleMappingComplete::test_get_all_mappings_contains_all_roles PASSED [ 25%]
tests/test_auth_bridges.py::TestRoleMappingComplete::test_get_all_mappings_returns_copy PASSED [ 25%]
tests/test_auth_bridges.py::TestAccessControlHelpers::test_has_admin_access PASSED [ 25%]
tests/test_auth_bridges.py::TestAccessControlHelpers::test_has_educator_access PASSED [ 25%]
tests/test_auth_bridges.py::TestAccessControlHelpers::test_has_staff_access PASSED [ 25%]
tests/test_auth_bridges.py::TestRoleHierarchy::test_role_hierarchy_levels PASSED [ 25%]
tests/test_auth_bridges.py::TestRoleHierarchy::test_unknown_role_hierarchy PASSED [ 25%]
tests/test_auth_bridges.py::TestRoleHierarchy::test_admin_can_access_all_roles PASSED [ 25%]
tests/test_auth_bridges.py::TestRoleHierarchy::test_teacher_can_access_lower_roles PASSED [ 25%]
tests/test_auth_bridges.py::TestRoleHierarchy::test_staff_access_permissions PASSED [ 25%]
tests/test_auth_bridges.py::TestRoleHierarchy::test_student_limited_access PASSED [ 25%]
tests/test_auth_bridges.py::TestRoleHierarchy::test_parent_limited_access PASSED [ 25%]
tests/test_auth_bridges.py::TestRoleHierarchy::test_user_minimal_access PASSED [ 25%]
tests/test_auth_bridges.py::TestEnumDefinitions::test_gibbon_role_id_enum_values PASSED [ 26%]
tests/test_auth_bridges.py::TestEnumDefinitions::test_ai_service_role_enum_values PASSED [ 26%]
tests/test_auth_bridges.py::TestEnumDefinitions::test_gibbon_role_id_is_string_enum PASSED [ 26%]
tests/test_auth_bridges.py::TestEnumDefinitions::test_ai_service_role_is_string_enum PASSED [ 26%]
tests/test_auth_bridges.py::TestBidirectionalMapping::test_mapping_is_bidirectional_for_admin PASSED [ 26%]
tests/test_auth_bridges.py::TestBidirectionalMapping::test_mapping_is_bidirectional_for_teacher PASSED [ 26%]
tests/test_auth_bridges.py::TestBidirectionalMapping::test_mapping_is_bidirectional_for_student PASSED [ 26%]
tests/test_auth_bridges.py::TestBidirectionalMapping::test_mapping_is_bidirectional_for_parent PASSED [ 26%]
tests/test_auth_bridges.py::TestBidirectionalMapping::test_mapping_is_bidirectional_for_staff PASSED [ 26%]
tests/test_auth_bridges.py::TestBidirectionalMapping::test_user_role_has_no_reverse_mapping PASSED [ 26%]
tests/test_auth_endpoints.py::test_login_success ERROR                   [ 26%]
tests/test_auth_endpoints.py::test_login_invalid_email ERROR             [ 26%]
tests/test_auth_endpoints.py::test_login_invalid_password ERROR          [ 26%]
tests/test_auth_endpoints.py::test_login_inactive_user ERROR             [ 26%]
tests/test_auth_endpoints.py::test_refresh_valid_token ERROR             [ 26%]
tests/test_auth_endpoints.py::test_refresh_invalid_token ERROR           [ 26%]
tests/test_auth_endpoints.py::test_refresh_expired_token ERROR           [ 26%]
tests/test_auth_endpoints.py::test_refresh_with_access_token ERROR       [ 26%]
tests/test_auth_endpoints.py::test_logout_success ERROR                  [ 27%]
tests/test_auth_endpoints.py::test_logout_blacklisted_token_rejected ERROR [ 27%]
tests/test_auth_endpoints.py::test_password_reset_request ERROR          [ 27%]
tests/test_auth_endpoints.py::test_password_reset_request_nonexistent_email ERROR [ 27%]
tests/test_auth_endpoints.py::test_password_reset_confirm_valid ERROR    [ 27%]
tests/test_auth_endpoints.py::test_password_reset_confirm_invalid_token ERROR [ 27%]
tests/test_auth_endpoints.py::test_password_reset_confirm_expired_token ERROR [ 27%]
tests/test_auth_endpoints.py::test_password_reset_confirm_used_token ERROR [ 27%]
tests/test_auth_endpoints.py::test_password_not_stored_plaintext FAILED  [ 27%]
tests/test_auth_endpoints.py::test_integration_login_to_protected_endpoint ERROR [ 27%]
tests/test_auth_endpoints.py::test_admin_endpoint_as_admin ERROR         [ 27%]
tests/test_auth_endpoints.py::test_admin_endpoint_as_teacher ERROR       [ 27%]
tests/test_auth_endpoints.py::test_financial_endpoint_as_admin ERROR     [ 27%]
tests/test_auth_endpoints.py::test_financial_endpoint_as_accountant ERROR [ 27%]
tests/test_auth_endpoints.py::test_financial_endpoint_as_teacher ERROR   [ 27%]
tests/test_batch.py::TestBatchGet::test_batch_get_activities_success ERROR [ 27%]
tests/test_batch.py::TestBatchGet::test_batch_get_with_field_selection ERROR [ 27%]
tests/test_batch.py::TestBatchGet::test_batch_get_with_missing_resources ERROR [ 27%]
tests/test_batch.py::TestBatchGet::test_batch_get_all_missing ERROR      [ 28%]
tests/test_batch.py::TestBatchGet::test_batch_get_unsupported_resource_type ERROR [ 28%]
tests/test_batch.py::TestBatchGet::test_batch_get_empty_ids ERROR        [ 28%]
tests/test_batch.py::TestBatchGet::test_batch_get_too_many_ids ERROR     [ 28%]
tests/test_batch.py::TestBatchGet::test_batch_get_unauthenticated ERROR  [ 28%]
tests/test_batch.py::TestBatchActivityRecommendations::test_batch_recommendations_success ERROR [ 28%]
tests/test_batch.py::TestBatchActivityRecommendations::test_batch_recommendations_with_filters ERROR [ 28%]
tests/test_batch.py::TestBatchActivityRecommendations::test_batch_recommendations_multiple_children ERROR [ 28%]
tests/test_batch.py::TestBatchActivityRecommendations::test_batch_recommendations_empty_children ERROR [ 28%]
tests/test_batch.py::TestBatchActivityRecommendations::test_batch_recommendations_too_many_children ERROR [ 28%]
tests/test_batch.py::TestBatchActivityRecommendations::test_batch_recommendations_unauthenticated ERROR [ 28%]
tests/test_batch.py::TestBatchSchemas::test_batch_get_request_validation PASSED [ 28%]
tests/test_batch.py::TestBatchSchemas::test_batch_activity_recommendation_request_validation PASSED [ 28%]
tests/test_batch.py::TestBatchSchemas::test_batch_operation_result_structure PASSED [ 28%]
tests/test_coaching.py::test_guidance_includes_citations PASSED          [ 28%]
tests/test_coaching.py::test_guidance_includes_disclaimer PASSED         [ 28%]
tests/test_coaching.py::test_all_special_need_types PASSED               [ 28%]
tests/test_coaching.py::test_medical_question_detection PASSED           [ 28%]
tests/test_coaching.py::test_session_persistence PASSED                  [ 29%]
tests/test_coaching.py::test_citation_validation PASSED                  [ 29%]
tests/test_coaching.py::test_empty_sources_error PASSED                  [ 29%]
tests/test_communication.py::TestCommunicationServiceReportGeneration::test_generate_report_returns_valid_response PASSED [ 29%]
tests/test_communication.py::TestCommunicationServiceReportGeneration::test_generate_report_in_english PASSED [ 29%]
tests/test_communication.py::TestCommunicationServiceReportGeneration::test_generate_report_in_french PASSED [ 29%]
tests/test_communication.py::TestCommunicationServiceReportGeneration::test_generate_report_future_date_raises_error PASSED [ 29%]
tests/test_communication.py::TestCommunicationServiceReportGeneration::test_generate_report_includes_educator_notes PASSED [ 29%]
tests/test_communication.py::TestCommunicationServiceReportGeneration::test_generate_report_with_activities PASSED [ 29%]
tests/test_communication.py::TestCommunicationServiceHomeActivities::test_get_home_activities_returns_response PASSED [ 29%]
tests/test_communication.py::TestCommunicationServiceHomeActivities::test_get_home_activities_respects_limit PASSED [ 29%]
tests/test_communication.py::TestCommunicationServiceHomeActivities::test_get_home_activities_in_english PASSED [ 29%]
tests/test_communication.py::TestCommunicationServiceHomeActivities::test_get_home_activities_in_french PASSED [ 29%]
tests/test_communication.py::TestCommunicationServiceHomeActivities::test_home_activities_include_all_fields PASSED [ 29%]
tests/test_communication.py::TestCommunicationServiceHomeActivities::test_home_activities_cover_developmental_areas PASSED [ 29%]
tests/test_communication.py::TestCommunicationServicePreferences::test_get_or_create_preference_creates_new PASSED [ 29%]
tests/test_communication.py::TestCommunicationServicePreferences::test_get_or_create_preference_returns_existing PASSED [ 29%]
tests/test_communication.py::TestCommunicationServicePreferences::test_update_preference_changes_language PASSED [ 29%]
tests/test_communication.py::TestCommunicationServicePreferences::test_update_preference_changes_frequency PASSED [ 30%]
tests/test_communication.py::TestCommunicationServicePreferences::test_get_preference_by_parent_returns_none PASSED [ 30%]
tests/test_communication.py::TestCommunicationServicePreferences::test_get_preference_by_parent_returns_preference PASSED [ 30%]
tests/test_communication.py::TestReportGenerationEndpoint::test_generate_report_success ERROR [ 30%]
tests/test_communication.py::TestReportGenerationEndpoint::test_generate_report_french ERROR [ 30%]
tests/test_communication.py::TestReportGenerationEndpoint::test_generate_report_requires_auth ERROR [ 30%]
tests/test_communication.py::TestReportGenerationEndpoint::test_generate_report_invalid_child_id ERROR [ 30%]
tests/test_communication.py::TestReportGenerationEndpoint::test_generate_report_future_date_error ERROR [ 30%]
tests/test_communication.py::TestHomeActivitiesEndpoint::test_get_home_activities_success ERROR [ 30%]
tests/test_communication.py::TestHomeActivitiesEndpoint::test_get_home_activities_with_french ERROR [ 30%]
tests/test_communication.py::TestHomeActivitiesEndpoint::test_get_home_activities_with_limit ERROR [ 30%]
tests/test_communication.py::TestHomeActivitiesEndpoint::test_get_home_activities_requires_auth ERROR [ 30%]
tests/test_communication.py::TestHomeActivitiesEndpoint::test_get_home_activities_invalid_limit ERROR [ 30%]
tests/test_communication.py::TestCommunicationPreferencesEndpoint::test_create_preferences_success ERROR [ 30%]
tests/test_communication.py::TestCommunicationPreferencesEndpoint::test_create_preferences_french ERROR [ 30%]
tests/test_communication.py::TestCommunicationPreferencesEndpoint::test_create_preferences_requires_auth ERROR [ 30%]
tests/test_communication.py::TestCommunicationPreferencesEndpoint::test_get_preferences_success ERROR [ 30%]
tests/test_communication.py::TestCommunicationPreferencesEndpoint::test_get_preferences_not_found ERROR [ 30%]
tests/test_communication.py::TestCommunicationPreferencesEndpoint::test_get_preferences_requires_auth ERROR [ 31%]
tests/test_communication.py::TestBilingualSupport::test_all_developmental_areas_in_english PASSED [ 31%]
tests/test_communication.py::TestBilingualSupport::test_all_developmental_areas_in_french PASSED [ 31%]
tests/test_communication.py::TestBilingualSupport::test_language_enum_values PASSED [ 31%]
tests/test_communication.py::TestBilingualSupport::test_report_frequency_enum_values PASSED [ 31%]
tests/test_communication.py::TestBilingualSupport::test_developmental_area_enum_completeness PASSED [ 31%]
tests/test_communication.py::TestEdgeCasesAndErrorHandling::test_report_for_today PASSED [ 31%]
tests/test_communication.py::TestEdgeCasesAndErrorHandling::test_report_for_past_date PASSED [ 31%]
tests/test_communication.py::TestEdgeCasesAndErrorHandling::test_home_activities_empty_child_history PASSED [ 31%]
tests/test_communication.py::TestEdgeCasesAndErrorHandling::test_preference_update_creates_if_not_exists PASSED [ 31%]
tests/test_communication.py::TestEdgeCasesAndErrorHandling::test_api_invalid_uuid_format ERROR [ 31%]
tests/test_communication.py::TestEdgeCasesAndErrorHandling::test_api_missing_required_fields ERROR [ 31%]
tests/test_communication.py::TestCommunicationFixtures::test_sample_parent_report_fixture PASSED [ 31%]
tests/test_communication.py::TestCommunicationFixtures::test_sample_french_parent_report_fixture PASSED [ 31%]
tests/test_communication.py::TestCommunicationFixtures::test_sample_home_activity_fixture PASSED [ 31%]
tests/test_communication.py::TestCommunicationFixtures::test_sample_communication_preference_fixture PASSED [ 31%]
tests/test_communication.py::TestCommunicationFixtures::test_sample_home_activities_list_fixture PASSED [ 31%]
tests/test_communication.py::TestCommunicationFixtures::test_mock_parent_report_repr PASSED [ 31%]
tests/test_communication.py::TestCommunicationFixtures::test_mock_home_activity_repr PASSED [ 32%]
tests/test_communication.py::TestCommunicationFixtures::test_mock_communication_preference_repr PASSED [ 32%]
tests/test_data_integrity.py::TestIntegrityCheckResult::test_result_initialization PASSED [ 32%]
tests/test_data_integrity.py::TestIntegrityCheckResult::test_add_issue PASSED [ 32%]
tests/test_data_integrity.py::TestIntegrityCheckResult::test_add_warning PASSED [ 32%]
tests/test_data_integrity.py::TestIntegrityCheckResult::test_add_info PASSED [ 32%]
tests/test_data_integrity.py::TestActivityIntegrity::test_valid_activity ERROR [ 32%]
tests/test_data_integrity.py::TestActivityIntegrity::test_activity_invalid_age_range ERROR [ 32%]
tests/test_data_integrity.py::TestActivityIntegrity::test_activity_negative_age ERROR [ 32%]
tests/test_data_integrity.py::TestActivityIntegrity::test_activity_invalid_duration ERROR [ 32%]
tests/test_data_integrity.py::TestActivityIntegrity::test_activity_empty_name ERROR [ 32%]
tests/test_data_integrity.py::TestActivityParticipationIntegrity::test_valid_participation ERROR [ 32%]
tests/test_data_integrity.py::TestActivityParticipationIntegrity::test_participation_invalid_dates ERROR [ 32%]
tests/test_data_integrity.py::TestActivityParticipationIntegrity::test_participation_invalid_engagement_score ERROR [ 32%]
tests/test_data_integrity.py::TestActivityParticipationIntegrity::test_participation_status_mismatch ERROR [ 32%]
tests/test_data_integrity.py::TestCoachingSessionIntegrity::test_valid_coaching_session ERROR [ 32%]
tests/test_data_integrity.py::TestCoachingSessionIntegrity::test_coaching_session_empty_question ERROR [ 32%]
tests/test_data_integrity.py::TestCoachingRecommendationIntegrity::test_valid_coaching_recommendation ERROR [ 32%]
tests/test_data_integrity.py::TestCoachingRecommendationIntegrity::test_recommendation_invalid_relevance_score ERROR [ 33%]
tests/test_data_integrity.py::TestCoachingRecommendationIntegrity::test_recommendation_invalid_priority ERROR [ 33%]
tests/test_data_integrity.py::TestOrphanedRecords::test_detect_orphaned_participation ERROR [ 33%]
tests/test_data_integrity.py::TestOrphanedRecords::test_detect_orphaned_evidence_source ERROR [ 33%]
tests/test_data_integrity.py::TestOrphanedRecords::test_fix_orphaned_records ERROR [ 33%]
tests/test_data_integrity.py::TestParentReportIntegrity::test_valid_parent_report ERROR [ 33%]
tests/test_data_integrity.py::TestCommunicationPreferenceIntegrity::test_valid_preference ERROR [ 33%]
tests/test_data_integrity.py::TestCommunicationPreferenceIntegrity::test_preference_no_channels_enabled ERROR [ 33%]
tests/test_data_integrity.py::TestFullVerification::test_run_all_checks ERROR [ 33%]
tests/test_data_integrity.py::TestFullVerification::test_run_full_checks ERROR [ 33%]
tests/test_development_profile.py::TestDevelopmentProfileModel::test_create_profile_with_all_fields PASSED [ 33%]
tests/test_development_profile.py::TestDevelopmentProfileModel::test_profile_repr PASSED [ 33%]
tests/test_development_profile.py::TestDevelopmentProfileModel::test_profile_default_values PASSED [ 33%]
tests/test_development_profile.py::TestSkillAssessmentModel::test_create_skill_assessment PASSED [ 33%]
tests/test_development_profile.py::TestSkillAssessmentModel::test_skill_assessment_repr PASSED [ 33%]
tests/test_development_profile.py::TestSkillAssessmentModel::test_skill_assessment_status_options PASSED [ 33%]
tests/test_development_profile.py::TestObservationModel::test_create_observation PASSED [ 33%]
tests/test_development_profile.py::TestObservationModel::test_observation_repr PASSED [ 33%]
tests/test_development_profile.py::TestObservationModel::test_observation_with_concern_flag PASSED [ 34%]
tests/test_development_profile.py::TestMonthlySnapshotModel::test_create_monthly_snapshot PASSED [ 34%]
tests/test_development_profile.py::TestMonthlySnapshotModel::test_monthly_snapshot_repr PASSED [ 34%]
tests/test_development_profile.py::TestMonthlySnapshotModel::test_monthly_snapshot_progress_values PASSED [ 34%]
tests/test_development_profile.py::TestQuebecDevelopmentalDomains::test_skill_assessments_cover_all_domains PASSED [ 34%]
tests/test_development_profile.py::TestQuebecDevelopmentalDomains::test_observations_cover_all_domains PASSED [ 34%]
tests/test_development_profile.py::TestQuebecDevelopmentalDomains::test_domain_specific_assessments PASSED [ 34%]
tests/test_development_profile.py::TestQuebecDevelopmentalDomains::test_bilingual_skill_names PASSED [ 34%]
tests/test_development_profile.py::TestCreateProfileEndpoint::test_create_profile_returns_201 SKIPPED [ 34%]
tests/test_development_profile.py::TestCreateProfileEndpoint::test_create_profile_requires_auth ERROR [ 34%]
tests/test_development_profile.py::TestCreateProfileEndpoint::test_create_duplicate_profile_fails ERROR [ 34%]
tests/test_development_profile.py::TestGetProfileEndpoint::test_get_profile_returns_200 ERROR [ 34%]
tests/test_development_profile.py::TestGetProfileEndpoint::test_get_profile_requires_auth ERROR [ 34%]
tests/test_development_profile.py::TestGetProfileEndpoint::test_get_profile_not_found ERROR [ 34%]
tests/test_development_profile.py::TestGetProfileByChildEndpoint::test_get_profile_by_child_returns_200 ERROR [ 34%]
tests/test_development_profile.py::TestGetProfileByChildEndpoint::test_get_profile_by_child_not_found ERROR [ 34%]
tests/test_development_profile.py::TestListProfilesEndpoint::test_list_profiles_returns_200 ERROR [ 34%]
tests/test_development_profile.py::TestListProfilesEndpoint::test_list_profiles_pagination ERROR [ 34%]
tests/test_development_profile.py::TestSkillAssessmentEndpoints::test_create_assessment_returns_201 ERROR [ 35%]
tests/test_development_profile.py::TestSkillAssessmentEndpoints::test_list_assessments_returns_200 SKIPPED [ 35%]
tests/test_development_profile.py::TestSkillAssessmentEndpoints::test_list_assessments_filter_by_domain ERROR [ 35%]
tests/test_development_profile.py::TestSkillAssessmentEndpoints::test_update_assessment_returns_200 SKIPPED [ 35%]
tests/test_development_profile.py::TestSkillAssessmentEndpoints::test_delete_assessment_returns_204 SKIPPED [ 35%]
tests/test_development_profile.py::TestObservationEndpoints::test_create_observation_returns_201 ERROR [ 35%]
tests/test_development_profile.py::TestObservationEndpoints::test_list_observations_returns_200 SKIPPED [ 35%]
tests/test_development_profile.py::TestObservationEndpoints::test_list_observations_filter_by_milestone SKIPPED [ 35%]
tests/test_development_profile.py::TestObservationEndpoints::test_list_observations_filter_by_concern SKIPPED [ 35%]
tests/test_development_profile.py::TestObservationEndpoints::test_update_observation_returns_200 SKIPPED [ 35%]
tests/test_development_profile.py::TestObservationEndpoints::test_delete_observation_returns_204 SKIPPED [ 35%]
tests/test_development_profile.py::TestMonthlySnapshotEndpoints::test_create_snapshot_returns_201 ERROR [ 35%]
tests/test_development_profile.py::TestMonthlySnapshotEndpoints::test_list_snapshots_returns_200 ERROR [ 35%]
tests/test_development_profile.py::TestMonthlySnapshotEndpoints::test_get_snapshot_returns_200 ERROR [ 35%]
tests/test_development_profile.py::TestMonthlySnapshotEndpoints::test_update_snapshot_returns_200 SKIPPED [ 35%]
tests/test_development_profile.py::TestMonthlySnapshotEndpoints::test_delete_snapshot_returns_204 ERROR [ 35%]
tests/test_development_profile.py::TestGrowthTrajectoryEndpoint::test_get_trajectory_returns_200 SKIPPED [ 35%]
tests/test_development_profile.py::TestGrowthTrajectoryEndpoint::test_get_trajectory_with_snapshots SKIPPED [ 35%]
tests/test_development_profile.py::TestGrowthTrajectoryEndpoint::test_get_trajectory_not_found ERROR [ 36%]
tests/test_development_profile.py::TestEdgeCases::test_invalid_uuid_format ERROR [ 36%]
tests/test_development_profile.py::TestEdgeCases::test_profile_id_mismatch_in_assessment ERROR [ 36%]
tests/test_development_profile.py::TestEdgeCases::test_invalid_domain_value ERROR [ 36%]
tests/test_development_profile.py::TestEdgeCases::test_invalid_skill_status ERROR [ 36%]
tests/test_development_profile.py::TestEdgeCases::test_expired_token_rejected ERROR [ 36%]
tests/test_development_profile.py::TestEdgeCases::test_assessment_for_nonexistent_profile ERROR [ 36%]
tests/test_development_profile.py::TestEdgeCases::test_empty_behavior_description_rejected ERROR [ 36%]
tests/test_development_profile.py::TestProfileUpdateDelete::test_update_profile_returns_200 SKIPPED [ 36%]
tests/test_development_profile.py::TestProfileUpdateDelete::test_delete_profile_returns_204 SKIPPED [ 36%]
tests/test_development_profile_authorization.py::TestDevelopmentProfileAuthorization::test_get_profile_by_id_unauthorized PASSED [ 36%]
tests/test_development_profile_authorization.py::TestDevelopmentProfileAuthorization::test_get_profile_by_id_authorized PASSED [ 36%]
tests/test_development_profile_authorization.py::TestDevelopmentProfileAuthorization::test_get_profile_by_child_id_unauthorized PASSED [ 36%]
tests/test_development_profile_authorization.py::TestDevelopmentProfileAuthorization::test_get_profile_by_child_id_authorized PASSED [ 36%]
tests/test_development_profile_authorization.py::TestDevelopmentProfileAuthorization::test_update_profile_unauthorized PASSED [ 36%]
tests/test_development_profile_authorization.py::TestDevelopmentProfileAuthorization::test_update_profile_authorized FAILED [ 36%]
tests/test_development_profile_authorization.py::TestSkillAssessmentAuthorization::test_get_skill_assessment_unauthorized PASSED [ 36%]
tests/test_development_profile_authorization.py::TestSkillAssessmentAuthorization::test_get_skill_assessment_authorized PASSED [ 36%]
tests/test_development_profile_authorization.py::TestSkillAssessmentAuthorization::test_update_skill_assessment_unauthorized PASSED [ 37%]
tests/test_development_profile_authorization.py::TestSkillAssessmentAuthorization::test_update_skill_assessment_authorized FAILED [ 37%]
tests/test_development_profile_authorization.py::TestObservationAuthorization::test_get_observation_unauthorized PASSED [ 37%]
tests/test_development_profile_authorization.py::TestObservationAuthorization::test_get_observation_authorized PASSED [ 37%]
tests/test_development_profile_authorization.py::TestObservationAuthorization::test_update_observation_unauthorized PASSED [ 37%]
tests/test_development_profile_authorization.py::TestObservationAuthorization::test_update_observation_authorized FAILED [ 37%]
tests/test_development_profile_authorization.py::TestMonthlySnapshotAuthorization::test_get_monthly_snapshot_unauthorized PASSED [ 37%]
tests/test_development_profile_authorization.py::TestMonthlySnapshotAuthorization::test_get_monthly_snapshot_authorized PASSED [ 37%]
tests/test_development_profile_authorization.py::TestMonthlySnapshotAuthorization::test_update_monthly_snapshot_unauthorized PASSED [ 37%]
tests/test_development_profile_authorization.py::TestMonthlySnapshotAuthorization::test_update_monthly_snapshot_authorized FAILED [ 37%]
tests/test_development_profile_authorization.py::TestGrowthTrajectoryAuthorization::test_get_growth_trajectory_unauthorized PASSED [ 37%]
tests/test_development_profile_authorization.py::TestGrowthTrajectoryAuthorization::test_get_growth_trajectory_authorized FAILED [ 37%]
tests/test_development_profile_authorization.py::TestIDORPrevention::test_cannot_access_another_educators_profile PASSED [ 37%]
tests/test_development_profile_authorization.py::TestIDORPrevention::test_cannot_update_another_educators_assessment PASSED [ 37%]
tests/test_development_profile_authorization.py::TestIDORPrevention::test_cannot_access_another_educators_observations PASSED [ 37%]
tests/test_development_profile_authorization.py::TestIDORPrevention::test_cannot_access_another_educators_snapshots PASSED [ 37%]
tests/test_document_authorization.py::TestDocumentAuthorization::test_creator_can_access_document PASSED [ 37%]
tests/test_document_authorization.py::TestDocumentAuthorization::test_non_creator_cannot_access_document PASSED [ 37%]
tests/test_document_authorization.py::TestDocumentAuthorization::test_creator_can_update_document PASSED [ 38%]
tests/test_document_authorization.py::TestDocumentAuthorization::test_non_creator_cannot_update_document PASSED [ 38%]
tests/test_document_authorization.py::TestDocumentAuthorization::test_authorization_with_nonexistent_document PASSED [ 38%]
tests/test_document_authorization.py::TestDocumentAuthorization::test_multiple_documents_authorization PASSED [ 38%]
tests/test_document_authorization.py::TestDocumentAuthorization::test_user_has_document_access_helper PASSED [ 38%]
tests/test_document_models.py::test_create_document PASSED               [ 38%]
tests/test_document_models.py::test_document_status_transitions PASSED   [ 38%]
tests/test_document_models.py::test_create_document_template PASSED      [ 38%]
tests/test_document_models.py::test_template_version_increment PASSED    [ 38%]
tests/test_document_models.py::test_create_signature PASSED              [ 38%]
tests/test_document_models.py::test_signature_cascade_delete PASSED      [ 38%]
tests/test_document_models.py::test_create_signature_request PASSED      [ 38%]
tests/test_document_models.py::test_signature_request_status_flow PASSED [ 38%]
tests/test_document_models.py::test_create_audit_log PASSED              [ 38%]
tests/test_document_models.py::test_audit_log_all_event_types PASSED     [ 38%]
tests/test_document_models.py::test_audit_log_with_foreign_keys PASSED   [ 38%]
tests/test_document_routes.py::test_create_template_success ERROR        [ 38%]
tests/test_document_routes.py::test_create_template_requires_auth ERROR  [ 38%]
tests/test_document_routes.py::test_get_template_success ERROR           [ 39%]
tests/test_document_routes.py::test_get_template_not_found ERROR         [ 39%]
tests/test_document_routes.py::test_list_templates_pagination ERROR      [ 39%]
tests/test_document_routes.py::test_update_template_success ERROR        [ 39%]
tests/test_document_routes.py::test_delete_template_success ERROR        [ 39%]
tests/test_document_routes.py::test_create_document_success ERROR        [ 39%]
tests/test_document_routes.py::test_create_document_from_template_success ERROR [ 39%]
tests/test_document_routes.py::test_get_document_success ERROR           [ 39%]
tests/test_document_routes.py::test_get_document_not_found ERROR         [ 39%]
tests/test_document_routes.py::test_list_documents_with_filters ERROR    [ 39%]
tests/test_document_routes.py::test_update_document_success ERROR        [ 39%]
tests/test_document_routes.py::test_create_signature_success ERROR       [ 39%]
tests/test_document_routes.py::test_get_signatures_for_document ERROR    [ 39%]
tests/test_document_routes.py::test_send_signature_request_success ERROR [ 39%]
tests/test_document_routes.py::test_mark_signature_request_viewed ERROR  [ 39%]
tests/test_document_routes.py::test_get_signature_requests_for_signer ERROR [ 39%]
tests/test_document_routes.py::test_get_dashboard_success ERROR          [ 39%]
tests/test_document_routes.py::test_get_audit_logs_for_document ERROR    [ 39%]
tests/test_document_routes.py::test_invalid_document_type_returns_422 ERROR [ 40%]
tests/test_document_routes.py::test_missing_required_fields_returns_422 ERROR [ 40%]
tests/test_document_service.py::test_create_template PASSED              [ 40%]
tests/test_document_service.py::test_get_template_by_id FAILED           [ 40%]
tests/test_document_service.py::test_get_template_by_id_not_found PASSED [ 40%]
tests/test_document_service.py::test_list_templates_pagination FAILED    [ 40%]
tests/test_document_service.py::test_update_template_increments_version FAILED [ 40%]
tests/test_document_service.py::test_delete_template FAILED              [ 40%]
tests/test_document_service.py::test_create_document PASSED              [ 40%]
tests/test_document_service.py::test_create_document_from_template FAILED [ 40%]
tests/test_document_service.py::test_get_document_by_id FAILED           [ 40%]
tests/test_document_service.py::test_list_documents_with_filters FAILED  [ 40%]
tests/test_document_service.py::test_update_document_status PASSED       [ 40%]
tests/test_document_service.py::test_create_signature_updates_document_status FAILED [ 40%]
tests/test_document_service.py::test_get_signatures_for_document FAILED  [ 40%]
tests/test_document_service.py::test_send_signature_request FAILED       [ 40%]
tests/test_document_service.py::test_mark_request_viewed FAILED          [ 40%]
tests/test_document_service.py::test_complete_signature_request_flow FAILED [ 40%]
tests/test_document_service.py::test_get_signature_dashboard FAILED      [ 41%]
tests/test_document_service.py::test_create_audit_log FAILED             [ 41%]
tests/test_document_service.py::test_get_audit_logs_for_document PASSED  [ 41%]
tests/test_document_service.py::test_signature_creates_audit_log FAILED  [ 41%]
tests/test_idor_protection_integration.py::TestDocumentIDORProtection::test_get_document_by_id_idor_protection ERROR [ 41%]
tests/test_idor_protection_integration.py::TestDocumentIDORProtection::test_update_document_idor_protection ERROR [ 41%]
tests/test_idor_protection_integration.py::TestDocumentIDORProtection::test_document_access_isolation_between_users ERROR [ 41%]
tests/test_idor_protection_integration.py::TestDocumentIDORProtection::test_cross_resource_idor_protection ERROR [ 41%]
tests/test_intervention_plans.py::test_service_initialization PASSED     [ 41%]
tests/test_intervention_plans.py::test_all_review_schedules_have_months_delta PASSED [ 41%]
tests/test_intervention_plans.py::test_calculate_next_review_date_monthly PASSED [ 41%]
tests/test_intervention_plans.py::test_calculate_next_review_date_quarterly PASSED [ 41%]
tests/test_intervention_plans.py::test_calculate_next_review_date_semi_annually PASSED [ 41%]
tests/test_intervention_plans.py::test_calculate_next_review_date_annually PASSED [ 41%]
tests/test_intervention_plans.py::test_add_months_handles_end_of_month PASSED [ 41%]
tests/test_intervention_plans.py::test_add_months_year_rollover PASSED   [ 41%]
tests/test_intervention_plans.py::test_all_plan_statuses_valid PASSED    [ 41%]
tests/test_intervention_plans.py::test_plan_status_transitions PASSED    [ 41%]
tests/test_intervention_plans.py::test_all_strength_categories_valid PASSED [ 42%]
tests/test_intervention_plans.py::test_all_need_categories_valid PASSED  [ 42%]
tests/test_intervention_plans.py::test_all_need_priorities_valid PASSED  [ 42%]
tests/test_intervention_plans.py::test_all_goal_statuses_valid PASSED    [ 42%]
tests/test_intervention_plans.py::test_all_progress_levels_valid PASSED  [ 42%]
tests/test_intervention_plans.py::test_all_responsible_parties_valid PASSED [ 42%]
tests/test_intervention_plans.py::test_all_monitoring_methods_valid PASSED [ 42%]
tests/test_intervention_plans.py::test_all_parent_activity_types_valid PASSED [ 42%]
tests/test_intervention_plans.py::test_all_specialist_types_valid PASSED [ 42%]
tests/test_intervention_plans.py::test_plan_create_schema_valid PASSED   [ 42%]
tests/test_intervention_plans.py::test_plan_create_schema_with_sections PASSED [ 42%]
tests/test_intervention_plans.py::test_plan_update_schema_partial PASSED [ 42%]
tests/test_intervention_plans.py::test_generate_change_summary_single_field PASSED [ 42%]
tests/test_intervention_plans.py::test_generate_change_summary_multiple_fields PASSED [ 42%]
tests/test_intervention_plans.py::test_generate_change_summary_empty_update PASSED [ 42%]
tests/test_intervention_plans.py::test_strength_create_schema PASSED     [ 42%]
tests/test_intervention_plans.py::test_need_create_schema PASSED         [ 42%]
tests/test_intervention_plans.py::test_need_create_schema_default_priority PASSED [ 42%]
tests/test_intervention_plans.py::test_smart_goal_create_schema PASSED   [ 43%]
tests/test_intervention_plans.py::test_smart_goal_create_schema_defaults PASSED [ 43%]
tests/test_intervention_plans.py::test_strategy_create_schema PASSED     [ 43%]
tests/test_intervention_plans.py::test_strategy_create_schema_default_responsible_party PASSED [ 43%]
tests/test_intervention_plans.py::test_monitoring_create_schema PASSED   [ 43%]
tests/test_intervention_plans.py::test_parent_involvement_create_schema PASSED [ 43%]
tests/test_intervention_plans.py::test_consultation_create_schema PASSED [ 43%]
tests/test_intervention_plans.py::test_progress_create_schema PASSED     [ 43%]
tests/test_intervention_plans.py::test_progress_create_schema_default_level PASSED [ 43%]
tests/test_intervention_plans.py::test_parent_signature_request_schema PASSED [ 43%]
tests/test_intervention_plans.py::test_parent_signature_request_default_agreed PASSED [ 43%]
tests/test_intervention_plans.py::test_plan_not_found_error PASSED       [ 43%]
tests/test_intervention_plans.py::test_invalid_plan_error PASSED         [ 43%]
tests/test_intervention_plans.py::test_progress_level_percentage_mapping PASSED [ 43%]
tests/test_intervention_plans.py::test_create_strength_model_helper PASSED [ 43%]
tests/test_intervention_plans.py::test_create_need_model_helper PASSED   [ 43%]
tests/test_intervention_plans.py::test_create_goal_model_helper PASSED   [ 43%]
tests/test_intervention_plans.py::test_create_strategy_model_helper PASSED [ 43%]
tests/test_intervention_plans.py::test_create_monitoring_model_helper PASSED [ 44%]
tests/test_intervention_plans.py::test_create_parent_involvement_model_helper PASSED [ 44%]
tests/test_intervention_plans.py::test_create_consultation_model_helper PASSED [ 44%]
tests/test_intervention_plans.py::test_create_plan_calls_db_methods PASSED [ 44%]
tests/test_intervention_plans.py::test_get_plan_raises_not_found PASSED  [ 44%]
tests/test_intervention_plans.py::test_update_plan_raises_not_found PASSED [ 44%]
tests/test_intervention_plans.py::test_delete_plan_raises_not_found PASSED [ 44%]
tests/test_intervention_plans.py::test_delete_plan_archives_instead_of_hard_delete PASSED [ 44%]
tests/test_intervention_plans.py::test_sign_plan_raises_not_found PASSED [ 44%]
tests/test_intervention_plans.py::test_sign_plan_raises_invalid_if_already_signed PASSED [ 44%]
tests/test_intervention_plans.py::test_sign_plan_raises_invalid_if_terms_not_agreed PASSED [ 44%]
tests/test_intervention_plans.py::test_sign_plan_success PASSED          [ 44%]
tests/test_intervention_plans.py::test_add_progress_raises_not_found PASSED [ 44%]
tests/test_intervention_plans.py::test_create_version_raises_not_found PASSED [ 44%]
tests/test_intervention_plans.py::test_get_plan_history_raises_not_found PASSED [ 44%]
tests/test_intervention_plans.py::test_verify_plan_exists_raises_not_found PASSED [ 44%]
tests/test_intervention_plans.py::test_verify_plan_exists_returns_plan PASSED [ 44%]
tests/test_intervention_plans.py::test_add_strength_calls_verify_and_commit PASSED [ 44%]
tests/test_intervention_plans.py::test_add_need_calls_verify_and_commit PASSED [ 45%]
tests/test_intervention_plans.py::test_add_goal_calls_verify_and_commit PASSED [ 45%]
tests/test_intervention_plans.py::test_add_strategy_calls_verify_and_commit PASSED [ 45%]
tests/test_intervention_plans.py::test_add_monitoring_calls_verify_and_commit PASSED [ 45%]
tests/test_intervention_plans.py::test_add_parent_involvement_calls_verify_and_commit PASSED [ 45%]
tests/test_intervention_plans.py::test_add_consultation_calls_verify_and_commit PASSED [ 45%]
tests/test_intervention_plans_router.py::TestInterventionPlanHealthEndpoint::test_health_check_returns_ok ERROR [ 45%]
tests/test_intervention_plans_router.py::TestInterventionPlanHealthEndpoint::test_health_check_no_auth_required ERROR [ 45%]
tests/test_intervention_plans_router.py::TestEndpointPathIntegration::test_list_plans_endpoint_path ERROR [ 45%]
tests/test_intervention_plans_router.py::TestEndpointPathIntegration::test_single_plan_endpoint_path ERROR [ 45%]
tests/test_intervention_plans_router.py::TestEndpointPathIntegration::test_pending_review_endpoint_path ERROR [ 45%]
tests/test_intervention_plans_router.py::TestEndpointPathIntegration::test_plan_history_endpoint_path ERROR [ 45%]
tests/test_intervention_plans_router.py::TestEndpointPathIntegration::test_plan_progress_endpoint_path ERROR [ 45%]
tests/test_intervention_plans_router.py::TestEndpointPathIntegration::test_plan_sign_endpoint_path ERROR [ 45%]
tests/test_intervention_plans_router.py::TestEndpointPathIntegration::test_plan_version_endpoint_path ERROR [ 45%]
tests/test_intervention_plans_router.py::TestSectionCRUDEndpoints::test_strengths_endpoint_exists ERROR [ 45%]
tests/test_intervention_plans_router.py::TestSectionCRUDEndpoints::test_needs_endpoint_exists ERROR [ 45%]
tests/test_intervention_plans_router.py::TestSectionCRUDEndpoints::test_goals_endpoint_exists ERROR [ 45%]
tests/test_intervention_plans_router.py::TestSectionCRUDEndpoints::test_strategies_endpoint_exists ERROR [ 46%]
tests/test_intervention_plans_router.py::TestSectionCRUDEndpoints::test_monitoring_endpoint_exists ERROR [ 46%]
tests/test_intervention_plans_router.py::TestSectionCRUDEndpoints::test_parent_involvement_endpoint_exists ERROR [ 46%]
tests/test_intervention_plans_router.py::TestSectionCRUDEndpoints::test_consultations_endpoint_exists ERROR [ 46%]
tests/test_intervention_plans_router.py::TestAuthenticationRequired::test_list_plans_requires_auth ERROR [ 46%]
tests/test_intervention_plans_router.py::TestAuthenticationRequired::test_create_plan_requires_auth ERROR [ 46%]
tests/test_intervention_plans_router.py::TestAuthenticationRequired::test_get_plan_requires_auth ERROR [ 46%]
tests/test_intervention_plans_router.py::TestAuthenticationRequired::test_update_plan_requires_auth ERROR [ 46%]
tests/test_intervention_plans_router.py::TestAuthenticationRequired::test_delete_plan_requires_auth ERROR [ 46%]
tests/test_intervention_plans_router.py::TestAuthenticationRequired::test_sign_plan_requires_auth ERROR [ 46%]
tests/test_intervention_plans_router.py::TestAuthenticationRequired::test_pending_review_requires_auth ERROR [ 46%]
tests/test_intervention_plans_router.py::TestErrorHandling::test_invalid_plan_id_returns_404 ERROR [ 46%]
tests/test_intervention_plans_router.py::TestErrorHandling::test_malformed_uuid_returns_422 ERROR [ 46%]
tests/test_intervention_plans_router.py::TestCrossServiceEndpointVerification::test_endpoint_contract_documentation PASSED [ 46%]
tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_signature_endpoint_accepts_valid_request_format ERROR [ 46%]
tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_signature_endpoint_matches_parent_portal_client_path ERROR [ 46%]
tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_get_plan_includes_signature_status_field ERROR [ 46%]
tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_list_plans_supports_parent_signed_filter ERROR [ 46%]
tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_list_plans_supports_status_filter ERROR [ 47%]
tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_signature_requires_authentication ERROR [ 47%]
tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_signature_rejects_missing_signature_data ERROR [ 47%]
tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_signature_request_with_base64_image ERROR [ 47%]
tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_signature_request_with_large_base64_data ERROR [ 47%]
tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_signature_response_format_for_gibbon_sync ERROR [ 47%]
tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_plan_details_endpoint_supports_gibbon_display ERROR [ 47%]
tests/test_intervention_plans_router.py::TestParentSignatureSchemaValidation::test_signature_request_snake_case_field_names ERROR [ 47%]
tests/test_intervention_plans_router.py::TestParentSignatureSchemaValidation::test_signature_response_contains_expected_fields ERROR [ 47%]
tests/test_intervention_plans_router.py::TestParentSignatureSchemaValidation::test_signature_validates_agreed_to_terms_required ERROR [ 47%]
tests/test_intervention_plans_router.py::TestCrossServiceSignatureIntegration::test_parent_portal_signature_endpoint_contract PASSED [ 47%]
tests/test_intervention_plans_router.py::TestCrossServiceSignatureIntegration::test_gibbon_signature_display_contract PASSED [ 47%]
tests/test_intervention_plans_router.py::TestCrossServiceSignatureIntegration::test_signature_workflow_steps_documented PASSED [ 47%]
tests/test_intervention_plans_router.py::TestCrossServiceSignatureIntegration::test_parent_portal_awaiting_signature_flow ERROR [ 47%]
tests/test_intervention_plans_router.py::TestCrossServiceSignatureIntegration::test_parent_portal_child_summary_flow ERROR [ 47%]
tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_create_plan_with_monthly_review_schedule ERROR [ 47%]
tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_create_plan_with_quarterly_review_schedule ERROR [ 47%]
tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_create_plan_with_semi_annual_review_schedule ERROR [ 47%]
tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_create_plan_with_annual_review_schedule ERROR [ 48%]
tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_create_plan_rejects_invalid_review_schedule ERROR [ 48%]
tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_pending_review_endpoint_exists ERROR [ 48%]
tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_pending_review_returns_list_response ERROR [ 48%]
tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_pending_review_accepts_days_ahead_parameter ERROR [ 48%]
tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_pending_review_accepts_30_days_ahead ERROR [ 48%]
tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_pending_review_rejects_invalid_days_ahead ERROR [ 48%]
tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_pending_review_rejects_zero_days_ahead ERROR [ 48%]
tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_pending_review_rejects_too_large_days_ahead ERROR [ 48%]
tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_review_reminder_structure_matches_parent_portal ERROR [ 48%]
tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_review_reminder_days_until_can_be_negative ERROR [ 48%]
tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_overdue_count_in_response ERROR [ 48%]
tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_upcoming_count_in_response ERROR [ 48%]
tests/test_intervention_plans_router.py::TestReviewReminderCrossServiceIntegration::test_review_reminder_endpoint_contract PASSED [ 48%]
tests/test_intervention_plans_router.py::TestReviewReminderCrossServiceIntegration::test_review_reminder_plan_fields_documented PASSED [ 48%]
tests/test_intervention_plans_router.py::TestReviewReminderCrossServiceIntegration::test_gibbon_review_workflow_documented PASSED [ 48%]
tests/test_intervention_plans_router.py::TestReviewReminderCrossServiceIntegration::test_parent_portal_review_summary_flow ERROR [ 48%]
tests/test_intervention_plans_router.py::TestReviewReminderCrossServiceIntegration::test_pending_review_count_for_badge ERROR [ 48%]
tests/test_intervention_plans_router.py::TestReviewScheduleValidation::test_valid_review_schedules_accepted ERROR [ 49%]
tests/test_intervention_plans_router.py::TestReviewScheduleValidation::test_invalid_review_schedules_rejected ERROR [ 49%]
tests/test_intervention_plans_router.py::TestReviewScheduleValidation::test_plan_list_filter_by_review_schedule ERROR [ 49%]
tests/test_intervention_plans_router.py::TestReviewScheduleValidation::test_plan_list_filter_needs_review ERROR [ 49%]
tests/test_intervention_plans_router.py::TestReviewReminderServiceViaAPI::test_reminder_service_filters_active_plans ERROR [ 49%]
tests/test_intervention_plans_router.py::TestReviewReminderServiceViaAPI::test_reminder_categorizes_overdue_correctly ERROR [ 49%]
tests/test_intervention_plans_router.py::TestReviewReminderServiceViaAPI::test_reminder_categorizes_upcoming_correctly ERROR [ 49%]
tests/test_jwt_secret_config.py::TestJWTSecretConfiguration::test_settings_loads_jwt_secret_from_env PASSED [ 49%]
tests/test_jwt_secret_config.py::TestJWTSecretConfiguration::test_settings_has_default_jwt_secret PASSED [ 49%]
tests/test_jwt_secret_config.py::TestJWTSecretConfiguration::test_settings_jwt_algorithm_default PASSED [ 49%]
tests/test_jwt_secret_config.py::TestJWTSecretConfiguration::test_jwt_token_can_be_signed_and_verified PASSED [ 49%]
tests/test_jwt_secret_config.py::TestJWTSecretConfiguration::test_jwt_token_signed_with_different_secret_fails_verification PASSED [ 49%]
tests/test_jwt_secret_config.py::TestJWTSecretConfiguration::test_gibbon_token_structure_compatibility PASSED [ 49%]
tests/test_jwt_secret_config.py::TestJWTSecretConfiguration::test_shared_secret_consistency PASSED [ 49%]
tests/test_jwt_secret_config.py::TestJWTSecretConfiguration::test_token_interoperability_ai_to_gibbon PASSED [ 49%]
tests/test_jwt_secret_config.py::TestJWTSecretConfiguration::test_token_interoperability_gibbon_to_ai PASSED [ 49%]
tests/test_jwt_secret_config.py::TestJWTSecretConfiguration::test_secret_length_validation PASSED [ 49%]
tests/test_jwt_secret_config.py::TestJWTSecretConfiguration::test_default_secret_is_placeholder PASSED [ 50%]
tests/test_jwt_secret_config.py::TestCrossServiceAuthentication::test_full_authentication_flow PASSED [ 50%]
tests/test_jwt_secret_config.py::TestCrossServiceAuthentication::test_multiple_token_sources_same_secret PASSED [ 50%]
tests/test_llm_api.py::TestCompletionsEndpoint::test_completions_returns_200_with_valid_request ERROR [ 50%]
tests/test_llm_api.py::TestCompletionsEndpoint::test_completions_requires_auth ERROR [ 50%]
tests/test_llm_api.py::TestCompletionsEndpoint::test_completions_with_minimal_request ERROR [ 50%]
tests/test_llm_api.py::TestCompletionsEndpoint::test_completions_validates_empty_messages ERROR [ 50%]
tests/test_llm_api.py::TestCompletionsEndpoint::test_completions_validates_message_role ERROR [ 50%]
tests/test_llm_api.py::TestCompletionsEndpoint::test_completions_validates_temperature_range ERROR [ 50%]
tests/test_llm_api.py::TestCompletionsEndpoint::test_completions_returns_503_when_provider_unavailable ERROR [ 50%]
tests/test_llm_api.py::TestCompletionsEndpoint::test_completions_returns_500_on_completion_error ERROR [ 50%]
tests/test_llm_api.py::TestStreamingCompletionsEndpoint::test_streaming_completions_returns_stream ERROR [ 50%]
tests/test_llm_api.py::TestStreamingCompletionsEndpoint::test_streaming_completions_requires_auth ERROR [ 50%]
tests/test_llm_api.py::TestHealthEndpoint::test_health_returns_200_without_auth ERROR [ 50%]
tests/test_llm_api.py::TestHealthEndpoint::test_health_returns_healthy_status ERROR [ 50%]
tests/test_llm_api.py::TestHealthEndpoint::test_health_returns_degraded_status ERROR [ 50%]
tests/test_llm_api.py::TestModelsEndpoint::test_models_returns_200 ERROR [ 50%]
tests/test_llm_api.py::TestModelsEndpoint::test_models_requires_auth ERROR [ 50%]
tests/test_llm_api.py::TestModelsEndpoint::test_models_returns_model_details ERROR [ 51%]
tests/test_llm_api.py::TestUsageEndpoint::test_usage_returns_200 ERROR   [ 51%]
tests/test_llm_api.py::TestUsageEndpoint::test_usage_requires_auth ERROR [ 51%]
tests/test_llm_api.py::TestUsageEndpoint::test_usage_with_provider_filter ERROR [ 51%]
tests/test_llm_api.py::TestUsageEndpoint::test_usage_with_model_filter ERROR [ 51%]
tests/test_llm_api.py::TestCacheStatsEndpoint::test_cache_stats_returns_200 ERROR [ 51%]
tests/test_llm_api.py::TestCacheStatsEndpoint::test_cache_stats_requires_auth ERROR [ 51%]
tests/test_llm_api.py::TestCacheInvalidateEndpoint::test_cache_invalidate_returns_200 ERROR [ 51%]
tests/test_llm_api.py::TestCacheInvalidateEndpoint::test_cache_invalidate_requires_auth ERROR [ 51%]
tests/test_llm_api.py::TestCacheInvalidateEndpoint::test_cache_invalidate_with_cache_key ERROR [ 51%]
tests/test_llm_api.py::TestCacheInvalidateEndpoint::test_cache_invalidate_with_provider_filter ERROR [ 51%]
tests/test_llm_api.py::TestCacheInvalidateEndpoint::test_cache_invalidate_with_model_filter ERROR [ 51%]
tests/test_llm_api.py::TestCacheCleanupEndpoint::test_cache_cleanup_returns_200 ERROR [ 51%]
tests/test_llm_api.py::TestCacheCleanupEndpoint::test_cache_cleanup_requires_auth ERROR [ 51%]
tests/test_llm_api.py::TestEdgeCases::test_completions_with_expired_token ERROR [ 51%]
tests/test_llm_api.py::TestEdgeCases::test_completions_with_invalid_token ERROR [ 51%]
tests/test_llm_api.py::TestEdgeCases::test_completions_with_empty_message_content ERROR [ 51%]
tests/test_llm_api.py::TestEdgeCases::test_completions_with_invalid_max_tokens ERROR [ 51%]
tests/test_llm_api.py::TestEdgeCases::test_completions_with_negative_max_tokens ERROR [ 52%]
tests/test_llm_api.py::TestEdgeCases::test_completions_with_invalid_provider ERROR [ 52%]
tests/test_llm_api.py::TestEdgeCases::test_completions_service_error_returns_500 ERROR [ 52%]
tests/test_llm_api.py::TestEdgeCases::test_completions_with_all_optional_parameters ERROR [ 52%]
tests/test_llm_api.py::TestResponseStructure::test_completion_response_contains_all_fields ERROR [ 52%]
tests/test_llm_api.py::TestResponseStructure::test_health_response_structure ERROR [ 52%]
tests/test_llm_api.py::TestResponseStructure::test_usage_response_structure ERROR [ 52%]
tests/test_llm_cache_fallback.py::TestLLMCacheKeyGeneration::test_generate_cache_key_basic PASSED [ 52%]
tests/test_llm_cache_fallback.py::TestLLMCacheKeyGeneration::test_generate_cache_key_with_optional_params PASSED [ 52%]
tests/test_llm_cache_fallback.py::TestLLMCacheKeyGeneration::test_generate_cache_key_deterministic PASSED [ 52%]
tests/test_llm_cache_fallback.py::TestLLMCacheKeyGeneration::test_generate_cache_key_different_messages PASSED [ 52%]
tests/test_llm_cache_fallback.py::TestLLMCacheKeyGeneration::test_generate_cache_key_different_providers PASSED [ 52%]
tests/test_llm_cache_fallback.py::TestLLMCacheKeyGeneration::test_generate_prompt_hash PASSED [ 52%]
tests/test_llm_cache_fallback.py::TestLLMCacheOperations::test_cache_set_and_get PASSED [ 52%]
tests/test_llm_cache_fallback.py::TestLLMCacheOperations::test_cache_miss_returns_none PASSED [ 52%]
tests/test_llm_cache_fallback.py::TestLLMCacheOperations::test_cache_hit_increments_count PASSED [ 52%]
tests/test_llm_cache_fallback.py::TestLLMCacheOperations::test_cache_ttl_expiration PASSED [ 52%]
tests/test_llm_cache_fallback.py::TestLLMCacheOperations::test_cache_custom_ttl PASSED [ 52%]
tests/test_llm_cache_fallback.py::TestLLMCacheOperations::test_cache_overwrite_existing PASSED [ 53%]
tests/test_llm_cache_fallback.py::TestLLMCacheInvalidation::test_invalidate_by_key PASSED [ 53%]
tests/test_llm_cache_fallback.py::TestLLMCacheInvalidation::test_invalidate_by_provider PASSED [ 53%]
tests/test_llm_cache_fallback.py::TestLLMCacheInvalidation::test_invalidate_by_model PASSED [ 53%]
tests/test_llm_cache_fallback.py::TestLLMCacheInvalidation::test_invalidate_no_criteria_returns_zero PASSED [ 53%]
tests/test_llm_cache_fallback.py::TestLLMCacheInvalidation::test_cleanup_expired PASSED [ 53%]
tests/test_llm_cache_fallback.py::TestLLMCacheStatistics::test_get_stats_empty_cache PASSED [ 53%]
tests/test_llm_cache_fallback.py::TestLLMCacheStatistics::test_get_stats_with_entries PASSED [ 53%]
tests/test_llm_cache_fallback.py::TestLLMCacheStatistics::test_get_stats_filter_by_provider PASSED [ 53%]
tests/test_llm_cache_fallback.py::TestLLMCacheStatistics::test_cache_size_property PASSED [ 53%]
tests/test_llm_cache_fallback.py::TestLLMCacheStatistics::test_cache_clear PASSED [ 53%]
tests/test_llm_cache_fallback.py::TestFallbackConfiguration::test_default_config PASSED [ 53%]
tests/test_llm_cache_fallback.py::TestFallbackConfiguration::test_custom_config PASSED [ 53%]
tests/test_llm_cache_fallback.py::TestFallbackConfiguration::test_fallback_mode_enum PASSED [ 53%]
tests/test_llm_cache_fallback.py::TestFallbackConfiguration::test_retryable_error_enum PASSED [ 53%]
tests/test_llm_cache_fallback.py::TestFallbackProviderManagement::test_add_provider PASSED [ 53%]
tests/test_llm_cache_fallback.py::TestFallbackProviderManagement::test_add_none_provider_raises PASSED [ 53%]
tests/test_llm_cache_fallback.py::TestFallbackProviderManagement::test_remove_provider PASSED [ 53%]
tests/test_llm_cache_fallback.py::TestFallbackProviderManagement::test_remove_nonexistent_provider PASSED [ 54%]
tests/test_llm_cache_fallback.py::TestFallbackProviderManagement::test_set_providers PASSED [ 54%]
tests/test_llm_cache_fallback.py::TestFallbackProviderManagement::test_configured_providers PASSED [ 54%]
tests/test_llm_cache_fallback.py::TestFallbackExecution::test_execute_success_first_provider PASSED [ 54%]
tests/test_llm_cache_fallback.py::TestFallbackExecution::test_execute_fallback_to_second_provider PASSED [ 54%]
tests/test_llm_cache_fallback.py::TestFallbackExecution::test_execute_all_providers_fail PASSED [ 54%]
tests/test_llm_cache_fallback.py::TestFallbackExecution::test_execute_no_providers PASSED [ 54%]
tests/test_llm_cache_fallback.py::TestFallbackExecution::test_execute_skips_unavailable_provider PASSED [ 54%]
tests/test_llm_cache_fallback.py::TestFallbackExecution::test_execute_respects_max_retries PASSED [ 54%]
tests/test_llm_cache_fallback.py::TestFallbackErrorHandling::test_retry_on_rate_limit PASSED [ 54%]
tests/test_llm_cache_fallback.py::TestFallbackErrorHandling::test_retry_on_timeout PASSED [ 54%]
tests/test_llm_cache_fallback.py::TestFallbackErrorHandling::test_no_retry_on_authentication_error PASSED [ 54%]
tests/test_llm_cache_fallback.py::TestFallbackErrorHandling::test_retry_all_errors_mode PASSED [ 54%]
tests/test_llm_cache_fallback.py::TestFallbackErrorHandling::test_fallback_callback_invoked PASSED [ 54%]
tests/test_llm_cache_fallback.py::TestFallbackRoundRobin::test_round_robin_rotates_providers PASSED [ 54%]
tests/test_llm_cache_fallback.py::TestFallbackMisc::test_strategy_repr PASSED [ 54%]
tests/test_llm_cache_fallback.py::TestFallbackMisc::test_execute_with_config PASSED [ 54%]
tests/test_llm_cache_fallback.py::TestFallbackMisc::test_fallback_attempt_has_duration PASSED [ 54%]
tests/test_llm_cache_fallback.py::TestCacheFallbackIntegration::test_cache_hit_avoids_fallback PASSED [ 55%]
tests/test_llm_cache_fallback.py::TestCacheFallbackIntegration::test_multiple_providers_different_cache_keys PASSED [ 55%]
tests/test_llm_parsing.py::TestParseExceptions::test_parse_error_attributes PASSED [ 55%]
tests/test_llm_parsing.py::TestParseExceptions::test_parse_error_minimal PASSED [ 55%]
tests/test_llm_parsing.py::TestParseExceptions::test_json_extraction_error PASSED [ 55%]
tests/test_llm_parsing.py::TestParseExceptions::test_validation_parse_error PASSED [ 55%]
tests/test_llm_parsing.py::TestParseExceptions::test_validation_parse_error_default_errors PASSED [ 55%]
tests/test_llm_parsing.py::TestResponseParserJsonExtraction::test_extract_json_from_raw_string PASSED [ 55%]
tests/test_llm_parsing.py::TestResponseParserJsonExtraction::test_extract_json_from_code_block PASSED [ 55%]
tests/test_llm_parsing.py::TestResponseParserJsonExtraction::test_extract_json_from_code_block_no_lang PASSED [ 55%]
tests/test_llm_parsing.py::TestResponseParserJsonExtraction::test_extract_json_with_default PASSED [ 55%]
tests/test_llm_parsing.py::TestResponseParserJsonExtraction::test_extract_json_strict_mode_raises_error PASSED [ 55%]
tests/test_llm_parsing.py::TestResponseParserJsonExtraction::test_extract_json_empty_content PASSED [ 55%]
tests/test_llm_parsing.py::TestResponseParserJsonExtraction::test_extract_json_empty_content_strict PASSED [ 55%]
tests/test_llm_parsing.py::TestResponseParserJsonExtraction::test_extract_json_fixes_trailing_comma PASSED [ 55%]
tests/test_llm_parsing.py::TestResponseParserJsonExtraction::test_extract_json_with_surrounding_text PASSED [ 55%]
tests/test_llm_parsing.py::TestResponseParserJsonExtraction::test_extract_json_nested_object PASSED [ 55%]
tests/test_llm_parsing.py::TestResponseParserJsonExtraction::test_extract_json_with_arrays PASSED [ 55%]
tests/test_llm_parsing.py::TestResponseParserJsonArray::test_extract_json_array_from_raw PASSED [ 56%]
tests/test_llm_parsing.py::TestResponseParserJsonArray::test_extract_json_array_from_code_block PASSED [ 56%]
tests/test_llm_parsing.py::TestResponseParserJsonArray::test_extract_json_array_empty_content PASSED [ 56%]
tests/test_llm_parsing.py::TestResponseParserJsonArray::test_extract_json_array_empty_content_strict PASSED [ 56%]
tests/test_llm_parsing.py::TestResponseParserJsonArray::test_extract_json_array_simple_values PASSED [ 56%]
tests/test_llm_parsing.py::TestResponseParserJsonArray::test_extract_json_array_with_default PASSED [ 56%]
tests/test_llm_parsing.py::TestResponseParserJsonArray::test_extract_json_array_strict_mode_raises PASSED [ 56%]
tests/test_llm_parsing.py::TestResponseParserJsonArray::test_extract_json_array_from_object_returns_default PASSED [ 56%]
tests/test_llm_parsing.py::TestResponseParserJsonArray::test_extract_json_array_fixes_trailing_comma PASSED [ 56%]
tests/test_llm_parsing.py::TestResponseParserList::test_extract_bulleted_list PASSED [ 56%]
tests/test_llm_parsing.py::TestResponseParserList::test_extract_bulleted_list_asterisk PASSED [ 56%]
tests/test_llm_parsing.py::TestResponseParserList::test_extract_bulleted_list_bullet_char PASSED [ 56%]
tests/test_llm_parsing.py::TestResponseParserList::test_extract_numbered_list PASSED [ 56%]
tests/test_llm_parsing.py::TestResponseParserList::test_extract_numbered_list_parentheses PASSED [ 56%]
tests/test_llm_parsing.py::TestResponseParserList::test_extract_list_strips_items PASSED [ 56%]
tests/test_llm_parsing.py::TestResponseParserList::test_extract_list_no_strip PASSED [ 56%]
tests/test_llm_parsing.py::TestResponseParserList::test_extract_list_empty_content PASSED [ 56%]
tests/test_llm_parsing.py::TestResponseParserList::test_extract_list_no_list_items PASSED [ 56%]
tests/test_llm_parsing.py::TestResponseParserList::test_extract_list_mixed_format PASSED [ 57%]
tests/test_llm_parsing.py::TestResponseParserKeyValue::test_extract_key_value_pairs PASSED [ 57%]
tests/test_llm_parsing.py::TestResponseParserKeyValue::test_extract_key_value_strips_values PASSED [ 57%]
tests/test_llm_parsing.py::TestResponseParserKeyValue::test_extract_key_value_no_strip PASSED [ 57%]
tests/test_llm_parsing.py::TestResponseParserKeyValue::test_extract_key_value_empty_content PASSED [ 57%]
tests/test_llm_parsing.py::TestResponseParserKeyValue::test_extract_key_value_no_pairs PASSED [ 57%]
tests/test_llm_parsing.py::TestResponseParserKeyValue::test_extract_key_value_with_colons_in_value PASSED [ 57%]
tests/test_llm_parsing.py::TestResponseParserPydantic::test_parse_to_model_success PASSED [ 57%]
tests/test_llm_parsing.py::TestResponseParserPydantic::test_parse_to_model_from_code_block PASSED [ 57%]
tests/test_llm_parsing.py::TestResponseParserPydantic::test_parse_to_model_complex PASSED [ 57%]
tests/test_llm_parsing.py::TestResponseParserPydantic::test_parse_to_model_validation_error PASSED [ 57%]
tests/test_llm_parsing.py::TestResponseParserPydantic::test_parse_to_model_invalid_json PASSED [ 57%]
tests/test_llm_parsing.py::TestResponseParserPydantic::test_parse_to_model_empty_raises PASSED [ 57%]
tests/test_llm_parsing.py::TestResponseParserPydantic::test_parse_to_model_list PASSED [ 57%]
tests/test_llm_parsing.py::TestResponseParserPydantic::test_parse_to_model_list_empty_raises PASSED [ 57%]
tests/test_llm_parsing.py::TestResponseParserPydantic::test_parse_to_model_list_validation_error PASSED [ 57%]
tests/test_llm_parsing.py::TestResponseParserPydantic::test_parse_to_model_no_extract_json PASSED [ 57%]
tests/test_llm_parsing.py::TestResponseParserAutoDetect::test_parse_detects_json PASSED [ 57%]
tests/test_llm_parsing.py::TestResponseParserAutoDetect::test_parse_detects_json_array PASSED [ 58%]
tests/test_llm_parsing.py::TestResponseParserAutoDetect::test_parse_detects_list PASSED [ 58%]
tests/test_llm_parsing.py::TestResponseParserAutoDetect::test_parse_detects_key_value PASSED [ 58%]
tests/test_llm_parsing.py::TestResponseParserAutoDetect::test_parse_detects_markdown PASSED [ 58%]
tests/test_llm_parsing.py::TestResponseParserAutoDetect::test_parse_defaults_to_text PASSED [ 58%]
tests/test_llm_parsing.py::TestResponseParserAutoDetect::test_parse_empty_content PASSED [ 58%]
tests/test_llm_parsing.py::TestResponseParserAutoDetect::test_parse_with_expected_format_json PASSED [ 58%]
tests/test_llm_parsing.py::TestResponseParserAutoDetect::test_parse_with_expected_format_json_array PASSED [ 58%]
tests/test_llm_parsing.py::TestResponseParserAutoDetect::test_parse_expected_format_fallback PASSED [ 58%]
tests/test_llm_parsing.py::TestCodeBlockExtraction::test_extract_code_blocks PASSED [ 58%]
tests/test_llm_parsing.py::TestCodeBlockExtraction::test_extract_code_blocks_with_language PASSED [ 58%]
tests/test_llm_parsing.py::TestCodeBlockExtraction::test_extract_code_blocks_empty_content PASSED [ 58%]
tests/test_llm_parsing.py::TestCodeBlockExtraction::test_extract_code_blocks_no_blocks PASSED [ 58%]
tests/test_llm_parsing.py::TestCodeBlockExtraction::test_extract_code_blocks_empty_block PASSED [ 58%]
tests/test_llm_parsing.py::TestMarkdownStripping::test_strip_markdown_formatting PASSED [ 58%]
tests/test_llm_parsing.py::TestMarkdownStripping::test_strip_markdown_code_blocks PASSED [ 58%]
tests/test_llm_parsing.py::TestMarkdownStripping::test_strip_markdown_inline_code PASSED [ 58%]
tests/test_llm_parsing.py::TestMarkdownStripping::test_strip_markdown_empty_content PASSED [ 58%]
tests/test_llm_parsing.py::TestMarkdownStripping::test_strip_markdown_underscore_formatting PASSED [ 59%]
tests/test_llm_parsing.py::TestOutputFormat::test_output_format_values PASSED [ 59%]
tests/test_llm_parsing.py::TestOutputFormat::test_output_format_is_string_enum PASSED [ 59%]
tests/test_llm_parsing.py::TestParsedResponse::test_parsed_response_creation PASSED [ 59%]
tests/test_llm_parsing.py::TestParsedResponse::test_parsed_response_with_notes PASSED [ 59%]
tests/test_llm_parsing.py::TestParsedResponse::test_parsed_response_default_format PASSED [ 59%]
tests/test_llm_parsing.py::TestResponseParserConfiguration::test_default_configuration PASSED [ 59%]
tests/test_llm_parsing.py::TestResponseParserConfiguration::test_strict_json_configuration PASSED [ 59%]
tests/test_llm_parsing.py::TestResponseParserConfiguration::test_strip_markdown_configuration PASSED [ 59%]
tests/test_llm_parsing.py::TestEdgeCases::test_malformed_json_recovery PASSED [ 59%]
tests/test_llm_parsing.py::TestEdgeCases::test_deeply_nested_json PASSED [ 59%]
tests/test_llm_parsing.py::TestEdgeCases::test_unicode_content PASSED    [ 59%]
tests/test_llm_parsing.py::TestEdgeCases::test_large_content PASSED      [ 59%]
tests/test_llm_parsing.py::TestEdgeCases::test_whitespace_variations PASSED [ 59%]
tests/test_llm_parsing.py::TestEdgeCases::test_json_with_null_values PASSED [ 59%]
tests/test_llm_parsing.py::TestEdgeCases::test_json_with_boolean_values PASSED [ 59%]
tests/test_llm_parsing.py::TestEdgeCases::test_multiple_json_objects_extracts_one PASSED [ 59%]
tests/test_llm_parsing.py::TestEdgeCases::test_json_in_url_style_content PASSED [ 59%]
tests/test_llm_parsing.py::TestEdgeCases::test_looks_like_markdown_detection PASSED [ 60%]
tests/test_llm_prompts.py::TestPromptTemplate::test_create_template_with_valid_string PASSED [ 60%]
tests/test_llm_prompts.py::TestPromptTemplate::test_create_template_raises_error_for_empty_string PASSED [ 60%]
tests/test_llm_prompts.py::TestPromptTemplate::test_create_template_raises_error_for_none PASSED [ 60%]
tests/test_llm_prompts.py::TestPromptTemplate::test_extract_single_variable PASSED [ 60%]
tests/test_llm_prompts.py::TestPromptTemplate::test_extract_multiple_variables PASSED [ 60%]
tests/test_llm_prompts.py::TestPromptTemplate::test_extract_no_variables PASSED [ 60%]
tests/test_llm_prompts.py::TestPromptTemplate::test_extract_repeated_variables PASSED [ 60%]
tests/test_llm_prompts.py::TestPromptTemplate::test_render_with_all_variables PASSED [ 60%]
tests/test_llm_prompts.py::TestPromptTemplate::test_render_raises_missing_variable_error PASSED [ 60%]
tests/test_llm_prompts.py::TestPromptTemplate::test_render_strict_mode_raises_invalid_variable_error PASSED [ 60%]
tests/test_llm_prompts.py::TestPromptTemplate::test_render_non_strict_mode_ignores_extra_variables PASSED [ 60%]
tests/test_llm_prompts.py::TestPromptTemplate::test_partial_render_with_some_variables PASSED [ 60%]
tests/test_llm_prompts.py::TestPromptTemplate::test_partial_render_with_all_variables PASSED [ 60%]
tests/test_llm_prompts.py::TestPromptTemplate::test_safe_render_with_missing_variables PASSED [ 60%]
tests/test_llm_prompts.py::TestPromptTemplate::test_safe_render_with_empty_default PASSED [ 60%]
tests/test_llm_prompts.py::TestPromptTemplate::test_validate_returns_true_when_all_provided PASSED [ 60%]
tests/test_llm_prompts.py::TestPromptTemplate::test_validate_returns_false_with_missing_variables PASSED [ 60%]
tests/test_llm_prompts.py::TestPromptTemplate::test_str_returns_template PASSED [ 61%]
tests/test_llm_prompts.py::TestPromptTemplate::test_repr_format PASSED   [ 61%]
tests/test_llm_prompts.py::TestPromptTemplate::test_repr_truncates_long_templates PASSED [ 61%]
tests/test_llm_prompts.py::TestPromptTemplate::test_equality_same_template PASSED [ 61%]
tests/test_llm_prompts.py::TestPromptTemplate::test_equality_different_template PASSED [ 61%]
tests/test_llm_prompts.py::TestPromptTemplate::test_hash_consistent PASSED [ 61%]
tests/test_llm_prompts.py::TestSystemUserPromptTemplate::test_create_system_user_template PASSED [ 61%]
tests/test_llm_prompts.py::TestSystemUserPromptTemplate::test_create_with_name PASSED [ 61%]
tests/test_llm_prompts.py::TestSystemUserPromptTemplate::test_raises_error_for_empty_system_template PASSED [ 61%]
tests/test_llm_prompts.py::TestSystemUserPromptTemplate::test_raises_error_for_empty_user_template PASSED [ 61%]
tests/test_llm_prompts.py::TestSystemUserPromptTemplate::test_variables_from_both_templates PASSED [ 61%]
tests/test_llm_prompts.py::TestSystemUserPromptTemplate::test_system_variables_property PASSED [ 61%]
tests/test_llm_prompts.py::TestSystemUserPromptTemplate::test_user_variables_property PASSED [ 61%]
tests/test_llm_prompts.py::TestSystemUserPromptTemplate::test_render_returns_both_messages PASSED [ 61%]
tests/test_llm_prompts.py::TestSystemUserPromptTemplate::test_render_raises_missing_variable_error PASSED [ 61%]
tests/test_llm_prompts.py::TestSystemUserPromptTemplate::test_render_system_only PASSED [ 61%]
tests/test_llm_prompts.py::TestSystemUserPromptTemplate::test_render_user_only PASSED [ 61%]
tests/test_llm_prompts.py::TestSystemUserPromptTemplate::test_repr_format PASSED [ 61%]
tests/test_llm_prompts.py::TestPromptTemplateExceptions::test_prompt_template_error_attributes PASSED [ 62%]
tests/test_llm_prompts.py::TestPromptTemplateExceptions::test_missing_variable_error_attributes PASSED [ 62%]
tests/test_llm_prompts.py::TestPromptTemplateExceptions::test_invalid_variable_error_attributes PASSED [ 62%]
tests/test_llm_prompts.py::TestActivityRecommendationPrompt::test_create_with_defaults PASSED [ 62%]
tests/test_llm_prompts.py::TestActivityRecommendationPrompt::test_create_with_custom_templates PASSED [ 62%]
tests/test_llm_prompts.py::TestActivityRecommendationPrompt::test_render_with_required_params PASSED [ 62%]
tests/test_llm_prompts.py::TestActivityRecommendationPrompt::test_render_with_optional_theme PASSED [ 62%]
tests/test_llm_prompts.py::TestActivityRecommendationPrompt::test_render_with_optional_materials PASSED [ 62%]
tests/test_llm_prompts.py::TestActivityRecommendationPrompt::test_render_with_learning_objectives PASSED [ 62%]
tests/test_llm_prompts.py::TestActivityRecommendationPrompt::test_render_for_api_format PASSED [ 62%]
tests/test_llm_prompts.py::TestActivityAdaptationPrompt::test_create_with_defaults PASSED [ 62%]
tests/test_llm_prompts.py::TestActivityAdaptationPrompt::test_render_with_required_params PASSED [ 62%]
tests/test_llm_prompts.py::TestActivityAdaptationPrompt::test_render_with_additional_context PASSED [ 62%]
tests/test_llm_prompts.py::TestDailyPlanningPrompt::test_create_with_defaults PASSED [ 62%]
tests/test_llm_prompts.py::TestDailyPlanningPrompt::test_render_with_required_params PASSED [ 62%]
tests/test_llm_prompts.py::TestDailyPlanningPrompt::test_render_with_special_events PASSED [ 62%]
tests/test_llm_prompts.py::TestDailyPlanningPrompt::test_render_with_focus_areas PASSED [ 62%]
tests/test_llm_prompts.py::TestDailyPlanningPrompt::test_render_with_constraints PASSED [ 62%]
tests/test_llm_prompts.py::TestDailyReportPrompt::test_create_with_defaults PASSED [ 63%]
tests/test_llm_prompts.py::TestDailyReportPrompt::test_create_with_custom_templates PASSED [ 63%]
tests/test_llm_prompts.py::TestDailyReportPrompt::test_render_with_required_params PASSED [ 63%]
tests/test_llm_prompts.py::TestDailyReportPrompt::test_render_with_activities PASSED [ 63%]
tests/test_llm_prompts.py::TestDailyReportPrompt::test_render_with_observations PASSED [ 63%]
tests/test_llm_prompts.py::TestDailyReportPrompt::test_render_with_meals_info PASSED [ 63%]
tests/test_llm_prompts.py::TestDailyReportPrompt::test_render_with_additional_notes PASSED [ 63%]
tests/test_llm_prompts.py::TestDailyReportPrompt::test_render_for_api_format PASSED [ 63%]
tests/test_llm_prompts.py::TestCoachingGuidancePrompt::test_create_with_defaults PASSED [ 63%]
tests/test_llm_prompts.py::TestCoachingGuidancePrompt::test_create_with_custom_templates PASSED [ 63%]
tests/test_llm_prompts.py::TestCoachingGuidancePrompt::test_render_with_required_params PASSED [ 63%]
tests/test_llm_prompts.py::TestCoachingGuidancePrompt::test_render_with_goal PASSED [ 63%]
tests/test_llm_prompts.py::TestCoachingGuidancePrompt::test_render_with_approaches_tried PASSED [ 63%]
tests/test_llm_prompts.py::TestCoachingGuidancePrompt::test_render_with_constraints PASSED [ 63%]
tests/test_llm_prompts.py::TestCoachingGuidancePrompt::test_render_for_api_format PASSED [ 63%]
tests/test_llm_prompts.py::TestBehaviorGuidancePrompt::test_create_with_defaults PASSED [ 63%]
tests/test_llm_prompts.py::TestBehaviorGuidancePrompt::test_render_with_required_params PASSED [ 63%]
tests/test_llm_prompts.py::TestBehaviorGuidancePrompt::test_render_with_known_triggers PASSED [ 63%]
tests/test_llm_prompts.py::TestBehaviorGuidancePrompt::test_render_with_strategies_tried PASSED [ 64%]
tests/test_llm_prompts.py::TestBehaviorGuidancePrompt::test_render_with_additional_info PASSED [ 64%]
tests/test_llm_prompts.py::TestParentCommunicationPrompt::test_create_with_defaults PASSED [ 64%]
tests/test_llm_prompts.py::TestParentCommunicationPrompt::test_render_with_required_params PASSED [ 64%]
tests/test_llm_prompts.py::TestParentCommunicationPrompt::test_render_with_key_points PASSED [ 64%]
tests/test_llm_prompts.py::TestParentCommunicationPrompt::test_render_with_context PASSED [ 64%]
tests/test_llm_prompts.py::TestPromptTemplateIntegration::test_all_prompts_have_laya_in_system PASSED [ 64%]
tests/test_llm_prompts.py::TestPromptTemplateIntegration::test_all_prompts_have_unique_names PASSED [ 64%]
tests/test_llm_prompts.py::TestPromptTemplateIntegration::test_quebec_context_in_relevant_prompts PASSED [ 64%]
tests/test_llm_prompts.py::TestPromptTemplateIntegration::test_child_development_focus PASSED [ 64%]
tests/test_llm_providers.py::TestOpenAIProvider::test_provider_attributes PASSED [ 64%]
tests/test_llm_providers.py::TestOpenAIProvider::test_is_available_with_api_key PASSED [ 64%]
tests/test_llm_providers.py::TestOpenAIProvider::test_is_available_without_api_key FAILED [ 64%]
tests/test_llm_providers.py::TestOpenAIProvider::test_is_available_with_empty_api_key FAILED [ 64%]
tests/test_llm_providers.py::TestOpenAIProvider::test_get_model_list PASSED [ 64%]
tests/test_llm_providers.py::TestOpenAIProvider::test_get_default_config FAILED [ 64%]
tests/test_llm_providers.py::TestOpenAIProvider::test_validate_messages_valid PASSED [ 64%]
tests/test_llm_providers.py::TestOpenAIProvider::test_validate_messages_empty_list PASSED [ 64%]
tests/test_llm_providers.py::TestOpenAIProvider::test_validate_messages_empty_content PASSED [ 65%]
tests/test_llm_providers.py::TestOpenAIProvider::test_complete_success FAILED [ 65%]
tests/test_llm_providers.py::TestOpenAIProvider::test_complete_with_custom_config FAILED [ 65%]
tests/test_llm_providers.py::TestOpenAIProvider::test_complete_authentication_error FAILED [ 65%]
tests/test_llm_providers.py::TestOpenAIProvider::test_complete_rate_limit_error FAILED [ 65%]
tests/test_llm_providers.py::TestOpenAIProvider::test_complete_provider_error_400 FAILED [ 65%]
tests/test_llm_providers.py::TestOpenAIProvider::test_complete_provider_error_500 FAILED [ 65%]
tests/test_llm_providers.py::TestOpenAIProvider::test_complete_timeout_error FAILED [ 65%]
tests/test_llm_providers.py::TestOpenAIProvider::test_complete_http_error FAILED [ 65%]
tests/test_llm_providers.py::TestOpenAIProvider::test_complete_without_api_key FAILED [ 65%]
tests/test_llm_providers.py::TestOpenAIProvider::test_complete_with_invalid_messages PASSED [ 65%]
tests/test_llm_providers.py::TestOpenAIProvider::test_complete_no_choices_in_response FAILED [ 65%]
tests/test_llm_providers.py::TestOpenAIProvider::test_repr PASSED        [ 65%]
tests/test_llm_providers.py::TestAnthropicProvider::test_provider_attributes PASSED [ 65%]
tests/test_llm_providers.py::TestAnthropicProvider::test_is_available_with_api_key PASSED [ 65%]
tests/test_llm_providers.py::TestAnthropicProvider::test_is_available_without_api_key FAILED [ 65%]
tests/test_llm_providers.py::TestAnthropicProvider::test_is_available_with_empty_api_key FAILED [ 65%]
tests/test_llm_providers.py::TestAnthropicProvider::test_get_model_list PASSED [ 65%]
tests/test_llm_providers.py::TestAnthropicProvider::test_get_default_config FAILED [ 66%]
tests/test_llm_providers.py::TestAnthropicProvider::test_validate_messages_valid PASSED [ 66%]
tests/test_llm_providers.py::TestAnthropicProvider::test_validate_messages_empty_list PASSED [ 66%]
tests/test_llm_providers.py::TestAnthropicProvider::test_complete_success FAILED [ 66%]
tests/test_llm_providers.py::TestAnthropicProvider::test_complete_with_system_message FAILED [ 66%]
tests/test_llm_providers.py::TestAnthropicProvider::test_complete_authentication_error FAILED [ 66%]
tests/test_llm_providers.py::TestAnthropicProvider::test_complete_rate_limit_error FAILED [ 66%]
tests/test_llm_providers.py::TestAnthropicProvider::test_complete_provider_error_400 FAILED [ 66%]
tests/test_llm_providers.py::TestAnthropicProvider::test_complete_provider_error_500 FAILED [ 66%]
tests/test_llm_providers.py::TestAnthropicProvider::test_complete_timeout_error FAILED [ 66%]
tests/test_llm_providers.py::TestAnthropicProvider::test_complete_http_error FAILED [ 66%]
tests/test_llm_providers.py::TestAnthropicProvider::test_complete_without_api_key FAILED [ 66%]
tests/test_llm_providers.py::TestAnthropicProvider::test_complete_with_invalid_messages PASSED [ 66%]
tests/test_llm_providers.py::TestAnthropicProvider::test_complete_no_content_in_response FAILED [ 66%]
tests/test_llm_providers.py::TestAnthropicProvider::test_repr PASSED     [ 66%]
tests/test_llm_providers.py::TestLLMExceptions::test_llm_authentication_error_format PASSED [ 66%]
tests/test_llm_providers.py::TestLLMExceptions::test_llm_rate_limit_error_with_retry_after PASSED [ 66%]
tests/test_llm_providers.py::TestLLMExceptions::test_llm_provider_error_with_status_code PASSED [ 66%]
tests/test_llm_providers.py::TestLLMExceptions::test_llm_timeout_error_with_timeout_seconds PASSED [ 67%]
tests/test_llm_providers.py::TestLLMTypes::test_llm_message_to_dict PASSED [ 67%]
tests/test_llm_providers.py::TestLLMTypes::test_llm_message_to_dict_without_name PASSED [ 67%]
tests/test_llm_providers.py::TestLLMTypes::test_llm_usage_defaults PASSED [ 67%]
tests/test_llm_providers.py::TestLLMTypes::test_llm_config_defaults PASSED [ 67%]
tests/test_llm_providers.py::TestLLMTypes::test_llm_response_creation PASSED [ 67%]
tests/test_llm_providers.py::TestLLMTypes::test_llm_role_values PASSED   [ 67%]
tests/test_llm_token_client.py::TestTokenEstimation::test_estimate_tokens_simple PASSED [ 67%]
tests/test_llm_token_client.py::TestTokenEstimation::test_estimate_tokens_empty_string PASSED [ 67%]
tests/test_llm_token_client.py::TestTokenEstimation::test_estimate_tokens_long_text PASSED [ 67%]
tests/test_llm_token_client.py::TestTokenEstimation::test_estimate_tokens_none_raises_error PASSED [ 67%]
tests/test_llm_token_client.py::TestTokenEstimation::test_estimate_tokens_non_string_raises_error PASSED [ 67%]
tests/test_llm_token_client.py::TestTokenEstimation::test_estimate_messages_tokens PASSED [ 67%]
tests/test_llm_token_client.py::TestTokenEstimation::test_estimate_messages_tokens_empty_list PASSED [ 67%]
tests/test_llm_token_client.py::TestTokenEstimation::test_estimate_messages_tokens_with_name PASSED [ 67%]
tests/test_llm_token_client.py::TestModelPricing::test_get_model_pricing_known_model PASSED [ 67%]
tests/test_llm_token_client.py::TestModelPricing::test_get_model_pricing_unknown_model PASSED [ 67%]
tests/test_llm_token_client.py::TestModelPricing::test_get_model_pricing_anthropic_model PASSED [ 67%]
tests/test_llm_token_client.py::TestModelPricing::test_get_model_pricing_prefix_match PASSED [ 68%]
tests/test_llm_token_client.py::TestModelPricing::test_model_pricing_dataclass PASSED [ 68%]
tests/test_llm_token_client.py::TestCostCalculation::test_calculate_cost_gpt4o PASSED [ 68%]
tests/test_llm_token_client.py::TestCostCalculation::test_calculate_cost_gpt35_turbo PASSED [ 68%]
tests/test_llm_token_client.py::TestCostCalculation::test_calculate_cost_claude_sonnet PASSED [ 68%]
tests/test_llm_token_client.py::TestCostCalculation::test_calculate_cost_unknown_model PASSED [ 68%]
tests/test_llm_token_client.py::TestCostCalculation::test_calculate_cost_zero_tokens PASSED [ 68%]
tests/test_llm_token_client.py::TestCostCalculation::test_calculate_response_cost PASSED [ 68%]
tests/test_llm_token_client.py::TestContextWindow::test_get_context_window_gpt4o PASSED [ 68%]
tests/test_llm_token_client.py::TestContextWindow::test_get_context_window_claude PASSED [ 68%]
tests/test_llm_token_client.py::TestContextWindow::test_get_context_window_unknown PASSED [ 68%]
tests/test_llm_token_client.py::TestContextWindow::test_check_context_limit_within_limit PASSED [ 68%]
tests/test_llm_token_client.py::TestContextWindow::test_check_context_limit_exceeds_limit PASSED [ 68%]
tests/test_llm_token_client.py::TestTokenTrackerUtilities::test_format_cost PASSED [ 68%]
tests/test_llm_token_client.py::TestTokenTrackerUtilities::test_format_tokens_small PASSED [ 68%]
tests/test_llm_token_client.py::TestTokenTrackerUtilities::test_format_tokens_thousands PASSED [ 68%]
tests/test_llm_token_client.py::TestTokenTrackerUtilities::test_format_tokens_millions PASSED [ 68%]
tests/test_llm_token_client.py::TestTokenTrackerUtilities::test_create_usage_from_response PASSED [ 68%]
tests/test_llm_token_client.py::TestTokenTrackerDatabase::test_log_usage_without_db_raises PASSED [ 69%]
tests/test_llm_token_client.py::TestTokenTrackerDatabase::test_log_error_without_db_raises PASSED [ 69%]
tests/test_llm_token_client.py::TestTokenTrackerDatabase::test_get_usage_statistics_without_db_raises PASSED [ 69%]
tests/test_llm_token_client.py::TestTokenTrackerDatabase::test_get_daily_usage_without_db_raises PASSED [ 69%]
tests/test_llm_token_client.py::TestUsageStatistics::test_usage_statistics_defaults PASSED [ 69%]
tests/test_llm_token_client.py::TestUsageStatistics::test_usage_statistics_with_values PASSED [ 69%]
tests/test_llm_token_client.py::TestLLMClientInitialization::test_client_default_initialization PASSED [ 69%]
tests/test_llm_token_client.py::TestLLMClientInitialization::test_client_custom_configuration PASSED [ 69%]
tests/test_llm_token_client.py::TestLLMClientInitialization::test_client_repr PASSED [ 69%]
tests/test_llm_token_client.py::TestLLMClientCompletion::test_complete_success FAILED [ 69%]
tests/test_llm_token_client.py::TestLLMClientCompletion::test_complete_no_providers_raises FAILED [ 69%]
tests/test_llm_token_client.py::TestLLMClientCompletion::test_complete_with_cache_hit FAILED [ 69%]
tests/test_llm_token_client.py::TestLLMClientCompletion::test_complete_with_cache_miss FAILED [ 69%]
tests/test_llm_token_client.py::TestLLMClientCompletion::test_complete_with_error FAILED [ 69%]
tests/test_llm_token_client.py::TestLLMClientStreaming::test_complete_stream_success FAILED [ 69%]
tests/test_llm_token_client.py::TestLLMClientStreaming::test_complete_stream_no_providers FAILED [ 69%]
tests/test_llm_token_client.py::TestLLMClientFallback::test_execute_with_fallback_success PASSED [ 69%]
tests/test_llm_token_client.py::TestLLMClientFallback::test_fallback_all_providers_fail PASSED [ 69%]
tests/test_llm_token_client.py::TestLLMClientUtilities::test_estimate_tokens PASSED [ 70%]
tests/test_llm_token_client.py::TestLLMClientUtilities::test_estimate_messages_tokens PASSED [ 70%]
tests/test_llm_token_client.py::TestLLMClientUtilities::test_calculate_cost PASSED [ 70%]
tests/test_llm_token_client.py::TestLLMClientUtilities::test_check_context_limit PASSED [ 70%]
tests/test_llm_token_client.py::TestLLMClientUtilities::test_get_usage_statistics_without_db PASSED [ 70%]
tests/test_llm_token_client.py::TestLLMClientUtilities::test_get_cache_stats PASSED [ 70%]
tests/test_llm_token_client.py::TestLLMClientUtilities::test_invalidate_cache PASSED [ 70%]
tests/test_llm_token_client.py::TestLLMClientUtilities::test_cleanup_expired_cache PASSED [ 70%]
tests/test_llm_token_client.py::TestLLMClientProviders::test_available_providers_property PASSED [ 70%]
tests/test_llm_token_client.py::TestLLMClientProviders::test_configured_providers_property PASSED [ 70%]
tests/test_llm_token_client.py::TestLLMClientProviders::test_get_provider PASSED [ 70%]
tests/test_llm_token_client.py::TestLLMClientError::test_llm_client_error_attributes PASSED [ 70%]
tests/test_llm_token_client.py::TestLLMClientError::test_no_providers_available_error PASSED [ 70%]
tests/test_llm_token_client.py::TestLLMClientError::test_completion_failed_error PASSED [ 70%]
tests/test_makefile_commands.py::TestMakefileCommands::test_makefile_exists PASSED [ 70%]
tests/test_makefile_commands.py::TestMakefileCommands::test_makefile_has_help_target PASSED [ 70%]
tests/test_makefile_commands.py::TestMakefileCommands::test_makefile_help_shows_all_targets PASSED [ 70%]
tests/test_makefile_commands.py::TestMakefileCommands::test_makefile_targets_are_phony PASSED [ 70%]
tests/test_makefile_commands.py::TestMakefileCommands::test_seed_ai_target_runs_python_script PASSED [ 71%]
tests/test_makefile_commands.py::TestMakefileCommands::test_seed_ai_reset_target_uses_alembic PASSED [ 71%]
tests/test_makefile_commands.py::TestMakefileCommands::test_seed_gibbon_target_runs_php_script PASSED [ 71%]
tests/test_makefile_commands.py::TestMakefileCommands::test_seed_gibbon_reset_target_uses_reset_flag PASSED [ 71%]
tests/test_makefile_commands.py::TestMakefileCommands::test_seed_target_combines_both_services PASSED [ 71%]
tests/test_makefile_commands.py::TestMakefileCommands::test_seed_reset_target_combines_both_resets PASSED [ 71%]
tests/test_makefile_commands.py::TestMakefileCommands::test_makefile_has_descriptive_comments PASSED [ 71%]
tests/test_makefile_commands.py::TestMakefileCommands::test_makefile_provides_next_steps PASSED [ 71%]
tests/test_makefile_commands.py::TestMakefileCommands::test_default_target_shows_help PASSED [ 71%]
tests/test_makefile_commands.py::TestMakefileIntegration::test_make_help_runs_successfully PASSED [ 71%]
tests/test_makefile_commands.py::TestMakefileIntegration::test_seed_scripts_are_executable PASSED [ 71%]
tests/test_makefile_commands.py::TestMakefileErrorHandling::test_makefile_uses_at_symbol_for_clean_output PASSED [ 71%]
tests/test_makefile_commands.py::TestMakefileErrorHandling::test_makefile_changes_directory_correctly PASSED [ 71%]
tests/test_manual_verification.py::TestManualVerificationDocumentation::test_storage_api_endpoints_documented PASSED [ 71%]
tests/test_manual_verification.py::TestManualVerificationDocumentation::test_curl_examples_documented PASSED [ 71%]
tests/test_manual_verification.py::TestManualVerificationDocumentation::test_verification_checklist_documented PASSED [ 71%]
tests/test_manual_verification.py::TestManualVerificationDocumentation::test_print_verification_summary PASSED [ 71%]
tests/test_manual_verification.py::TestSupportedFileTypes::test_allowed_mime_types PASSED [ 71%]
tests/test_manual_verification.py::TestSupportedFileTypes::test_image_types_for_thumbnails PASSED [ 72%]
tests/test_manual_verification.py::TestSupportedFileTypes::test_default_configuration PASSED [ 72%]
tests/test_message_quality.py::TestAccusatoryLanguageDetection::test_detects_accusatory_you_in_english PASSED [ 72%]
tests/test_message_quality.py::TestAccusatoryLanguageDetection::test_detects_accusatory_vous_in_french PASSED [ 72%]
tests/test_message_quality.py::TestAccusatoryLanguageDetection::test_accusatory_message_has_low_quality_score PASSED [ 72%]
tests/test_message_quality.py::TestJudgmentalLabelDetection::test_detects_judgmental_labels_in_english PASSED [ 72%]
tests/test_message_quality.py::TestJudgmentalLabelDetection::test_detects_judgmental_labels_in_french PASSED [ 72%]
tests/test_message_quality.py::TestJudgmentalLabelDetection::test_judgmental_message_not_acceptable PASSED [ 72%]
tests/test_message_quality.py::TestBlameShameDetection::test_detects_blame_patterns_in_english PASSED [ 72%]
tests/test_message_quality.py::TestBlameShameDetection::test_detects_blame_patterns_in_french PASSED [ 72%]
tests/test_message_quality.py::TestExaggerationDetection::test_detects_exaggeration_in_english PASSED [ 72%]
tests/test_message_quality.py::TestExaggerationDetection::test_detects_exaggeration_in_french PASSED [ 72%]
tests/test_message_quality.py::TestAlarmistLanguageDetection::test_detects_alarmist_language_in_english PASSED [ 72%]
tests/test_message_quality.py::TestAlarmistLanguageDetection::test_detects_alarmist_language_in_french PASSED [ 72%]
tests/test_message_quality.py::TestComparisonDetection::test_detects_comparison_in_english PASSED [ 72%]
tests/test_message_quality.py::TestComparisonDetection::test_detects_comparison_in_french PASSED [ 72%]
tests/test_message_quality.py::TestPositiveMessageRecognition::test_positive_message_has_high_quality_score_en PASSED [ 72%]
tests/test_message_quality.py::TestPositiveMessageRecognition::test_positive_message_has_high_quality_score_fr PASSED [ 72%]
tests/test_message_quality.py::TestPositiveMessageRecognition::test_positive_message_has_structural_elements FAILED [ 73%]
tests/test_message_quality.py::TestPositiveMessageRecognition::test_short_positive_message_acceptable PASSED [ 73%]
tests/test_message_quality.py::TestQualityScoreCalculation::test_quality_score_public_method PASSED [ 73%]
tests/test_message_quality.py::TestQualityScoreCalculation::test_quality_score_range PASSED [ 73%]
tests/test_message_quality.py::TestQualityScoreCalculation::test_empty_message_raises_error PASSED [ 73%]
tests/test_message_quality.py::TestRewriteSuggestions::test_rewrite_suggestion_generated_for_issues PASSED [ 73%]
tests/test_message_quality.py::TestRewriteSuggestions::test_rewrite_uses_i_language PASSED [ 73%]
tests/test_message_quality.py::TestRewriteSuggestions::test_rewrite_has_sandwich_structure PASSED [ 73%]
tests/test_message_quality.py::TestRewriteSuggestions::test_no_rewrite_when_disabled PASSED [ 73%]
tests/test_message_quality.py::TestRewriteILanguageTransformations::test_rewrite_transforms_you_need_to_i_language PASSED [ 73%]
tests/test_message_quality.py::TestRewriteILanguageTransformations::test_rewrite_transforms_you_should_to_i_suggest PASSED [ 73%]
tests/test_message_quality.py::TestRewriteILanguageTransformations::test_rewrite_transforms_vous_devez_to_je_language_fr PASSED [ 73%]
tests/test_message_quality.py::TestRewriteILanguageTransformations::test_rewrite_removes_exaggerations_always_to_often PASSED [ 73%]
tests/test_message_quality.py::TestRewriteILanguageTransformations::test_rewrite_removes_exaggerations_never_to_rarely PASSED [ 73%]
tests/test_message_quality.py::TestRewriteILanguageTransformations::test_rewrite_confidence_score_high_for_simple_issues PASSED [ 73%]
tests/test_message_quality.py::TestRewriteILanguageTransformations::test_rewrite_confidence_score_lower_for_critical_issues PASSED [ 73%]
tests/test_message_quality.py::TestRewriteSandwichMethodStructure::test_rewrite_contains_positive_opening PASSED [ 73%]
tests/test_message_quality.py::TestRewriteSandwichMethodStructure::test_rewrite_contains_solution_closing PASSED [ 73%]
tests/test_message_quality.py::TestRewriteSandwichMethodStructure::test_rewrite_sandwich_structure_in_french PASSED [ 74%]
tests/test_message_quality.py::TestRewriteSandwichMethodStructure::test_rewrite_maintains_core_message_content PASSED [ 74%]
tests/test_message_quality.py::TestRewriteSandwichMethodStructure::test_rewrite_explanation_references_sandwich_method PASSED [ 74%]
tests/test_message_quality.py::TestRewriteSandwichMethodStructure::test_rewrite_explanation_in_french_references_sandwich PASSED [ 74%]
tests/test_message_quality.py::TestRewriteSandwichMethodStructure::test_rewrite_with_multiple_issues_addresses_all PASSED [ 74%]
tests/test_message_quality.py::TestRewriteSandwichMethodStructure::test_rewrite_handles_empty_message_gracefully FAILED [ 74%]
tests/test_message_quality.py::TestRewriteSandwichMethodStructure::test_rewrite_with_child_name_personalization PASSED [ 74%]
tests/test_message_quality.py::TestRewriteSandwichMethodStructure::test_rewrite_for_behavior_concern_includes_strategies PASSED [ 74%]
tests/test_message_quality.py::TestBilingualSupport::test_english_analysis_returns_english_content PASSED [ 74%]
tests/test_message_quality.py::TestBilingualSupport::test_french_analysis_returns_french_content PASSED [ 74%]
tests/test_message_quality.py::TestBilingualSupport::test_language_enum_values PASSED [ 74%]
tests/test_message_quality.py::TestBilingualSupport::test_french_accusatory_detection_quebec_compliance PASSED [ 74%]
tests/test_message_quality.py::TestBilingualSupport::test_french_judgmental_detection_quebec_compliance PASSED [ 74%]
tests/test_message_quality.py::TestBilingualSupport::test_french_blame_shame_detection_quebec_compliance PASSED [ 74%]
tests/test_message_quality.py::TestBilingualSupport::test_french_exaggeration_detection_quebec_compliance PASSED [ 74%]
tests/test_message_quality.py::TestBilingualSupport::test_french_alarmist_detection_quebec_compliance PASSED [ 74%]
tests/test_message_quality.py::TestBilingualSupport::test_french_comparison_detection_quebec_compliance PASSED [ 74%]
tests/test_message_quality.py::TestBilingualSupport::test_french_positive_message_high_score_quebec_compliance PASSED [ 75%]
tests/test_message_quality.py::TestBilingualSupport::test_french_short_positive_message_acceptable PASSED [ 75%]
tests/test_message_quality.py::TestBilingualSupport::test_french_rewrite_suggestions_in_french PASSED [ 75%]
tests/test_message_quality.py::TestBilingualSupport::test_consistent_issue_severity_english_french PASSED [ 75%]
tests/test_message_quality.py::TestBilingualSupport::test_french_issue_descriptions_in_french PASSED [ 75%]
tests/test_message_quality.py::TestBilingualSupport::test_french_suggestion_text_in_french FAILED [ 75%]
tests/test_message_quality.py::TestBilingualSupport::test_bilingual_quality_score_calculation_parity PASSED [ 75%]
tests/test_message_quality.py::TestBilingualSupport::test_french_structural_elements_detected FAILED [ 75%]
tests/test_message_quality.py::TestBilingualSupport::test_french_quality_score_validation_fields PASSED [ 75%]
tests/test_message_quality.py::TestErrorHandling::test_empty_message_raises_invalid_message_error FAILED [ 75%]
tests/test_message_quality.py::TestErrorHandling::test_whitespace_only_message_raises_error FAILED [ 75%]
tests/test_message_quality.py::TestIssueDetailStructure::test_issue_contains_all_required_fields PASSED [ 75%]
tests/test_message_quality.py::TestIssueDetailStructure::test_issue_positions_are_valid PASSED [ 75%]
tests/test_message_quality.py::TestAllQualityIssueTypes::test_quality_issue_enum_completeness PASSED [ 75%]
tests/test_message_quality.py::TestAllQualityIssueTypes::test_issue_severity_enum_completeness PASSED [ 75%]
tests/test_message_quality.py::TestAllQualityIssueTypes::test_message_context_enum_completeness PASSED [ 75%]
tests/test_message_quality.py::TestAnalyzeEndpoint::test_analyze_success ERROR [ 75%]
tests/test_message_quality.py::TestAnalyzeEndpoint::test_analyze_french_message ERROR [ 75%]
tests/test_message_quality.py::TestAnalyzeEndpoint::test_analyze_with_issues_detected ERROR [ 76%]
tests/test_message_quality.py::TestAnalyzeEndpoint::test_analyze_with_rewrites ERROR [ 76%]
tests/test_message_quality.py::TestAnalyzeEndpoint::test_analyze_requires_auth ERROR [ 76%]
tests/test_message_quality.py::TestAnalyzeEndpoint::test_analyze_empty_message_returns_400 ERROR [ 76%]
tests/test_message_quality.py::TestAnalyzeEndpoint::test_analyze_invalid_language_returns_422 ERROR [ 76%]
tests/test_message_quality.py::TestAnalyzeEndpoint::test_analyze_invalid_context_returns_422 ERROR [ 76%]
tests/test_message_quality.py::TestAnalyzeEndpoint::test_analyze_response_has_structural_flags ERROR [ 76%]
tests/test_message_quality.py::TestTemplatesEndpoint::test_get_templates_success ERROR [ 76%]
tests/test_message_quality.py::TestTemplatesEndpoint::test_get_templates_with_language_filter ERROR [ 76%]
tests/test_message_quality.py::TestTemplatesEndpoint::test_get_templates_with_category_filter ERROR [ 76%]
tests/test_message_quality.py::TestTemplatesEndpoint::test_get_templates_with_pagination ERROR [ 76%]
tests/test_message_quality.py::TestTemplatesEndpoint::test_get_templates_invalid_limit ERROR [ 76%]
tests/test_message_quality.py::TestTemplatesEndpoint::test_get_templates_requires_auth ERROR [ 76%]
tests/test_message_quality.py::TestTemplatesEndpoint::test_create_template_success ERROR [ 76%]
tests/test_message_quality.py::TestTemplatesEndpoint::test_create_template_french ERROR [ 76%]
tests/test_message_quality.py::TestTemplatesEndpoint::test_create_template_requires_auth ERROR [ 76%]
tests/test_message_quality.py::TestTemplatesEndpoint::test_create_template_missing_required_fields ERROR [ 76%]
tests/test_message_quality.py::TestTemplatesEndpoint::test_create_template_invalid_category ERROR [ 76%]
tests/test_message_quality.py::TestTrainingExamplesEndpoint::test_get_training_examples_success ERROR [ 77%]
tests/test_message_quality.py::TestTrainingExamplesEndpoint::test_get_training_examples_with_language_filter ERROR [ 77%]
tests/test_message_quality.py::TestTrainingExamplesEndpoint::test_get_training_examples_with_issue_type_filter ERROR [ 77%]
tests/test_message_quality.py::TestTrainingExamplesEndpoint::test_get_training_examples_with_difficulty_filter ERROR [ 77%]
tests/test_message_quality.py::TestTrainingExamplesEndpoint::test_get_training_examples_with_pagination ERROR [ 77%]
tests/test_message_quality.py::TestTrainingExamplesEndpoint::test_get_training_examples_invalid_limit ERROR [ 77%]
tests/test_message_quality.py::TestTrainingExamplesEndpoint::test_get_training_examples_requires_auth ERROR [ 77%]
tests/test_message_quality.py::TestTrainingExamplesEndpoint::test_get_training_examples_response_structure ERROR [ 77%]
tests/test_message_quality.py::TestTrainingExamplesEndpoint::test_get_training_examples_multiple_filters ERROR [ 77%]
tests/test_message_quality.py::TestAPIEdgeCasesAndErrorHandling::test_api_invalid_uuid_format ERROR [ 77%]
tests/test_message_quality.py::TestAPIEdgeCasesAndErrorHandling::test_api_whitespace_only_message ERROR [ 77%]
tests/test_message_quality.py::TestAPIEdgeCasesAndErrorHandling::test_api_very_long_message ERROR [ 77%]
tests/test_message_quality.py::TestAPIEdgeCasesAndErrorHandling::test_api_message_exceeds_max_length ERROR [ 77%]
tests/test_message_quality.py::TestAPIEdgeCasesAndErrorHandling::test_api_template_content_exceeds_max_length ERROR [ 77%]
tests/test_message_quality.py::TestAPIEdgeCasesAndErrorHandling::test_api_invalid_offset_returns_422 ERROR [ 77%]
tests/test_messaging.py::TestMessagingServiceThreads::test_create_thread_returns_valid_response FAILED [ 77%]
tests/test_messaging.py::TestMessagingServiceThreads::test_create_thread_adds_creator_as_participant FAILED [ 77%]
tests/test_messaging.py::TestMessagingServiceThreads::test_create_thread_empty_subject_raises_error PASSED [ 77%]
tests/test_messaging.py::TestMessagingServiceThreads::test_get_thread_returns_thread ERROR [ 78%]
tests/test_messaging.py::TestMessagingServiceThreads::test_get_thread_not_found_raises_error FAILED [ 78%]
tests/test_messaging.py::TestMessagingServiceThreads::test_get_thread_unauthorized_raises_error ERROR [ 78%]
tests/test_messaging.py::TestMessagingServiceThreads::test_list_threads_for_user_returns_threads ERROR [ 78%]
tests/test_messaging.py::TestMessagingServiceThreads::test_list_threads_for_user_filters_by_child ERROR [ 78%]
tests/test_messaging.py::TestMessagingServiceThreads::test_list_threads_excludes_archived_by_default FAILED [ 78%]
tests/test_messaging.py::TestMessagingServiceThreads::test_update_thread_changes_subject ERROR [ 78%]
tests/test_messaging.py::TestMessagingServiceThreads::test_archive_thread_sets_inactive ERROR [ 78%]
tests/test_messaging.py::TestMessagingServiceMessages::test_send_message_returns_valid_response ERROR [ 78%]
tests/test_messaging.py::TestMessagingServiceMessages::test_send_message_to_archived_thread_raises_error FAILED [ 78%]
tests/test_messaging.py::TestMessagingServiceMessages::test_get_message_returns_message ERROR [ 78%]
tests/test_messaging.py::TestMessagingServiceMessages::test_get_message_not_found_raises_error FAILED [ 78%]
tests/test_messaging.py::TestMessagingServiceMessages::test_list_messages_returns_messages ERROR [ 78%]
tests/test_messaging.py::TestMessagingServiceMessages::test_mark_messages_as_read_updates_status ERROR [ 78%]
tests/test_messaging.py::TestMessagingServiceMessages::test_mark_own_messages_as_read_does_nothing ERROR [ 78%]
tests/test_messaging.py::TestMessagingServiceMessages::test_mark_thread_as_read_updates_all_messages ERROR [ 78%]
tests/test_messaging.py::TestMessagingServiceMessages::test_delete_message_removes_message ERROR [ 78%]
tests/test_messaging.py::TestMessagingServiceMessages::test_delete_message_by_non_sender_raises_error ERROR [ 78%]
tests/test_messaging.py::TestMessagingServiceMessages::test_get_unread_count_returns_correct_counts ERROR [ 79%]
tests/test_messaging.py::TestMessagingServiceNotifications::test_create_notification_preference_success FAILED [ 79%]
tests/test_messaging.py::TestMessagingServiceNotifications::test_create_notification_preference_updates_existing ERROR [ 79%]
tests/test_messaging.py::TestMessagingServiceNotifications::test_get_notification_preferences_returns_all FAILED [ 79%]
tests/test_messaging.py::TestMessagingServiceNotifications::test_get_notification_preference_not_found_raises_error FAILED [ 79%]
tests/test_messaging.py::TestMessagingServiceNotifications::test_delete_notification_preference_success ERROR [ 79%]
tests/test_messaging.py::TestMessagingServiceNotifications::test_get_or_create_default_preferences FAILED [ 79%]
tests/test_messaging.py::TestMessagingServiceNotifications::test_set_quiet_hours_updates_all_preferences FAILED [ 79%]
tests/test_messaging.py::TestMessagingServiceNotifications::test_is_notification_enabled_returns_correct_status ERROR [ 79%]
tests/test_messaging.py::TestMessagingServiceNotifications::test_is_notification_enabled_defaults_to_true FAILED [ 79%]
tests/test_messaging.py::TestMentionExtraction::test_extract_mentions_with_username PASSED [ 79%]
tests/test_messaging.py::TestMentionExtraction::test_extract_mentions_with_bracket_name PASSED [ 79%]
tests/test_messaging.py::TestMentionExtraction::test_extract_mentions_with_uuid PASSED [ 79%]
tests/test_messaging.py::TestMentionExtraction::test_extract_mentions_multiple PASSED [ 79%]
tests/test_messaging.py::TestMentionExtraction::test_extract_mentions_empty_content PASSED [ 79%]
tests/test_messaging.py::TestMentionExtraction::test_extract_mentions_no_mentions PASSED [ 79%]
tests/test_messaging.py::TestMentionExtraction::test_extract_mentions_removes_duplicates PASSED [ 79%]
tests/test_messaging.py::TestMentionExtraction::test_extract_mention_uuids_returns_valid_uuids PASSED [ 79%]
tests/test_messaging.py::TestMentionExtraction::test_is_staff_sender_educator PASSED [ 80%]
tests/test_messaging.py::TestMentionExtraction::test_is_staff_sender_director PASSED [ 80%]
tests/test_messaging.py::TestMentionExtraction::test_is_staff_sender_admin PASSED [ 80%]
tests/test_messaging.py::TestMentionExtraction::test_is_staff_sender_parent PASSED [ 80%]
tests/test_messaging.py::TestMentionExtraction::test_format_mentions_for_display_username PASSED [ 80%]
tests/test_messaging.py::TestMentionExtraction::test_format_mentions_for_display_bracket_name PASSED [ 80%]
tests/test_messaging.py::TestMentionExtraction::test_strip_mention_formatting PASSED [ 80%]
tests/test_messaging.py::TestPrivateNoteVisibility::test_can_view_private_note_staff_always_sees PASSED [ 80%]
tests/test_messaging.py::TestPrivateNoteVisibility::test_can_view_private_note_parent_in_list PASSED [ 80%]
tests/test_messaging.py::TestPrivateNoteVisibility::test_can_view_private_note_parent_not_in_list PASSED [ 80%]
tests/test_messaging.py::TestPrivateNoteVisibility::test_resolve_mentions_to_participants PASSED [ 80%]
tests/test_messaging.py::TestThreadEndpoints::test_create_thread_endpoint_success ERROR [ 80%]
tests/test_messaging.py::TestThreadEndpoints::test_create_thread_endpoint_requires_auth ERROR [ 80%]
tests/test_messaging.py::TestThreadEndpoints::test_list_threads_endpoint_success ERROR [ 80%]
tests/test_messaging.py::TestThreadEndpoints::test_list_threads_endpoint_with_filters ERROR [ 80%]
tests/test_messaging.py::TestThreadEndpoints::test_get_thread_endpoint_not_found ERROR [ 80%]
tests/test_messaging.py::TestMessageEndpoints::test_send_message_endpoint_thread_not_found ERROR [ 80%]
tests/test_messaging.py::TestMessageEndpoints::test_list_messages_endpoint_thread_not_found ERROR [ 80%]
tests/test_messaging.py::TestMessageEndpoints::test_mark_messages_as_read_endpoint_requires_auth ERROR [ 81%]
tests/test_messaging.py::TestMessageEndpoints::test_get_message_endpoint_not_found ERROR [ 81%]
tests/test_messaging.py::TestNotificationPreferenceEndpoints::test_create_preference_endpoint_success ERROR [ 81%]
tests/test_messaging.py::TestNotificationPreferenceEndpoints::test_get_preferences_endpoint_returns_list ERROR [ 81%]
tests/test_messaging.py::TestNotificationPreferenceEndpoints::test_get_specific_preference_endpoint_not_found ERROR [ 81%]
tests/test_messaging.py::TestNotificationPreferenceEndpoints::test_delete_preference_endpoint_not_found ERROR [ 81%]
tests/test_messaging.py::TestNotificationPreferenceEndpoints::test_create_default_preferences_endpoint ERROR [ 81%]
tests/test_messaging.py::TestNotificationPreferenceEndpoints::test_set_quiet_hours_endpoint ERROR [ 81%]
tests/test_messaging.py::TestThreadEndpointIntegration::test_endpoint_create_thread_with_initial_message ERROR [ 81%]
tests/test_messaging.py::TestThreadEndpointIntegration::test_endpoint_create_question_thread_type ERROR [ 81%]
tests/test_messaging.py::TestThreadEndpointIntegration::test_endpoint_create_urgent_thread_type ERROR [ 81%]
tests/test_messaging.py::TestThreadEndpointIntegration::test_endpoint_get_thread_with_messages ERROR [ 81%]
tests/test_messaging.py::TestThreadEndpointIntegration::test_endpoint_update_thread_subject ERROR [ 81%]
tests/test_messaging.py::TestThreadEndpointIntegration::test_endpoint_archive_thread ERROR [ 81%]
tests/test_messaging.py::TestThreadEndpointIntegration::test_endpoint_list_threads_pagination ERROR [ 81%]
tests/test_messaging.py::TestThreadEndpointIntegration::test_endpoint_list_threads_filter_by_type ERROR [ 81%]
tests/test_messaging.py::TestThreadEndpointIntegration::test_endpoint_create_thread_invalid_thread_type ERROR [ 81%]
tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_send_message_success ERROR [ 81%]
tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_send_message_with_mentions ERROR [ 82%]
tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_list_messages_success ERROR [ 82%]
tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_list_messages_pagination ERROR [ 82%]
tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_get_message_success ERROR [ 82%]
tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_mark_messages_as_read_success ERROR [ 82%]
tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_mark_thread_as_read_success ERROR [ 82%]
tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_delete_message_success ERROR [ 82%]
tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_get_unread_count_success ERROR [ 82%]
tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_send_message_empty_content ERROR [ 82%]
tests/test_messaging.py::TestNotificationEndpointIntegration::test_endpoint_create_preference_with_quiet_hours ERROR [ 82%]
tests/test_messaging.py::TestNotificationEndpointIntegration::test_endpoint_update_preference_toggle_enabled ERROR [ 82%]
tests/test_messaging.py::TestNotificationEndpointIntegration::test_endpoint_get_specific_preference_success ERROR [ 82%]
tests/test_messaging.py::TestNotificationEndpointIntegration::test_endpoint_delete_preference_success ERROR [ 82%]
tests/test_messaging.py::TestNotificationEndpointIntegration::test_endpoint_notification_preferences_requires_auth ERROR [ 82%]
tests/test_messaging.py::TestNotificationEndpointIntegration::test_endpoint_batch_update_preferences ERROR [ 82%]
tests/test_messaging.py::TestEndpointErrorHandling::test_endpoint_invalid_uuid_thread ERROR [ 82%]
tests/test_messaging.py::TestEndpointErrorHandling::test_endpoint_invalid_uuid_message ERROR [ 82%]
tests/test_messaging.py::TestEndpointErrorHandling::test_endpoint_invalid_uuid_child ERROR [ 82%]
tests/test_messaging.py::TestEndpointErrorHandling::test_endpoint_missing_required_subject ERROR [ 83%]
tests/test_messaging.py::TestEndpointErrorHandling::test_endpoint_missing_required_content ERROR [ 83%]
tests/test_messaging.py::TestEndpointErrorHandling::test_endpoint_notification_invalid_type ERROR [ 83%]
tests/test_messaging.py::TestEndpointErrorHandling::test_endpoint_notification_invalid_channel ERROR [ 83%]
tests/test_messaging.py::TestEndpointErrorHandling::test_endpoint_send_message_to_archived_thread ERROR [ 83%]
tests/test_messaging.py::TestEndpointSchemaValidation::test_endpoint_thread_type_enum_values PASSED [ 83%]
tests/test_messaging.py::TestEndpointSchemaValidation::test_endpoint_sender_type_enum_values PASSED [ 83%]
tests/test_messaging.py::TestEndpointSchemaValidation::test_endpoint_content_type_enum_values PASSED [ 83%]
tests/test_messaging.py::TestEndpointSchemaValidation::test_endpoint_notification_type_enum_values PASSED [ 83%]
tests/test_messaging.py::TestEndpointSchemaValidation::test_endpoint_notification_channel_enum_values PASSED [ 83%]
tests/test_messaging.py::TestEndpointSchemaValidation::test_endpoint_notification_frequency_enum_values PASSED [ 83%]
tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_step1_admin_initiates_mfa_setup FAILED [ 83%]
tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_step2_qr_code_and_secret_stored FAILED [ 83%]
tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_step3_user_verifies_totp_to_enable_mfa FAILED [ 83%]
tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_step3_invalid_code_rejected FAILED [ 83%]
tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_step4_subsequent_logins_require_totp FAILED [ 83%]
tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_step5_backup_codes_generated_and_used FAILED [ 83%]
tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_step6_ip_whitelist_bypasses_mfa FAILED [ 83%]
tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_lockout_and_recovery FAILED [ 84%]
tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_disable_mfa FAILED  [ 84%]
tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_complete_flow FAILED [ 84%]
tests/test_mfa_e2e.py::TestMFASecurityFeatures::test_totp_time_window_tolerance FAILED [ 84%]
tests/test_mfa_e2e.py::TestMFASecurityFeatures::test_backup_code_hashing FAILED [ 84%]
tests/test_mfa_e2e.py::TestMFASecurityFeatures::test_mfa_not_bypassed_without_whitelist FAILED [ 84%]
tests/test_mfa_service.py::TestMFASettingsModel::test_create_mfa_settings FAILED [ 84%]
tests/test_mfa_service.py::TestMFASettingsModel::test_mfa_settings_repr FAILED [ 84%]
tests/test_mfa_service.py::TestMFASettingsModel::test_mfa_settings_default_values FAILED [ 84%]
tests/test_mfa_service.py::TestMFABackupCodeModel::test_create_backup_code FAILED [ 84%]
tests/test_mfa_service.py::TestMFABackupCodeModel::test_backup_code_repr FAILED [ 84%]
tests/test_mfa_service.py::TestMFAIPWhitelistModel::test_create_ip_whitelist_entry FAILED [ 84%]
tests/test_mfa_service.py::TestMFAIPWhitelistModel::test_ip_whitelist_repr FAILED [ 84%]
tests/test_mfa_service.py::TestMFAServiceStatus::test_get_status_no_mfa_setup FAILED [ 84%]
tests/test_mfa_service.py::TestMFAServiceSetup::test_initiate_setup_generates_secret FAILED [ 84%]
tests/test_mfa_service.py::TestMFAServiceSetup::test_initiate_setup_with_recovery_email FAILED [ 84%]
tests/test_mfa_service.py::TestMFAServiceVerifyTOTP::test_verify_totp_raises_when_no_settings FAILED [ 84%]
tests/test_mfa_service.py::TestMFAServiceEnableDisable::test_enable_mfa_with_valid_code FAILED [ 84%]
tests/test_mfa_service.py::TestMFAServiceEnableDisable::test_enable_mfa_fails_with_invalid_code FAILED [ 85%]
tests/test_mfa_service.py::TestMFAServiceEnableDisable::test_disable_mfa_raises_when_not_enabled FAILED [ 85%]
tests/test_mfa_service.py::TestMFAServiceLockout::test_reset_lockout_returns_false_for_nonexistent_user FAILED [ 85%]
tests/test_mfa_service.py::TestMFAServiceBackupCodes::test_generate_backup_codes_requires_mfa_enabled FAILED [ 85%]
tests/test_mfa_service.py::TestMFAServiceIPWhitelist::test_ip_whitelist_requires_mfa_enabled FAILED [ 85%]
tests/test_mfa_service.py::TestMFAServiceEdgeCases::test_ip_match_handles_invalid_format PASSED [ 85%]
tests/test_mfa_service.py::TestMFAServiceEdgeCases::test_ip_match_exact PASSED [ 85%]
tests/test_mfa_service.py::TestMFAServiceEdgeCases::test_ip_match_cidr PASSED [ 85%]
tests/test_mfa_service.py::TestMFAServiceEdgeCases::test_check_ip_whitelisted_no_mfa FAILED [ 85%]
tests/test_middleware_auth.py::test_verify_ai_service_token PASSED       [ 85%]
tests/test_middleware_auth.py::test_verify_gibbon_token PASSED           [ 85%]
tests/test_middleware_auth.py::test_expired_token_raises_exception PASSED [ 85%]
tests/test_middleware_auth.py::test_invalid_token_raises_exception PASSED [ 85%]
tests/test_middleware_auth.py::test_token_without_sub_raises_exception PASSED [ 85%]
tests/test_middleware_auth.py::test_gibbon_token_without_username_raises_exception PASSED [ 85%]
tests/test_middleware_auth.py::test_token_with_wrong_secret_raises_exception PASSED [ 85%]
tests/test_middleware_auth.py::test_extract_user_info_ai_service PASSED  [ 85%]
tests/test_middleware_auth.py::test_extract_user_info_gibbon PASSED      [ 85%]
tests/test_middleware_auth.py::test_extract_user_info_defaults_to_ai_service PASSED [ 86%]
tests/test_middleware_auth.py::test_verify_token_accepts_unknown_source PASSED [ 86%]
tests/test_migration_verification.py::TestMigrationVerifier::test_initialization PASSED [ 86%]
tests/test_migration_verification.py::TestMigrationVerifier::test_verbose_mode PASSED [ 86%]
tests/test_migration_verification.py::TestMigrationVerifier::test_get_engine PASSED [ 86%]
tests/test_migration_verification.py::TestMigrationVerifier::test_get_head_revision PASSED [ 86%]
tests/test_migration_verification.py::TestMigrationVerifier::test_get_all_revisions PASSED [ 86%]
tests/test_migration_verification.py::TestMigrationVerifier::test_get_pending_migrations_none_applied PASSED [ 86%]
tests/test_migration_verification.py::TestMigrationVerifier::test_get_pending_migrations_up_to_date PASSED [ 86%]
tests/test_migration_verification.py::TestMigrationVerifier::test_get_pending_migrations_behind PASSED [ 86%]
tests/test_migration_verification.py::TestMigrationVerifier::test_check_migration_status_up_to_date PASSED [ 86%]
tests/test_migration_verification.py::TestMigrationVerifier::test_check_migration_status_behind PASSED [ 86%]
tests/test_migration_verification.py::TestMigrationVerifier::test_check_migration_status_no_migrations PASSED [ 86%]
tests/test_migration_verification.py::TestMigrationVerifier::test_check_migration_files_valid PASSED [ 86%]
tests/test_migration_verification.py::TestMigrationVerifier::test_check_migration_files_duplicate_revisions PASSED [ 86%]
tests/test_migration_verification.py::TestMigrationVerifier::test_check_database_tables PASSED [ 86%]
tests/test_migration_verification.py::TestMigrationVerifier::test_check_database_tables_no_alembic_version PASSED [ 86%]
tests/test_migration_verification.py::TestMigrationVerifier::test_check_schema_consistency_match PASSED [ 86%]
tests/test_migration_verification.py::TestMigrationVerifier::test_check_schema_consistency_mismatch PASSED [ 87%]
tests/test_migration_verification.py::TestMigrationVerifier::test_test_upgrade_up_to_date PASSED [ 87%]
tests/test_migration_verification.py::TestMigrationVerifier::test_test_upgrade_pending PASSED [ 87%]
tests/test_migration_verification.py::TestMigrationVerifier::test_test_upgrade_missing_upgrade_function PASSED [ 87%]
tests/test_migration_verification.py::TestMigrationVerifier::test_test_downgrade_all_have_downgrade PASSED [ 87%]
tests/test_migration_verification.py::TestMigrationVerifier::test_test_downgrade_missing_downgrade PASSED [ 87%]
tests/test_migration_verification.py::TestMigrationVerifier::test_verify_basic PASSED [ 87%]
tests/test_migration_verification.py::TestMigrationVerifier::test_verify_full PASSED [ 87%]
tests/test_migration_verification.py::TestMigrationVerifier::test_verify_with_schema PASSED [ 87%]
tests/test_migration_verification.py::TestMigrationVerifier::test_verify_with_failures PASSED [ 87%]
tests/test_migration_verification.py::TestMigrationVerifier::test_message_methods PASSED [ 87%]
tests/test_migration_verification.py::test_main_success PASSED           [ 87%]
tests/test_migration_verification.py::test_main_failure PASSED           [ 87%]
tests/test_migration_verification.py::test_main_exception PASSED         [ 87%]
tests/test_qa_diagnostics.py::TestQADiagnosticsIngestion::test_ingest_minimal_diagnostics_success ERROR [ 87%]
tests/test_qa_diagnostics.py::TestQADiagnosticsIngestion::test_ingest_full_diagnostics_success ERROR [ 87%]
tests/test_qa_diagnostics.py::TestQADiagnosticsIngestion::test_ingest_diagnostics_missing_auth ERROR [ 87%]
tests/test_qa_diagnostics.py::TestQADiagnosticsIngestion::test_ingest_diagnostics_invalid_token ERROR [ 87%]
tests/test_qa_diagnostics.py::TestQADiagnosticsValidation::test_missing_test_run_id ERROR [ 88%]
tests/test_qa_diagnostics.py::TestQADiagnosticsValidation::test_invalid_test_run_id_format ERROR [ 88%]
tests/test_qa_diagnostics.py::TestQADiagnosticsValidation::test_missing_app_metadata ERROR [ 88%]
tests/test_qa_diagnostics.py::TestQADiagnosticsValidation::test_missing_device_metadata ERROR [ 88%]
tests/test_qa_diagnostics.py::TestQADiagnosticsValidation::test_invalid_app_version_format ERROR [ 88%]
tests/test_qa_diagnostics.py::TestQADiagnosticsValidation::test_invalid_ios_version_format ERROR [ 88%]
tests/test_qa_diagnostics.py::TestQADiagnosticsValidation::test_invalid_battery_level ERROR [ 88%]
tests/test_qa_diagnostics.py::TestQADiagnosticsValidation::test_invalid_log_level ERROR [ 88%]
tests/test_qa_diagnostics.py::TestQADiagnosticsValidation::test_invalid_network_error_type ERROR [ 88%]
tests/test_qa_diagnostics.py::TestQADiagnosticsHealthCheck::test_health_check_success ERROR [ 88%]
tests/test_qa_diagnostics.py::TestQADiagnosticsHealthCheck::test_health_check_no_auth_required ERROR [ 88%]
tests/test_qa_diagnostics.py::TestQADiagnosticsRetrieval::test_get_diagnostics_not_found ERROR [ 88%]
tests/test_qa_diagnostics.py::TestQADiagnosticsRetrieval::test_get_diagnostics_by_run_empty ERROR [ 88%]
tests/test_qa_diagnostics.py::TestQADiagnosticsRetrieval::test_get_diagnostics_requires_auth ERROR [ 88%]
tests/test_qa_diagnostics.py::TestQADiagnosticsSchemaValidation::test_log_message_max_length ERROR [ 88%]
tests/test_qa_diagnostics.py::TestQADiagnosticsSchemaValidation::test_status_code_valid_range ERROR [ 88%]
tests/test_qa_diagnostics.py::TestQADiagnosticsSchemaValidation::test_null_status_code_allowed ERROR [ 88%]
tests/test_qa_diagnostics.py::TestQADiagnosticsSchemaValidation::test_empty_logs_array_allowed ERROR [ 88%]
tests/test_qa_diagnostics.py::TestQADiagnosticsSchemaValidation::test_custom_data_allowed ERROR [ 89%]
tests/test_query_optimization.py::test_activity_relationships_without_eager_loading FAILED [ 89%]
tests/test_query_optimization.py::test_activity_relationships_with_eager_loading FAILED [ 89%]
tests/test_query_optimization.py::test_participation_relationships_with_eager_loading FAILED [ 89%]
tests/test_query_optimization.py::test_coaching_session_relationships_with_eager_loading FAILED [ 89%]
tests/test_query_optimization.py::test_activity_service_get_participations_optimization FAILED [ 89%]
tests/test_query_optimization.py::test_coaching_service_get_sessions_optimization FAILED [ 89%]
tests/test_query_optimization.py::test_query_count_improvement PASSED    [ 89%]
tests/test_review_reminders.py::test_plan_review_reminder_schema_valid PASSED [ 89%]
tests/test_review_reminders.py::test_plan_review_reminder_overdue PASSED [ 89%]
tests/test_review_reminders.py::test_plan_review_reminder_due_today PASSED [ 89%]
tests/test_review_reminders.py::test_plan_review_reminder_list_response_schema PASSED [ 89%]
tests/test_review_reminders.py::test_plan_review_reminder_list_response_empty PASSED [ 89%]
tests/test_review_reminders.py::test_plan_review_reminder_list_response_defaults PASSED [ 89%]
tests/test_review_reminders.py::test_get_plans_for_review_returns_overdue_plans PASSED [ 89%]
tests/test_review_reminders.py::test_get_plans_for_review_returns_upcoming_plans PASSED [ 89%]
tests/test_review_reminders.py::test_get_plans_for_review_mixed_overdue_and_upcoming PASSED [ 89%]
tests/test_review_reminders.py::test_get_plans_for_review_empty_result PASSED [ 89%]
tests/test_review_reminders.py::test_get_plans_for_review_custom_days_ahead PASSED [ 90%]
tests/test_review_reminders.py::test_get_plans_for_review_response_structure PASSED [ 90%]
tests/test_review_reminders.py::test_get_plans_for_review_active_status_only PASSED [ 90%]
tests/test_review_reminders.py::test_get_plans_for_review_default_days_ahead PASSED [ 90%]
tests/test_review_reminders.py::test_get_plans_for_review_sorted_by_date PASSED [ 90%]
tests/test_review_reminders.py::test_all_review_schedules_valid PASSED   [ 90%]
tests/test_review_reminders.py::test_review_schedule_enum_values PASSED  [ 90%]
tests/test_review_reminders.py::test_calculate_next_review_date_from_today PASSED [ 90%]
tests/test_review_reminders.py::test_days_until_review_calculation PASSED [ 90%]
tests/test_review_reminders.py::test_review_window_boundary_cases PASSED [ 90%]
tests/test_review_reminders.py::test_review_eligible_statuses PASSED     [ 90%]
tests/test_review_reminders.py::test_plan_review_reminder_with_long_child_name PASSED [ 90%]
tests/test_review_reminders.py::test_plan_review_reminder_with_long_title PASSED [ 90%]
tests/test_review_reminders.py::test_get_plans_for_review_with_zero_days_ahead PASSED [ 90%]
tests/test_review_reminders.py::test_get_plans_for_review_large_days_ahead PASSED [ 90%]
tests/test_review_reminders.py::test_get_plans_for_review_multiple_children PASSED [ 90%]
tests/test_review_reminders.py::test_get_plans_for_review_same_child_multiple_plans PASSED [ 90%]
tests/test_seed_idempotency.py::TestSeedIdempotency::test_seed_activities_idempotent ERROR [ 90%]
tests/test_seed_idempotency.py::TestSeedIdempotency::test_seed_activity_participations_idempotent ERROR [ 91%]
tests/test_seed_idempotency.py::TestSeedIdempotency::test_seed_activity_recommendations_idempotent ERROR [ 91%]
tests/test_seed_idempotency.py::TestSeedIdempotency::test_seed_coaching_sessions_idempotent ERROR [ 91%]
tests/test_seed_idempotency.py::TestSeedIdempotency::test_seed_parent_reports_idempotent ERROR [ 91%]
tests/test_seed_idempotency.py::TestSeedIdempotency::test_seed_home_activities_idempotent ERROR [ 91%]
tests/test_seed_idempotency.py::TestSeedIdempotency::test_seed_communication_preferences_idempotent ERROR [ 91%]
tests/test_seed_idempotency.py::TestSeedIdempotency::test_full_seed_script_idempotent ERROR [ 91%]
tests/test_seed_idempotency.py::TestSeedIdempotency::test_no_duplicate_activities_by_name ERROR [ 91%]
tests/test_seed_idempotency.py::TestSeedIdempotency::test_data_integrity_after_multiple_runs ERROR [ 91%]
tests/test_seed_idempotency.py::TestSeedEdgeCases::test_seed_with_empty_database ERROR [ 91%]
tests/test_seed_idempotency.py::TestSeedEdgeCases::test_seed_with_partial_data ERROR [ 91%]
tests/test_storage.py::TestFileModel::test_create_file_with_all_fields ERROR [ 91%]
tests/test_storage.py::TestFileModel::test_file_repr ERROR               [ 91%]
tests/test_storage.py::TestFileModel::test_create_public_file ERROR      [ 91%]
tests/test_storage.py::TestFileModel::test_file_with_thumbnails ERROR    [ 91%]
tests/test_storage.py::TestFileThumbnailModel::test_create_thumbnail ERROR [ 91%]
tests/test_storage.py::TestFileThumbnailModel::test_thumbnail_repr ERROR [ 91%]
tests/test_storage.py::TestStorageQuotaModel::test_create_storage_quota ERROR [ 91%]
tests/test_storage.py::TestStorageQuotaModel::test_storage_quota_available_bytes ERROR [ 92%]
tests/test_storage.py::TestStorageQuotaModel::test_storage_quota_usage_percentage ERROR [ 92%]
tests/test_storage.py::TestStorageQuotaModel::test_storage_quota_near_limit ERROR [ 92%]
tests/test_storage.py::TestStorageQuotaModel::test_empty_storage_quota ERROR [ 92%]
tests/test_storage.py::TestStorageQuotaModel::test_storage_quota_repr ERROR [ 92%]
tests/test_storage.py::TestStorageServiceHelpers::test_is_image_file_jpeg FAILED [ 92%]
tests/test_storage.py::TestStorageServiceHelpers::test_is_image_file_png FAILED [ 92%]
tests/test_storage.py::TestStorageServiceHelpers::test_is_image_file_gif FAILED [ 92%]
tests/test_storage.py::TestStorageServiceHelpers::test_is_image_file_webp FAILED [ 92%]
tests/test_storage.py::TestStorageServiceHelpers::test_is_image_file_pdf_false FAILED [ 92%]
tests/test_storage.py::TestStorageServiceHelpers::test_is_image_file_text_false FAILED [ 92%]
tests/test_storage.py::TestStorageServiceQuota::test_get_or_create_quota_creates_new FAILED [ 92%]
tests/test_storage.py::TestStorageServiceQuota::test_get_or_create_quota_returns_existing ERROR [ 92%]
tests/test_storage.py::TestStorageServiceQuota::test_check_quota_returns_true_when_available ERROR [ 92%]
tests/test_storage.py::TestStorageServiceQuota::test_check_quota_returns_false_when_exceeded ERROR [ 92%]
tests/test_storage.py::TestStorageServiceQuota::test_check_quota_raises_when_exceeded ERROR [ 92%]
tests/test_storage.py::TestStorageServiceQuota::test_get_quota_usage_returns_stats ERROR [ 92%]
tests/test_storage.py::TestStorageServiceQuota::test_update_quota_changes_limit FAILED [ 92%]
tests/test_storage.py::TestStorageServiceQuota::test_update_quota_rejects_negative FAILED [ 93%]
tests/test_storage.py::TestStorageServiceSignedUrls::test_verify_local_signed_url_valid FAILED [ 93%]
tests/test_storage.py::TestStorageServiceSignedUrls::test_verify_local_signed_url_expired FAILED [ 93%]
tests/test_storage.py::TestStorageServiceSignedUrls::test_verify_local_signed_url_invalid_signature FAILED [ 93%]
tests/test_storage.py::TestStorageServiceSignedUrls::test_generate_secure_url_invalid_expiration ERROR [ 93%]
tests/test_storage.py::TestStorageServiceConversion::test_file_to_response FAILED [ 93%]
tests/test_storage.py::TestStorageServiceConversion::test_quota_to_response FAILED [ 93%]
tests/test_storage.py::TestUploadEndpoint::test_upload_requires_auth ERROR [ 93%]
tests/test_storage.py::TestUploadEndpoint::test_upload_missing_file_returns_422 ERROR [ 93%]
tests/test_storage.py::TestGetQuotaEndpoint::test_get_quota_returns_200 ERROR [ 93%]
tests/test_storage.py::TestGetQuotaEndpoint::test_get_quota_requires_auth ERROR [ 93%]
tests/test_storage.py::TestListFilesEndpoint::test_list_files_returns_200 ERROR [ 93%]
tests/test_storage.py::TestListFilesEndpoint::test_list_files_requires_auth ERROR [ 93%]
tests/test_storage.py::TestListFilesEndpoint::test_list_files_pagination ERROR [ 93%]
tests/test_storage.py::TestListFilesEndpoint::test_list_files_content_type_filter ERROR [ 93%]
tests/test_storage.py::TestListFilesEndpoint::test_list_files_public_filter ERROR [ 93%]
tests/test_storage.py::TestGetFileEndpoint::test_get_file_requires_auth ERROR [ 93%]
tests/test_storage.py::TestGetFileEndpoint::test_get_file_not_found ERROR [ 93%]
tests/test_storage.py::TestDownloadFileEndpoint::test_download_file_requires_auth ERROR [ 94%]
tests/test_storage.py::TestDownloadFileEndpoint::test_download_file_not_found ERROR [ 94%]
tests/test_storage.py::TestDeleteFileEndpoint::test_delete_file_requires_auth ERROR [ 94%]
tests/test_storage.py::TestDeleteFileEndpoint::test_delete_file_not_found ERROR [ 94%]
tests/test_storage.py::TestSecureUrlEndpoint::test_secure_url_requires_auth ERROR [ 94%]
tests/test_storage.py::TestSecureUrlEndpoint::test_secure_url_not_found ERROR [ 94%]
tests/test_storage.py::TestSecureUrlEndpoint::test_secure_url_validates_expiration ERROR [ 94%]
tests/test_storage.py::TestEdgeCases::test_invalid_uuid_format_get_file ERROR [ 94%]
tests/test_storage.py::TestEdgeCases::test_invalid_uuid_format_delete_file ERROR [ 94%]
tests/test_storage.py::TestEdgeCases::test_invalid_uuid_format_download ERROR [ 94%]
tests/test_storage.py::TestEdgeCases::test_negative_skip_rejected ERROR  [ 94%]
tests/test_storage.py::TestEdgeCases::test_zero_limit_rejected ERROR     [ 94%]
tests/test_storage.py::TestEdgeCases::test_limit_over_100_rejected ERROR [ 94%]
tests/test_storage.py::TestEdgeCases::test_storage_quota_zero_division PASSED [ 94%]
tests/test_storage.py::TestFileMetadataFixtures::test_sample_file_data_fixture ERROR [ 94%]
tests/test_storage.py::TestFileMetadataFixtures::test_multiple_files_fixture ERROR [ 94%]
tests/test_storage.py::TestFileMetadataFixtures::test_thumbnail_sizes_fixture ERROR [ 94%]
tests/test_storage.py::TestFileMetadataFixtures::test_image_content_types_fixture ERROR [ 94%]
tests/test_storage.py::TestFileMetadataFixtures::test_allowed_content_types_fixture ERROR [ 95%]
tests/test_webhooks.py::TestWebhookPayloadParsing::test_valid_care_activity_payload ERROR [ 95%]
tests/test_webhooks.py::TestWebhookPayloadParsing::test_valid_meal_logged_payload ERROR [ 95%]
tests/test_webhooks.py::TestWebhookPayloadParsing::test_valid_nap_logged_payload ERROR [ 95%]
tests/test_webhooks.py::TestWebhookPayloadParsing::test_valid_photo_uploaded_payload ERROR [ 95%]
tests/test_webhooks.py::TestWebhookPayloadParsing::test_minimal_valid_payload ERROR [ 95%]
tests/test_webhooks.py::TestWebhookPayloadParsing::test_missing_event_type ERROR [ 95%]
tests/test_webhooks.py::TestWebhookPayloadParsing::test_missing_entity_type ERROR [ 95%]
tests/test_webhooks.py::TestWebhookPayloadParsing::test_missing_entity_id ERROR [ 95%]
tests/test_webhooks.py::TestWebhookPayloadParsing::test_invalid_event_type ERROR [ 95%]
tests/test_webhooks.py::TestWebhookPayloadParsing::test_invalid_entity_type ERROR [ 95%]
tests/test_webhooks.py::TestWebhookPayloadParsing::test_empty_entity_id ERROR [ 95%]
tests/test_webhooks.py::TestWebhookPayloadParsing::test_entity_id_too_long ERROR [ 95%]
tests/test_webhooks.py::TestWebhookPayloadParsing::test_empty_payload_dict ERROR [ 95%]
tests/test_webhooks.py::TestWebhookPayloadParsing::test_invalid_gibbon_sync_log_id ERROR [ 95%]
tests/test_webhooks.py::TestWebhookJWTValidation::test_valid_jwt_token ERROR [ 95%]
tests/test_webhooks.py::TestWebhookJWTValidation::test_missing_jwt_token ERROR [ 95%]
tests/test_webhooks.py::TestWebhookJWTValidation::test_expired_jwt_token ERROR [ 95%]
tests/test_webhooks.py::TestWebhookJWTValidation::test_malformed_jwt_token ERROR [ 96%]
tests/test_webhooks.py::TestWebhookJWTValidation::test_invalid_bearer_format ERROR [ 96%]
tests/test_webhooks.py::TestWebhookJWTValidation::test_wrong_auth_scheme ERROR [ 96%]
tests/test_webhooks.py::TestWebhookJWTValidation::test_empty_bearer_token ERROR [ 96%]
tests/test_webhooks.py::TestWebhookJWTValidation::test_jwt_with_additional_claims ERROR [ 96%]
tests/test_webhooks.py::TestWebhookEventProcessing::test_care_activity_created_processing ERROR [ 96%]
tests/test_webhooks.py::TestWebhookEventProcessing::test_care_activity_updated_processing ERROR [ 96%]
tests/test_webhooks.py::TestWebhookEventProcessing::test_care_activity_deleted_processing ERROR [ 96%]
tests/test_webhooks.py::TestWebhookEventProcessing::test_meal_logged_processing ERROR [ 96%]
tests/test_webhooks.py::TestWebhookEventProcessing::test_nap_logged_processing ERROR [ 96%]
tests/test_webhooks.py::TestWebhookEventProcessing::test_photo_uploaded_processing ERROR [ 96%]
tests/test_webhooks.py::TestWebhookEventProcessing::test_attendance_check_in_processing ERROR [ 96%]
tests/test_webhooks.py::TestWebhookEventProcessing::test_attendance_check_out_processing ERROR [ 96%]
tests/test_webhooks.py::TestWebhookEventProcessing::test_child_profile_updated_processing ERROR [ 96%]
tests/test_webhooks.py::TestWebhookEventProcessing::test_custom_event_processing ERROR [ 96%]
tests/test_webhooks.py::TestWebhookEventProcessing::test_all_event_types_return_processing_time ERROR [ 96%]
tests/test_webhooks.py::TestWebhookResponseStructure::test_response_contains_all_required_fields ERROR [ 96%]
tests/test_webhooks.py::TestWebhookResponseStructure::test_response_status_is_processed ERROR [ 96%]
tests/test_webhooks.py::TestWebhookResponseStructure::test_response_echoes_event_type_and_entity_id ERROR [ 97%]
tests/test_webhooks.py::TestWebhookResponseStructure::test_response_received_at_is_valid_timestamp ERROR [ 97%]
tests/test_webhooks.py::TestWebhookResponseStructure::test_processing_time_is_reasonable ERROR [ 97%]
tests/test_webhooks.py::TestWebhookHealthCheck::test_health_check_returns_200 ERROR [ 97%]
tests/test_webhooks.py::TestWebhookHealthCheck::test_health_check_no_auth_required ERROR [ 97%]
tests/test_webhooks.py::TestWebhookHealthCheck::test_health_check_returns_healthy_status ERROR [ 97%]
tests/test_webhooks.py::TestWebhookHealthCheck::test_health_check_timestamp_is_valid ERROR [ 97%]
tests/test_webhooks.py::TestWebhookEdgeCases::test_large_payload_is_accepted ERROR [ 97%]
tests/test_webhooks.py::TestWebhookEdgeCases::test_special_characters_in_entity_id ERROR [ 97%]
tests/test_webhooks.py::TestWebhookEdgeCases::test_unicode_in_payload ERROR [ 97%]
tests/test_webhooks.py::TestWebhookEdgeCases::test_null_optional_fields ERROR [ 97%]
tests/test_webhooks.py::TestWebhookEdgeCases::test_entity_id_at_max_length ERROR [ 97%]
tests/test_webhooks.py::TestWebhookEdgeCases::test_valid_timestamp_format ERROR [ 97%]
tests/test_webhooks.py::TestWebhookEdgeCases::test_payload_with_various_data_types ERROR [ 97%]
tests/utils/test_field_selection.py::TestParseFields::test_parse_simple_fields PASSED [ 97%]
tests/utils/test_field_selection.py::TestParseFields::test_parse_fields_with_whitespace PASSED [ 97%]
tests/utils/test_field_selection.py::TestParseFields::test_parse_single_field PASSED [ 97%]
tests/utils/test_field_selection.py::TestParseFields::test_parse_empty_string PASSED [ 97%]
tests/utils/test_field_selection.py::TestParseFields::test_parse_whitespace_only PASSED [ 98%]
tests/utils/test_field_selection.py::TestParseFields::test_parse_none PASSED [ 98%]
tests/utils/test_field_selection.py::TestParseFields::test_parse_nested_fields PASSED [ 98%]
tests/utils/test_field_selection.py::TestParseFields::test_parse_with_trailing_commas PASSED [ 98%]
tests/utils/test_field_selection.py::TestParseFields::test_parse_duplicate_fields PASSED [ 98%]
tests/utils/test_field_selection.py::TestFilterResponse::test_filter_pydantic_model PASSED [ 98%]
tests/utils/test_field_selection.py::TestFilterResponse::test_filter_dict PASSED [ 98%]
tests/utils/test_field_selection.py::TestFilterResponse::test_filter_with_always_include PASSED [ 98%]
tests/utils/test_field_selection.py::TestFilterResponse::test_filter_none_fields_returns_all PASSED [ 98%]
tests/utils/test_field_selection.py::TestFilterResponse::test_filter_list_of_models PASSED [ 98%]
tests/utils/test_field_selection.py::TestFilterResponse::test_filter_nested_fields PASSED [ 98%]
tests/utils/test_field_selection.py::TestFilterResponse::test_filter_nonexistent_fields PASSED [ 98%]
tests/utils/test_field_selection.py::TestFilterResponse::test_filter_empty_fields_set PASSED [ 98%]
tests/utils/test_field_selection.py::TestFilterResponse::test_filter_with_always_include_only PASSED [ 98%]
tests/utils/test_field_selection.py::TestValidateFields::test_validate_all_valid_fields PASSED [ 98%]
tests/utils/test_field_selection.py::TestValidateFields::test_validate_with_invalid_fields_no_raise PASSED [ 98%]
tests/utils/test_field_selection.py::TestValidateFields::test_validate_with_invalid_fields_raises PASSED [ 98%]
tests/utils/test_field_selection.py::TestValidateFields::test_validate_nested_fields PASSED [ 98%]
tests/utils/test_field_selection.py::TestValidateFields::test_validate_nested_invalid_top_level PASSED [ 99%]
tests/utils/test_field_selection.py::TestValidateFields::test_validate_empty_requested PASSED [ 99%]
tests/utils/test_field_selection.py::TestValidateFields::test_validate_multiple_invalid_fields_raises PASSED [ 99%]
tests/utils/test_field_selection.py::TestFieldSelector::test_field_selector_initialization PASSED [ 99%]
tests/utils/test_field_selection.py::TestFieldSelector::test_field_selector_custom_always_include PASSED [ 99%]
tests/utils/test_field_selection.py::TestFieldSelector::test_filter_fields_with_model PASSED [ 99%]
tests/utils/test_field_selection.py::TestFieldSelector::test_filter_fields_without_model_class PASSED [ 99%]
tests/utils/test_field_selection.py::TestFieldSelector::test_filter_fields_with_validation PASSED [ 99%]
tests/utils/test_field_selection.py::TestFieldSelector::test_is_field_requested_true PASSED [ 99%]
tests/utils/test_field_selection.py::TestFieldSelector::test_is_field_requested_false PASSED [ 99%]
tests/utils/test_field_selection.py::TestFieldSelector::test_is_field_requested_always_include PASSED [ 99%]
tests/utils/test_field_selection.py::TestFieldSelector::test_is_field_requested_no_filtering PASSED [ 99%]
tests/utils/test_field_selection.py::TestFieldSelector::test_filter_fields_list PASSED [ 99%]
tests/utils/test_field_selection.py::TestFieldSelector::test_filter_fields_no_fields PASSED [ 99%]
tests/utils/test_field_selection.py::TestFieldSelectionIntegration::test_api_response_optimization PASSED [ 99%]
tests/utils/test_field_selection.py::TestFieldSelectionIntegration::test_list_response_optimization PASSED [ 99%]
tests/utils/test_field_selection.py::TestFieldSelectionIntegration::test_backward_compatibility PASSED [ 99%]
tests/utils/test_field_selection.py::TestFieldSelectionIntegration::test_security_critical_fields_always_included PASSED [100%]

==================================== ERRORS ====================================
_ ERROR at setup of TestDocumentIDORProtection.test_get_document_by_id_idor_protection _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/ai-service/tests/test_idor_protection_integration.py, line 91
      @pytest.mark.asyncio
      async def test_get_document_by_id_idor_protection(
          self,
          client: AsyncClient,
          user_a_id: UUID,
          user_a_headers: dict[str, str],
          user_b_headers: dict[str, str],
      ):
          """Test that user B cannot access user A's document via GET /api/v1/documents/{id}."""
          # User A creates a document
          create_response = await client.post(
              "/api/v1/documents",
              json={
                  "type": "enrollment",
                  "title": "User A's Enrollment Form",
                  "content_url": "https://example.com/usera-enrollment.pdf",
                  "created_by": str(user_a_id),
              },
              headers=user_a_headers,
          )
          assert create_response.status_code == 201
          document_id = create_response.json()["id"]

          # User A can access their own document
          response_a = await client.get(
              f"/api/v1/documents/{document_id}",
              headers=user_a_headers,
          )
          assert response_a.status_code == 200
          assert response_a.json()["id"] == document_id
          assert response_a.json()["title"] == "User A's Enrollment Form"

          # User B attempts to access user A's document - should get 403 Forbidden
          response_b = await client.get(
              f"/api/v1/documents/{document_id}",
              headers=user_b_headers,
          )
          assert response_b.status_code == 403
          # Verify it's an authorization error (various messages possible)
          detail = response_b.json()["detail"].lower()
          assert any(word in detail for word in ["not authorized", "permission", "access denied", "forbidden"])
E       fixture 'client' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, doctest_namespace, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, user_a_headers, user_a_id, user_a_token, user_b_headers, user_b_id, user_b_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/ai-service/tests/test_idor_protection_integration.py:91
_ ERROR at setup of TestDocumentIDORProtection.test_update_document_idor_protection _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/ai-service/tests/test_idor_protection_integration.py, line 133
      @pytest.mark.asyncio
      async def test_update_document_idor_protection(
          self,
          client: AsyncClient,
          user_a_id: UUID,
          user_a_headers: dict[str, str],
          user_b_headers: dict[str, str],
      ):
          """Test that user B cannot update user A's document via PATCH /api/v1/documents/{id}."""
          # User A creates a document
          create_response = await client.post(
              "/api/v1/documents",
              json={
                  "type": "permission",
                  "title": "User A's Permission Form",
                  "content_url": "https://example.com/usera-permission.pdf",
                  "created_by": str(user_a_id),
              },
              headers=user_a_headers,
          )
          assert create_response.status_code == 201
          document_id = create_response.json()["id"]

          # User A can update their own document
          update_response_a = await client.patch(
              f"/api/v1/documents/{document_id}",
              json={
                  "title": "User A's Updated Permission Form",
                  "status": "pending",
              },
              headers=user_a_headers,
          )
          assert update_response_a.status_code == 200
          assert update_response_a.json()["title"] == "User A's Updated Permission Form"

          # User B attempts to update user A's document - should get 403 Forbidden
          update_response_b = await client.patch(
              f"/api/v1/documents/{document_id}",
              json={
                  "title": "Malicious Update",
                  "status": "signed",
              },
              headers=user_b_headers,
          )
          assert update_response_b.status_code == 403
          # Verify it's an authorization error (various messages possible)
          detail = update_response_b.json()["detail"].lower()
          assert any(word in detail for word in ["not authorized", "permission", "access denied", "forbidden"])

          # Verify document was not modified by user B
          verify_response = await client.get(
              f"/api/v1/documents/{document_id}",
              headers=user_a_headers,
          )
          assert verify_response.status_code == 200
          assert verify_response.json()["title"] == "User A's Updated Permission Form"
          assert verify_response.json()["status"] == "pending"  # Not "signed"
E       fixture 'client' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, doctest_namespace, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, user_a_headers, user_a_id, user_a_token, user_b_headers, user_b_id, user_b_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/ai-service/tests/test_idor_protection_integration.py:133
_ ERROR at setup of TestDocumentIDORProtection.test_document_access_isolation_between_users _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/ai-service/tests/test_idor_protection_integration.py, line 191
      @pytest.mark.asyncio
      async def test_document_access_isolation_between_users(
          self,
          client: AsyncClient,
          user_a_id: UUID,
          user_b_id: UUID,
          user_a_headers: dict[str, str],
          user_b_headers: dict[str, str],
      ):
          """Test that documents are properly isolated between different users."""
          # User A creates a document
          response_a = await client.post(
              "/api/v1/documents",
              json={
                  "type": "financial",
                  "title": "User A's Financial Document",
                  "content_url": "https://example.com/usera-financial.pdf",
                  "created_by": str(user_a_id),
              },
              headers=user_a_headers,
          )
          assert response_a.status_code == 201
          document_a_id = response_a.json()["id"]

          # User B creates their own document
          response_b = await client.post(
              "/api/v1/documents",
              json={
                  "type": "financial",
                  "title": "User B's Financial Document",
                  "content_url": "https://example.com/userb-financial.pdf",
                  "created_by": str(user_b_id),
              },
              headers=user_b_headers,
          )
          assert response_b.status_code == 201
          document_b_id = response_b.json()["id"]

          # User A can only access their own document
          a_access_own = await client.get(
              f"/api/v1/documents/{document_a_id}",
              headers=user_a_headers,
          )
          assert a_access_own.status_code == 200
          assert a_access_own.json()["title"] == "User A's Financial Document"

          # User A cannot access user B's document
          a_access_b = await client.get(
              f"/api/v1/documents/{document_b_id}",
              headers=user_a_headers,
          )
          assert a_access_b.status_code == 403

          # User B can only access their own document
          b_access_own = await client.get(
              f"/api/v1/documents/{document_b_id}",
              headers=user_b_headers,
          )
          assert b_access_own.status_code == 200
          assert b_access_own.json()["title"] == "User B's Financial Document"

          # User B cannot access user A's document
          b_access_a = await client.get(
              f"/api/v1/documents/{document_a_id}",
              headers=user_b_headers,
          )
          assert b_access_a.status_code == 403
E       fixture 'client' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, doctest_namespace, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, user_a_headers, user_a_id, user_a_token, user_b_headers, user_b_id, user_b_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/ai-service/tests/test_idor_protection_integration.py:191
_ ERROR at setup of TestDocumentIDORProtection.test_cross_resource_idor_protection _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/ai-service/tests/test_idor_protection_integration.py, line 259
      @pytest.mark.asyncio
      async def test_cross_resource_idor_protection(
          self,
          client: AsyncClient,
          user_a_id: UUID,
          user_a_headers: dict[str, str],
          user_b_headers: dict[str, str],
      ):
          """Test that manipulating resource IDs is properly blocked across operations."""
          # Create document as user A
          doc_response = await client.post(
              "/api/v1/documents",
              json={
                  "type": "enrollment",
                  "title": "User A's Document",
                  "content_url": "https://example.com/doc.pdf",
                  "created_by": str(user_a_id),
              },
              headers=user_a_headers,
          )
          document_id = doc_response.json()["id"]

          # User B cannot access the resource with GET
          doc_access = await client.get(
              f"/api/v1/documents/{document_id}",
              headers=user_b_headers,
          )
          assert doc_access.status_code == 403

          # User B cannot update the resource with PATCH
          doc_update = await client.patch(
              f"/api/v1/documents/{document_id}",
              json={"title": "Malicious update"},
              headers=user_b_headers,
          )
          assert doc_update.status_code == 403
E       fixture 'client' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, doctest_namespace, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, user_a_headers, user_a_id, user_a_token, user_b_headers, user_b_id, user_b_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/ai-service/tests/test_idor_protection_integration.py:259
____________ ERROR at setup of TestLoginEndpoint.test_login_success ____________

self = <Coroutine test_login_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
________ ERROR at setup of TestLoginEndpoint.test_login_wrong_password _________

self = <Coroutine test_login_wrong_password>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______ ERROR at setup of TestLoginEndpoint.test_login_nonexistent_user ________

self = <Coroutine test_login_nonexistent_user>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_________ ERROR at setup of TestLoginEndpoint.test_login_inactive_user _________

self = <Coroutine test_login_inactive_user>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_________ ERROR at setup of TestLoginEndpoint.test_login_missing_email _________

self = <Coroutine test_login_missing_email>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______ ERROR at setup of TestLoginEndpoint.test_login_missing_password ________

self = <Coroutine test_login_missing_password>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestLoginEndpoint.test_login_invalid_email_format ______

self = <Coroutine test_login_invalid_email_format>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
________ ERROR at setup of TestLoginEndpoint.test_login_empty_password _________

self = <Coroutine test_login_empty_password>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___________ ERROR at setup of TestLoginEndpoint.test_login_all_roles ___________

self = <Coroutine test_login_all_roles>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__________ ERROR at setup of TestRefreshEndpoint.test_refresh_success __________

self = <Coroutine test_refresh_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestRefreshEndpoint.test_refresh_with_access_token_fails __

self = <Coroutine test_refresh_with_access_token_fails>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______ ERROR at setup of TestRefreshEndpoint.test_refresh_expired_token _______

self = <Coroutine test_refresh_expired_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______ ERROR at setup of TestRefreshEndpoint.test_refresh_invalid_token _______

self = <Coroutine test_refresh_invalid_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestRefreshEndpoint.test_refresh_blacklisted_token _____

self = <Coroutine test_refresh_blacklisted_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestRefreshEndpoint.test_refresh_nonexistent_user ______

self = <Coroutine test_refresh_nonexistent_user>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______ ERROR at setup of TestRefreshEndpoint.test_refresh_inactive_user _______

self = <Coroutine test_refresh_inactive_user>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______ ERROR at setup of TestRefreshEndpoint.test_refresh_missing_token _______

self = <Coroutine test_refresh_missing_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestLogoutEndpoint.test_logout_success_access_only _____

self = <Coroutine test_logout_success_access_only>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestLogoutEndpoint.test_logout_success_both_tokens _____

self = <Coroutine test_logout_success_both_tokens>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestLogoutEndpoint.test_logout_invalid_access_token _____

self = <Coroutine test_logout_invalid_access_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestLogoutEndpoint.test_logout_refresh_as_access_fails ___

self = <Coroutine test_logout_refresh_as_access_fails>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestLogoutEndpoint.test_logout_missing_access_token _____

self = <Coroutine test_logout_missing_access_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestLogoutEndpoint.test_logout_expired_access_token _____

self = <Coroutine test_logout_expired_access_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestLogoutEndpoint.test_logout_ignores_invalid_refresh ___

self = <Coroutine test_logout_ignores_invalid_refresh>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestPasswordResetRequestEndpoint.test_password_reset_request_existing_user _

self = <Coroutine test_password_reset_request_existing_user>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestPasswordResetRequestEndpoint.test_password_reset_request_nonexistent_user _

self = <Coroutine test_password_reset_request_nonexistent_user>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestPasswordResetRequestEndpoint.test_password_reset_request_inactive_user _

self = <Coroutine test_password_reset_request_inactive_user>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestPasswordResetRequestEndpoint.test_password_reset_request_missing_email _

self = <Coroutine test_password_reset_request_missing_email>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestPasswordResetRequestEndpoint.test_password_reset_request_invalid_email _

self = <Coroutine test_password_reset_request_invalid_email>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestPasswordResetRequestEndpoint.test_password_reset_email_masking _

self = <Coroutine test_password_reset_email_masking>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestPasswordResetConfirmEndpoint.test_password_reset_confirm_success _

self = <Coroutine test_password_reset_confirm_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestPasswordResetConfirmEndpoint.test_password_reset_confirm_invalid_token _

self = <Coroutine test_password_reset_confirm_invalid_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestPasswordResetConfirmEndpoint.test_password_reset_confirm_used_token _

self = <Coroutine test_password_reset_confirm_used_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestPasswordResetConfirmEndpoint.test_password_reset_confirm_expired_token _

self = <Coroutine test_password_reset_confirm_expired_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestPasswordResetConfirmEndpoint.test_password_reset_confirm_missing_token _

self = <Coroutine test_password_reset_confirm_missing_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestPasswordResetConfirmEndpoint.test_password_reset_confirm_missing_password _

self = <Coroutine test_password_reset_confirm_missing_password>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestPasswordResetConfirmEndpoint.test_password_reset_confirm_empty_password _

self = <Coroutine test_password_reset_confirm_empty_password>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___________ ERROR at setup of TestGetMeEndpoint.test_get_me_success ____________

self = <Coroutine test_get_me_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____________ ERROR at setup of TestGetMeEndpoint.test_get_me_admin _____________

self = <Coroutine test_get_me_admin>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___________ ERROR at setup of TestGetMeEndpoint.test_get_me_no_token ___________

self = <Coroutine test_get_me_no_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
________ ERROR at setup of TestGetMeEndpoint.test_get_me_invalid_token _________

self = <Coroutine test_get_me_invalid_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
________ ERROR at setup of TestGetMeEndpoint.test_get_me_expired_token _________

self = <Coroutine test_get_me_expired_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestGetMeEndpoint.test_get_me_blacklisted_token _______

self = <Coroutine test_get_me_blacklisted_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestAdminTestEndpoint.test_admin_endpoint_with_admin ____

self = <Coroutine test_admin_endpoint_with_admin>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAdminTestEndpoint.test_admin_endpoint_with_teacher_forbidden _

self = <Coroutine test_admin_endpoint_with_teacher_forbidden>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAdminTestEndpoint.test_admin_endpoint_with_parent_forbidden _

self = <Coroutine test_admin_endpoint_with_parent_forbidden>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAdminTestEndpoint.test_admin_endpoint_with_accountant_forbidden _

self = <Coroutine test_admin_endpoint_with_accountant_forbidden>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestAdminTestEndpoint.test_admin_endpoint_no_token _____

self = <Coroutine test_admin_endpoint_no_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestFinancialTestEndpoint.test_financial_endpoint_with_admin _

self = <Coroutine test_financial_endpoint_with_admin>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestFinancialTestEndpoint.test_financial_endpoint_with_accountant _

self = <Coroutine test_financial_endpoint_with_accountant>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestFinancialTestEndpoint.test_financial_endpoint_with_teacher_forbidden _

self = <Coroutine test_financial_endpoint_with_teacher_forbidden>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestFinancialTestEndpoint.test_financial_endpoint_with_parent_forbidden _

self = <Coroutine test_financial_endpoint_with_parent_forbidden>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestFinancialTestEndpoint.test_financial_endpoint_no_token _

self = <Coroutine test_financial_endpoint_no_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAuthFlowIntegration.test_login_then_access_protected_endpoint _

self = <Coroutine test_login_then_access_protected_endpoint>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAuthFlowIntegration.test_login_logout_then_access_fails _

self = <Coroutine test_login_logout_then_access_fails>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestAuthFlowIntegration.test_login_refresh_then_access ___

self = <Coroutine test_login_refresh_then_access>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAuthFlowIntegration.test_admin_login_access_admin_endpoint _

self = <Coroutine test_admin_login_access_admin_endpoint>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestAuthFlowIntegration.test_password_reset_flow ______

self = <Coroutine test_password_reset_flow>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAuthFlowIntegration.test_teacher_cannot_access_admin_endpoint _

self = <Coroutine test_teacher_cannot_access_admin_endpoint>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestSecurityEdgeCases.test_sql_injection_in_email ______

self = <Coroutine test_sql_injection_in_email>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______ ERROR at setup of TestSecurityEdgeCases.test_very_long_password ________

self = <Coroutine test_very_long_password>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______ ERROR at setup of TestSecurityEdgeCases.test_unicode_in_password _______

self = <Coroutine test_unicode_in_password>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestSecurityEdgeCases.test_case_sensitivity_email ______

self = <Coroutine test_case_sensitivity_email>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_________ ERROR at setup of TestSecurityEdgeCases.test_token_tampering _________

self = <Coroutine test_token_tampering>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestSecurityEdgeCases.test_malformed_authorization_header __

self = <Coroutine test_malformed_authorization_header>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestSecurityEdgeCases.test_empty_authorization_header ____

self = <Coroutine test_empty_authorization_header>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestSecurityEdgeCases.test_bearer_only_no_token _______

self = <Coroutine test_bearer_only_no_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestSecurityEdgeCases.test_multiple_rapid_login_attempts __

self = <Coroutine test_multiple_rapid_login_attempts>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/auth/conftest.py:487: in auth_client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestAuthenticateUser.test_authenticate_user_success _____

self = <tests.auth.test_service.TestAuthenticateUser object at 0x10537a970>

    @pytest.fixture
    def mock_user(self):
        """Create a mock user object with freshly hashed password."""
        user = MagicMock(spec=User)
        user.id = uuid4()
        user.email = "teacher@example.com"
        # Generate fresh hash for compatibility with current bcrypt version
>       user.password_hash = hash_password(TEST_PASSWORD_PLAIN)

tests/auth/test_service.py:74: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x1072d2790>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log setup ------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
_ ERROR at setup of TestAuthenticateUser.test_authenticate_user_wrong_password _

self = <tests.auth.test_service.TestAuthenticateUser object at 0x10537a760>

    @pytest.fixture
    def mock_user(self):
        """Create a mock user object with freshly hashed password."""
        user = MagicMock(spec=User)
        user.id = uuid4()
        user.email = "teacher@example.com"
        # Generate fresh hash for compatibility with current bcrypt version
>       user.password_hash = hash_password(TEST_PASSWORD_PLAIN)

tests/auth/test_service.py:74: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x107639b50>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log setup ------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
_ ERROR at setup of TestAuthenticateUser.test_authenticate_user_inactive_user __

self = <tests.auth.test_service.TestAuthenticateUser object at 0x10537a0a0>

    @pytest.fixture
    def mock_inactive_user(self):
        """Create a mock inactive user object."""
        user = MagicMock(spec=User)
        user.id = uuid4()
        user.email = "inactive@example.com"
>       user.password_hash = hash_password(TEST_PASSWORD_PLAIN)

tests/auth/test_service.py:89: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x1073f3340>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log setup ------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
________________ ERROR at setup of TestLogin.test_login_success ________________

self = <tests.auth.test_service.TestLogin object at 0x105197220>

    @pytest.fixture
    def mock_user(self):
        """Create a mock user object with freshly hashed password."""
        user = MagicMock(spec=User)
        user.id = uuid4()
        user.email = "teacher@example.com"
>       user.password_hash = hash_password(TEST_PASSWORD_PLAIN)

tests/auth/test_service.py:220: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x1077b6370>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log setup ------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
_______ ERROR at setup of TestLogin.test_login_wrong_password_raises_401 _______

self = <tests.auth.test_service.TestLogin object at 0x105197430>

    @pytest.fixture
    def mock_user(self):
        """Create a mock user object with freshly hashed password."""
        user = MagicMock(spec=User)
        user.id = uuid4()
        user.email = "teacher@example.com"
>       user.password_hash = hash_password(TEST_PASSWORD_PLAIN)

tests/auth/test_service.py:220: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x107345760>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log setup ------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
_______ ERROR at setup of TestLogin.test_login_inactive_user_raises_401 ________

self = <tests.auth.test_service.TestLogin object at 0x105197580>

    @pytest.fixture
    def mock_inactive_user(self):
        """Create a mock inactive user object."""
        user = MagicMock(spec=User)
        user.id = uuid4()
        user.email = "inactive@example.com"
>       user.password_hash = hash_password(TEST_PASSWORD_PLAIN)

tests/auth/test_service.py:246: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x107020af0>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log setup ------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
____ ERROR at setup of TestLogin.test_login_access_token_contains_user_info ____

self = <tests.auth.test_service.TestLogin object at 0x105197c40>

    @pytest.fixture
    def mock_admin_user(self):
        """Create a mock admin user object with freshly hashed password."""
        user = MagicMock(spec=User)
        user.id = uuid4()
        user.email = "admin@example.com"
>       user.password_hash = hash_password(TEST_PASSWORD_PLAIN)

tests/auth/test_service.py:233: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x1076dc310>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log setup ------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
____ ERROR at setup of TestLogin.test_login_refresh_token_has_correct_type _____

self = <tests.auth.test_service.TestLogin object at 0x105197ee0>

    @pytest.fixture
    def mock_user(self):
        """Create a mock user object with freshly hashed password."""
        user = MagicMock(spec=User)
        user.id = uuid4()
        user.email = "teacher@example.com"
>       user.password_hash = hash_password(TEST_PASSWORD_PLAIN)

tests/auth/test_service.py:220: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x1079a16a0>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log setup ------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
_ ERROR at setup of TestConfirmPasswordReset.test_confirm_password_reset_success _

self = <tests.auth.test_service.TestConfirmPasswordReset object at 0x104f38b80>

    @pytest.fixture
    def mock_user(self):
        """Create a mock user object with freshly hashed password."""
        user = MagicMock(spec=User)
        user.id = uuid4()
        user.email = "teacher@example.com"
        user.is_active = True
>       user.password_hash = hash_password(TEST_PASSWORD_PLAIN)

tests/auth/test_service.py:885: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x1074f6b80>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log setup ------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
_ ERROR at setup of TestConfirmPasswordReset.test_confirm_password_reset_already_used _

self = <tests.auth.test_service.TestConfirmPasswordReset object at 0x10536ce20>

    @pytest.fixture
    def mock_user(self):
        """Create a mock user object with freshly hashed password."""
        user = MagicMock(spec=User)
        user.id = uuid4()
        user.email = "teacher@example.com"
        user.is_active = True
>       user.password_hash = hash_password(TEST_PASSWORD_PLAIN)

tests/auth/test_service.py:885: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x10741a850>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log setup ------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
_ ERROR at setup of TestConfirmPasswordReset.test_confirm_password_reset_expired_token _

self = <tests.auth.test_service.TestConfirmPasswordReset object at 0x105197910>

    @pytest.fixture
    def mock_user(self):
        """Create a mock user object with freshly hashed password."""
        user = MagicMock(spec=User)
        user.id = uuid4()
        user.email = "teacher@example.com"
        user.is_active = True
>       user.password_hash = hash_password(TEST_PASSWORD_PLAIN)

tests/auth/test_service.py:885: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x1073106a0>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log setup ------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
_____ ERROR at setup of TestAuthServiceIntegration.test_login_logout_flow ______

self = <tests.auth.test_service.TestAuthServiceIntegration object at 0x104e181f0>

    @pytest.fixture
    def mock_user(self):
        """Create a mock user object with freshly hashed password."""
        user = MagicMock(spec=User)
        user.id = uuid4()
        user.email = "teacher@example.com"
>       user.password_hash = hash_password(TEST_PASSWORD_PLAIN)

tests/auth/test_service.py:1085: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x107639b50>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log setup ------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
_____ ERROR at setup of TestAuthServiceIntegration.test_login_refresh_flow _____

self = <tests.auth.test_service.TestAuthServiceIntegration object at 0x104e184c0>

    @pytest.fixture
    def mock_user(self):
        """Create a mock user object with freshly hashed password."""
        user = MagicMock(spec=User)
        user.id = uuid4()
        user.email = "teacher@example.com"
>       user.password_hash = hash_password(TEST_PASSWORD_PLAIN)

tests/auth/test_service.py:1085: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x107339700>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log setup ------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
_ ERROR at setup of TestRecommendationsEndpoint.test_recommendations_endpoint_returns_200 _

self = <Coroutine test_recommendations_endpoint_returns_200>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestRecommendationsEndpoint.test_recommendations_endpoint_requires_auth _

self = <Coroutine test_recommendations_endpoint_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestRecommendationsEndpoint.test_recommendations_endpoint_with_parameters _

self = <Coroutine test_recommendations_endpoint_with_parameters>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestRecommendationsEndpoint.test_recommendations_endpoint_validates_max_recommendations _

self = <Coroutine test_recommendations_endpoint_validates_max_recommendations>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestRecommendationsEndpoint.test_recommendations_endpoint_validates_age_range _

self = <Coroutine test_recommendations_endpoint_validates_age_range>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestGetActivityEndpoint.test_get_activity_returns_200 ____

self = <Coroutine test_get_activity_returns_200>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestGetActivityEndpoint.test_get_activity_requires_auth ___

self = <Coroutine test_get_activity_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestGetActivityEndpoint.test_get_activity_not_found _____

self = <Coroutine test_get_activity_not_found>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestListActivitiesEndpoint.test_list_activities_returns_200 _

self = <Coroutine test_list_activities_returns_200>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestListActivitiesEndpoint.test_list_activities_requires_auth _

self = <Coroutine test_list_activities_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestListActivitiesEndpoint.test_list_activities_pagination _

self = <Coroutine test_list_activities_pagination>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestListActivitiesEndpoint.test_list_activities_type_filter _

self = <Coroutine test_list_activities_type_filter>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___________ ERROR at setup of TestEdgeCases.test_invalid_uuid_format ___________

self = <Coroutine test_invalid_uuid_format>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestEdgeCases.test_invalid_activity_type_filter _______

self = <Coroutine test_invalid_activity_type_filter>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestEdgeCases.test_negative_group_size_rejected _______

self = <Coroutine test_negative_group_size_rejected>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____________________ ERROR at setup of test_login_success _____________________

self = <Coroutine test_login_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__________________ ERROR at setup of test_login_invalid_email __________________

self = <Coroutine test_login_invalid_email>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
________________ ERROR at setup of test_login_invalid_password _________________

self = <Coroutine test_login_invalid_password>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__________________ ERROR at setup of test_login_inactive_user __________________

self = <Coroutine test_login_inactive_user>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__________________ ERROR at setup of test_refresh_valid_token __________________

self = <Coroutine test_refresh_valid_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_________________ ERROR at setup of test_refresh_invalid_token _________________

self = <Coroutine test_refresh_invalid_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_________________ ERROR at setup of test_refresh_expired_token _________________

self = <Coroutine test_refresh_expired_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______________ ERROR at setup of test_refresh_with_access_token _______________

self = <Coroutine test_refresh_with_access_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____________________ ERROR at setup of test_logout_success _____________________

self = <Coroutine test_logout_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___________ ERROR at setup of test_logout_blacklisted_token_rejected ___________

self = <Coroutine test_logout_blacklisted_token_rejected>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
________________ ERROR at setup of test_password_reset_request _________________

self = <Coroutine test_password_reset_request>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______ ERROR at setup of test_password_reset_request_nonexistent_email ________

self = <Coroutine test_password_reset_request_nonexistent_email>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____________ ERROR at setup of test_password_reset_confirm_valid ______________

self = <Coroutine test_password_reset_confirm_valid>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_________ ERROR at setup of test_password_reset_confirm_invalid_token __________

self = <Coroutine test_password_reset_confirm_invalid_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_________ ERROR at setup of test_password_reset_confirm_expired_token __________

self = <Coroutine test_password_reset_confirm_expired_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___________ ERROR at setup of test_password_reset_confirm_used_token ___________

self = <Coroutine test_password_reset_confirm_used_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
________ ERROR at setup of test_integration_login_to_protected_endpoint ________

self = <Coroutine test_integration_login_to_protected_endpoint>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
________________ ERROR at setup of test_admin_endpoint_as_admin ________________

self = <Coroutine test_admin_endpoint_as_admin>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______________ ERROR at setup of test_admin_endpoint_as_teacher _______________

self = <Coroutine test_admin_endpoint_as_teacher>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______________ ERROR at setup of test_financial_endpoint_as_admin ______________

self = <Coroutine test_financial_endpoint_as_admin>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___________ ERROR at setup of test_financial_endpoint_as_accountant ____________

self = <Coroutine test_financial_endpoint_as_accountant>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____________ ERROR at setup of test_financial_endpoint_as_teacher _____________

self = <Coroutine test_financial_endpoint_as_teacher>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______ ERROR at setup of TestBatchGet.test_batch_get_activities_success _______

self = <Coroutine test_batch_get_activities_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestBatchGet.test_batch_get_with_field_selection ______

self = <Coroutine test_batch_get_with_field_selection>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestBatchGet.test_batch_get_with_missing_resources _____

self = <Coroutine test_batch_get_with_missing_resources>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__________ ERROR at setup of TestBatchGet.test_batch_get_all_missing ___________

self = <Coroutine test_batch_get_all_missing>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestBatchGet.test_batch_get_unsupported_resource_type ____

self = <Coroutine test_batch_get_unsupported_resource_type>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___________ ERROR at setup of TestBatchGet.test_batch_get_empty_ids ____________

self = <Coroutine test_batch_get_empty_ids>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__________ ERROR at setup of TestBatchGet.test_batch_get_too_many_ids __________

self = <Coroutine test_batch_get_too_many_ids>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
________ ERROR at setup of TestBatchGet.test_batch_get_unauthenticated _________

self = <Coroutine test_batch_get_unauthenticated>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestBatchActivityRecommendations.test_batch_recommendations_success _

self = <Coroutine test_batch_recommendations_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestBatchActivityRecommendations.test_batch_recommendations_with_filters _

self = <Coroutine test_batch_recommendations_with_filters>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestBatchActivityRecommendations.test_batch_recommendations_multiple_children _

self = <Coroutine test_batch_recommendations_multiple_children>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestBatchActivityRecommendations.test_batch_recommendations_empty_children _

self = <Coroutine test_batch_recommendations_empty_children>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestBatchActivityRecommendations.test_batch_recommendations_too_many_children _

self = <Coroutine test_batch_recommendations_too_many_children>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestBatchActivityRecommendations.test_batch_recommendations_unauthenticated _

self = <Coroutine test_batch_recommendations_unauthenticated>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestReportGenerationEndpoint.test_generate_report_success __

self = <Coroutine test_generate_report_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestReportGenerationEndpoint.test_generate_report_french __

self = <Coroutine test_generate_report_french>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestReportGenerationEndpoint.test_generate_report_requires_auth _

self = <Coroutine test_generate_report_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestReportGenerationEndpoint.test_generate_report_invalid_child_id _

self = <Coroutine test_generate_report_invalid_child_id>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestReportGenerationEndpoint.test_generate_report_future_date_error _

self = <Coroutine test_generate_report_future_date_error>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestHomeActivitiesEndpoint.test_get_home_activities_success _

self = <Coroutine test_get_home_activities_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestHomeActivitiesEndpoint.test_get_home_activities_with_french _

self = <Coroutine test_get_home_activities_with_french>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestHomeActivitiesEndpoint.test_get_home_activities_with_limit _

self = <Coroutine test_get_home_activities_with_limit>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestHomeActivitiesEndpoint.test_get_home_activities_requires_auth _

self = <Coroutine test_get_home_activities_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestHomeActivitiesEndpoint.test_get_home_activities_invalid_limit _

self = <Coroutine test_get_home_activities_invalid_limit>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCommunicationPreferencesEndpoint.test_create_preferences_success _

self = <Coroutine test_create_preferences_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCommunicationPreferencesEndpoint.test_create_preferences_french _

self = <Coroutine test_create_preferences_french>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCommunicationPreferencesEndpoint.test_create_preferences_requires_auth _

self = <Coroutine test_create_preferences_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCommunicationPreferencesEndpoint.test_get_preferences_success _

self = <Coroutine test_get_preferences_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCommunicationPreferencesEndpoint.test_get_preferences_not_found _

self = <Coroutine test_get_preferences_not_found>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCommunicationPreferencesEndpoint.test_get_preferences_requires_auth _

self = <Coroutine test_get_preferences_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestEdgeCasesAndErrorHandling.test_api_invalid_uuid_format _

self = <Coroutine test_api_invalid_uuid_format>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestEdgeCasesAndErrorHandling.test_api_missing_required_fields _

self = <Coroutine test_api_missing_required_fields>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_________ ERROR at setup of TestActivityIntegrity.test_valid_activity __________
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 98
      @pytest.mark.asyncio
      async def test_valid_activity(self, test_session: AsyncSession):
          """Test that valid activities pass integrity checks."""
          # Create a valid activity
          activity = Activity(
              id=uuid4(),
              name="Test Activity",
              description="A test activity",
              activity_type=ActivityType.COGNITIVE,
              difficulty=ActivityDifficulty.MEDIUM,
              duration_minutes=30,
              materials_needed=["Material 1", "Material 2"],
              min_age_months=24,
              max_age_months=48,
              is_active=True,
          )
          test_session.add(activity)
          await test_session.commit()

          # Run integrity check
          checker = DataIntegrityChecker(test_session)
          await checker._check_activity_integrity()

          # Verify no issues
          assert len(checker.results) == 1
          result = checker.results[0]
          assert result.passed is True
          assert result.issues_found == 0
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:98
___ ERROR at setup of TestActivityIntegrity.test_activity_invalid_age_range ____
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 127
      @pytest.mark.asyncio
      async def test_activity_invalid_age_range(self, test_session: AsyncSession):
          """Test detection of invalid age range (min > max)."""
          activity = Activity(
              id=uuid4(),
              name="Test Activity",
              description="A test activity",
              activity_type=ActivityType.COGNITIVE,
              difficulty=ActivityDifficulty.MEDIUM,
              duration_minutes=30,
              materials_needed=["Material 1"],
              min_age_months=48,  # Invalid: min > max
              max_age_months=24,
              is_active=True,
          )
          test_session.add(activity)
          await test_session.commit()

          # Run integrity check
          checker = DataIntegrityChecker(test_session)
          await checker._check_activity_integrity()

          # Verify issue detected
          result = checker.results[0]
          assert result.passed is False
          assert result.issues_found > 0
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:127
______ ERROR at setup of TestActivityIntegrity.test_activity_negative_age ______
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 154
      @pytest.mark.asyncio
      async def test_activity_negative_age(self, test_session: AsyncSession):
          """Test detection of negative age values."""
          activity = Activity(
              id=uuid4(),
              name="Test Activity",
              description="A test activity",
              activity_type=ActivityType.COGNITIVE,
              difficulty=ActivityDifficulty.MEDIUM,
              duration_minutes=30,
              materials_needed=["Material 1"],
              min_age_months=-5,  # Invalid: negative
              max_age_months=24,
              is_active=True,
          )
          test_session.add(activity)
          await test_session.commit()

          # Run integrity check
          checker = DataIntegrityChecker(test_session)
          await checker._check_activity_integrity()

          # Verify issue detected
          result = checker.results[0]
          assert result.passed is False
          assert result.issues_found > 0
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:154
____ ERROR at setup of TestActivityIntegrity.test_activity_invalid_duration ____
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 181
      @pytest.mark.asyncio
      async def test_activity_invalid_duration(self, test_session: AsyncSession):
          """Test detection of invalid duration."""
          activity = Activity(
              id=uuid4(),
              name="Test Activity",
              description="A test activity",
              activity_type=ActivityType.COGNITIVE,
              difficulty=ActivityDifficulty.MEDIUM,
              duration_minutes=-10,  # Invalid: negative
              materials_needed=["Material 1"],
              min_age_months=24,
              max_age_months=48,
              is_active=True,
          )
          test_session.add(activity)
          await test_session.commit()

          # Run integrity check
          checker = DataIntegrityChecker(test_session)
          await checker._check_activity_integrity()

          # Verify issue detected
          result = checker.results[0]
          assert result.passed is False
          assert result.issues_found > 0
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:181
_______ ERROR at setup of TestActivityIntegrity.test_activity_empty_name _______
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 208
      @pytest.mark.asyncio
      async def test_activity_empty_name(self, test_session: AsyncSession):
          """Test detection of empty name."""
          activity = Activity(
              id=uuid4(),
              name="",  # Invalid: empty
              description="A test activity",
              activity_type=ActivityType.COGNITIVE,
              difficulty=ActivityDifficulty.MEDIUM,
              duration_minutes=30,
              materials_needed=["Material 1"],
              is_active=True,
          )
          test_session.add(activity)
          await test_session.commit()

          # Run integrity check
          checker = DataIntegrityChecker(test_session)
          await checker._check_activity_integrity()

          # Verify issue detected
          result = checker.results[0]
          assert result.passed is False
          assert result.issues_found > 0
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:208
_ ERROR at setup of TestActivityParticipationIntegrity.test_valid_participation _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 242
      @pytest.mark.asyncio
      async def test_valid_participation(self, test_session: AsyncSession):
          """Test that valid participations pass integrity checks."""
          # Create activity
          activity = Activity(
              id=uuid4(),
              name="Test Activity",
              description="A test activity",
              activity_type=ActivityType.COGNITIVE,
              difficulty=ActivityDifficulty.MEDIUM,
              duration_minutes=30,
              materials_needed=["Material 1"],
              is_active=True,
          )
          test_session.add(activity)
          await test_session.commit()

          # Create participation
          started = datetime.utcnow() - timedelta(hours=1)
          completed = started + timedelta(minutes=30)
          participation = ActivityParticipation(
              id=uuid4(),
              child_id=uuid4(),
              activity_id=activity.id,
              started_at=started,
              completed_at=completed,
              duration_minutes=30,
              completion_status="completed",
              engagement_score=0.85,
          )
          test_session.add(participation)
          await test_session.commit()

          # Run integrity check
          checker = DataIntegrityChecker(test_session)
          await checker._check_activity_participation_integrity()

          # Verify no issues
          result = checker.results[0]
          assert result.passed is True
          assert result.issues_found == 0
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:242
_ ERROR at setup of TestActivityParticipationIntegrity.test_participation_invalid_dates _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 284
      @pytest.mark.asyncio
      async def test_participation_invalid_dates(self, test_session: AsyncSession):
          """Test detection of completed_at before started_at."""
          # Create activity
          activity = Activity(
              id=uuid4(),
              name="Test Activity",
              description="A test activity",
              activity_type=ActivityType.COGNITIVE,
              difficulty=ActivityDifficulty.MEDIUM,
              duration_minutes=30,
              materials_needed=["Material 1"],
              is_active=True,
          )
          test_session.add(activity)
          await test_session.commit()

          # Create participation with invalid dates
          started = datetime.utcnow()
          completed = started - timedelta(hours=1)  # Invalid: before started
          participation = ActivityParticipation(
              id=uuid4(),
              child_id=uuid4(),
              activity_id=activity.id,
              started_at=started,
              completed_at=completed,
              duration_minutes=30,
              completion_status="completed",
          )
          test_session.add(participation)
          await test_session.commit()

          # Run integrity check
          checker = DataIntegrityChecker(test_session)
          await checker._check_activity_participation_integrity()

          # Verify issue detected
          result = checker.results[0]
          assert result.passed is False
          assert result.issues_found > 0
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:284
_ ERROR at setup of TestActivityParticipationIntegrity.test_participation_invalid_engagement_score _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 325
      @pytest.mark.asyncio
      async def test_participation_invalid_engagement_score(self, test_session: AsyncSession):
          """Test detection of invalid engagement score."""
          # Create activity
          activity = Activity(
              id=uuid4(),
              name="Test Activity",
              description="A test activity",
              activity_type=ActivityType.COGNITIVE,
              difficulty=ActivityDifficulty.MEDIUM,
              duration_minutes=30,
              materials_needed=["Material 1"],
              is_active=True,
          )
          test_session.add(activity)
          await test_session.commit()

          # Create participation with invalid score
          participation = ActivityParticipation(
              id=uuid4(),
              child_id=uuid4(),
              activity_id=activity.id,
              started_at=datetime.utcnow(),
              engagement_score=1.5,  # Invalid: > 1.0
          )
          test_session.add(participation)
          await test_session.commit()

          # Run integrity check
          checker = DataIntegrityChecker(test_session)
          await checker._check_activity_participation_integrity()

          # Verify issue detected
          result = checker.results[0]
          assert result.passed is False
          assert result.issues_found > 0
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:325
_ ERROR at setup of TestActivityParticipationIntegrity.test_participation_status_mismatch _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 362
      @pytest.mark.asyncio
      async def test_participation_status_mismatch(self, test_session: AsyncSession):
          """Test detection of status/completion mismatch."""
          # Create activity
          activity = Activity(
              id=uuid4(),
              name="Test Activity",
              description="A test activity",
              activity_type=ActivityType.COGNITIVE,
              difficulty=ActivityDifficulty.MEDIUM,
              duration_minutes=30,
              materials_needed=["Material 1"],
              is_active=True,
          )
          test_session.add(activity)
          await test_session.commit()

          # Create participation marked completed without timestamp
          participation = ActivityParticipation(
              id=uuid4(),
              child_id=uuid4(),
              activity_id=activity.id,
              started_at=datetime.utcnow(),
              completed_at=None,  # Missing
              completion_status="completed",  # But marked completed
          )
          test_session.add(participation)
          await test_session.commit()

          # Run integrity check
          checker = DataIntegrityChecker(test_session)
          await checker._check_activity_participation_integrity()

          # Verify issue detected
          result = checker.results[0]
          assert result.passed is False
          assert result.issues_found > 0
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:362
__ ERROR at setup of TestCoachingSessionIntegrity.test_valid_coaching_session __
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 409
      @pytest.mark.asyncio
      async def test_valid_coaching_session(self, test_session: AsyncSession):
          """Test that valid sessions pass integrity checks."""
          session_obj = CoachingSession(
              id=uuid4(),
              child_id=uuid4(),
              user_id=uuid4(),
              question="How can I help my child?",
              context="Additional context",
              special_need_types=["autism", "adhd"],
              category="behavior",
          )
          test_session.add(session_obj)
          await test_session.commit()

          # Run integrity check
          checker = DataIntegrityChecker(test_session)
          await checker._check_coaching_session_integrity()

          # Verify no issues
          result = checker.results[0]
          assert result.passed is True
          assert result.issues_found == 0
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:409
_ ERROR at setup of TestCoachingSessionIntegrity.test_coaching_session_empty_question _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 433
      @pytest.mark.asyncio
      async def test_coaching_session_empty_question(self, test_session: AsyncSession):
          """Test detection of empty question."""
          session_obj = CoachingSession(
              id=uuid4(),
              child_id=uuid4(),
              user_id=uuid4(),
              question="",  # Invalid: empty
          )
          test_session.add(session_obj)
          await test_session.commit()

          # Run integrity check
          checker = DataIntegrityChecker(test_session)
          await checker._check_coaching_session_integrity()

          # Verify issue detected
          result = checker.results[0]
          assert result.passed is False
          assert result.issues_found > 0
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:433
_ ERROR at setup of TestCoachingRecommendationIntegrity.test_valid_coaching_recommendation _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 463
      @pytest.mark.asyncio
      async def test_valid_coaching_recommendation(self, test_session: AsyncSession):
          """Test that valid recommendations pass integrity checks."""
          # Create session
          session_obj = CoachingSession(
              id=uuid4(),
              child_id=uuid4(),
              user_id=uuid4(),
              question="How can I help my child?",
          )
          test_session.add(session_obj)
          await test_session.commit()

          # Create recommendation
          recommendation = CoachingRecommendation(
              id=uuid4(),
              session_id=session_obj.id,
              title="Test Recommendation",
              content="Detailed recommendation content",
              category="behavior",
              priority="medium",
              relevance_score=0.85,
          )
          test_session.add(recommendation)
          await test_session.commit()

          # Run integrity check
          checker = DataIntegrityChecker(test_session)
          await checker._check_coaching_recommendation_integrity()

          # Verify no issues
          result = checker.results[0]
          assert result.passed is True
          assert result.issues_found == 0
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:463
_ ERROR at setup of TestCoachingRecommendationIntegrity.test_recommendation_invalid_relevance_score _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 498
      @pytest.mark.asyncio
      async def test_recommendation_invalid_relevance_score(self, test_session: AsyncSession):
          """Test detection of invalid relevance score."""
          # Create session
          session_obj = CoachingSession(
              id=uuid4(),
              child_id=uuid4(),
              user_id=uuid4(),
              question="How can I help my child?",
          )
          test_session.add(session_obj)
          await test_session.commit()

          # Create recommendation with invalid score
          recommendation = CoachingRecommendation(
              id=uuid4(),
              session_id=session_obj.id,
              title="Test Recommendation",
              content="Detailed recommendation content",
              category="behavior",
              priority="medium",
              relevance_score=1.5,  # Invalid: > 1.0
          )
          test_session.add(recommendation)
          await test_session.commit()

          # Run integrity check
          checker = DataIntegrityChecker(test_session)
          await checker._check_coaching_recommendation_integrity()

          # Verify issue detected
          result = checker.results[0]
          assert result.passed is False
          assert result.issues_found > 0
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:498
_ ERROR at setup of TestCoachingRecommendationIntegrity.test_recommendation_invalid_priority _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 533
      @pytest.mark.asyncio
      async def test_recommendation_invalid_priority(self, test_session: AsyncSession):
          """Test detection of invalid priority."""
          # Create session
          session_obj = CoachingSession(
              id=uuid4(),
              child_id=uuid4(),
              user_id=uuid4(),
              question="How can I help my child?",
          )
          test_session.add(session_obj)
          await test_session.commit()

          # Create recommendation with invalid priority
          recommendation = CoachingRecommendation(
              id=uuid4(),
              session_id=session_obj.id,
              title="Test Recommendation",
              content="Detailed recommendation content",
              category="behavior",
              priority="super-critical",  # Invalid
              relevance_score=0.85,
          )
          test_session.add(recommendation)
          await test_session.commit()

          # Run integrity check
          checker = DataIntegrityChecker(test_session)
          await checker._check_coaching_recommendation_integrity()

          # Verify issue detected
          result = checker.results[0]
          assert result.passed is False
          assert result.issues_found > 0
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:533
___ ERROR at setup of TestOrphanedRecords.test_detect_orphaned_participation ___
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 577
      @pytest.mark.asyncio
      async def test_detect_orphaned_participation(self, test_session: AsyncSession):
          """Test detection of orphaned activity participation."""
          # Create participation without activity
          participation = ActivityParticipation(
              id=uuid4(),
              child_id=uuid4(),
              activity_id=uuid4(),  # Non-existent activity
              started_at=datetime.utcnow(),
          )
          test_session.add(participation)
          await test_session.commit()

          # Run orphan check
          checker = DataIntegrityChecker(test_session)
          await checker._check_orphaned_records()

          # Verify orphan detected
          result = checker.results[0]
          assert result.passed is False
          assert result.issues_found > 0
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:577
__ ERROR at setup of TestOrphanedRecords.test_detect_orphaned_evidence_source __
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 599
      @pytest.mark.asyncio
      async def test_detect_orphaned_evidence_source(self, test_session: AsyncSession):
          """Test detection of orphaned evidence source."""
          # Create evidence source without recommendation
          evidence = EvidenceSource(
              id=uuid4(),
              recommendation_id=uuid4(),  # Non-existent recommendation
              title="Test Evidence",
              source_type="research",
              relevance_score=0.85,
          )
          test_session.add(evidence)
          await test_session.commit()

          # Run orphan check
          checker = DataIntegrityChecker(test_session)
          await checker._check_orphaned_records()

          # Verify orphan detected
          result = checker.results[0]
          assert result.passed is False
          assert result.issues_found > 0
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:599
_______ ERROR at setup of TestOrphanedRecords.test_fix_orphaned_records ________
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 622
      @pytest.mark.asyncio
      async def test_fix_orphaned_records(self, test_session: AsyncSession):
          """Test automatic fixing of orphaned records."""
          # Create orphaned participation
          participation = ActivityParticipation(
              id=uuid4(),
              child_id=uuid4(),
              activity_id=uuid4(),  # Non-existent
              started_at=datetime.utcnow(),
          )
          test_session.add(participation)
          await test_session.commit()

          # Get count before fix
          stmt = select(ActivityParticipation)
          result = await test_session.execute(stmt)
          count_before = len(result.scalars().all())

          # Run orphan check with fix enabled
          checker = DataIntegrityChecker(test_session, fix_orphans=True)
          await checker._check_orphaned_records()

          # Verify orphan was removed
          result = await test_session.execute(stmt)
          count_after = len(result.scalars().all())
          assert count_after < count_before
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:622
_____ ERROR at setup of TestParentReportIntegrity.test_valid_parent_report _____
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 658
      @pytest.mark.asyncio
      async def test_valid_parent_report(self, test_session: AsyncSession):
          """Test that valid reports pass integrity checks."""
          report = ParentReport(
              id=uuid4(),
              child_id=uuid4(),
              parent_id=uuid4(),
              date=datetime.utcnow().date(),
              language="en",
              summary="Test summary",
          )
          test_session.add(report)
          await test_session.commit()

          # Run integrity check
          checker = DataIntegrityChecker(test_session)
          await checker._check_parent_report_integrity()

          # Verify no issues
          result = checker.results[0]
          assert result.passed is True
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:658
_ ERROR at setup of TestCommunicationPreferenceIntegrity.test_valid_preference _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 689
      @pytest.mark.asyncio
      async def test_valid_preference(self, test_session: AsyncSession):
          """Test that valid preferences pass integrity checks."""
          pref = CommunicationPreference(
              id=uuid4(),
              parent_id=uuid4(),
              email_enabled=True,
              sms_enabled=False,
              push_enabled=True,
              in_app_enabled=True,
              language="en",
          )
          test_session.add(pref)
          await test_session.commit()

          # Run integrity check
          checker = DataIntegrityChecker(test_session)
          await checker._check_communication_preference_integrity()

          # Verify no issues
          result = checker.results[0]
          assert result.passed is True
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:689
_ ERROR at setup of TestCommunicationPreferenceIntegrity.test_preference_no_channels_enabled _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 712
      @pytest.mark.asyncio
      async def test_preference_no_channels_enabled(self, test_session: AsyncSession):
          """Test warning when no communication channels are enabled."""
          pref = CommunicationPreference(
              id=uuid4(),
              parent_id=uuid4(),
              email_enabled=False,
              sms_enabled=False,
              push_enabled=False,
              in_app_enabled=False,
              language="en",
          )
          test_session.add(pref)
          await test_session.commit()

          # Run integrity check
          checker = DataIntegrityChecker(test_session)
          await checker._check_communication_preference_integrity()

          # Verify warning issued
          result = checker.results[0]
          assert len(result.warnings) > 0
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:712
__________ ERROR at setup of TestFullVerification.test_run_all_checks __________
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 744
      @pytest.mark.asyncio
      async def test_run_all_checks(self, test_session: AsyncSession):
          """Test running all integrity checks."""
          # Create some valid data
          activity = Activity(
              id=uuid4(),
              name="Test Activity",
              description="A test activity",
              activity_type=ActivityType.COGNITIVE,
              difficulty=ActivityDifficulty.MEDIUM,
              duration_minutes=30,
              materials_needed=["Material 1"],
              is_active=True,
          )
          test_session.add(activity)
          await test_session.commit()

          # Run all checks
          checker = DataIntegrityChecker(test_session)
          success = await checker.run_all_checks(full=False)

          # Verify checks ran
          assert len(checker.results) > 0
          assert success is True
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:744
_________ ERROR at setup of TestFullVerification.test_run_full_checks __________
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py, line 769
      @pytest.mark.asyncio
      async def test_run_full_checks(self, test_session: AsyncSession):
          """Test running full integrity verification."""
          # Run full checks
          checker = DataIntegrityChecker(test_session)
          success = await checker.run_all_checks(full=True)

          # Verify extended checks ran
          assert len(checker.results) > 0
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_data_integrity.py:769
_ ERROR at setup of TestCreateProfileEndpoint.test_create_profile_requires_auth _

self = <Coroutine test_create_profile_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCreateProfileEndpoint.test_create_duplicate_profile_fails _

self = <Coroutine test_create_duplicate_profile_fails>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestGetProfileEndpoint.test_get_profile_returns_200 _____

self = <Coroutine test_get_profile_returns_200>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestGetProfileEndpoint.test_get_profile_requires_auth ____

self = <Coroutine test_get_profile_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestGetProfileEndpoint.test_get_profile_not_found ______

self = <Coroutine test_get_profile_not_found>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestGetProfileByChildEndpoint.test_get_profile_by_child_returns_200 _

self = <Coroutine test_get_profile_by_child_returns_200>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestGetProfileByChildEndpoint.test_get_profile_by_child_not_found _

self = <Coroutine test_get_profile_by_child_not_found>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestListProfilesEndpoint.test_list_profiles_returns_200 ___

self = <Coroutine test_list_profiles_returns_200>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestListProfilesEndpoint.test_list_profiles_pagination ___

self = <Coroutine test_list_profiles_pagination>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestSkillAssessmentEndpoints.test_create_assessment_returns_201 _

self = <Coroutine test_create_assessment_returns_201>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestSkillAssessmentEndpoints.test_list_assessments_filter_by_domain _

self = <Coroutine test_list_assessments_filter_by_domain>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestObservationEndpoints.test_create_observation_returns_201 _

self = <Coroutine test_create_observation_returns_201>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestMonthlySnapshotEndpoints.test_create_snapshot_returns_201 _

self = <Coroutine test_create_snapshot_returns_201>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestMonthlySnapshotEndpoints.test_list_snapshots_returns_200 _

self = <Coroutine test_list_snapshots_returns_200>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestMonthlySnapshotEndpoints.test_get_snapshot_returns_200 _

self = <Coroutine test_get_snapshot_returns_200>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestMonthlySnapshotEndpoints.test_delete_snapshot_returns_204 _

self = <Coroutine test_delete_snapshot_returns_204>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestGrowthTrajectoryEndpoint.test_get_trajectory_not_found _

self = <Coroutine test_get_trajectory_not_found>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___________ ERROR at setup of TestEdgeCases.test_invalid_uuid_format ___________

self = <Coroutine test_invalid_uuid_format>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestEdgeCases.test_profile_id_mismatch_in_assessment ____

self = <Coroutine test_profile_id_mismatch_in_assessment>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__________ ERROR at setup of TestEdgeCases.test_invalid_domain_value ___________

self = <Coroutine test_invalid_domain_value>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__________ ERROR at setup of TestEdgeCases.test_invalid_skill_status ___________

self = <Coroutine test_invalid_skill_status>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_________ ERROR at setup of TestEdgeCases.test_expired_token_rejected __________

self = <Coroutine test_expired_token_rejected>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestEdgeCases.test_assessment_for_nonexistent_profile ____

self = <Coroutine test_assessment_for_nonexistent_profile>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestEdgeCases.test_empty_behavior_description_rejected ___

self = <Coroutine test_empty_behavior_description_rejected>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
________________ ERROR at setup of test_create_template_success ________________

self = <Coroutine test_create_template_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____________ ERROR at setup of test_create_template_requires_auth _____________

self = <Coroutine test_create_template_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_________________ ERROR at setup of test_get_template_success __________________

self = <Coroutine test_get_template_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
________________ ERROR at setup of test_get_template_not_found _________________

self = <Coroutine test_get_template_not_found>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______________ ERROR at setup of test_list_templates_pagination _______________

self = <Coroutine test_list_templates_pagination>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
________________ ERROR at setup of test_update_template_success ________________

self = <Coroutine test_update_template_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
________________ ERROR at setup of test_delete_template_success ________________

self = <Coroutine test_delete_template_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
________________ ERROR at setup of test_create_document_success ________________

self = <Coroutine test_create_document_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_________ ERROR at setup of test_create_document_from_template_success _________

self = <Coroutine test_create_document_from_template_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_________________ ERROR at setup of test_get_document_success __________________

self = <Coroutine test_get_document_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
________________ ERROR at setup of test_get_document_not_found _________________

self = <Coroutine test_get_document_not_found>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______________ ERROR at setup of test_list_documents_with_filters ______________

self = <Coroutine test_list_documents_with_filters>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
________________ ERROR at setup of test_update_document_success ________________

self = <Coroutine test_update_document_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______________ ERROR at setup of test_create_signature_success ________________

self = <Coroutine test_create_signature_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______________ ERROR at setup of test_get_signatures_for_document ______________

self = <Coroutine test_get_signatures_for_document>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____________ ERROR at setup of test_send_signature_request_success _____________

self = <Coroutine test_send_signature_request_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____________ ERROR at setup of test_mark_signature_request_viewed _____________

self = <Coroutine test_mark_signature_request_viewed>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___________ ERROR at setup of test_get_signature_requests_for_signer ___________

self = <Coroutine test_get_signature_requests_for_signer>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_________________ ERROR at setup of test_get_dashboard_success _________________

self = <Coroutine test_get_dashboard_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______________ ERROR at setup of test_get_audit_logs_for_document ______________

self = <Coroutine test_get_audit_logs_for_document>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___________ ERROR at setup of test_invalid_document_type_returns_422 ___________

self = <Coroutine test_invalid_document_type_returns_422>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__________ ERROR at setup of test_missing_required_fields_returns_422 __________

self = <Coroutine test_missing_required_fields_returns_422>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestDocumentIDORProtection.test_get_document_by_id_idor_protection _

self = <Coroutine test_get_document_by_id_idor_protection>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestDocumentIDORProtection.test_update_document_idor_protection _

self = <Coroutine test_update_document_idor_protection>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestDocumentIDORProtection.test_document_access_isolation_between_users _

self = <Coroutine test_document_access_isolation_between_users>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestDocumentIDORProtection.test_cross_resource_idor_protection _

self = <Coroutine test_cross_resource_idor_protection>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestInterventionPlanHealthEndpoint.test_health_check_returns_ok _

self = <Coroutine test_health_check_returns_ok>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestInterventionPlanHealthEndpoint.test_health_check_no_auth_required _

self = <Coroutine test_health_check_no_auth_required>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestEndpointPathIntegration.test_list_plans_endpoint_path __

self = <Coroutine test_list_plans_endpoint_path>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestEndpointPathIntegration.test_single_plan_endpoint_path _

self = <Coroutine test_single_plan_endpoint_path>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestEndpointPathIntegration.test_pending_review_endpoint_path _

self = <Coroutine test_pending_review_endpoint_path>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestEndpointPathIntegration.test_plan_history_endpoint_path _

self = <Coroutine test_plan_history_endpoint_path>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestEndpointPathIntegration.test_plan_progress_endpoint_path _

self = <Coroutine test_plan_progress_endpoint_path>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestEndpointPathIntegration.test_plan_sign_endpoint_path __

self = <Coroutine test_plan_sign_endpoint_path>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestEndpointPathIntegration.test_plan_version_endpoint_path _

self = <Coroutine test_plan_version_endpoint_path>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestSectionCRUDEndpoints.test_strengths_endpoint_exists ___

self = <Coroutine test_strengths_endpoint_exists>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestSectionCRUDEndpoints.test_needs_endpoint_exists _____

self = <Coroutine test_needs_endpoint_exists>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestSectionCRUDEndpoints.test_goals_endpoint_exists _____

self = <Coroutine test_goals_endpoint_exists>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestSectionCRUDEndpoints.test_strategies_endpoint_exists __

self = <Coroutine test_strategies_endpoint_exists>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestSectionCRUDEndpoints.test_monitoring_endpoint_exists __

self = <Coroutine test_monitoring_endpoint_exists>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestSectionCRUDEndpoints.test_parent_involvement_endpoint_exists _

self = <Coroutine test_parent_involvement_endpoint_exists>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestSectionCRUDEndpoints.test_consultations_endpoint_exists _

self = <Coroutine test_consultations_endpoint_exists>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestAuthenticationRequired.test_list_plans_requires_auth __

self = <Coroutine test_list_plans_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAuthenticationRequired.test_create_plan_requires_auth __

self = <Coroutine test_create_plan_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestAuthenticationRequired.test_get_plan_requires_auth ___

self = <Coroutine test_get_plan_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAuthenticationRequired.test_update_plan_requires_auth __

self = <Coroutine test_update_plan_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAuthenticationRequired.test_delete_plan_requires_auth __

self = <Coroutine test_delete_plan_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestAuthenticationRequired.test_sign_plan_requires_auth ___

self = <Coroutine test_sign_plan_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAuthenticationRequired.test_pending_review_requires_auth _

self = <Coroutine test_pending_review_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestErrorHandling.test_invalid_plan_id_returns_404 _____

self = <Coroutine test_invalid_plan_id_returns_404>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestErrorHandling.test_malformed_uuid_returns_422 ______

self = <Coroutine test_malformed_uuid_returns_422>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestParentSignatureWorkflowE2E.test_signature_endpoint_accepts_valid_request_format _

self = <Coroutine test_signature_endpoint_accepts_valid_request_format>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestParentSignatureWorkflowE2E.test_signature_endpoint_matches_parent_portal_client_path _

self = <Coroutine test_signature_endpoint_matches_parent_portal_client_path>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestParentSignatureWorkflowE2E.test_get_plan_includes_signature_status_field _

self = <Coroutine test_get_plan_includes_signature_status_field>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestParentSignatureWorkflowE2E.test_list_plans_supports_parent_signed_filter _

self = <Coroutine test_list_plans_supports_parent_signed_filter>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestParentSignatureWorkflowE2E.test_list_plans_supports_status_filter _

self = <Coroutine test_list_plans_supports_status_filter>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestParentSignatureWorkflowE2E.test_signature_requires_authentication _

self = <Coroutine test_signature_requires_authentication>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestParentSignatureWorkflowE2E.test_signature_rejects_missing_signature_data _

self = <Coroutine test_signature_rejects_missing_signature_data>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestParentSignatureWorkflowE2E.test_signature_request_with_base64_image _

self = <Coroutine test_signature_request_with_base64_image>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestParentSignatureWorkflowE2E.test_signature_request_with_large_base64_data _

self = <Coroutine test_signature_request_with_large_base64_data>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestParentSignatureWorkflowE2E.test_signature_response_format_for_gibbon_sync _

self = <Coroutine test_signature_response_format_for_gibbon_sync>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestParentSignatureWorkflowE2E.test_plan_details_endpoint_supports_gibbon_display _

self = <Coroutine test_plan_details_endpoint_supports_gibbon_display>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestParentSignatureSchemaValidation.test_signature_request_snake_case_field_names _

self = <Coroutine test_signature_request_snake_case_field_names>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestParentSignatureSchemaValidation.test_signature_response_contains_expected_fields _

self = <Coroutine test_signature_response_contains_expected_fields>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestParentSignatureSchemaValidation.test_signature_validates_agreed_to_terms_required _

self = <Coroutine test_signature_validates_agreed_to_terms_required>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCrossServiceSignatureIntegration.test_parent_portal_awaiting_signature_flow _

self = <Coroutine test_parent_portal_awaiting_signature_flow>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCrossServiceSignatureIntegration.test_parent_portal_child_summary_flow _

self = <Coroutine test_parent_portal_child_summary_flow>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAutomatedReviewReminderFlowE2E.test_create_plan_with_monthly_review_schedule _

self = <Coroutine test_create_plan_with_monthly_review_schedule>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAutomatedReviewReminderFlowE2E.test_create_plan_with_quarterly_review_schedule _

self = <Coroutine test_create_plan_with_quarterly_review_schedule>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAutomatedReviewReminderFlowE2E.test_create_plan_with_semi_annual_review_schedule _

self = <Coroutine test_create_plan_with_semi_annual_review_schedule>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAutomatedReviewReminderFlowE2E.test_create_plan_with_annual_review_schedule _

self = <Coroutine test_create_plan_with_annual_review_schedule>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAutomatedReviewReminderFlowE2E.test_create_plan_rejects_invalid_review_schedule _

self = <Coroutine test_create_plan_rejects_invalid_review_schedule>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAutomatedReviewReminderFlowE2E.test_pending_review_endpoint_exists _

self = <Coroutine test_pending_review_endpoint_exists>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAutomatedReviewReminderFlowE2E.test_pending_review_returns_list_response _

self = <Coroutine test_pending_review_returns_list_response>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAutomatedReviewReminderFlowE2E.test_pending_review_accepts_days_ahead_parameter _

self = <Coroutine test_pending_review_accepts_days_ahead_parameter>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAutomatedReviewReminderFlowE2E.test_pending_review_accepts_30_days_ahead _

self = <Coroutine test_pending_review_accepts_30_days_ahead>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAutomatedReviewReminderFlowE2E.test_pending_review_rejects_invalid_days_ahead _

self = <Coroutine test_pending_review_rejects_invalid_days_ahead>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAutomatedReviewReminderFlowE2E.test_pending_review_rejects_zero_days_ahead _

self = <Coroutine test_pending_review_rejects_zero_days_ahead>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAutomatedReviewReminderFlowE2E.test_pending_review_rejects_too_large_days_ahead _

self = <Coroutine test_pending_review_rejects_too_large_days_ahead>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAutomatedReviewReminderFlowE2E.test_review_reminder_structure_matches_parent_portal _

self = <Coroutine test_review_reminder_structure_matches_parent_portal>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAutomatedReviewReminderFlowE2E.test_review_reminder_days_until_can_be_negative _

self = <Coroutine test_review_reminder_days_until_can_be_negative>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAutomatedReviewReminderFlowE2E.test_overdue_count_in_response _

self = <Coroutine test_overdue_count_in_response>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAutomatedReviewReminderFlowE2E.test_upcoming_count_in_response _

self = <Coroutine test_upcoming_count_in_response>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestReviewReminderCrossServiceIntegration.test_parent_portal_review_summary_flow _

self = <Coroutine test_parent_portal_review_summary_flow>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestReviewReminderCrossServiceIntegration.test_pending_review_count_for_badge _

self = <Coroutine test_pending_review_count_for_badge>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestReviewScheduleValidation.test_valid_review_schedules_accepted _

self = <Coroutine test_valid_review_schedules_accepted>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestReviewScheduleValidation.test_invalid_review_schedules_rejected _

self = <Coroutine test_invalid_review_schedules_rejected>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestReviewScheduleValidation.test_plan_list_filter_by_review_schedule _

self = <Coroutine test_plan_list_filter_by_review_schedule>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestReviewScheduleValidation.test_plan_list_filter_needs_review _

self = <Coroutine test_plan_list_filter_needs_review>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestReviewReminderServiceViaAPI.test_reminder_service_filters_active_plans _

self = <Coroutine test_reminder_service_filters_active_plans>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestReviewReminderServiceViaAPI.test_reminder_categorizes_overdue_correctly _

self = <Coroutine test_reminder_categorizes_overdue_correctly>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestReviewReminderServiceViaAPI.test_reminder_categorizes_upcoming_correctly _

self = <Coroutine test_reminder_categorizes_upcoming_correctly>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCompletionsEndpoint.test_completions_returns_200_with_valid_request _

self = <Coroutine test_completions_returns_200_with_valid_request>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestCompletionsEndpoint.test_completions_requires_auth ___

self = <Coroutine test_completions_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCompletionsEndpoint.test_completions_with_minimal_request _

self = <Coroutine test_completions_with_minimal_request>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCompletionsEndpoint.test_completions_validates_empty_messages _

self = <Coroutine test_completions_validates_empty_messages>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCompletionsEndpoint.test_completions_validates_message_role _

self = <Coroutine test_completions_validates_message_role>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCompletionsEndpoint.test_completions_validates_temperature_range _

self = <Coroutine test_completions_validates_temperature_range>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCompletionsEndpoint.test_completions_returns_503_when_provider_unavailable _

self = <Coroutine test_completions_returns_503_when_provider_unavailable>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCompletionsEndpoint.test_completions_returns_500_on_completion_error _

self = <Coroutine test_completions_returns_500_on_completion_error>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestStreamingCompletionsEndpoint.test_streaming_completions_returns_stream _

self = <Coroutine test_streaming_completions_returns_stream>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestStreamingCompletionsEndpoint.test_streaming_completions_requires_auth _

self = <Coroutine test_streaming_completions_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestHealthEndpoint.test_health_returns_200_without_auth ___

self = <Coroutine test_health_returns_200_without_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestHealthEndpoint.test_health_returns_healthy_status ____

self = <Coroutine test_health_returns_healthy_status>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestHealthEndpoint.test_health_returns_degraded_status ___

self = <Coroutine test_health_returns_degraded_status>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_________ ERROR at setup of TestModelsEndpoint.test_models_returns_200 _________

self = <Coroutine test_models_returns_200>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
________ ERROR at setup of TestModelsEndpoint.test_models_requires_auth ________

self = <Coroutine test_models_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestModelsEndpoint.test_models_returns_model_details ____

self = <Coroutine test_models_returns_model_details>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__________ ERROR at setup of TestUsageEndpoint.test_usage_returns_200 __________

self = <Coroutine test_usage_returns_200>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_________ ERROR at setup of TestUsageEndpoint.test_usage_requires_auth _________

self = <Coroutine test_usage_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestUsageEndpoint.test_usage_with_provider_filter ______

self = <Coroutine test_usage_with_provider_filter>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______ ERROR at setup of TestUsageEndpoint.test_usage_with_model_filter _______

self = <Coroutine test_usage_with_model_filter>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestCacheStatsEndpoint.test_cache_stats_returns_200 _____

self = <Coroutine test_cache_stats_returns_200>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestCacheStatsEndpoint.test_cache_stats_requires_auth ____

self = <Coroutine test_cache_stats_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCacheInvalidateEndpoint.test_cache_invalidate_returns_200 _

self = <Coroutine test_cache_invalidate_returns_200>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCacheInvalidateEndpoint.test_cache_invalidate_requires_auth _

self = <Coroutine test_cache_invalidate_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCacheInvalidateEndpoint.test_cache_invalidate_with_cache_key _

self = <Coroutine test_cache_invalidate_with_cache_key>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCacheInvalidateEndpoint.test_cache_invalidate_with_provider_filter _

self = <Coroutine test_cache_invalidate_with_provider_filter>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCacheInvalidateEndpoint.test_cache_invalidate_with_model_filter _

self = <Coroutine test_cache_invalidate_with_model_filter>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestCacheCleanupEndpoint.test_cache_cleanup_returns_200 ___

self = <Coroutine test_cache_cleanup_returns_200>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestCacheCleanupEndpoint.test_cache_cleanup_requires_auth __

self = <Coroutine test_cache_cleanup_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestEdgeCases.test_completions_with_expired_token ______

self = <Coroutine test_completions_with_expired_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestEdgeCases.test_completions_with_invalid_token ______

self = <Coroutine test_completions_with_invalid_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestEdgeCases.test_completions_with_empty_message_content __

self = <Coroutine test_completions_with_empty_message_content>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestEdgeCases.test_completions_with_invalid_max_tokens ___

self = <Coroutine test_completions_with_invalid_max_tokens>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestEdgeCases.test_completions_with_negative_max_tokens ___

self = <Coroutine test_completions_with_negative_max_tokens>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestEdgeCases.test_completions_with_invalid_provider ____

self = <Coroutine test_completions_with_invalid_provider>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestEdgeCases.test_completions_service_error_returns_500 __

self = <Coroutine test_completions_service_error_returns_500>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestEdgeCases.test_completions_with_all_optional_parameters _

self = <Coroutine test_completions_with_all_optional_parameters>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestResponseStructure.test_completion_response_contains_all_fields _

self = <Coroutine test_completion_response_contains_all_fields>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestResponseStructure.test_health_response_structure ____

self = <Coroutine test_health_response_structure>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestResponseStructure.test_usage_response_structure _____

self = <Coroutine test_usage_response_structure>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__________ ERROR at setup of TestAnalyzeEndpoint.test_analyze_success __________

self = <Coroutine test_analyze_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestAnalyzeEndpoint.test_analyze_french_message _______

self = <Coroutine test_analyze_french_message>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestAnalyzeEndpoint.test_analyze_with_issues_detected ____

self = <Coroutine test_analyze_with_issues_detected>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______ ERROR at setup of TestAnalyzeEndpoint.test_analyze_with_rewrites _______

self = <Coroutine test_analyze_with_rewrites>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______ ERROR at setup of TestAnalyzeEndpoint.test_analyze_requires_auth _______

self = <Coroutine test_analyze_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAnalyzeEndpoint.test_analyze_empty_message_returns_400 _

self = <Coroutine test_analyze_empty_message_returns_400>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAnalyzeEndpoint.test_analyze_invalid_language_returns_422 _

self = <Coroutine test_analyze_invalid_language_returns_422>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAnalyzeEndpoint.test_analyze_invalid_context_returns_422 _

self = <Coroutine test_analyze_invalid_context_returns_422>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAnalyzeEndpoint.test_analyze_response_has_structural_flags _

self = <Coroutine test_analyze_response_has_structural_flags>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestTemplatesEndpoint.test_get_templates_success ______

self = <Coroutine test_get_templates_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestTemplatesEndpoint.test_get_templates_with_language_filter _

self = <Coroutine test_get_templates_with_language_filter>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestTemplatesEndpoint.test_get_templates_with_category_filter _

self = <Coroutine test_get_templates_with_category_filter>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestTemplatesEndpoint.test_get_templates_with_pagination __

self = <Coroutine test_get_templates_with_pagination>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestTemplatesEndpoint.test_get_templates_invalid_limit ___

self = <Coroutine test_get_templates_invalid_limit>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestTemplatesEndpoint.test_get_templates_requires_auth ___

self = <Coroutine test_get_templates_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestTemplatesEndpoint.test_create_template_success _____

self = <Coroutine test_create_template_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestTemplatesEndpoint.test_create_template_french ______

self = <Coroutine test_create_template_french>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestTemplatesEndpoint.test_create_template_requires_auth __

self = <Coroutine test_create_template_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestTemplatesEndpoint.test_create_template_missing_required_fields _

self = <Coroutine test_create_template_missing_required_fields>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestTemplatesEndpoint.test_create_template_invalid_category _

self = <Coroutine test_create_template_invalid_category>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestTrainingExamplesEndpoint.test_get_training_examples_success _

self = <Coroutine test_get_training_examples_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestTrainingExamplesEndpoint.test_get_training_examples_with_language_filter _

self = <Coroutine test_get_training_examples_with_language_filter>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestTrainingExamplesEndpoint.test_get_training_examples_with_issue_type_filter _

self = <Coroutine test_get_training_examples_with_issue_type_filter>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestTrainingExamplesEndpoint.test_get_training_examples_with_difficulty_filter _

self = <Coroutine test_get_training_examples_with_difficulty_filter>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestTrainingExamplesEndpoint.test_get_training_examples_with_pagination _

self = <Coroutine test_get_training_examples_with_pagination>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestTrainingExamplesEndpoint.test_get_training_examples_invalid_limit _

self = <Coroutine test_get_training_examples_invalid_limit>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestTrainingExamplesEndpoint.test_get_training_examples_requires_auth _

self = <Coroutine test_get_training_examples_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestTrainingExamplesEndpoint.test_get_training_examples_response_structure _

self = <Coroutine test_get_training_examples_response_structure>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestTrainingExamplesEndpoint.test_get_training_examples_multiple_filters _

self = <Coroutine test_get_training_examples_multiple_filters>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAPIEdgeCasesAndErrorHandling.test_api_invalid_uuid_format _

self = <Coroutine test_api_invalid_uuid_format>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAPIEdgeCasesAndErrorHandling.test_api_whitespace_only_message _

self = <Coroutine test_api_whitespace_only_message>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAPIEdgeCasesAndErrorHandling.test_api_very_long_message _

self = <Coroutine test_api_very_long_message>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAPIEdgeCasesAndErrorHandling.test_api_message_exceeds_max_length _

self = <Coroutine test_api_message_exceeds_max_length>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAPIEdgeCasesAndErrorHandling.test_api_template_content_exceeds_max_length _

self = <Coroutine test_api_template_content_exceeds_max_length>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestAPIEdgeCasesAndErrorHandling.test_api_invalid_offset_returns_422 _

self = <Coroutine test_api_invalid_offset_returns_422>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestMessagingServiceThreads.test_get_thread_returns_thread _

self = <sqlalchemy.engine.base.Connection object at 0x10a88d8b0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x10a88de50>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10a88dbe0>
parameters = [('5410deb0-3807-4983-9d62-344458e67519', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '1234567...r"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109f93250>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')
test_child_id = UUID('87654321-4321-4321-4321-cba987654321')
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest_asyncio.fixture
    async def sample_thread(
        db_session: AsyncSession,
        test_user_id: UUID,
        test_child_id: UUID,
        test_parent_id_messaging: UUID,
    ) -> MockMessageThread:
        """Create a sample message thread in the database."""
>       return await create_thread_in_db(
            db_session,
            subject="Test Thread",
            created_by=test_user_id,
            thread_type="daily_log",
            child_id=test_child_id,
            participants=[
                {
                    "user_id": str(test_user_id),
                    "user_type": "educator",
                    "display_name": "Test Educator",
                },
                {
                    "user_id": str(test_parent_id_messaging),
                    "user_type": "parent",
                    "display_name": "Test Parent",
                },
            ],
        )

tests/test_messaging.py:435: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:239: in create_thread_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: 
E                           INSERT INTO message_threads (
E                               id, subject, thread_type, child_id, created_by,
E                               participants, is_active, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('5410deb0-3807-4983-9d62-344458e67519', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '12345678-1234-1234-1234-123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator", "display_name": "Test Educator"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', 1, '2026-02-17T15:04:18.491454+00:00', '2026-02-17T15:04:18.491454+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ ERROR at setup of TestMessagingServiceThreads.test_get_thread_unauthorized_raises_error _

self = <sqlalchemy.engine.base.Connection object at 0x10a802910>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x10a802730>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10a88dbe0>
parameters = [('33ac9e22-8eb2-4913-b30a-d2cccdd50459', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '1234567...r"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109723640>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')
test_child_id = UUID('87654321-4321-4321-4321-cba987654321')
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest_asyncio.fixture
    async def sample_thread(
        db_session: AsyncSession,
        test_user_id: UUID,
        test_child_id: UUID,
        test_parent_id_messaging: UUID,
    ) -> MockMessageThread:
        """Create a sample message thread in the database."""
>       return await create_thread_in_db(
            db_session,
            subject="Test Thread",
            created_by=test_user_id,
            thread_type="daily_log",
            child_id=test_child_id,
            participants=[
                {
                    "user_id": str(test_user_id),
                    "user_type": "educator",
                    "display_name": "Test Educator",
                },
                {
                    "user_id": str(test_parent_id_messaging),
                    "user_type": "parent",
                    "display_name": "Test Parent",
                },
            ],
        )

tests/test_messaging.py:435: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:239: in create_thread_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: 
E                           INSERT INTO message_threads (
E                               id, subject, thread_type, child_id, created_by,
E                               participants, is_active, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('33ac9e22-8eb2-4913-b30a-d2cccdd50459', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '12345678-1234-1234-1234-123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator", "display_name": "Test Educator"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', 1, '2026-02-17T15:04:19.439699+00:00', '2026-02-17T15:04:19.439699+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ ERROR at setup of TestMessagingServiceThreads.test_list_threads_for_user_returns_threads _

self = <sqlalchemy.engine.base.Connection object at 0x108f2a0d0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x108f2a490>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10a88dbe0>
parameters = [('e8f2952c-21cf-42ee-8749-4087f883cfbc', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '1234567...r"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x108f2aa00>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')
test_child_id = UUID('87654321-4321-4321-4321-cba987654321')
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest_asyncio.fixture
    async def sample_thread(
        db_session: AsyncSession,
        test_user_id: UUID,
        test_child_id: UUID,
        test_parent_id_messaging: UUID,
    ) -> MockMessageThread:
        """Create a sample message thread in the database."""
>       return await create_thread_in_db(
            db_session,
            subject="Test Thread",
            created_by=test_user_id,
            thread_type="daily_log",
            child_id=test_child_id,
            participants=[
                {
                    "user_id": str(test_user_id),
                    "user_type": "educator",
                    "display_name": "Test Educator",
                },
                {
                    "user_id": str(test_parent_id_messaging),
                    "user_type": "parent",
                    "display_name": "Test Parent",
                },
            ],
        )

tests/test_messaging.py:435: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:239: in create_thread_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: 
E                           INSERT INTO message_threads (
E                               id, subject, thread_type, child_id, created_by,
E                               participants, is_active, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('e8f2952c-21cf-42ee-8749-4087f883cfbc', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '12345678-1234-1234-1234-123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator", "display_name": "Test Educator"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', 1, '2026-02-17T15:04:19.800271+00:00', '2026-02-17T15:04:19.800271+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ ERROR at setup of TestMessagingServiceThreads.test_list_threads_for_user_filters_by_child _

self = <sqlalchemy.engine.base.Connection object at 0x10aa54c40>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x10aa549d0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10a88dbe0>
parameters = [('4b810225-8919-4561-8640-f97097b1cd27', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '1234567...r"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10aa543d0>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')
test_child_id = UUID('87654321-4321-4321-4321-cba987654321')
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest_asyncio.fixture
    async def sample_thread(
        db_session: AsyncSession,
        test_user_id: UUID,
        test_child_id: UUID,
        test_parent_id_messaging: UUID,
    ) -> MockMessageThread:
        """Create a sample message thread in the database."""
>       return await create_thread_in_db(
            db_session,
            subject="Test Thread",
            created_by=test_user_id,
            thread_type="daily_log",
            child_id=test_child_id,
            participants=[
                {
                    "user_id": str(test_user_id),
                    "user_type": "educator",
                    "display_name": "Test Educator",
                },
                {
                    "user_id": str(test_parent_id_messaging),
                    "user_type": "parent",
                    "display_name": "Test Parent",
                },
            ],
        )

tests/test_messaging.py:435: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:239: in create_thread_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: 
E                           INSERT INTO message_threads (
E                               id, subject, thread_type, child_id, created_by,
E                               participants, is_active, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('4b810225-8919-4561-8640-f97097b1cd27', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '12345678-1234-1234-1234-123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator", "display_name": "Test Educator"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', 1, '2026-02-17T15:04:20.167853+00:00', '2026-02-17T15:04:20.167853+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ ERROR at setup of TestMessagingServiceThreads.test_update_thread_changes_subject _

self = <sqlalchemy.engine.base.Connection object at 0x10a8b5970>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x10a8b5580>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10a88dbe0>
parameters = [('5e4aa559-b65f-4828-a7bf-d40230d124f0', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '1234567...r"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10a88e130>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')
test_child_id = UUID('87654321-4321-4321-4321-cba987654321')
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest_asyncio.fixture
    async def sample_thread(
        db_session: AsyncSession,
        test_user_id: UUID,
        test_child_id: UUID,
        test_parent_id_messaging: UUID,
    ) -> MockMessageThread:
        """Create a sample message thread in the database."""
>       return await create_thread_in_db(
            db_session,
            subject="Test Thread",
            created_by=test_user_id,
            thread_type="daily_log",
            child_id=test_child_id,
            participants=[
                {
                    "user_id": str(test_user_id),
                    "user_type": "educator",
                    "display_name": "Test Educator",
                },
                {
                    "user_id": str(test_parent_id_messaging),
                    "user_type": "parent",
                    "display_name": "Test Parent",
                },
            ],
        )

tests/test_messaging.py:435: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:239: in create_thread_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: 
E                           INSERT INTO message_threads (
E                               id, subject, thread_type, child_id, created_by,
E                               participants, is_active, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('5e4aa559-b65f-4828-a7bf-d40230d124f0', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '12345678-1234-1234-1234-123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator", "display_name": "Test Educator"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', 1, '2026-02-17T15:04:20.902222+00:00', '2026-02-17T15:04:20.902222+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ ERROR at setup of TestMessagingServiceThreads.test_archive_thread_sets_inactive _

self = <sqlalchemy.engine.base.Connection object at 0x109b3fcd0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109b3fc40>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10a88dbe0>
parameters = [('ec91ef36-53b3-4f4f-84a6-af64af9ee85c', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '1234567...r"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109163520>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')
test_child_id = UUID('87654321-4321-4321-4321-cba987654321')
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest_asyncio.fixture
    async def sample_thread(
        db_session: AsyncSession,
        test_user_id: UUID,
        test_child_id: UUID,
        test_parent_id_messaging: UUID,
    ) -> MockMessageThread:
        """Create a sample message thread in the database."""
>       return await create_thread_in_db(
            db_session,
            subject="Test Thread",
            created_by=test_user_id,
            thread_type="daily_log",
            child_id=test_child_id,
            participants=[
                {
                    "user_id": str(test_user_id),
                    "user_type": "educator",
                    "display_name": "Test Educator",
                },
                {
                    "user_id": str(test_parent_id_messaging),
                    "user_type": "parent",
                    "display_name": "Test Parent",
                },
            ],
        )

tests/test_messaging.py:435: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:239: in create_thread_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: 
E                           INSERT INTO message_threads (
E                               id, subject, thread_type, child_id, created_by,
E                               participants, is_active, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('ec91ef36-53b3-4f4f-84a6-af64af9ee85c', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '12345678-1234-1234-1234-123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator", "display_name": "Test Educator"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', 1, '2026-02-17T15:04:21.282192+00:00', '2026-02-17T15:04:21.282192+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ ERROR at setup of TestMessagingServiceMessages.test_send_message_returns_valid_response _

self = <sqlalchemy.engine.base.Connection object at 0x109708d90>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109708b20>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10a88dbe0>
parameters = [('db6f4886-b405-4c03-9df0-120a4402762b', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '1234567...r"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109703280>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')
test_child_id = UUID('87654321-4321-4321-4321-cba987654321')
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest_asyncio.fixture
    async def sample_thread(
        db_session: AsyncSession,
        test_user_id: UUID,
        test_child_id: UUID,
        test_parent_id_messaging: UUID,
    ) -> MockMessageThread:
        """Create a sample message thread in the database."""
>       return await create_thread_in_db(
            db_session,
            subject="Test Thread",
            created_by=test_user_id,
            thread_type="daily_log",
            child_id=test_child_id,
            participants=[
                {
                    "user_id": str(test_user_id),
                    "user_type": "educator",
                    "display_name": "Test Educator",
                },
                {
                    "user_id": str(test_parent_id_messaging),
                    "user_type": "parent",
                    "display_name": "Test Parent",
                },
            ],
        )

tests/test_messaging.py:435: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:239: in create_thread_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: 
E                           INSERT INTO message_threads (
E                               id, subject, thread_type, child_id, created_by,
E                               participants, is_active, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('db6f4886-b405-4c03-9df0-120a4402762b', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '12345678-1234-1234-1234-123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator", "display_name": "Test Educator"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', 1, '2026-02-17T15:04:21.632260+00:00', '2026-02-17T15:04:21.632260+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ ERROR at setup of TestMessagingServiceMessages.test_get_message_returns_message _

self = <sqlalchemy.engine.base.Connection object at 0x1089951f0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x108995190>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10a88dbe0>
parameters = [('22ca342c-1120-4c3f-b8f1-dc20adb54003', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '1234567...r"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x108995af0>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')
test_child_id = UUID('87654321-4321-4321-4321-cba987654321')
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest_asyncio.fixture
    async def sample_thread(
        db_session: AsyncSession,
        test_user_id: UUID,
        test_child_id: UUID,
        test_parent_id_messaging: UUID,
    ) -> MockMessageThread:
        """Create a sample message thread in the database."""
>       return await create_thread_in_db(
            db_session,
            subject="Test Thread",
            created_by=test_user_id,
            thread_type="daily_log",
            child_id=test_child_id,
            participants=[
                {
                    "user_id": str(test_user_id),
                    "user_type": "educator",
                    "display_name": "Test Educator",
                },
                {
                    "user_id": str(test_parent_id_messaging),
                    "user_type": "parent",
                    "display_name": "Test Parent",
                },
            ],
        )

tests/test_messaging.py:435: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:239: in create_thread_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: 
E                           INSERT INTO message_threads (
E                               id, subject, thread_type, child_id, created_by,
E                               participants, is_active, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('22ca342c-1120-4c3f-b8f1-dc20adb54003', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '12345678-1234-1234-1234-123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator", "display_name": "Test Educator"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', 1, '2026-02-17T15:04:22.454186+00:00', '2026-02-17T15:04:22.454186+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ ERROR at setup of TestMessagingServiceMessages.test_list_messages_returns_messages _

self = <sqlalchemy.engine.base.Connection object at 0x10aa2b8b0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x10aa2b6d0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10a88dbe0>
parameters = [('a0a15eca-2d24-44f7-a0c5-7e0905a34d0e', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '1234567...r"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1096bf6a0>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')
test_child_id = UUID('87654321-4321-4321-4321-cba987654321')
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest_asyncio.fixture
    async def sample_thread(
        db_session: AsyncSession,
        test_user_id: UUID,
        test_child_id: UUID,
        test_parent_id_messaging: UUID,
    ) -> MockMessageThread:
        """Create a sample message thread in the database."""
>       return await create_thread_in_db(
            db_session,
            subject="Test Thread",
            created_by=test_user_id,
            thread_type="daily_log",
            child_id=test_child_id,
            participants=[
                {
                    "user_id": str(test_user_id),
                    "user_type": "educator",
                    "display_name": "Test Educator",
                },
                {
                    "user_id": str(test_parent_id_messaging),
                    "user_type": "parent",
                    "display_name": "Test Parent",
                },
            ],
        )

tests/test_messaging.py:435: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:239: in create_thread_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: 
E                           INSERT INTO message_threads (
E                               id, subject, thread_type, child_id, created_by,
E                               participants, is_active, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('a0a15eca-2d24-44f7-a0c5-7e0905a34d0e', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '12345678-1234-1234-1234-123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator", "display_name": "Test Educator"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', 1, '2026-02-17T15:04:23.200073+00:00', '2026-02-17T15:04:23.200073+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ ERROR at setup of TestMessagingServiceMessages.test_mark_messages_as_read_updates_status _

self = <sqlalchemy.engine.base.Connection object at 0x108c71ca0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x108c71a30>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10a88dbe0>
parameters = [('98ad1615-6d33-42ee-b0a5-03e38c498680', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '1234567...r"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x108c714f0>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')
test_child_id = UUID('87654321-4321-4321-4321-cba987654321')
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest_asyncio.fixture
    async def sample_thread(
        db_session: AsyncSession,
        test_user_id: UUID,
        test_child_id: UUID,
        test_parent_id_messaging: UUID,
    ) -> MockMessageThread:
        """Create a sample message thread in the database."""
>       return await create_thread_in_db(
            db_session,
            subject="Test Thread",
            created_by=test_user_id,
            thread_type="daily_log",
            child_id=test_child_id,
            participants=[
                {
                    "user_id": str(test_user_id),
                    "user_type": "educator",
                    "display_name": "Test Educator",
                },
                {
                    "user_id": str(test_parent_id_messaging),
                    "user_type": "parent",
                    "display_name": "Test Parent",
                },
            ],
        )

tests/test_messaging.py:435: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:239: in create_thread_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: 
E                           INSERT INTO message_threads (
E                               id, subject, thread_type, child_id, created_by,
E                               participants, is_active, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('98ad1615-6d33-42ee-b0a5-03e38c498680', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '12345678-1234-1234-1234-123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator", "display_name": "Test Educator"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', 1, '2026-02-17T15:04:23.836280+00:00', '2026-02-17T15:04:23.836280+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ ERROR at setup of TestMessagingServiceMessages.test_mark_own_messages_as_read_does_nothing _

self = <sqlalchemy.engine.base.Connection object at 0x108daaca0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x108daa9a0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10a88dbe0>
parameters = [('879e9b00-fef0-48ba-b268-8ff3d9e80c4f', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '1234567...r"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x108daa460>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')
test_child_id = UUID('87654321-4321-4321-4321-cba987654321')
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest_asyncio.fixture
    async def sample_thread(
        db_session: AsyncSession,
        test_user_id: UUID,
        test_child_id: UUID,
        test_parent_id_messaging: UUID,
    ) -> MockMessageThread:
        """Create a sample message thread in the database."""
>       return await create_thread_in_db(
            db_session,
            subject="Test Thread",
            created_by=test_user_id,
            thread_type="daily_log",
            child_id=test_child_id,
            participants=[
                {
                    "user_id": str(test_user_id),
                    "user_type": "educator",
                    "display_name": "Test Educator",
                },
                {
                    "user_id": str(test_parent_id_messaging),
                    "user_type": "parent",
                    "display_name": "Test Parent",
                },
            ],
        )

tests/test_messaging.py:435: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:239: in create_thread_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: 
E                           INSERT INTO message_threads (
E                               id, subject, thread_type, child_id, created_by,
E                               participants, is_active, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('879e9b00-fef0-48ba-b268-8ff3d9e80c4f', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '12345678-1234-1234-1234-123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator", "display_name": "Test Educator"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', 1, '2026-02-17T15:04:24.270836+00:00', '2026-02-17T15:04:24.270836+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ ERROR at setup of TestMessagingServiceMessages.test_mark_thread_as_read_updates_all_messages _

self = <sqlalchemy.engine.base.Connection object at 0x109c68cd0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109c68a60>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10a88dbe0>
parameters = [('570f6694-96b8-4379-9636-ba7d6c6754d2', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '1234567...r"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109c75160>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')
test_child_id = UUID('87654321-4321-4321-4321-cba987654321')
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest_asyncio.fixture
    async def sample_thread(
        db_session: AsyncSession,
        test_user_id: UUID,
        test_child_id: UUID,
        test_parent_id_messaging: UUID,
    ) -> MockMessageThread:
        """Create a sample message thread in the database."""
>       return await create_thread_in_db(
            db_session,
            subject="Test Thread",
            created_by=test_user_id,
            thread_type="daily_log",
            child_id=test_child_id,
            participants=[
                {
                    "user_id": str(test_user_id),
                    "user_type": "educator",
                    "display_name": "Test Educator",
                },
                {
                    "user_id": str(test_parent_id_messaging),
                    "user_type": "parent",
                    "display_name": "Test Parent",
                },
            ],
        )

tests/test_messaging.py:435: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:239: in create_thread_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: 
E                           INSERT INTO message_threads (
E                               id, subject, thread_type, child_id, created_by,
E                               participants, is_active, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('570f6694-96b8-4379-9636-ba7d6c6754d2', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '12345678-1234-1234-1234-123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator", "display_name": "Test Educator"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', 1, '2026-02-17T15:04:24.678049+00:00', '2026-02-17T15:04:24.678049+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ ERROR at setup of TestMessagingServiceMessages.test_delete_message_removes_message _

self = <sqlalchemy.engine.base.Connection object at 0x10894af10>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x10894acd0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10a88dbe0>
parameters = [('c91efb3f-e813-4c5b-9033-5fcb9fadd16d', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '1234567...r"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109445970>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')
test_child_id = UUID('87654321-4321-4321-4321-cba987654321')
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest_asyncio.fixture
    async def sample_thread(
        db_session: AsyncSession,
        test_user_id: UUID,
        test_child_id: UUID,
        test_parent_id_messaging: UUID,
    ) -> MockMessageThread:
        """Create a sample message thread in the database."""
>       return await create_thread_in_db(
            db_session,
            subject="Test Thread",
            created_by=test_user_id,
            thread_type="daily_log",
            child_id=test_child_id,
            participants=[
                {
                    "user_id": str(test_user_id),
                    "user_type": "educator",
                    "display_name": "Test Educator",
                },
                {
                    "user_id": str(test_parent_id_messaging),
                    "user_type": "parent",
                    "display_name": "Test Parent",
                },
            ],
        )

tests/test_messaging.py:435: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:239: in create_thread_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: 
E                           INSERT INTO message_threads (
E                               id, subject, thread_type, child_id, created_by,
E                               participants, is_active, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('c91efb3f-e813-4c5b-9033-5fcb9fadd16d', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '12345678-1234-1234-1234-123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator", "display_name": "Test Educator"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', 1, '2026-02-17T15:04:25.062342+00:00', '2026-02-17T15:04:25.062342+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ ERROR at setup of TestMessagingServiceMessages.test_delete_message_by_non_sender_raises_error _

self = <sqlalchemy.engine.base.Connection object at 0x108b35eb0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x108b35cd0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10a88dbe0>
parameters = [('d3669355-0f16-4303-80be-4b880500e821', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '1234567...r"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1095d0be0>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')
test_child_id = UUID('87654321-4321-4321-4321-cba987654321')
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest_asyncio.fixture
    async def sample_thread(
        db_session: AsyncSession,
        test_user_id: UUID,
        test_child_id: UUID,
        test_parent_id_messaging: UUID,
    ) -> MockMessageThread:
        """Create a sample message thread in the database."""
>       return await create_thread_in_db(
            db_session,
            subject="Test Thread",
            created_by=test_user_id,
            thread_type="daily_log",
            child_id=test_child_id,
            participants=[
                {
                    "user_id": str(test_user_id),
                    "user_type": "educator",
                    "display_name": "Test Educator",
                },
                {
                    "user_id": str(test_parent_id_messaging),
                    "user_type": "parent",
                    "display_name": "Test Parent",
                },
            ],
        )

tests/test_messaging.py:435: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:239: in create_thread_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: 
E                           INSERT INTO message_threads (
E                               id, subject, thread_type, child_id, created_by,
E                               participants, is_active, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('d3669355-0f16-4303-80be-4b880500e821', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '12345678-1234-1234-1234-123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator", "display_name": "Test Educator"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', 1, '2026-02-17T15:04:25.431387+00:00', '2026-02-17T15:04:25.431387+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ ERROR at setup of TestMessagingServiceMessages.test_get_unread_count_returns_correct_counts _

self = <sqlalchemy.engine.base.Connection object at 0x109d62bb0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109d62df0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10a88dbe0>
parameters = [('c3f69278-634f-4d18-a3fa-cb3290c4c203', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '1234567...r"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10894a670>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')
test_child_id = UUID('87654321-4321-4321-4321-cba987654321')
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest_asyncio.fixture
    async def sample_thread(
        db_session: AsyncSession,
        test_user_id: UUID,
        test_child_id: UUID,
        test_parent_id_messaging: UUID,
    ) -> MockMessageThread:
        """Create a sample message thread in the database."""
>       return await create_thread_in_db(
            db_session,
            subject="Test Thread",
            created_by=test_user_id,
            thread_type="daily_log",
            child_id=test_child_id,
            participants=[
                {
                    "user_id": str(test_user_id),
                    "user_type": "educator",
                    "display_name": "Test Educator",
                },
                {
                    "user_id": str(test_parent_id_messaging),
                    "user_type": "parent",
                    "display_name": "Test Parent",
                },
            ],
        )

tests/test_messaging.py:435: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:239: in create_thread_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: 
E                           INSERT INTO message_threads (
E                               id, subject, thread_type, child_id, created_by,
E                               participants, is_active, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('c3f69278-634f-4d18-a3fa-cb3290c4c203', 'Test Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '12345678-1234-1234-1234-123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator", "display_name": "Test Educator"}, {"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Test Parent"}]', 1, '2026-02-17T15:04:25.814055+00:00', '2026-02-17T15:04:25.814055+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ ERROR at setup of TestMessagingServiceNotifications.test_create_notification_preference_updates_existing _

self = <sqlalchemy.engine.base.Connection object at 0x1095b02e0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x1095b01f0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x1095b0400>
parameters = [('d2446cd9-ea71-4a8d-8dec-08e83562695b', '22222222-2222-2222-2222-222222222222', 'message', 'email', 1, 'immediate', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: notification_preferences

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10965d1f0>
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest_asyncio.fixture
    async def sample_notification_preference(
        db_session: AsyncSession,
        test_parent_id_messaging: UUID,
    ) -> MockNotificationPreference:
        """Create a sample notification preference in the database."""
>       return await create_notification_preference_in_db(
            db_session,
            parent_id=test_parent_id_messaging,
            notification_type="message",
            channel="email",
            is_enabled=True,
        )

tests/test_messaging.py:478: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:344: in create_notification_preference_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: notification_preferences
E               [SQL: 
E                           INSERT INTO notification_preferences (
E                               id, parent_id, notification_type, channel, is_enabled,
E                               frequency, quiet_hours_start, quiet_hours_end, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('d2446cd9-ea71-4a8d-8dec-08e83562695b', '22222222-2222-2222-2222-222222222222', 'message', 'email', 1, 'immediate', None, None, '2026-02-17T15:04:26.630118+00:00', '2026-02-17T15:04:26.630118+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ ERROR at setup of TestMessagingServiceNotifications.test_delete_notification_preference_success _

self = <sqlalchemy.engine.base.Connection object at 0x1093c2e50>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x1093c2c70>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x1095b0400>
parameters = [('9b471a50-54db-45b2-8701-6cae492248d1', '22222222-2222-2222-2222-222222222222', 'message', 'email', 1, 'immediate', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: notification_preferences

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1093c8220>
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest_asyncio.fixture
    async def sample_notification_preference(
        db_session: AsyncSession,
        test_parent_id_messaging: UUID,
    ) -> MockNotificationPreference:
        """Create a sample notification preference in the database."""
>       return await create_notification_preference_in_db(
            db_session,
            parent_id=test_parent_id_messaging,
            notification_type="message",
            channel="email",
            is_enabled=True,
        )

tests/test_messaging.py:478: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:344: in create_notification_preference_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: notification_preferences
E               [SQL: 
E                           INSERT INTO notification_preferences (
E                               id, parent_id, notification_type, channel, is_enabled,
E                               frequency, quiet_hours_start, quiet_hours_end, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('9b471a50-54db-45b2-8701-6cae492248d1', '22222222-2222-2222-2222-222222222222', 'message', 'email', 1, 'immediate', None, None, '2026-02-17T15:04:27.755068+00:00', '2026-02-17T15:04:27.755068+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ ERROR at setup of TestMessagingServiceNotifications.test_is_notification_enabled_returns_correct_status _

self = <sqlalchemy.engine.base.Connection object at 0x109b90970>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109b90790>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x1095b0400>
parameters = [('33be1d17-1f58-482a-a140-66bc43e7077f', '22222222-2222-2222-2222-222222222222', 'message', 'email', 1, 'immediate', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: notification_preferences

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x107553ca0>
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest_asyncio.fixture
    async def sample_notification_preference(
        db_session: AsyncSession,
        test_parent_id_messaging: UUID,
    ) -> MockNotificationPreference:
        """Create a sample notification preference in the database."""
>       return await create_notification_preference_in_db(
            db_session,
            parent_id=test_parent_id_messaging,
            notification_type="message",
            channel="email",
            is_enabled=True,
        )

tests/test_messaging.py:478: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:344: in create_notification_preference_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: notification_preferences
E               [SQL: 
E                           INSERT INTO notification_preferences (
E                               id, parent_id, notification_type, channel, is_enabled,
E                               frequency, quiet_hours_start, quiet_hours_end, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('33be1d17-1f58-482a-a140-66bc43e7077f', '22222222-2222-2222-2222-222222222222', 'message', 'email', 1, 'immediate', None, None, '2026-02-17T15:04:29.031577+00:00', '2026-02-17T15:04:29.031577+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
__ ERROR at setup of TestThreadEndpoints.test_create_thread_endpoint_success ___

self = <Coroutine test_create_thread_endpoint_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestThreadEndpoints.test_create_thread_endpoint_requires_auth _

self = <Coroutine test_create_thread_endpoint_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestThreadEndpoints.test_list_threads_endpoint_success ___

self = <Coroutine test_list_threads_endpoint_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestThreadEndpoints.test_list_threads_endpoint_with_filters _

self = <Coroutine test_list_threads_endpoint_with_filters>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestThreadEndpoints.test_get_thread_endpoint_not_found ___

self = <Coroutine test_get_thread_endpoint_not_found>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestMessageEndpoints.test_send_message_endpoint_thread_not_found _

self = <Coroutine test_send_message_endpoint_thread_not_found>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestMessageEndpoints.test_list_messages_endpoint_thread_not_found _

self = <Coroutine test_list_messages_endpoint_thread_not_found>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestMessageEndpoints.test_mark_messages_as_read_endpoint_requires_auth _

self = <Coroutine test_mark_messages_as_read_endpoint_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestMessageEndpoints.test_get_message_endpoint_not_found __

self = <Coroutine test_get_message_endpoint_not_found>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestNotificationPreferenceEndpoints.test_create_preference_endpoint_success _

self = <Coroutine test_create_preference_endpoint_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestNotificationPreferenceEndpoints.test_get_preferences_endpoint_returns_list _

self = <Coroutine test_get_preferences_endpoint_returns_list>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestNotificationPreferenceEndpoints.test_get_specific_preference_endpoint_not_found _

self = <Coroutine test_get_specific_preference_endpoint_not_found>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestNotificationPreferenceEndpoints.test_delete_preference_endpoint_not_found _

self = <Coroutine test_delete_preference_endpoint_not_found>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestNotificationPreferenceEndpoints.test_create_default_preferences_endpoint _

self = <Coroutine test_create_default_preferences_endpoint>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestNotificationPreferenceEndpoints.test_set_quiet_hours_endpoint _

self = <Coroutine test_set_quiet_hours_endpoint>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestThreadEndpointIntegration.test_endpoint_create_thread_with_initial_message _

self = <Coroutine test_endpoint_create_thread_with_initial_message>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestThreadEndpointIntegration.test_endpoint_create_question_thread_type _

self = <Coroutine test_endpoint_create_question_thread_type>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestThreadEndpointIntegration.test_endpoint_create_urgent_thread_type _

self = <Coroutine test_endpoint_create_urgent_thread_type>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestThreadEndpointIntegration.test_endpoint_get_thread_with_messages _

self = <Coroutine test_endpoint_get_thread_with_messages>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestThreadEndpointIntegration.test_endpoint_update_thread_subject _

self = <Coroutine test_endpoint_update_thread_subject>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestThreadEndpointIntegration.test_endpoint_archive_thread _

self = <Coroutine test_endpoint_archive_thread>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestThreadEndpointIntegration.test_endpoint_list_threads_pagination _

self = <Coroutine test_endpoint_list_threads_pagination>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestThreadEndpointIntegration.test_endpoint_list_threads_filter_by_type _

self = <Coroutine test_endpoint_list_threads_filter_by_type>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestThreadEndpointIntegration.test_endpoint_create_thread_invalid_thread_type _

self = <Coroutine test_endpoint_create_thread_invalid_thread_type>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestMessageEndpointIntegration.test_endpoint_send_message_success _

self = <Coroutine test_endpoint_send_message_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestMessageEndpointIntegration.test_endpoint_send_message_with_mentions _

self = <Coroutine test_endpoint_send_message_with_mentions>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestMessageEndpointIntegration.test_endpoint_list_messages_success _

self = <Coroutine test_endpoint_list_messages_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestMessageEndpointIntegration.test_endpoint_list_messages_pagination _

self = <Coroutine test_endpoint_list_messages_pagination>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestMessageEndpointIntegration.test_endpoint_get_message_success _

self = <Coroutine test_endpoint_get_message_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestMessageEndpointIntegration.test_endpoint_mark_messages_as_read_success _

self = <Coroutine test_endpoint_mark_messages_as_read_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestMessageEndpointIntegration.test_endpoint_mark_thread_as_read_success _

self = <Coroutine test_endpoint_mark_thread_as_read_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestMessageEndpointIntegration.test_endpoint_delete_message_success _

self = <Coroutine test_endpoint_delete_message_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestMessageEndpointIntegration.test_endpoint_get_unread_count_success _

self = <Coroutine test_endpoint_get_unread_count_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestMessageEndpointIntegration.test_endpoint_send_message_empty_content _

self = <Coroutine test_endpoint_send_message_empty_content>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestNotificationEndpointIntegration.test_endpoint_create_preference_with_quiet_hours _

self = <Coroutine test_endpoint_create_preference_with_quiet_hours>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestNotificationEndpointIntegration.test_endpoint_update_preference_toggle_enabled _

self = <Coroutine test_endpoint_update_preference_toggle_enabled>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestNotificationEndpointIntegration.test_endpoint_get_specific_preference_success _

self = <Coroutine test_endpoint_get_specific_preference_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestNotificationEndpointIntegration.test_endpoint_delete_preference_success _

self = <Coroutine test_endpoint_delete_preference_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestNotificationEndpointIntegration.test_endpoint_notification_preferences_requires_auth _

self = <Coroutine test_endpoint_notification_preferences_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestNotificationEndpointIntegration.test_endpoint_batch_update_preferences _

self = <Coroutine test_endpoint_batch_update_preferences>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestEndpointErrorHandling.test_endpoint_invalid_uuid_thread _

self = <Coroutine test_endpoint_invalid_uuid_thread>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestEndpointErrorHandling.test_endpoint_invalid_uuid_message _

self = <Coroutine test_endpoint_invalid_uuid_message>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestEndpointErrorHandling.test_endpoint_invalid_uuid_child _

self = <Coroutine test_endpoint_invalid_uuid_child>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestEndpointErrorHandling.test_endpoint_missing_required_subject _

self = <Coroutine test_endpoint_missing_required_subject>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestEndpointErrorHandling.test_endpoint_missing_required_content _

self = <Coroutine test_endpoint_missing_required_content>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestEndpointErrorHandling.test_endpoint_notification_invalid_type _

self = <Coroutine test_endpoint_notification_invalid_type>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestEndpointErrorHandling.test_endpoint_notification_invalid_channel _

self = <Coroutine test_endpoint_notification_invalid_channel>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestEndpointErrorHandling.test_endpoint_send_message_to_archived_thread _

self = <Coroutine test_endpoint_send_message_to_archived_thread>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestQADiagnosticsIngestion.test_ingest_minimal_diagnostics_success _

self = <Coroutine test_ingest_minimal_diagnostics_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestQADiagnosticsIngestion.test_ingest_full_diagnostics_success _

self = <Coroutine test_ingest_full_diagnostics_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestQADiagnosticsIngestion.test_ingest_diagnostics_missing_auth _

self = <Coroutine test_ingest_diagnostics_missing_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestQADiagnosticsIngestion.test_ingest_diagnostics_invalid_token _

self = <Coroutine test_ingest_diagnostics_invalid_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestQADiagnosticsValidation.test_missing_test_run_id ____

self = <Coroutine test_missing_test_run_id>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestQADiagnosticsValidation.test_invalid_test_run_id_format _

self = <Coroutine test_invalid_test_run_id_format>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestQADiagnosticsValidation.test_missing_app_metadata ____

self = <Coroutine test_missing_app_metadata>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestQADiagnosticsValidation.test_missing_device_metadata __

self = <Coroutine test_missing_device_metadata>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestQADiagnosticsValidation.test_invalid_app_version_format _

self = <Coroutine test_invalid_app_version_format>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestQADiagnosticsValidation.test_invalid_ios_version_format _

self = <Coroutine test_invalid_ios_version_format>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestQADiagnosticsValidation.test_invalid_battery_level ___

self = <Coroutine test_invalid_battery_level>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestQADiagnosticsValidation.test_invalid_log_level _____

self = <Coroutine test_invalid_log_level>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestQADiagnosticsValidation.test_invalid_network_error_type _

self = <Coroutine test_invalid_network_error_type>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestQADiagnosticsHealthCheck.test_health_check_success ___

self = <Coroutine test_health_check_success>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestQADiagnosticsHealthCheck.test_health_check_no_auth_required _

self = <Coroutine test_health_check_no_auth_required>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestQADiagnosticsRetrieval.test_get_diagnostics_not_found __

self = <Coroutine test_get_diagnostics_not_found>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestQADiagnosticsRetrieval.test_get_diagnostics_by_run_empty _

self = <Coroutine test_get_diagnostics_by_run_empty>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestQADiagnosticsRetrieval.test_get_diagnostics_requires_auth _

self = <Coroutine test_get_diagnostics_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestQADiagnosticsSchemaValidation.test_log_message_max_length _

self = <Coroutine test_log_message_max_length>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestQADiagnosticsSchemaValidation.test_status_code_valid_range _

self = <Coroutine test_status_code_valid_range>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestQADiagnosticsSchemaValidation.test_null_status_code_allowed _

self = <Coroutine test_null_status_code_allowed>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestQADiagnosticsSchemaValidation.test_empty_logs_array_allowed _

self = <Coroutine test_empty_logs_array_allowed>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestQADiagnosticsSchemaValidation.test_custom_data_allowed _

self = <Coroutine test_custom_data_allowed>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestSeedIdempotency.test_seed_activities_idempotent _____
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py, line 87
      @pytest.mark.asyncio
      async def test_seed_activities_idempotent(self, test_session: AsyncSession):
          """Test that seeding activities multiple times doesn't create duplicates."""
          # First run
          activity_ids_1 = await seed_activities(test_session)
          count_1 = await count_records(test_session, Activity)

          # Second run - should not create new activities
          activity_ids_2 = await seed_activities(test_session)
          count_2 = await count_records(test_session, Activity)

          # Verify idempotency
          assert count_1 == count_2, "Activity count should remain the same after second run"
          assert count_1 > 0, "Should have created some activities"

          # Verify we get the same IDs back (order may differ)
          assert set(activity_ids_1) == set(activity_ids_2), "Should return same activity IDs"
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py:87
_ ERROR at setup of TestSeedIdempotency.test_seed_activity_participations_idempotent _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py, line 105
      @pytest.mark.asyncio
      async def test_seed_activity_participations_idempotent(self, test_session: AsyncSession):
          """Test that seeding participations multiple times doesn't create duplicates."""
          # Setup: create activities and children
          activity_ids = await seed_activities(test_session)
          child_ids, _, _ = await generate_children_and_families()

          # First run
          await seed_activity_participations(test_session, child_ids, activity_ids)
          count_1 = await count_records(test_session, ActivityParticipation)

          # Second run - should not create new participations
          await seed_activity_participations(test_session, child_ids, activity_ids)
          count_2 = await count_records(test_session, ActivityParticipation)

          # Verify idempotency
          assert count_1 == count_2, "Participation count should remain the same after second run"
          assert count_1 > 0, "Should have created some participations"
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py:105
_ ERROR at setup of TestSeedIdempotency.test_seed_activity_recommendations_idempotent _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py, line 124
      @pytest.mark.asyncio
      async def test_seed_activity_recommendations_idempotent(self, test_session: AsyncSession):
          """Test that seeding recommendations multiple times doesn't create duplicates."""
          # Setup
          activity_ids = await seed_activities(test_session)
          child_ids, _, _ = await generate_children_and_families()

          # First run
          await seed_activity_recommendations(test_session, child_ids, activity_ids)
          count_1 = await count_records(test_session, ActivityRecommendation)

          # Second run - should not create new recommendations
          await seed_activity_recommendations(test_session, child_ids, activity_ids)
          count_2 = await count_records(test_session, ActivityRecommendation)

          # Verify idempotency
          assert count_1 == count_2, "Recommendation count should remain the same after second run"
          assert count_1 > 0, "Should have created some recommendations"
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py:124
_ ERROR at setup of TestSeedIdempotency.test_seed_coaching_sessions_idempotent _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py, line 143
      @pytest.mark.asyncio
      async def test_seed_coaching_sessions_idempotent(self, test_session: AsyncSession):
          """Test that seeding coaching sessions multiple times doesn't create duplicates."""
          # Setup
          child_ids, _, parent_ids = await generate_children_and_families()

          # First run
          session_ids_1 = await seed_coaching_sessions(test_session, child_ids, parent_ids)
          count_1 = await count_records(test_session, CoachingSession)

          # Second run - should not create new sessions
          session_ids_2 = await seed_coaching_sessions(test_session, child_ids, parent_ids)
          count_2 = await count_records(test_session, CoachingSession)

          # Verify idempotency
          assert count_1 == count_2, "Coaching session count should remain the same after second run"
          assert count_1 > 0, "Should have created some coaching sessions"
          assert set(session_ids_1) == set(session_ids_2), "Should return same session IDs"
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py:143
__ ERROR at setup of TestSeedIdempotency.test_seed_parent_reports_idempotent ___
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py, line 162
      @pytest.mark.asyncio
      async def test_seed_parent_reports_idempotent(self, test_session: AsyncSession):
          """Test that seeding parent reports multiple times doesn't create duplicates."""
          # Setup
          child_ids, _, parent_ids = await generate_children_and_families()

          # First run
          await seed_parent_reports(test_session, child_ids, parent_ids)
          count_1 = await count_records(test_session, ParentReport)

          # Second run - should not create new reports
          await seed_parent_reports(test_session, child_ids, parent_ids)
          count_2 = await count_records(test_session, ParentReport)

          # Verify idempotency
          assert count_1 == count_2, "Parent report count should remain the same after second run"
          assert count_1 > 0, "Should have created some parent reports"
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py:162
__ ERROR at setup of TestSeedIdempotency.test_seed_home_activities_idempotent __
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py, line 180
      @pytest.mark.asyncio
      async def test_seed_home_activities_idempotent(self, test_session: AsyncSession):
          """Test that seeding home activities multiple times doesn't create duplicates."""
          # Setup
          activity_ids = await seed_activities(test_session)
          child_ids, _, _ = await generate_children_and_families()

          # First run
          await seed_home_activities(test_session, child_ids, activity_ids)
          count_1 = await count_records(test_session, HomeActivity)

          # Second run - should not create new home activities
          await seed_home_activities(test_session, child_ids, activity_ids)
          count_2 = await count_records(test_session, HomeActivity)

          # Verify idempotency
          assert count_1 == count_2, "Home activity count should remain the same after second run"
          assert count_1 > 0, "Should have created some home activities"
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py:180
_ ERROR at setup of TestSeedIdempotency.test_seed_communication_preferences_idempotent _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py, line 199
      @pytest.mark.asyncio
      async def test_seed_communication_preferences_idempotent(self, test_session: AsyncSession):
          """Test that seeding communication preferences multiple times doesn't create duplicates."""
          # Setup
          child_ids, _, parent_ids = await generate_children_and_families()

          # First run
          await seed_communication_preferences(test_session, child_ids, parent_ids)
          count_1 = await count_records(test_session, CommunicationPreference)

          # Second run - should not create new preferences
          await seed_communication_preferences(test_session, child_ids, parent_ids)
          count_2 = await count_records(test_session, CommunicationPreference)

          # Verify idempotency
          assert count_1 == count_2, "Communication preference count should remain the same after second run"
          assert count_1 > 0, "Should have created some communication preferences"
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py:199
____ ERROR at setup of TestSeedIdempotency.test_full_seed_script_idempotent ____
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py, line 217
      @pytest.mark.asyncio
      async def test_full_seed_script_idempotent(self, test_session: AsyncSession):
          """Test that running the complete seed script multiple times is idempotent."""
          # Generate IDs
          child_ids, family_ids, parent_ids = await generate_children_and_families()

          # First complete run
          activity_ids_1 = await seed_activities(test_session)
          await seed_activity_participations(test_session, child_ids, activity_ids_1)
          await seed_activity_recommendations(test_session, child_ids, activity_ids_1)
          await seed_coaching_sessions(test_session, child_ids, parent_ids)
          await seed_parent_reports(test_session, child_ids, parent_ids)
          await seed_home_activities(test_session, child_ids, activity_ids_1)
          await seed_communication_preferences(test_session, child_ids, parent_ids)

          # Count all records after first run
          counts_1 = {
              "activities": await count_records(test_session, Activity),
              "participations": await count_records(test_session, ActivityParticipation),
              "recommendations": await count_records(test_session, ActivityRecommendation),
              "coaching_sessions": await count_records(test_session, CoachingSession),
              "parent_reports": await count_records(test_session, ParentReport),
              "home_activities": await count_records(test_session, HomeActivity),
              "communication_prefs": await count_records(test_session, CommunicationPreference),
          }

          # Second complete run
          activity_ids_2 = await seed_activities(test_session)
          await seed_activity_participations(test_session, child_ids, activity_ids_2)
          await seed_activity_recommendations(test_session, child_ids, activity_ids_2)
          await seed_coaching_sessions(test_session, child_ids, parent_ids)
          await seed_parent_reports(test_session, child_ids, parent_ids)
          await seed_home_activities(test_session, child_ids, activity_ids_2)
          await seed_communication_preferences(test_session, child_ids, parent_ids)

          # Count all records after second run
          counts_2 = {
              "activities": await count_records(test_session, Activity),
              "participations": await count_records(test_session, ActivityParticipation),
              "recommendations": await count_records(test_session, ActivityRecommendation),
              "coaching_sessions": await count_records(test_session, CoachingSession),
              "parent_reports": await count_records(test_session, ParentReport),
              "home_activities": await count_records(test_session, HomeActivity),
              "communication_prefs": await count_records(test_session, CommunicationPreference),
          }

          # Verify all counts remained the same
          for entity_type, count_1 in counts_1.items():
              count_2 = counts_2[entity_type]
              assert count_1 == count_2, (
                  f"{entity_type} count changed from {count_1} to {count_2} "
                  "after second run - seed script is not idempotent!"
              )
              assert count_1 > 0, f"Should have created some {entity_type}"
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py:217
__ ERROR at setup of TestSeedIdempotency.test_no_duplicate_activities_by_name __
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py, line 272
      @pytest.mark.asyncio
      async def test_no_duplicate_activities_by_name(self, test_session: AsyncSession):
          """Test that running seed multiple times doesn't create activities with duplicate names."""
          # Run seed twice
          await seed_activities(test_session)
          await seed_activities(test_session)

          # Get all activity names
          result = await test_session.execute(select(Activity.name))
          names = [row[0] for row in result.all()]

          # Check for duplicates
          unique_names = set(names)
          assert len(names) == len(unique_names), (
              f"Found duplicate activity names. "
              f"Total: {len(names)}, Unique: {len(unique_names)}"
          )
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py:272
_ ERROR at setup of TestSeedIdempotency.test_data_integrity_after_multiple_runs _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py, line 290
      @pytest.mark.asyncio
      async def test_data_integrity_after_multiple_runs(self, test_session: AsyncSession):
          """Test that data integrity is maintained after running seed script multiple times."""
          # Setup
          child_ids, _, parent_ids = await generate_children_and_families()
          activity_ids = await seed_activities(test_session)

          # Run participations seeding 3 times
          for _ in range(3):
              await seed_activity_participations(test_session, child_ids, activity_ids)

          # Verify all participations reference valid activities
          result = await test_session.execute(
              select(ActivityParticipation.activity_id)
          )
          participation_activity_ids = [row[0] for row in result.all()]

          # All participation activity IDs should be in the seeded activity IDs
          for activity_id in participation_activity_ids:
              assert activity_id in activity_ids, (
                  f"Found participation referencing non-existent activity {activity_id}"
              )
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py:290
______ ERROR at setup of TestSeedEdgeCases.test_seed_with_empty_database _______
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py, line 322
      @pytest.mark.asyncio
      async def test_seed_with_empty_database(self, test_session: AsyncSession):
          """Test seeding into empty database works correctly."""
          # Verify database is empty
          count = await count_records(test_session, Activity)
          assert count == 0, "Database should start empty"

          # Run seed
          activity_ids = await seed_activities(test_session)

          # Verify data was created
          count = await count_records(test_session, Activity)
          assert count > 0, "Should have created activities"
          assert len(activity_ids) == count, "Should return all created activity IDs"
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py:322
_______ ERROR at setup of TestSeedEdgeCases.test_seed_with_partial_data ________
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py, line 337
      @pytest.mark.asyncio
      async def test_seed_with_partial_data(self, test_session: AsyncSession):
          """Test seeding when some data already exists."""
          # Create some activities manually
          manual_activity = Activity(
              id=uuid4(),
              name="Manual Test Activity",
              description="Manually created for testing",
              activity_type=ActivityType.COGNITIVE,
              difficulty=ActivityDifficulty.EASY,
              duration_minutes=30,
              materials_needed=["test materials"],
              min_age_months=12,
              max_age_months=36,
              is_active=True,
          )
          test_session.add(manual_activity)
          await test_session.commit()

          initial_count = await count_records(test_session, Activity)
          assert initial_count == 1, "Should have one manual activity"

          # Run seed - should add more activities
          activity_ids = await seed_activities(test_session)
          final_count = await count_records(test_session, Activity)

          # Verify seed added activities
          assert final_count > initial_count, "Should have added seeded activities"

          # Verify manual activity still exists
          result = await test_session.execute(
              select(Activity).where(Activity.id == manual_activity.id)
          )
          found_activity = result.scalar_one_or_none()
          assert found_activity is not None, "Manual activity should still exist"
          assert found_activity.name == "Manual Test Activity", "Manual activity should be unchanged"
E       fixture 'test_session' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_seed_idempotency.py:337
_______ ERROR at setup of TestFileModel.test_create_file_with_all_fields _______
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 40
      @pytest.mark.asyncio
      async def test_create_file_with_all_fields(
          self,
          sample_file: MockFile,
      ):
          """Test File can be created with all fields."""
          assert sample_file.id is not None
          assert sample_file.owner_id is not None
          assert sample_file.filename is not None
          assert sample_file.original_filename == "test_image.jpg"
          assert sample_file.content_type == "image/jpeg"
          assert sample_file.size_bytes == 1024 * 100  # 100 KB
          assert sample_file.storage_backend == "local"
          assert sample_file.storage_path is not None
          assert sample_file.is_public is False
          assert sample_file.description == "A test image file"
          assert sample_file.created_at is not None
          assert sample_file.updated_at is not None
E       fixture 'sample_file' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:40
________________ ERROR at setup of TestFileModel.test_file_repr ________________
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 59
      @pytest.mark.asyncio
      async def test_file_repr(
          self,
          sample_file: MockFile,
      ):
          """Test File string representation."""
          repr_str = repr(sample_file)
          assert "File" in repr_str
          assert str(sample_file.id) in repr_str
          assert sample_file.original_filename in repr_str
E       fixture 'sample_file' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:59
___________ ERROR at setup of TestFileModel.test_create_public_file ____________
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 70
      @pytest.mark.asyncio
      async def test_create_public_file(
          self,
          sample_public_file: MockFile,
      ):
          """Test File can be created with public visibility."""
          assert sample_public_file.is_public is True
          assert sample_public_file.content_type == "application/pdf"
          assert sample_public_file.storage_backend == "s3"
E       fixture 'sample_public_file' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:70
__________ ERROR at setup of TestFileModel.test_file_with_thumbnails ___________
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 80
      @pytest.mark.asyncio
      async def test_file_with_thumbnails(
          self,
          sample_file_with_thumbnails: MockFile,
      ):
          """Test File can have associated thumbnails."""
          assert len(sample_file_with_thumbnails.thumbnails) == 3
          sizes = {thumb.size for thumb in sample_file_with_thumbnails.thumbnails}
          assert sizes == {"small", "medium", "large"}
E       fixture 'sample_file_with_thumbnails' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:80
________ ERROR at setup of TestFileThumbnailModel.test_create_thumbnail ________
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 94
      @pytest.mark.asyncio
      async def test_create_thumbnail(
          self,
          db_session: AsyncSession,
          sample_file: MockFile,
      ):
          """Test FileThumbnail can be created."""
          thumbnail = await create_file_thumbnail_in_db(
              db_session,
              file_id=sample_file.id,
              size="medium",
              width=300,
              height=300,
          )

          assert thumbnail.id is not None
          assert thumbnail.file_id == sample_file.id
          assert thumbnail.size == "medium"
          assert thumbnail.width == 300
          assert thumbnail.height == 300
          assert thumbnail.storage_path is not None
          assert thumbnail.created_at is not None
E       fixture 'sample_file' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:94
_________ ERROR at setup of TestFileThumbnailModel.test_thumbnail_repr _________
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 117
      @pytest.mark.asyncio
      async def test_thumbnail_repr(
          self,
          db_session: AsyncSession,
          sample_file: MockFile,
      ):
          """Test FileThumbnail string representation."""
          thumbnail = await create_file_thumbnail_in_db(
              db_session,
              file_id=sample_file.id,
              size="small",
              width=100,
              height=100,
          )

          repr_str = repr(thumbnail)
          assert "FileThumbnail" in repr_str
          assert str(thumbnail.id) in repr_str
          assert "small" in repr_str
          assert "100x100" in repr_str
E       fixture 'sample_file' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:117
______ ERROR at setup of TestStorageQuotaModel.test_create_storage_quota _______
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 142
      @pytest.mark.asyncio
      async def test_create_storage_quota(
          self,
          sample_storage_quota: MockStorageQuota,
      ):
          """Test StorageQuota can be created."""
          assert sample_storage_quota.id is not None
          assert sample_storage_quota.owner_id is not None
          assert sample_storage_quota.quota_bytes == 104857600  # 100 MB
          assert sample_storage_quota.used_bytes == 10485760  # 10 MB
          assert sample_storage_quota.file_count == 5
          assert sample_storage_quota.created_at is not None
          assert sample_storage_quota.updated_at is not None
E       fixture 'sample_storage_quota' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:142
__ ERROR at setup of TestStorageQuotaModel.test_storage_quota_available_bytes __
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 156
      @pytest.mark.asyncio
      async def test_storage_quota_available_bytes(
          self,
          sample_storage_quota: MockStorageQuota,
      ):
          """Test StorageQuota available_bytes calculation."""
          expected_available = 104857600 - 10485760  # 90 MB
          assert sample_storage_quota.available_bytes == expected_available
E       fixture 'sample_storage_quota' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:156
_ ERROR at setup of TestStorageQuotaModel.test_storage_quota_usage_percentage __
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 165
      @pytest.mark.asyncio
      async def test_storage_quota_usage_percentage(
          self,
          sample_storage_quota: MockStorageQuota,
      ):
          """Test StorageQuota usage_percentage calculation."""
          expected_percentage = (10485760 / 104857600) * 100  # ~10%
          assert abs(sample_storage_quota.usage_percentage - expected_percentage) < 0.01
E       fixture 'sample_storage_quota' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:165
____ ERROR at setup of TestStorageQuotaModel.test_storage_quota_near_limit _____
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 174
      @pytest.mark.asyncio
      async def test_storage_quota_near_limit(
          self,
          sample_storage_quota_near_limit: MockStorageQuota,
      ):
          """Test StorageQuota near limit calculations."""
          assert sample_storage_quota_near_limit.usage_percentage > 90.0
          assert sample_storage_quota_near_limit.available_bytes < 500000  # < 500 KB
E       fixture 'sample_storage_quota_near_limit' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:174
_______ ERROR at setup of TestStorageQuotaModel.test_empty_storage_quota _______
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 183
      @pytest.mark.asyncio
      async def test_empty_storage_quota(
          self,
          sample_empty_storage_quota: MockStorageQuota,
      ):
          """Test StorageQuota with no files."""
          assert sample_empty_storage_quota.used_bytes == 0
          assert sample_empty_storage_quota.file_count == 0
          assert sample_empty_storage_quota.usage_percentage == 0.0
          assert sample_empty_storage_quota.available_bytes == sample_empty_storage_quota.quota_bytes
E       fixture 'sample_empty_storage_quota' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:183
_______ ERROR at setup of TestStorageQuotaModel.test_storage_quota_repr ________
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 194
      @pytest.mark.asyncio
      async def test_storage_quota_repr(
          self,
          sample_storage_quota: MockStorageQuota,
      ):
          """Test StorageQuota string representation."""
          repr_str = repr(sample_storage_quota)
          assert "StorageQuota" in repr_str
          assert str(sample_storage_quota.id) in repr_str
E       fixture 'sample_storage_quota' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:194
_ ERROR at setup of TestStorageServiceQuota.test_get_or_create_quota_returns_existing _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 301
      @pytest.mark.asyncio
      async def test_get_or_create_quota_returns_existing(
          self,
          db_session: AsyncSession,
          sample_storage_quota: MockStorageQuota,
      ):
          """Test get_or_create_quota returns existing quota."""
          from app.services.storage_service import StorageService

          service = StorageService(db_session)

          quota = await service.get_or_create_quota(sample_storage_quota.owner_id)

          assert quota is not None
          assert quota.owner_id == sample_storage_quota.owner_id
E       fixture 'sample_storage_quota' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:301
_ ERROR at setup of TestStorageServiceQuota.test_check_quota_returns_true_when_available _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 317
      @pytest.mark.asyncio
      async def test_check_quota_returns_true_when_available(
          self,
          db_session: AsyncSession,
          sample_storage_quota: MockStorageQuota,
      ):
          """Test check_quota returns True when space is available."""
          from app.services.storage_service import StorageService

          service = StorageService(db_session)

          # Request less than available
          result = await service.check_quota(
              sample_storage_quota.owner_id,
              required_bytes=1024 * 1024,  # 1 MB
              raise_on_exceeded=False,
          )

          assert result is True
E       fixture 'sample_storage_quota' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:317
_ ERROR at setup of TestStorageServiceQuota.test_check_quota_returns_false_when_exceeded _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 337
      @pytest.mark.asyncio
      async def test_check_quota_returns_false_when_exceeded(
          self,
          db_session: AsyncSession,
          sample_storage_quota_near_limit: MockStorageQuota,
      ):
          """Test check_quota returns False when quota would be exceeded."""
          from app.services.storage_service import StorageService

          service = StorageService(db_session)

          # Request more than available
          result = await service.check_quota(
              sample_storage_quota_near_limit.owner_id,
              required_bytes=10 * 1024 * 1024,  # 10 MB
              raise_on_exceeded=False,
          )

          assert result is False
E       fixture 'sample_storage_quota_near_limit' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:337
_ ERROR at setup of TestStorageServiceQuota.test_check_quota_raises_when_exceeded _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 357
      @pytest.mark.asyncio
      async def test_check_quota_raises_when_exceeded(
          self,
          db_session: AsyncSession,
          sample_storage_quota_near_limit: MockStorageQuota,
      ):
          """Test check_quota raises QuotaExceededError when quota exceeded."""
          from app.services.storage_service import QuotaExceededError, StorageService

          service = StorageService(db_session)

          with pytest.raises(QuotaExceededError):
              await service.check_quota(
                  sample_storage_quota_near_limit.owner_id,
                  required_bytes=10 * 1024 * 1024,  # 10 MB
                  raise_on_exceeded=True,
              )
E       fixture 'sample_storage_quota_near_limit' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:357
_ ERROR at setup of TestStorageServiceQuota.test_get_quota_usage_returns_stats _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 375
      @pytest.mark.asyncio
      async def test_get_quota_usage_returns_stats(
          self,
          db_session: AsyncSession,
          sample_storage_quota: MockStorageQuota,
      ):
          """Test get_quota_usage returns detailed statistics."""
          from app.services.storage_service import StorageService

          service = StorageService(db_session)

          stats = await service.get_quota_usage(sample_storage_quota.owner_id)

          assert "quota_bytes" in stats
          assert "used_bytes" in stats
          assert "available_bytes" in stats
          assert "usage_percentage" in stats
          assert "file_count" in stats
          assert "can_upload" in stats
          assert stats["can_upload"] is True
E       fixture 'sample_storage_quota' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:375
_ ERROR at setup of TestStorageServiceSignedUrls.test_generate_secure_url_invalid_expiration _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 520
      @pytest.mark.asyncio
      async def test_generate_secure_url_invalid_expiration(
          self,
          db_session: AsyncSession,
          sample_file: MockFile,
          test_user_id,
      ):
          """Test generate_secure_url rejects invalid expiration time."""
          from app.services.storage_service import StorageService

          service = StorageService(db_session)

          # Too short (< 60 seconds)
          with pytest.raises(ValueError):
              await service.generate_secure_url(
                  file_id=sample_file.id,
                  owner_id=test_user_id,
                  expires_in_seconds=30,
              )

          # Too long (> 86400 seconds / 24 hours)
          with pytest.raises(ValueError):
              await service.generate_secure_url(
                  file_id=sample_file.id,
                  owner_id=test_user_id,
                  expires_in_seconds=100000,
              )
E       fixture 'sample_file' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:520
________ ERROR at setup of TestUploadEndpoint.test_upload_requires_auth ________

self = <Coroutine test_upload_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestUploadEndpoint.test_upload_missing_file_returns_422 ___

self = <Coroutine test_upload_missing_file_returns_422>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestGetQuotaEndpoint.test_get_quota_returns_200 _______

self = <Coroutine test_get_quota_returns_200>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestGetQuotaEndpoint.test_get_quota_requires_auth ______

self = <Coroutine test_get_quota_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestListFilesEndpoint.test_list_files_returns_200 ______

self = <Coroutine test_list_files_returns_200>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestListFilesEndpoint.test_list_files_requires_auth _____

self = <Coroutine test_list_files_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestListFilesEndpoint.test_list_files_pagination ______

self = <Coroutine test_list_files_pagination>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestListFilesEndpoint.test_list_files_content_type_filter __

self = <Coroutine test_list_files_content_type_filter>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestListFilesEndpoint.test_list_files_public_filter _____

self = <Coroutine test_list_files_public_filter>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestGetFileEndpoint.test_get_file_requires_auth _______

self = <Coroutine test_get_file_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
________ ERROR at setup of TestGetFileEndpoint.test_get_file_not_found _________

self = <Coroutine test_get_file_not_found>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestDownloadFileEndpoint.test_download_file_requires_auth __

self = <Coroutine test_download_file_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestDownloadFileEndpoint.test_download_file_not_found ____

self = <Coroutine test_download_file_not_found>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestDeleteFileEndpoint.test_delete_file_requires_auth ____

self = <Coroutine test_delete_file_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestDeleteFileEndpoint.test_delete_file_not_found ______

self = <Coroutine test_delete_file_not_found>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestSecureUrlEndpoint.test_secure_url_requires_auth _____

self = <Coroutine test_secure_url_requires_auth>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestSecureUrlEndpoint.test_secure_url_not_found _______

self = <Coroutine test_secure_url_not_found>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestSecureUrlEndpoint.test_secure_url_validates_expiration _

self = <Coroutine test_secure_url_validates_expiration>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestEdgeCases.test_invalid_uuid_format_get_file _______

self = <Coroutine test_invalid_uuid_format_get_file>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestEdgeCases.test_invalid_uuid_format_delete_file _____

self = <Coroutine test_invalid_uuid_format_delete_file>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestEdgeCases.test_invalid_uuid_format_download _______

self = <Coroutine test_invalid_uuid_format_download>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_________ ERROR at setup of TestEdgeCases.test_negative_skip_rejected __________

self = <Coroutine test_negative_skip_rejected>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___________ ERROR at setup of TestEdgeCases.test_zero_limit_rejected ___________

self = <Coroutine test_zero_limit_rejected>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_________ ERROR at setup of TestEdgeCases.test_limit_over_100_rejected _________

self = <Coroutine test_limit_over_100_rejected>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestFileMetadataFixtures.test_sample_file_data_fixture ___
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 1051
      @pytest.mark.asyncio
      async def test_sample_file_data_fixture(
          self,
          sample_file_data: dict,
          test_user_id,
      ):
          """Test sample_file_data fixture has correct structure."""
          assert "owner_id" in sample_file_data
          assert "filename" in sample_file_data
          assert "original_filename" in sample_file_data
          assert "content_type" in sample_file_data
          assert "size_bytes" in sample_file_data
          assert "storage_backend" in sample_file_data
          assert sample_file_data["owner_id"] == test_user_id
E       fixture 'sample_file_data' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:1051
____ ERROR at setup of TestFileMetadataFixtures.test_multiple_files_fixture ____
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 1066
      @pytest.mark.asyncio
      async def test_multiple_files_fixture(
          self,
          sample_files: list[MockFile],
          test_user_id,
      ):
          """Test sample_files fixture creates multiple files."""
          assert len(sample_files) == 5

          # All files should belong to the same owner
          for file in sample_files:
              assert file.owner_id == test_user_id

          # Should have variety of content types
          content_types = {file.content_type for file in sample_files}
          assert len(content_types) > 1
E       fixture 'sample_files' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:1066
___ ERROR at setup of TestFileMetadataFixtures.test_thumbnail_sizes_fixture ____
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 1083
      @pytest.mark.asyncio
      async def test_thumbnail_sizes_fixture(
          self,
          sample_thumbnail_sizes: dict,
      ):
          """Test thumbnail_sizes fixture has correct structure."""
          assert "small" in sample_thumbnail_sizes
          assert "medium" in sample_thumbnail_sizes
          assert "large" in sample_thumbnail_sizes

          for size_name, dimensions in sample_thumbnail_sizes.items():
              assert "width" in dimensions
              assert "height" in dimensions
              assert dimensions["width"] > 0
              assert dimensions["height"] > 0
E       fixture 'sample_thumbnail_sizes' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:1083
_ ERROR at setup of TestFileMetadataFixtures.test_image_content_types_fixture __
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 1099
      @pytest.mark.asyncio
      async def test_image_content_types_fixture(
          self,
          image_content_types: list[str],
      ):
          """Test image_content_types fixture contains expected types."""
          assert "image/jpeg" in image_content_types
          assert "image/png" in image_content_types
          assert "image/gif" in image_content_types
          assert "image/webp" in image_content_types
E       fixture 'image_content_types' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:1099
_ ERROR at setup of TestFileMetadataFixtures.test_allowed_content_types_fixture _
file /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py, line 1110
      @pytest.mark.asyncio
      async def test_allowed_content_types_fixture(
          self,
          allowed_content_types: list[str],
      ):
          """Test allowed_content_types fixture contains expected types."""
          assert "image/jpeg" in allowed_content_types
          assert "application/pdf" in allowed_content_types
          assert len(allowed_content_types) >= 4
E       fixture 'allowed_content_types' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, current_timestamp, db_session, doctest_namespace, event_loop_policy, expired_token, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, infant_age_months, medical_keywords, monkeypatch, preschool_age_months, pytestconfig, rainy_weather, random_uuid, record_property, record_testsuite_property, record_xml_attribute, recwarn, safety_disclaimer, sample_activities, sample_activity, sample_activity_data, sample_birth_date, sample_child_id, sample_child_id_activity, sample_coaching_guidance, sample_coaching_request, sample_communication_preference, sample_communication_preference_request, sample_development_profile, sample_educator_id, sample_evidence_source, sample_french_communication_preference, sample_french_communication_preference_request, sample_french_home_activity, sample_french_home_activity_data, sample_french_parent_report, sample_french_report_request, sample_home_activities, sample_home_activity, sample_home_activity_data, sample_medical_question_request, sample_monthly_snapshot, sample_observation, sample_observations_all_domains, sample_parent_report, sample_participation, sample_profile_child_id, sample_recommendation, sample_report_request, sample_skill_assessment, sample_skill_assessments_all_domains, school_age_months, sunny_weather, test_child_id, test_parent_id, test_user_id, test_user_payload, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, toddler_age_months, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, valid_token
>       use 'pytest --fixtures [testpath]' for help on them.

/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_storage.py:1110
_ ERROR at setup of TestWebhookPayloadParsing.test_valid_care_activity_payload _

self = <Coroutine test_valid_care_activity_payload>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestWebhookPayloadParsing.test_valid_meal_logged_payload __

self = <Coroutine test_valid_meal_logged_payload>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestWebhookPayloadParsing.test_valid_nap_logged_payload ___

self = <Coroutine test_valid_nap_logged_payload>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookPayloadParsing.test_valid_photo_uploaded_payload _

self = <Coroutine test_valid_photo_uploaded_payload>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestWebhookPayloadParsing.test_minimal_valid_payload ____

self = <Coroutine test_minimal_valid_payload>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestWebhookPayloadParsing.test_missing_event_type ______

self = <Coroutine test_missing_event_type>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestWebhookPayloadParsing.test_missing_entity_type _____

self = <Coroutine test_missing_entity_type>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestWebhookPayloadParsing.test_missing_entity_id ______

self = <Coroutine test_missing_entity_id>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestWebhookPayloadParsing.test_invalid_event_type ______

self = <Coroutine test_invalid_event_type>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestWebhookPayloadParsing.test_invalid_entity_type _____

self = <Coroutine test_invalid_entity_type>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______ ERROR at setup of TestWebhookPayloadParsing.test_empty_entity_id _______

self = <Coroutine test_empty_entity_id>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestWebhookPayloadParsing.test_entity_id_too_long ______

self = <Coroutine test_entity_id_too_long>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestWebhookPayloadParsing.test_empty_payload_dict ______

self = <Coroutine test_empty_payload_dict>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookPayloadParsing.test_invalid_gibbon_sync_log_id __

self = <Coroutine test_invalid_gibbon_sync_log_id>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______ ERROR at setup of TestWebhookJWTValidation.test_valid_jwt_token ________

self = <Coroutine test_valid_jwt_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestWebhookJWTValidation.test_missing_jwt_token _______

self = <Coroutine test_missing_jwt_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestWebhookJWTValidation.test_expired_jwt_token _______

self = <Coroutine test_expired_jwt_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestWebhookJWTValidation.test_malformed_jwt_token ______

self = <Coroutine test_malformed_jwt_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestWebhookJWTValidation.test_invalid_bearer_format _____

self = <Coroutine test_invalid_bearer_format>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestWebhookJWTValidation.test_wrong_auth_scheme _______

self = <Coroutine test_wrong_auth_scheme>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestWebhookJWTValidation.test_empty_bearer_token ______

self = <Coroutine test_empty_bearer_token>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestWebhookJWTValidation.test_jwt_with_additional_claims __

self = <Coroutine test_jwt_with_additional_claims>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookEventProcessing.test_care_activity_created_processing _

self = <Coroutine test_care_activity_created_processing>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookEventProcessing.test_care_activity_updated_processing _

self = <Coroutine test_care_activity_updated_processing>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookEventProcessing.test_care_activity_deleted_processing _

self = <Coroutine test_care_activity_deleted_processing>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestWebhookEventProcessing.test_meal_logged_processing ___

self = <Coroutine test_meal_logged_processing>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___ ERROR at setup of TestWebhookEventProcessing.test_nap_logged_processing ____

self = <Coroutine test_nap_logged_processing>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookEventProcessing.test_photo_uploaded_processing __

self = <Coroutine test_photo_uploaded_processing>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookEventProcessing.test_attendance_check_in_processing _

self = <Coroutine test_attendance_check_in_processing>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookEventProcessing.test_attendance_check_out_processing _

self = <Coroutine test_attendance_check_out_processing>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookEventProcessing.test_child_profile_updated_processing _

self = <Coroutine test_child_profile_updated_processing>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__ ERROR at setup of TestWebhookEventProcessing.test_custom_event_processing ___

self = <Coroutine test_custom_event_processing>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookEventProcessing.test_all_event_types_return_processing_time _

self = <Coroutine test_all_event_types_return_processing_time>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookResponseStructure.test_response_contains_all_required_fields _

self = <Coroutine test_response_contains_all_required_fields>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookResponseStructure.test_response_status_is_processed _

self = <Coroutine test_response_status_is_processed>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookResponseStructure.test_response_echoes_event_type_and_entity_id _

self = <Coroutine test_response_echoes_event_type_and_entity_id>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookResponseStructure.test_response_received_at_is_valid_timestamp _

self = <Coroutine test_response_received_at_is_valid_timestamp>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookResponseStructure.test_processing_time_is_reasonable _

self = <Coroutine test_processing_time_is_reasonable>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestWebhookHealthCheck.test_health_check_returns_200 ____

self = <Coroutine test_health_check_returns_200>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookHealthCheck.test_health_check_no_auth_required __

self = <Coroutine test_health_check_no_auth_required>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookHealthCheck.test_health_check_returns_healthy_status _

self = <Coroutine test_health_check_returns_healthy_status>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookHealthCheck.test_health_check_timestamp_is_valid _

self = <Coroutine test_health_check_timestamp_is_valid>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____ ERROR at setup of TestWebhookEdgeCases.test_large_payload_is_accepted _____

self = <Coroutine test_large_payload_is_accepted>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookEdgeCases.test_special_characters_in_entity_id __

self = <Coroutine test_special_characters_in_entity_id>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
________ ERROR at setup of TestWebhookEdgeCases.test_unicode_in_payload ________

self = <Coroutine test_unicode_in_payload>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______ ERROR at setup of TestWebhookEdgeCases.test_null_optional_fields _______

self = <Coroutine test_null_optional_fields>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____ ERROR at setup of TestWebhookEdgeCases.test_entity_id_at_max_length ______

self = <Coroutine test_entity_id_at_max_length>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ ERROR at setup of TestWebhookEdgeCases.test_valid_timestamp_format ______

self = <Coroutine test_valid_timestamp_format>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ ERROR at setup of TestWebhookEdgeCases.test_payload_with_various_data_types __

self = <Coroutine test_payload_with_various_data_types>

    def setup(self) -> None:
        runner_fixture_id = f"_{self._loop_scope}_scoped_runner"
        if runner_fixture_id not in self.fixturenames:
            self.fixturenames.append(runner_fixture_id)
>       return super().setup()

.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:463: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:748: in pytest_fixture_setup
    hook_result = yield
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:318: in _asyncgen_fixture_wrapper
    result = runner.run(setup(), context=context)
.venv_test/lib/python3.9/site-packages/backports/asyncio/runner/runner.py:175: in run
    return self._loop.run_until_complete(task)  # type: ignore[union-attr, no-any-return]
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/base_events.py:642: in run_until_complete
    return future.result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/futures.py:201: in result
    raise self._exception
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:256: in __step
    result = coro.send(None)
.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:314: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:461: in client
    from app.main import app
app/main.py:17: in <module>
    from app.routers.storage import router as storage_router
app/routers/storage.py:35: in <module>
    from app.services.storage_service import (
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
=================================== FAILURES ===================================
______________ TestHashPassword.test_hash_password_returns_string ______________

self = <tests.auth.test_security.TestHashPassword object at 0x1051a8df0>

    def test_hash_password_returns_string(self):
        """Test hash_password returns a string."""
>       hashed = hash_password("test_password")

tests/auth/test_security.py:19: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x1073dfd60>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
___________ TestHashPassword.test_hash_password_returns_bcrypt_hash ____________

self = <tests.auth.test_security.TestHashPassword object at 0x104f1d0a0>

    def test_hash_password_returns_bcrypt_hash(self):
        """Test hash_password returns a valid bcrypt hash."""
>       hashed = hash_password("test_password")

tests/auth/test_security.py:24: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x1076dbd60>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
_ TestHashPassword.test_hash_password_different_passwords_produce_different_hashes _

self = <tests.auth.test_security.TestHashPassword object at 0x104f98cd0>

    def test_hash_password_different_passwords_produce_different_hashes(self):
        """Test different passwords produce different hashes."""
>       hash1 = hash_password("password1")

tests/auth/test_security.py:30: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x107750430>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
______ TestHashPassword.test_hash_password_same_password_different_hashes ______

self = <tests.auth.test_security.TestHashPassword object at 0x104f98b80>

    def test_hash_password_same_password_different_hashes(self):
        """Test same password produces different hashes due to salt."""
>       hash1 = hash_password("same_password")

tests/auth/test_security.py:36: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x10739b0d0>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
_______________ TestHashPassword.test_hash_password_empty_string _______________

self = <tests.auth.test_security.TestHashPassword object at 0x104f98fd0>

    def test_hash_password_empty_string(self):
        """Test hash_password handles empty string."""
>       hashed = hash_password("")

tests/auth/test_security.py:43: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x10708cac0>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
____________ TestHashPassword.test_hash_password_special_characters ____________

self = <tests.auth.test_security.TestHashPassword object at 0x104f98d00>

    def test_hash_password_special_characters(self):
        """Test hash_password handles special characters."""
        special_password = "P@$$w0rd!#%&*()[]{}|;:',.<>?/~`"
>       hashed = hash_password(special_password)

tests/auth/test_security.py:50: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x107010ee0>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
____________ TestHashPassword.test_hash_password_unicode_characters ____________

self = <tests.auth.test_security.TestHashPassword object at 0x105010100>

    def test_hash_password_unicode_characters(self):
        """Test hash_password handles unicode characters."""
        unicode_password = "password\u00e9\u00e0\u00fc\u4e2d\u6587"
>       hashed = hash_password(unicode_password)

tests/auth/test_security.py:57: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x1072d4eb0>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
______________ TestHashPassword.test_hash_password_long_password _______________

self = <tests.auth.test_security.TestHashPassword object at 0x105010280>

    def test_hash_password_long_password(self):
        """Test hash_password handles long passwords."""
        # Bcrypt has a 72-byte limit, test with longer password
        long_password = "a" * 100
>       hashed = hash_password(long_password)

tests/auth/test_security.py:65: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x10710a310>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
_______________ TestHashPassword.test_hash_password_hash_length ________________

self = <tests.auth.test_security.TestHashPassword object at 0x1050108e0>

    def test_hash_password_hash_length(self):
        """Test hash_password produces standard bcrypt hash length."""
>       hashed = hash_password("test_password")

tests/auth/test_security.py:71: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x1074d2910>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
___________ TestVerifyPassword.test_verify_password_correct_password ___________

self = <tests.auth.test_security.TestVerifyPassword object at 0x105010c10>

    def test_verify_password_correct_password(self):
        """Test verify_password returns True for correct password."""
        password = "my_secure_password"
>       hashed = hash_password(password)

tests/auth/test_security.py:82: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x1077def10>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
__________ TestVerifyPassword.test_verify_password_incorrect_password __________

self = <tests.auth.test_security.TestVerifyPassword object at 0x105010df0>

    def test_verify_password_incorrect_password(self):
        """Test verify_password returns False for incorrect password."""
        password = "my_secure_password"
>       hashed = hash_password(password)

tests/auth/test_security.py:88: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x107293250>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
_______ TestVerifyPassword.test_verify_password_empty_password_mismatch ________

self = <tests.auth.test_security.TestVerifyPassword object at 0x105010f70>

    def test_verify_password_empty_password_mismatch(self):
        """Test verify_password handles empty password verification."""
>       hashed = hash_password("non_empty_password")

tests/auth/test_security.py:93: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x107020b50>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
_________ TestVerifyPassword.test_verify_password_empty_password_match _________

self = <tests.auth.test_security.TestVerifyPassword object at 0x104d88fd0>

    def test_verify_password_empty_password_match(self):
        """Test verify_password with empty password hashed and verified."""
>       hashed = hash_password("")

tests/auth/test_security.py:98: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x10761ff10>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
____________ TestVerifyPassword.test_verify_password_case_sensitive ____________

self = <tests.auth.test_security.TestVerifyPassword object at 0x104d889d0>

    def test_verify_password_case_sensitive(self):
        """Test verify_password is case sensitive."""
        password = "CaseSensitivePassword"
>       hashed = hash_password(password)

tests/auth/test_security.py:104: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x1072d4ca0>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
__________ TestVerifyPassword.test_verify_password_special_characters __________

self = <tests.auth.test_security.TestVerifyPassword object at 0x104d88d00>

    def test_verify_password_special_characters(self):
        """Test verify_password with special characters."""
        special_password = "P@$$w0rd!#%&*()[]{}|;:',.<>?/~`"
>       hashed = hash_password(special_password)

tests/auth/test_security.py:112: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x1077eda00>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
__________ TestVerifyPassword.test_verify_password_unicode_characters __________

self = <tests.auth.test_security.TestVerifyPassword object at 0x104d88af0>

    def test_verify_password_unicode_characters(self):
        """Test verify_password with unicode characters."""
        unicode_password = "password\u00e9\u00e0\u00fc\u4e2d\u6587"
>       hashed = hash_password(unicode_password)

tests/auth/test_security.py:119: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x107025700>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
________ TestVerifyPassword.test_verify_password_whitespace_significant ________

self = <tests.auth.test_security.TestVerifyPassword object at 0x104d88910>

    def test_verify_password_whitespace_significant(self):
        """Test verify_password treats whitespace as significant."""
        password = "password"
>       hashed = hash_password(password)

tests/auth/test_security.py:126: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x1072cd0a0>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
________ TestVerifyPassword.test_verify_password_with_precomputed_hash _________

self = <tests.auth.test_security.TestVerifyPassword object at 0x104d88820>

    def test_verify_password_with_precomputed_hash(self):
        """Test verify_password works with known bcrypt hash."""
        # This is a valid bcrypt hash for "Test123!@#"
        known_hash = "$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/X4.G5P0FsMLr/fGYC"
        # Note: This hash is for "Test123!@#" but due to version differences
        # we just verify it works with the correct format
>       assert isinstance(verify_password("Test123!@#", known_hash), bool)

tests/auth/test_security.py:138: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:49: in verify_password
    return pwd_context.verify(plain_password, hashed_password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2347: in verify
    return record.verify(secret, hash, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x1070ae5b0>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
_______________ TestSecurityIntegration.test_password_roundtrip ________________

self = <tests.auth.test_security.TestSecurityIntegration object at 0x104d84f40>

    def test_password_roundtrip(self):
        """Test complete password hash and verify cycle."""
        passwords = [
            "simple",
            "Complex@123!",
            "unicode\u00e9\u4e2d",
            "",
            "a" * 50,
        ]
        for password in passwords:
>           hashed = hash_password(password)

tests/auth/test_security.py:237: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x10728aac0>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
____________ TestSecurityIntegration.test_token_vs_password_hashing ____________

self = <tests.auth.test_security.TestSecurityIntegration object at 0x104d84160>

    def test_token_vs_password_hashing(self):
        """Test that token and password hashing behave differently."""
        value = "same_value"
    
        # Password hashing is non-deterministic (uses salt)
>       pwd_hash1 = hash_password(value)

tests/auth/test_security.py:246: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x1073e2970>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
___________ TestSecurityIntegration.test_hash_formats_are_different ____________

self = <tests.auth.test_security.TestSecurityIntegration object at 0x104d84820>

    def test_hash_formats_are_different(self):
        """Test password and token hashes have different formats."""
        value = "test_value"
    
>       pwd_hash = hash_password(value)

tests/auth/test_security.py:259: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x10778ed30>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
___________ TestAuthServiceIntegration.test_all_user_roles_can_login ___________

self = <tests.auth.test_service.TestAuthServiceIntegration object at 0x104e18fa0>

    @pytest.mark.asyncio
    async def test_all_user_roles_can_login(self):
        """Test all user roles can successfully log in."""
        roles = [
            UserRole.ADMIN,
            UserRole.TEACHER,
            UserRole.PARENT,
            UserRole.ACCOUNTANT,
            UserRole.STAFF,
        ]
    
        # Generate hash once for performance
>       password_hash = hash_password(TEST_PASSWORD_PLAIN)

tests/auth/test_service.py:1179: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x1073fa640>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
_______________ TestHelperFunctions.test_get_client_ip_no_client _______________

self = <tests.test_auth_audit_logger.TestHelperFunctions object at 0x105163fd0>

    def test_get_client_ip_no_client(self) -> None:
        """Test getting client IP when request has no client."""
        request = Mock()
        request.headers = {}
        # No client attribute
    
        ip = get_client_ip(request)
>       assert ip is None
E       AssertionError: assert <Mock name='mock.client.host' id='4423245008'> is None

tests/test_auth_audit_logger.py:257: AssertionError
_________________ TestHelperFunctions.test_get_endpoint_no_url _________________

self = <tests.test_auth_audit_logger.TestHelperFunctions object at 0x10520e220>

    def test_get_endpoint_no_url(self) -> None:
        """Test getting endpoint when request has no URL."""
        request = Mock()
        # No url attribute
    
        endpoint = get_endpoint(request)
>       assert endpoint == ""
E       assert "<Mock name='...'4418276944'>" == ''
E         
E         + <Mock name='mock.method' id='4418275840'> <Mock name='mock.url.path' id='4418276944'>

tests/test_auth_audit_logger.py:301: AssertionError
______________________ test_password_not_stored_plaintext ______________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1081fc4f0>

    @pytest.mark.asyncio
    async def test_password_not_stored_plaintext(
        db_session: AsyncSession,
    ) -> None:
        """Test that passwords are never stored in plaintext.
    
        Verifies critical password security requirements:
        1. Passwords are hashed using bcrypt (hash starts with $2b$)
        2. Plain text passwords are never stored in the database
        3. verify_password correctly validates hashed passwords
    
        This ensures compliance with security best practices and prevents
        credential exposure in case of database breach.
        """
        from app.core.security import verify_password
    
        # Create a user with a known plain password
        plain_password = "SecureTestPassword123!"
        user = User(
            id=uuid4(),
            email="security_test@example.com",
>           password_hash=hash_password(plain_password),
            first_name="Security",
            last_name="Test",
            role=UserRole.TEACHER,
            is_active=True,
        )

tests/test_auth_endpoints.py:820: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/core/security.py:29: in hash_password
    return pwd_context.hash(password)
.venv_test/lib/python3.9/site-packages/passlib/context.py:2258: in hash
    return record.hash(secret, **kwds)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:779: in hash
    self.checksum = self._calc_checksum(secret)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:591: in _calc_checksum
    self._stub_requires_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2254: in _stub_requires_backend
    cls.set_backend()
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2156: in set_backend
    return owner.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2163: in set_backend
    return cls.set_backend(name, dryrun=dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2188: in set_backend
    cls._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2311: in _set_backend
    super(SubclassBackendMixin, cls)._set_backend(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:2224: in _set_backend
    ok = loader(**kwds)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:626: in _load_backend_mixin
    return mixin_cls._finalize_backend_mixin(name, dryrun)
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:421: in _finalize_backend_mixin
    if detect_wrap_bug(IDENT_2A):
.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:380: in detect_wrap_bug
    if verify(secret, bug_hash):
.venv_test/lib/python3.9/site-packages/passlib/utils/handlers.py:792: in verify
    return consteq(self._calc_checksum(secret), chk)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <passlib.handlers.bcrypt._BcryptBackend object at 0x1081fcb50>
secret = b'01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345...7890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234'

    def _calc_checksum(self, secret):
        # bcrypt behavior:
        #   secret must be bytes
        #   config must be ascii bytes
        #   returns ascii bytes
        secret, ident = self._prepare_digest_args(secret)
        config = self._get_config(ident)
        if isinstance(config, unicode):
            config = config.encode("ascii")
>       hash = _bcrypt.hashpw(secret, config)
E       ValueError: password cannot be longer than 72 bytes, truncate manually if necessary (e.g. my_password[:72])

.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py:655: ValueError
------------------------------ Captured log call -------------------------------
WARNING  passlib.handlers.bcrypt:bcrypt.py:622 (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
AttributeError: module 'bcrypt' has no attribute '__about__'
______ TestDevelopmentProfileAuthorization.test_update_profile_authorized ______

self = <tests.test_development_profile_authorization.TestDevelopmentProfileAuthorization object at 0x1059199a0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1075d4970>
sample_profile = UUID('5b5ec3df-24a1-4223-a24f-c31daea54a40')
test_child_id_dev = UUID('cccccccc-cccc-cccc-cccc-cccccccccccc')
test_educator_id = UUID('aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')

    @pytest.mark.asyncio
    async def test_update_profile_authorized(
        self,
        db_session: AsyncSession,
        sample_profile: UUID,
        test_child_id_dev: UUID,
        test_educator_id: UUID,
    ):
        """Test that update_profile succeeds for the owner."""
        service = DevelopmentProfileService(db_session)
    
        request = DevelopmentProfileRequest(
            child_id=test_child_id_dev,
            educator_id=test_educator_id,
            birth_date=date(2020, 1, 15),
            notes="Updated notes",
        )
    
>       profile = await service.update_profile(
            profile_id=sample_profile,
            request=request,
            user_id=test_educator_id,  # Authorized educator
        )

tests/test_development_profile_authorization.py:531: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/development_profile_service.py:260: in update_profile
    await self.db.commit()
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:4467: in _flush
    transaction.rollback(_capture_exception=True)
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/persistence.py:85: in save_obj
    _emit_update_statements(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

base_mapper = <Mapper at 0x10447bd60; DevelopmentProfile>
uowtransaction = <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x10854d1f0>
mapper = <Mapper at 0x10447bd60; DevelopmentProfile>
table = Table('development_profiles', MetaData(), Column('id', UUID(), table=<development_profiles>, primary_key=True, nullabl...ow>), server_default=DefaultClause(<sqlalchemy.sql.functions.now at 0x10447b040; now>, for_update=False)), schema=None)
update = <generator object _collect_update_commands at 0x107a6b820>

    def _emit_update_statements(
        base_mapper,
        uowtransaction,
        mapper,
        table,
        update,
        *,
        bookkeeping=True,
        use_orm_update_stmt=None,
        enable_check_rowcount=True,
    ):
        """Emit UPDATE statements corresponding to value lists collected
        by _collect_update_commands()."""
    
        needs_version_id = (
            mapper.version_id_col is not None
            and mapper.version_id_col in mapper._cols_by_table[table]
        )
    
        execution_options = {"compiled_cache": base_mapper._compiled_cache}
    
        def update_stmt(existing_stmt=None):
            clauses = BooleanClauseList._construct_raw(operators.and_)
    
            for col in mapper._pks_by_table[table]:
                clauses._append_inplace(
                    col == sql.bindparam(col._label, type_=col.type)
                )
    
            if needs_version_id:
                clauses._append_inplace(
                    mapper.version_id_col
                    == sql.bindparam(
                        mapper.version_id_col._label,
                        type_=mapper.version_id_col.type,
                    )
                )
    
            if existing_stmt is not None:
                stmt = existing_stmt.where(clauses)
            else:
                stmt = table.update().where(clauses)
            return stmt
    
        if use_orm_update_stmt is not None:
            cached_stmt = update_stmt(use_orm_update_stmt)
    
        else:
            cached_stmt = base_mapper._memo(("update", table), update_stmt)
    
        for (
            (connection, paramkeys, hasvalue, has_all_defaults, has_all_pks),
            records,
        ) in groupby(
            update,
            lambda rec: (
                rec[4],  # connection
                set(rec[2]),  # set of parameter keys
                bool(rec[5]),  # whether or not we have "value" parameters
                rec[6],  # has_all_defaults
                rec[7],  # has all pks
            ),
        ):
            rows = 0
            records = list(records)
    
            statement = cached_stmt
    
            if use_orm_update_stmt is not None:
                statement = statement._annotate(
                    {
                        "_emit_update_table": table,
                        "_emit_update_mapper": mapper,
                    }
                )
    
            return_defaults = False
    
            if not has_all_pks:
                statement = statement.return_defaults(*mapper._pks_by_table[table])
                return_defaults = True
    
            if (
                bookkeeping
                and not has_all_defaults
                and mapper.base_mapper.eager_defaults is True
                # change as of #8889 - if RETURNING is not going to be used anyway,
                # (applies to MySQL, MariaDB which lack UPDATE RETURNING) ensure
                # we can do an executemany UPDATE which is more efficient
                and table.implicit_returning
                and connection.dialect.update_returning
            ):
                statement = statement.return_defaults(
                    *mapper._server_onupdate_default_cols[table]
                )
                return_defaults = True
    
            if mapper._version_id_has_server_side_value:
                statement = statement.return_defaults(mapper.version_id_col)
                return_defaults = True
    
            assert_singlerow = connection.dialect.supports_sane_rowcount
    
            assert_multirow = (
                assert_singlerow
                and connection.dialect.supports_sane_multi_rowcount
            )
    
            # change as of #8889 - if RETURNING is not going to be used anyway,
            # (applies to MySQL, MariaDB which lack UPDATE RETURNING) ensure
            # we can do an executemany UPDATE which is more efficient
            allow_executemany = not return_defaults and not needs_version_id
    
            if hasvalue:
                for (
                    state,
                    state_dict,
                    params,
                    mapper,
                    connection,
                    value_params,
                    has_all_defaults,
                    has_all_pks,
                ) in records:
                    c = connection.execute(
                        statement.values(value_params),
                        params,
                        execution_options=execution_options,
                    )
                    if bookkeeping:
                        _postfetch(
                            mapper,
                            uowtransaction,
                            table,
                            state,
                            state_dict,
                            c,
                            c.context.compiled_parameters[0],
                            value_params,
                            True,
                            c.returned_defaults,
                        )
                    rows += c.rowcount
                    check_rowcount = enable_check_rowcount and assert_singlerow
            else:
                if not allow_executemany:
                    check_rowcount = enable_check_rowcount and assert_singlerow
                    for (
                        state,
                        state_dict,
                        params,
                        mapper,
                        connection,
                        value_params,
                        has_all_defaults,
                        has_all_pks,
                    ) in records:
                        c = connection.execute(
                            statement, params, execution_options=execution_options
                        )
    
                        # TODO: why with bookkeeping=False?
                        if bookkeeping:
                            _postfetch(
                                mapper,
                                uowtransaction,
                                table,
                                state,
                                state_dict,
                                c,
                                c.context.compiled_parameters[0],
                                value_params,
                                True,
                                c.returned_defaults,
                            )
                        rows += c.rowcount
                else:
                    multiparams = [rec[2] for rec in records]
    
                    check_rowcount = enable_check_rowcount and (
                        assert_multirow
                        or (assert_singlerow and len(multiparams) == 1)
                    )
    
                    c = connection.execute(
                        statement, multiparams, execution_options=execution_options
                    )
    
                    rows += c.rowcount
    
                    for (
                        state,
                        state_dict,
                        params,
                        mapper,
                        connection,
                        value_params,
                        has_all_defaults,
                        has_all_pks,
                    ) in records:
                        if bookkeeping:
                            _postfetch(
                                mapper,
                                uowtransaction,
                                table,
                                state,
                                state_dict,
                                c,
                                c.context.compiled_parameters[0],
                                value_params,
                                True,
                                (
                                    c.returned_defaults
                                    if not c.context.executemany
                                    else None
                                ),
                            )
    
            if check_rowcount:
                if rows != len(records):
>                   raise orm_exc.StaleDataError(
                        "UPDATE statement on table '%s' expected to "
                        "update %d row(s); %d were matched."
                        % (table.description, len(records), rows)
                    )
E                   sqlalchemy.orm.exc.StaleDataError: UPDATE statement on table 'development_profiles' expected to update 1 row(s); 0 were matched.

.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/persistence.py:948: StaleDataError
___ TestSkillAssessmentAuthorization.test_update_skill_assessment_authorized ___

self = <tests.test_development_profile_authorization.TestSkillAssessmentAuthorization object at 0x105919670>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x108233460>
sample_assessment = UUID('69afea36-4090-4221-a97b-8e19705a5d7d')
test_educator_id = UUID('aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')

    @pytest.mark.asyncio
    async def test_update_skill_assessment_authorized(
        self,
        db_session: AsyncSession,
        sample_assessment: UUID,
        test_educator_id: UUID,
    ):
        """Test that update_skill_assessment succeeds for the owner."""
        service = DevelopmentProfileService(db_session)
    
        request = SkillAssessmentUpdateRequest(
            status=SkillStatusSchema.CAN,
            evidence="Updated evidence",
        )
    
>       assessment = await service.update_skill_assessment(
            assessment_id=sample_assessment,
            request=request,
            user_id=test_educator_id,  # Authorized educator
        )

tests/test_development_profile_authorization.py:620: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.services.development_profile_service.DevelopmentProfileService object at 0x108233280>
assessment_id = UUID('69afea36-4090-4221-a97b-8e19705a5d7d')
request = SkillAssessmentUpdateRequest(status=<SkillStatus.CAN: 'can'>, evidence='Updated evidence', assessed_by_id=None)
user_id = UUID('aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')

    async def update_skill_assessment(
        self,
        assessment_id: UUID,
        request: SkillAssessmentUpdateRequest,
        user_id: UUID,
    ) -> Optional[SkillAssessmentResponse]:
        """Update an existing skill assessment.
    
        Args:
            assessment_id: Unique identifier of the assessment.
            request: Update request with partial data.
            user_id: ID of the user updating the assessment.
    
        Returns:
            Updated assessment if found, None otherwise.
    
        Raises:
            UnauthorizedAccessError: When the user doesn't have access.
        """
        query = select(SkillAssessment).where(
            cast(SkillAssessment.id, String) == str(assessment_id)
        ).options(selectinload(SkillAssessment.profile))
        result = await self.db.execute(query)
        assessment = result.scalar_one_or_none()
    
        if assessment is None:
            return None
    
        # Verify user has access to the parent profile
        if not self._user_has_profile_access(assessment.profile, user_id):
>           raise UnauthorizedAccessError(
                "User does not have permission to update this skill assessment"
            )
E           app.services.development_profile_service.UnauthorizedAccessError: User does not have permission to update this skill assessment

app/services/development_profile_service.py:457: UnauthorizedAccessError
_______ TestObservationAuthorization.test_update_observation_authorized ________

self = <tests.test_development_profile_authorization.TestObservationAuthorization object at 0x1056b2d60>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x107c0b1c0>
sample_observation = UUID('212d1eb5-4297-4fed-b88b-c1b497e3b399')
test_educator_id = UUID('aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')

    @pytest.mark.asyncio
    async def test_update_observation_authorized(
        self,
        db_session: AsyncSession,
        sample_observation: UUID,
        test_educator_id: UUID,
    ):
        """Test that update_observation succeeds for the owner."""
        service = DevelopmentProfileService(db_session)
    
        request = ObservationUpdateRequest(
            behavior_description="Updated description",
            is_milestone=True,
        )
    
>       observation = await service.update_observation(
            observation_id=sample_observation,
            request=request,
            user_id=test_educator_id,  # Authorized educator
        )

tests/test_development_profile_authorization.py:709: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.services.development_profile_service.DevelopmentProfileService object at 0x107c0beb0>
observation_id = UUID('212d1eb5-4297-4fed-b88b-c1b497e3b399')
request = ObservationUpdateRequest(behavior_description='Updated description', context=None, is_milestone=True, is_concern=None, attachments=None)
user_id = UUID('aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')

    async def update_observation(
        self,
        observation_id: UUID,
        request: ObservationUpdateRequest,
        user_id: UUID,
    ) -> Optional[ObservationResponse]:
        """Update an existing observation.
    
        Args:
            observation_id: Unique identifier of the observation.
            request: Update request with partial data.
            user_id: ID of the user updating the observation.
    
        Returns:
            Updated observation if found, None otherwise.
    
        Raises:
            UnauthorizedAccessError: When the user doesn't have access.
        """
        query = select(Observation).where(
            cast(Observation.id, String) == str(observation_id)
        ).options(selectinload(Observation.profile))
        result = await self.db.execute(query)
        observation = result.scalar_one_or_none()
    
        if observation is None:
            return None
    
        # Verify user has access to the parent profile
        if not self._user_has_profile_access(observation.profile, user_id):
>           raise UnauthorizedAccessError(
                "User does not have permission to update this observation"
            )
E           app.services.development_profile_service.UnauthorizedAccessError: User does not have permission to update this observation

app/services/development_profile_service.py:672: UnauthorizedAccessError
___ TestMonthlySnapshotAuthorization.test_update_monthly_snapshot_authorized ___

self = <tests.test_development_profile_authorization.TestMonthlySnapshotAuthorization object at 0x104f0a7c0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10821c790>
sample_snapshot = UUID('e4d7a611-6f8a-4939-9a48-9f7b0d544d9f')
test_educator_id = UUID('aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')

    @pytest.mark.asyncio
    async def test_update_monthly_snapshot_authorized(
        self,
        db_session: AsyncSession,
        sample_snapshot: UUID,
        test_educator_id: UUID,
    ):
        """Test that update_monthly_snapshot succeeds for the owner."""
        service = DevelopmentProfileService(db_session)
    
        request = MonthlySnapshotUpdateRequest(
            overall_progress=OverallProgress.EXCELLING,
            recommendations="Updated recommendations",
        )
    
>       snapshot = await service.update_monthly_snapshot(
            snapshot_id=sample_snapshot,
            request=request,
            user_id=test_educator_id,  # Authorized educator
        )

tests/test_development_profile_authorization.py:799: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.services.development_profile_service.DevelopmentProfileService object at 0x10821c4f0>
snapshot_id = UUID('e4d7a611-6f8a-4939-9a48-9f7b0d544d9f')
request = MonthlySnapshotUpdateRequest(overall_progress=<OverallProgress.EXCELLING: 'excelling'>, recommendations='Updated recommendations', strengths=None, growth_areas=None, is_parent_shared=None)
user_id = UUID('aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')

    async def update_monthly_snapshot(
        self,
        snapshot_id: UUID,
        request: MonthlySnapshotUpdateRequest,
        user_id: UUID,
    ) -> Optional[MonthlySnapshotResponse]:
        """Update an existing monthly snapshot.
    
        Args:
            snapshot_id: Unique identifier of the snapshot.
            request: Update request with partial data.
            user_id: ID of the user updating the snapshot.
    
        Returns:
            Updated snapshot if found, None otherwise.
    
        Raises:
            UnauthorizedAccessError: When the user doesn't have access.
        """
        query = select(MonthlySnapshot).where(
            cast(MonthlySnapshot.id, String) == str(snapshot_id)
        ).options(selectinload(MonthlySnapshot.profile))
        result = await self.db.execute(query)
        snapshot = result.scalar_one_or_none()
    
        if snapshot is None:
            return None
    
        # Verify user has access to the parent profile
        if not self._user_has_profile_access(snapshot.profile, user_id):
>           raise UnauthorizedAccessError(
                "User does not have permission to update this monthly snapshot"
            )
E           app.services.development_profile_service.UnauthorizedAccessError: User does not have permission to update this monthly snapshot

app/services/development_profile_service.py:909: UnauthorizedAccessError
___ TestGrowthTrajectoryAuthorization.test_get_growth_trajectory_authorized ____

self = <tests.test_development_profile_authorization.TestGrowthTrajectoryAuthorization object at 0x1056bd6d0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1082b7af0>
sample_profile = UUID('6bdb091c-a9e0-420d-bfef-b26aaf67c7af')
sample_snapshot = UUID('5ad1d8c9-dde3-4725-a671-f7bb537edd49')
test_educator_id = UUID('aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa')

    @pytest.mark.asyncio
    async def test_get_growth_trajectory_authorized(
        self,
        db_session: AsyncSession,
        sample_profile: UUID,
        sample_snapshot: UUID,
        test_educator_id: UUID,
    ):
        """Test that get_growth_trajectory succeeds for the owner."""
        service = DevelopmentProfileService(db_session)
    
>       trajectory = await service.get_growth_trajectory(
            profile_id=sample_profile,
            user_id=test_educator_id,  # Authorized educator
        )

tests/test_development_profile_authorization.py:844: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/development_profile_service.py:1178: in get_growth_trajectory
    profile_response = await self.get_profile_by_id(profile_id, user_id, include_relations=False)
app/services/development_profile_service.py:174: in get_profile_by_id
    return self._profile_to_response(profile)
app/services/development_profile_service.py:1336: in _profile_to_response
    for a in (profile.skill_assessments or [])
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/attributes.py:569: in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/attributes.py:1096: in get
    value = self._fire_loader_callables(state, key, passive)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/attributes.py:1131: in _fire_loader_callables
    return self.callable_(state, passive)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/strategies.py:978: in _load_for_state
    return self._emit_lazyload(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/strategies.py:1141: in _emit_lazyload
    result = session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2366: in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:159: in execute
    _cursor: AsyncIODBAPICursor = self.await_(self._connection.cursor())  # type: ignore[arg-type] # noqa: E501
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

awaitable = <aiosqlite.context.Result object at 0x10843c500>

    def await_only(awaitable: Awaitable[_T]) -> _T:
        """Awaits an async function in a sync method.
    
        The sync method must be inside a :func:`greenlet_spawn` context.
        :func:`await_only` calls cannot be nested.
    
        :param awaitable: The coroutine to call.
    
        """
        # this is called in the context greenlet while running fn
        current = getcurrent()
        if not getattr(current, "__sqlalchemy_greenlet_provider__", False):
            _safe_cancel_awaitable(awaitable)
    
>           raise exc.MissingGreenlet(
                "greenlet_spawn has not been called; can't call await_only() "
                "here. Was IO attempted in an unexpected place?"
            )
E           sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)

.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:123: MissingGreenlet
___________________________ test_get_template_by_id ____________________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x107cd3580>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')

    @pytest.mark.asyncio
    async def test_get_template_by_id(db_session: AsyncSession, test_user_id: UUID):
        """Test retrieving a template by ID."""
        service = DocumentService(db_session)
    
        # Create template first
        template_data = DocumentTemplateCreate(
            name="Test Template",
            type="permission",
            template_content="<html>Test</html>",
            created_by=test_user_id,
        )
        created = await service.create_template(template_data)
    
        # Retrieve it
        retrieved = await service.get_template_by_id(created.id)
    
>       assert retrieved is not None
E       assert None is not None

tests/test_document_service.py:85: AssertionError
________________________ test_list_templates_pagination ________________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x108057790>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')

    @pytest.mark.asyncio
    async def test_list_templates_pagination(db_session: AsyncSession, test_user_id: UUID):
        """Test listing templates with pagination."""
        service = DocumentService(db_session)
    
        # Create 5 templates
        for i in range(5):
            template_data = DocumentTemplateCreate(
                name=f"Template {i}",
                type="enrollment",
                template_content=f"<html>Template {i}</html>",
                created_by=test_user_id,
            )
            await service.create_template(template_data)
    
        # Test first page
        first_page = await service.list_templates(skip=0, limit=2)
        assert len(first_page) == 2
    
        # Test second page
        second_page = await service.list_templates(skip=2, limit=2)
        assert len(second_page) == 2
    
        # Ensure different templates
>       assert first_page[0].id != second_page[0].id
E       AttributeError: 'list' object has no attribute 'id'

tests/test_document_service.py:124: AttributeError
___________________ test_update_template_increments_version ____________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x108795d60>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')

    @pytest.mark.asyncio
    async def test_update_template_increments_version(
        db_session: AsyncSession, test_user_id: UUID
    ):
        """Test that updating template increments version number."""
        service = DocumentService(db_session)
    
        # Create template (version 1)
        template_data = DocumentTemplateCreate(
            name="Original Template",
            type="medical",
            template_content="<html>v1</html>",
            created_by=test_user_id,
        )
        template = await service.create_template(template_data)
        assert template.version == 1
    
        # Update template
        update_data = DocumentTemplateUpdate(
            template_content="<html>v2 updated</html>"
        )
        updated = await service.update_template(template.id, update_data)
    
>       assert updated is not None
E       assert None is not None

tests/test_document_service.py:150: AssertionError
_____________________________ test_delete_template _____________________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1083c2970>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')

    @pytest.mark.asyncio
    async def test_delete_template(db_session: AsyncSession, test_user_id: UUID):
        """Test soft deleting a template (sets is_active=False)."""
        service = DocumentService(db_session)
    
        template_data = DocumentTemplateCreate(
            name="To Delete",
            type="financial",
            template_content="<html>Delete me</html>",
            created_by=test_user_id,
        )
        template = await service.create_template(template_data)
        assert template.is_active is True
    
        # Delete (soft delete)
        result = await service.delete_template(template.id)
>       assert result is True
E       assert False is True

tests/test_document_service.py:171: AssertionError
______________________ test_create_document_from_template ______________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10848da90>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')

    @pytest.mark.asyncio
    async def test_create_document_from_template(
        db_session: AsyncSession, test_user_id: UUID
    ):
        """Test creating document from template."""
        service = DocumentService(db_session)
    
        # Create template first
        template_data = DocumentTemplateCreate(
            name="Enrollment Template",
            type="enrollment",
            template_content="<html>{{childName}}</html>",
            required_fields=["childName"],
            created_by=test_user_id,
        )
        template = await service.create_template(template_data)
    
        # Create document from template
        document_data = DocumentCreate(
            type="enrollment",
            title="Child Enrollment",
            content_url="https://example.com/child-enrollment.pdf",
            created_by=test_user_id,
        )
    
>       document = await service.create_document_from_template(
            template_id=template.id,
            document_data=document_data,
            user_id=test_user_id,
        )
E       TypeError: create_document_from_template() got an unexpected keyword argument 'document_data'

tests/test_document_service.py:230: TypeError
___________________________ test_get_document_by_id ____________________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10891f250>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')

    @pytest.mark.asyncio
    async def test_get_document_by_id(db_session: AsyncSession, test_user_id: UUID):
        """Test retrieving a document by ID."""
        service = DocumentService(db_session)
    
        # Create document
        document_data = DocumentCreate(
            type="permission",
            title="Permission Slip",
            content_url="https://example.com/permission.pdf",
            created_by=test_user_id,
        )
        created = await service.create_document(document_data)
    
        # Retrieve it
>       retrieved = await service.get_document_by_id(created.id)
E       TypeError: get_document_by_id() missing 1 required positional argument: 'user_id'

tests/test_document_service.py:257: TypeError
_______________________ test_list_documents_with_filters _______________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x108243c40>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')

    @pytest.mark.asyncio
    async def test_list_documents_with_filters(
        db_session: AsyncSession, test_user_id: UUID
    ):
        """Test listing documents with status filter."""
        service = DocumentService(db_session)
    
        # Create documents with different statuses
        for status in ["draft", "pending", "signed"]:
            document_data = DocumentCreate(
                type="enrollment",
                title=f"Document {status}",
                content_url=f"https://example.com/{status}.pdf",
                created_by=test_user_id,
            )
            doc = await service.create_document(document_data)
    
            # Update status for non-draft documents
            if status != "draft":
                update_data = DocumentUpdate(status=status)
                await service.update_document(doc.id, update_data, test_user_id)
    
        # Filter by status
        draft_docs = await service.list_documents(status=DocumentStatus.DRAFT)
        assert len(draft_docs) >= 1
>       assert all(doc.status == DocumentStatus.DRAFT for doc in draft_docs)

tests/test_document_service.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

.0 = <tuple_iterator object at 0x1050e9250>

>   assert all(doc.status == DocumentStatus.DRAFT for doc in draft_docs)
E   AttributeError: 'list' object has no attribute 'status'

tests/test_document_service.py:289: AttributeError
________________ test_create_signature_updates_document_status _________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x107483790>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')

    @pytest.mark.asyncio
    async def test_create_signature_updates_document_status(
        db_session: AsyncSession, test_user_id: UUID
    ):
        """Test that creating signature updates document to SIGNED status."""
        service = DocumentService(db_session)
    
        # Create document (PENDING status)
        document_data = DocumentCreate(
            type="financial",
            title="Financial Agreement",
            content_url="https://example.com/agreement.pdf",
            created_by=test_user_id,
        )
        document = await service.create_document(document_data)
    
        # Update to PENDING first
        update_data = DocumentUpdate(status="pending")
        await service.update_document(document.id, update_data, test_user_id)
    
        # Create signature
        signature_data = SignatureCreate(
            document_id=document.id,
            signer_id=test_user_id,
            signature_image_url="https://example.com/signatures/sig123.png",
            ip_address="192.168.1.100",
            device_info="Mozilla/5.0 (iPhone)",
        )
    
>       signature = await service.create_signature(signature_data, test_user_id)
E       TypeError: create_signature() takes 2 positional arguments but 3 were given

tests/test_document_service.py:349: TypeError
_______________________ test_get_signatures_for_document _______________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x107c54850>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')

    @pytest.mark.asyncio
    async def test_get_signatures_for_document(
        db_session: AsyncSession, test_user_id: UUID
    ):
        """Test retrieving all signatures for a document."""
        service = DocumentService(db_session)
    
        # Create document
        document_data = DocumentCreate(
            type="permission",
            title="Multi-Signature Doc",
            content_url="https://example.com/multi.pdf",
            created_by=test_user_id,
        )
        document = await service.create_document(document_data)
    
        # Update to PENDING
        update_data = DocumentUpdate(status="pending")
        await service.update_document(document.id, update_data, test_user_id)
    
        # Create 2 signatures
        for i in range(2):
            signature_data = SignatureCreate(
                document_id=document.id,
                signer_id=uuid4(),
                signature_image_url=f"https://example.com/sig{i}.png",
                ip_address=f"192.168.1.{100+i}",
            )
>           await service.create_signature(signature_data, test_user_id)
E           TypeError: create_signature() takes 2 positional arguments but 3 were given

tests/test_document_service.py:388: TypeError
_________________________ test_send_signature_request __________________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1076d04c0>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')

    @pytest.mark.asyncio
    async def test_send_signature_request(db_session: AsyncSession, test_user_id: UUID):
        """Test sending a signature request."""
        service = DocumentService(db_session)
    
        # Create document (DRAFT)
        document_data = DocumentCreate(
            type="enrollment",
            title="Enrollment Form",
            content_url="https://example.com/enrollment.pdf",
            created_by=test_user_id,
        )
        document = await service.create_document(document_data)
    
        # Send signature request
        signer_id = uuid4()
        expires_at = datetime.now(timezone.utc) + timedelta(days=7)
    
        request_data = SignatureRequestCreate(
            document_id=document.id,
            requester_id=test_user_id,
            signer_id=signer_id,
            expires_at=expires_at,
            message="Please sign this enrollment form",
        )
    
>       sig_request = await service.send_signature_request(
            request_data, test_user_id, "127.0.0.1", "Test Agent"
        )
E       TypeError: send_signature_request() takes 3 positional arguments but 5 were given

tests/test_document_service.py:427: TypeError
___________________________ test_mark_request_viewed ___________________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10868caf0>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')

    @pytest.mark.asyncio
    async def test_mark_request_viewed(db_session: AsyncSession, test_user_id: UUID):
        """Test marking signature request as viewed."""
        service = DocumentService(db_session)
    
        # Create document and signature request
        document_data = DocumentCreate(
            type="permission",
            title="Permission Form",
            content_url="https://example.com/permission.pdf",
            created_by=test_user_id,
        )
        document = await service.create_document(document_data)
    
        signer_id = uuid4()
        request_data = SignatureRequestCreate(
            document_id=document.id,
            requester_id=test_user_id,
            signer_id=signer_id,
        )
    
>       sig_request = await service.send_signature_request(
            request_data, test_user_id, "127.0.0.1", "Test Agent"
        )
E       TypeError: send_signature_request() takes 3 positional arguments but 5 were given

tests/test_document_service.py:462: TypeError
_____________________ test_complete_signature_request_flow _____________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1079d08e0>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')

    @pytest.mark.asyncio
    async def test_complete_signature_request_flow(
        db_session: AsyncSession, test_user_id: UUID
    ):
        """Test complete signature request workflow."""
        service = DocumentService(db_session)
    
        # 1. Create document
        document_data = DocumentCreate(
            type="financial",
            title="Financial Form",
            content_url="https://example.com/financial.pdf",
            created_by=test_user_id,
        )
        document = await service.create_document(document_data)
    
        # 2. Send signature request
        signer_id = uuid4()
        request_data = SignatureRequestCreate(
            document_id=document.id,
            requester_id=test_user_id,
            signer_id=signer_id,
        )
>       sig_request = await service.send_signature_request(
            request_data, test_user_id, "127.0.0.1", "Test Agent"
        )
E       TypeError: send_signature_request() takes 3 positional arguments but 5 were given

tests/test_document_service.py:501: TypeError
_________________________ test_get_signature_dashboard _________________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1080c94c0>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')

    @pytest.mark.asyncio
    async def test_get_signature_dashboard(db_session: AsyncSession, test_user_id: UUID):
        """Test dashboard statistics calculation."""
        service = DocumentService(db_session)
    
        # Create mix of documents with different statuses
        statuses = ["draft", "pending", "signed", "expired"]
        for status in statuses:
            document_data = DocumentCreate(
                type="enrollment",
                title=f"Document {status}",
                content_url=f"https://example.com/{status}.pdf",
                created_by=test_user_id,
            )
            doc = await service.create_document(document_data)
    
            if status != "draft":
                update_data = DocumentUpdate(status=status)
                await service.update_document(doc.id, update_data, test_user_id)
    
        # Get dashboard
        dashboard = await service.get_signature_dashboard(user_id=test_user_id)
    
        assert dashboard is not None
>       assert dashboard.total_documents >= 4
E       AttributeError: 'dict' object has no attribute 'total_documents'

tests/test_document_service.py:560: AttributeError
____________________________ test_create_audit_log _____________________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1072a83d0>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')

    @pytest.mark.asyncio
    async def test_create_audit_log(db_session: AsyncSession, test_user_id: UUID):
        """Test creating audit log entry."""
        service = DocumentService(db_session)
    
        # Create document first
        document_data = DocumentCreate(
            type="medical",
            title="Medical Form",
            content_url="https://example.com/medical.pdf",
            created_by=test_user_id,
        )
        document = await service.create_document(document_data)
    
        # Create audit log manually
        from app.schemas.document import DocumentAuditLogCreate
    
        audit_data = DocumentAuditLogCreate(
            event_type=DocumentAuditEventType.DOCUMENT_CREATED,
            document_id=document.id,
            user_id=test_user_id,
            event_data={"documentType": "medical", "title": "Medical Form"},
            ip_address="192.168.1.100",
            user_agent="Mozilla/5.0",
        )
    
>       audit_log = await service.create_audit_log(audit_data)
E       TypeError: create_audit_log() missing 2 required positional arguments: 'document_id' and 'user_id'

tests/test_document_service.py:597: TypeError
_______________________ test_signature_creates_audit_log _______________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10901b3a0>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')

    @pytest.mark.asyncio
    async def test_signature_creates_audit_log(
        db_session: AsyncSession, test_user_id: UUID
    ):
        """Test that signature creation generates audit log."""
        service = DocumentService(db_session)
    
        # Create document
        document_data = DocumentCreate(
            type="enrollment",
            title="Test Document",
            content_url="https://example.com/test.pdf",
            created_by=test_user_id,
        )
        document = await service.create_document(document_data)
    
        # Update to PENDING
        update_data = DocumentUpdate(status="pending")
        await service.update_document(document.id, update_data, test_user_id)
    
        # Create signature
        signature_data = SignatureCreate(
            document_id=document.id,
            signer_id=test_user_id,
            signature_image_url="https://example.com/sig.png",
            ip_address="127.0.0.1",
            device_info="Test Device",
        )
>       await service.create_signature(signature_data, test_user_id)
E       TypeError: create_signature() takes 2 positional arguments but 3 were given

tests/test_document_service.py:660: TypeError
_____________ TestOpenAIProvider.test_is_available_without_api_key _____________

self = <tests.test_llm_providers.TestOpenAIProvider object at 0x105bee8b0>

    def test_is_available_without_api_key(self) -> None:
        """Test that provider is not available without API key.
    
        Verifies that is_available() returns False when no
        API key is configured.
        """
>       provider = OpenAIProvider(api_key=None)

tests/test_llm_providers.py:175: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/openai_provider.py:67: in __init__
    self.api_key = api_key or settings.openai_api_key
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'openai_api_key'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'openai_api_key'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
___________ TestOpenAIProvider.test_is_available_with_empty_api_key ____________

self = <tests.test_llm_providers.TestOpenAIProvider object at 0x1061c22e0>

    def test_is_available_with_empty_api_key(self) -> None:
        """Test that provider is not available with empty API key.
    
        Verifies that is_available() returns False when an
        empty string is provided as the API key.
        """
>       provider = OpenAIProvider(api_key="")

tests/test_llm_providers.py:184: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/openai_provider.py:67: in __init__
    self.api_key = api_key or settings.openai_api_key
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'openai_api_key'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'openai_api_key'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
__________________ TestOpenAIProvider.test_get_default_config __________________

self = <tests.test_llm_providers.TestOpenAIProvider object at 0x1061c2640>
openai_provider = <OpenAIProvider name=openai>

    def test_get_default_config(self, openai_provider: OpenAIProvider) -> None:
        """Test that provider returns valid default configuration.
    
        Verifies that get_default_config() returns an LLMConfig
        with sensible defaults for OpenAI models.
        """
>       config = openai_provider.get_default_config()

tests/test_llm_providers.py:208: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/openai_provider.py:250: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
___________________ TestOpenAIProvider.test_complete_success ___________________

self = <tests.test_llm_providers.TestOpenAIProvider object at 0x1061c2fd0>
openai_provider = <OpenAIProvider name=openai>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]
mock_openai_response = {'choices': [{'finish_reason': 'stop', 'index': 0, 'message': {'content': "Hello! I'm doing well, thank you for asking.", 'role': 'assistant'}}], 'created': 1677652288, 'id': 'chatcmpl-123456789', 'model': 'gpt-4o', ...}

    @pytest.mark.asyncio
    async def test_complete_success(
        self,
        openai_provider: OpenAIProvider,
        sample_messages: list[LLMMessage],
        mock_openai_response: dict[str, Any],
    ) -> None:
        """Test successful completion with mocked API response.
    
        Verifies that the provider correctly processes a successful
        API response and returns a properly formatted LLMResponse.
        """
        mock_response = MagicMock(spec=httpx.Response)
        mock_response.status_code = 200
        mock_response.json.return_value = mock_openai_response
    
        with patch("httpx.AsyncClient") as mock_client_class:
            mock_client = AsyncMock()
            mock_client.post.return_value = mock_response
            mock_client.__aenter__.return_value = mock_client
            mock_client.__aexit__.return_value = None
            mock_client_class.return_value = mock_client
    
>           response = await openai_provider.complete(sample_messages)

tests/test_llm_providers.py:274: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/openai_provider.py:105: in complete
    effective_config = self._merge_config(config)
app/llm/providers/openai_provider.py:275: in _merge_config
    default = self.get_default_config()
app/llm/providers/openai_provider.py:250: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
_____________ TestOpenAIProvider.test_complete_with_custom_config ______________

self = <tests.test_llm_providers.TestOpenAIProvider object at 0x1061c2940>
openai_provider = <OpenAIProvider name=openai>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]
sample_config = LLMConfig(model='gpt-4o', temperature=0.7, max_tokens=1000, top_p=1.0, frequency_penalty=0.0, presence_penalty=0.0, stop=None, timeout=30)
mock_openai_response = {'choices': [{'finish_reason': 'stop', 'index': 0, 'message': {'content': "Hello! I'm doing well, thank you for asking.", 'role': 'assistant'}}], 'created': 1677652288, 'id': 'chatcmpl-123456789', 'model': 'gpt-4o', ...}

    @pytest.mark.asyncio
    async def test_complete_with_custom_config(
        self,
        openai_provider: OpenAIProvider,
        sample_messages: list[LLMMessage],
        sample_config: LLMConfig,
        mock_openai_response: dict[str, Any],
    ) -> None:
        """Test completion with custom configuration.
    
        Verifies that custom configuration is properly applied
        to the API request.
        """
        mock_response = MagicMock(spec=httpx.Response)
        mock_response.status_code = 200
        mock_response.json.return_value = mock_openai_response
    
        with patch("httpx.AsyncClient") as mock_client_class:
            mock_client = AsyncMock()
            mock_client.post.return_value = mock_response
            mock_client.__aenter__.return_value = mock_client
            mock_client.__aexit__.return_value = None
            mock_client_class.return_value = mock_client
    
>           response = await openai_provider.complete(sample_messages, sample_config)

tests/test_llm_providers.py:310: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/openai_provider.py:105: in complete
    effective_config = self._merge_config(config)
app/llm/providers/openai_provider.py:275: in _merge_config
    default = self.get_default_config()
app/llm/providers/openai_provider.py:250: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
____________ TestOpenAIProvider.test_complete_authentication_error _____________

self = <tests.test_llm_providers.TestOpenAIProvider object at 0x106320610>
openai_provider = <OpenAIProvider name=openai>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_authentication_error(
        self,
        openai_provider: OpenAIProvider,
        sample_messages: list[LLMMessage],
    ) -> None:
        """Test that 401 response raises LLMAuthenticationError.
    
        Verifies that authentication failures from the API
        are properly translated to LLMAuthenticationError.
        """
        mock_response = MagicMock(spec=httpx.Response)
        mock_response.status_code = 401
        mock_response.text = "Invalid API key"
    
        with patch("httpx.AsyncClient") as mock_client_class:
            mock_client = AsyncMock()
            mock_client.post.return_value = mock_response
            mock_client.__aenter__.return_value = mock_client
            mock_client.__aexit__.return_value = None
            mock_client_class.return_value = mock_client
    
            with pytest.raises(LLMAuthenticationError) as exc_info:
>               await openai_provider.complete(sample_messages)

tests/test_llm_providers.py:342: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/openai_provider.py:105: in complete
    effective_config = self._merge_config(config)
app/llm/providers/openai_provider.py:275: in _merge_config
    default = self.get_default_config()
app/llm/providers/openai_provider.py:250: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
______________ TestOpenAIProvider.test_complete_rate_limit_error _______________

self = <tests.test_llm_providers.TestOpenAIProvider object at 0x1061c2370>
openai_provider = <OpenAIProvider name=openai>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_rate_limit_error(
        self,
        openai_provider: OpenAIProvider,
        sample_messages: list[LLMMessage],
    ) -> None:
        """Test that 429 response raises LLMRateLimitError.
    
        Verifies that rate limit errors from the API
        are properly translated to LLMRateLimitError.
        """
        mock_response = MagicMock(spec=httpx.Response)
        mock_response.status_code = 429
        mock_response.text = "Rate limit exceeded"
    
        with patch("httpx.AsyncClient") as mock_client_class:
            mock_client = AsyncMock()
            mock_client.post.return_value = mock_response
            mock_client.__aenter__.return_value = mock_client
            mock_client.__aexit__.return_value = None
            mock_client_class.return_value = mock_client
    
            with pytest.raises(LLMRateLimitError) as exc_info:
>               await openai_provider.complete(sample_messages)

tests/test_llm_providers.py:369: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/openai_provider.py:105: in complete
    effective_config = self._merge_config(config)
app/llm/providers/openai_provider.py:275: in _merge_config
    default = self.get_default_config()
app/llm/providers/openai_provider.py:250: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
_____________ TestOpenAIProvider.test_complete_provider_error_400 ______________

self = <tests.test_llm_providers.TestOpenAIProvider object at 0x105beefd0>
openai_provider = <OpenAIProvider name=openai>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_provider_error_400(
        self,
        openai_provider: OpenAIProvider,
        sample_messages: list[LLMMessage],
    ) -> None:
        """Test that 400 response raises LLMProviderError.
    
        Verifies that bad request errors from the API
        are properly translated to LLMProviderError.
        """
        mock_response = MagicMock(spec=httpx.Response)
        mock_response.status_code = 400
        mock_response.text = "Bad request: invalid model"
    
        with patch("httpx.AsyncClient") as mock_client_class:
            mock_client = AsyncMock()
            mock_client.post.return_value = mock_response
            mock_client.__aenter__.return_value = mock_client
            mock_client.__aexit__.return_value = None
            mock_client_class.return_value = mock_client
    
            with pytest.raises(LLMProviderError) as exc_info:
>               await openai_provider.complete(sample_messages)

tests/test_llm_providers.py:396: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/openai_provider.py:105: in complete
    effective_config = self._merge_config(config)
app/llm/providers/openai_provider.py:275: in _merge_config
    default = self.get_default_config()
app/llm/providers/openai_provider.py:250: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
_____________ TestOpenAIProvider.test_complete_provider_error_500 ______________

self = <tests.test_llm_providers.TestOpenAIProvider object at 0x105beedf0>
openai_provider = <OpenAIProvider name=openai>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_provider_error_500(
        self,
        openai_provider: OpenAIProvider,
        sample_messages: list[LLMMessage],
    ) -> None:
        """Test that 500 response raises LLMProviderError.
    
        Verifies that server errors from the API
        are properly translated to LLMProviderError.
        """
        mock_response = MagicMock(spec=httpx.Response)
        mock_response.status_code = 500
        mock_response.text = "Internal server error"
    
        with patch("httpx.AsyncClient") as mock_client_class:
            mock_client = AsyncMock()
            mock_client.post.return_value = mock_response
            mock_client.__aenter__.return_value = mock_client
            mock_client.__aexit__.return_value = None
            mock_client_class.return_value = mock_client
    
            with pytest.raises(LLMProviderError) as exc_info:
>               await openai_provider.complete(sample_messages)

tests/test_llm_providers.py:423: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/openai_provider.py:105: in complete
    effective_config = self._merge_config(config)
app/llm/providers/openai_provider.py:275: in _merge_config
    default = self.get_default_config()
app/llm/providers/openai_provider.py:250: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
________________ TestOpenAIProvider.test_complete_timeout_error ________________

self = <tests.test_llm_providers.TestOpenAIProvider object at 0x1063202b0>
openai_provider = <OpenAIProvider name=openai>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_timeout_error(
        self,
        openai_provider: OpenAIProvider,
        sample_messages: list[LLMMessage],
    ) -> None:
        """Test that timeout raises LLMTimeoutError.
    
        Verifies that request timeouts are properly
        translated to LLMTimeoutError.
        """
        with patch("httpx.AsyncClient") as mock_client_class:
            mock_client = AsyncMock()
            mock_client.post.side_effect = httpx.TimeoutException("Request timed out")
            mock_client.__aenter__.return_value = mock_client
            mock_client.__aexit__.return_value = None
            mock_client_class.return_value = mock_client
    
            with pytest.raises(LLMTimeoutError) as exc_info:
>               await openai_provider.complete(sample_messages)

tests/test_llm_providers.py:446: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/openai_provider.py:105: in complete
    effective_config = self._merge_config(config)
app/llm/providers/openai_provider.py:275: in _merge_config
    default = self.get_default_config()
app/llm/providers/openai_provider.py:250: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
_________________ TestOpenAIProvider.test_complete_http_error __________________

self = <tests.test_llm_providers.TestOpenAIProvider object at 0x106320670>
openai_provider = <OpenAIProvider name=openai>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_http_error(
        self,
        openai_provider: OpenAIProvider,
        sample_messages: list[LLMMessage],
    ) -> None:
        """Test that HTTP errors raise LLMProviderError.
    
        Verifies that generic HTTP errors are properly
        translated to LLMProviderError.
        """
        with patch("httpx.AsyncClient") as mock_client_class:
            mock_client = AsyncMock()
            mock_client.post.side_effect = httpx.HTTPError("Connection failed")
            mock_client.__aenter__.return_value = mock_client
            mock_client.__aexit__.return_value = None
            mock_client_class.return_value = mock_client
    
            with pytest.raises(LLMProviderError) as exc_info:
>               await openai_provider.complete(sample_messages)

tests/test_llm_providers.py:469: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/openai_provider.py:105: in complete
    effective_config = self._merge_config(config)
app/llm/providers/openai_provider.py:275: in _merge_config
    default = self.get_default_config()
app/llm/providers/openai_provider.py:250: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
_______________ TestOpenAIProvider.test_complete_without_api_key _______________

self = <tests.test_llm_providers.TestOpenAIProvider object at 0x106320070>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_without_api_key(
        self,
        sample_messages: list[LLMMessage],
    ) -> None:
        """Test that completion without API key raises LLMAuthenticationError.
    
        Verifies that attempting to complete without a configured
        API key raises LLMAuthenticationError immediately.
        """
>       provider = OpenAIProvider(api_key=None)

tests/test_llm_providers.py:483: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/openai_provider.py:67: in __init__
    self.api_key = api_key or settings.openai_api_key
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'openai_api_key'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'openai_api_key'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
___________ TestOpenAIProvider.test_complete_no_choices_in_response ____________

self = <tests.test_llm_providers.TestOpenAIProvider object at 0x105bee880>
openai_provider = <OpenAIProvider name=openai>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_no_choices_in_response(
        self,
        openai_provider: OpenAIProvider,
        sample_messages: list[LLMMessage],
    ) -> None:
        """Test that response without choices raises LLMProviderError.
    
        Verifies that an API response missing the choices array
        is properly handled with LLMProviderError.
        """
        mock_response = MagicMock(spec=httpx.Response)
        mock_response.status_code = 200
        mock_response.json.return_value = {
            "id": "chatcmpl-123",
            "model": "gpt-4o",
            "choices": [],  # Empty choices
            "usage": {"prompt_tokens": 10, "completion_tokens": 0, "total_tokens": 10},
        }
    
        with patch("httpx.AsyncClient") as mock_client_class:
            mock_client = AsyncMock()
            mock_client.post.return_value = mock_response
            mock_client.__aenter__.return_value = mock_client
            mock_client.__aexit__.return_value = None
            mock_client_class.return_value = mock_client
    
            with pytest.raises(LLMProviderError) as exc_info:
>               await openai_provider.complete(sample_messages)

tests/test_llm_providers.py:533: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/openai_provider.py:105: in complete
    effective_config = self._merge_config(config)
app/llm/providers/openai_provider.py:275: in _merge_config
    default = self.get_default_config()
app/llm/providers/openai_provider.py:250: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
___________ TestAnthropicProvider.test_is_available_without_api_key ____________

self = <tests.test_llm_providers.TestAnthropicProvider object at 0x106344d90>

    def test_is_available_without_api_key(self) -> None:
        """Test that provider is not available without API key.
    
        Verifies that is_available() returns False when no
        API key is configured.
        """
>       provider = AnthropicProvider(api_key=None)

tests/test_llm_providers.py:581: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/anthropic_provider.py:70: in __init__
    self.api_key = api_key or settings.anthropic_api_key
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'anthropic_api_key'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'anthropic_api_key'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
__________ TestAnthropicProvider.test_is_available_with_empty_api_key __________

self = <tests.test_llm_providers.TestAnthropicProvider object at 0x106344d30>

    def test_is_available_with_empty_api_key(self) -> None:
        """Test that provider is not available with empty API key.
    
        Verifies that is_available() returns False when an
        empty string is provided as the API key.
        """
>       provider = AnthropicProvider(api_key="")

tests/test_llm_providers.py:590: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/anthropic_provider.py:70: in __init__
    self.api_key = api_key or settings.anthropic_api_key
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'anthropic_api_key'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'anthropic_api_key'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
________________ TestAnthropicProvider.test_get_default_config _________________

self = <tests.test_llm_providers.TestAnthropicProvider object at 0x106344eb0>
anthropic_provider = <AnthropicProvider name=anthropic>

    def test_get_default_config(self, anthropic_provider: AnthropicProvider) -> None:
        """Test that provider returns valid default configuration.
    
        Verifies that get_default_config() returns an LLMConfig
        with sensible defaults for Claude models.
        """
>       config = anthropic_provider.get_default_config()

tests/test_llm_providers.py:613: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/anthropic_provider.py:257: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
_________________ TestAnthropicProvider.test_complete_success __________________

self = <tests.test_llm_providers.TestAnthropicProvider object at 0x105b3c460>
anthropic_provider = <AnthropicProvider name=anthropic>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]
mock_anthropic_response = {'content': [{'text': "Hello! I'm doing well, thank you for asking.", 'type': 'text'}], 'id': 'msg_01XFDUDYJgAACzvnptvVoYEL', 'model': 'claude-3-5-sonnet-20241022', 'role': 'assistant', ...}

    @pytest.mark.asyncio
    async def test_complete_success(
        self,
        anthropic_provider: AnthropicProvider,
        sample_messages: list[LLMMessage],
        mock_anthropic_response: dict[str, Any],
    ) -> None:
        """Test successful completion with mocked API response.
    
        Verifies that the provider correctly processes a successful
        API response and returns a properly formatted LLMResponse.
        """
        mock_response = MagicMock(spec=httpx.Response)
        mock_response.status_code = 200
        mock_response.json.return_value = mock_anthropic_response
    
        with patch("httpx.AsyncClient") as mock_client_class:
            mock_client = AsyncMock()
            mock_client.post.return_value = mock_response
            mock_client.__aenter__.return_value = mock_client
            mock_client.__aexit__.return_value = None
            mock_client_class.return_value = mock_client
    
>           response = await anthropic_provider.complete(sample_messages)

tests/test_llm_providers.py:667: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/anthropic_provider.py:108: in complete
    effective_config = self._merge_config(config)
app/llm/providers/anthropic_provider.py:283: in _merge_config
    default = self.get_default_config()
app/llm/providers/anthropic_provider.py:257: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
___________ TestAnthropicProvider.test_complete_with_system_message ____________

self = <tests.test_llm_providers.TestAnthropicProvider object at 0x106344820>
anthropic_provider = <AnthropicProvider name=anthropic>
mock_anthropic_response = {'content': [{'text': "Hello! I'm doing well, thank you for asking.", 'type': 'text'}], 'id': 'msg_01XFDUDYJgAACzvnptvVoYEL', 'model': 'claude-3-5-sonnet-20241022', 'role': 'assistant', ...}

    @pytest.mark.asyncio
    async def test_complete_with_system_message(
        self,
        anthropic_provider: AnthropicProvider,
        mock_anthropic_response: dict[str, Any],
    ) -> None:
        """Test completion with system message is handled correctly.
    
        Verifies that system messages are properly separated and
        sent as the 'system' parameter in Anthropic API calls.
        """
        messages = [
            LLMMessage(role=LLMRole.SYSTEM, content="You are a helpful assistant."),
            LLMMessage(role=LLMRole.USER, content="Hello!"),
        ]
    
        mock_response = MagicMock(spec=httpx.Response)
        mock_response.status_code = 200
        mock_response.json.return_value = mock_anthropic_response
    
        with patch("httpx.AsyncClient") as mock_client_class:
            mock_client = AsyncMock()
            mock_client.post.return_value = mock_response
            mock_client.__aenter__.return_value = mock_client
            mock_client.__aexit__.return_value = None
            mock_client_class.return_value = mock_client
    
>           await anthropic_provider.complete(messages)

tests/test_llm_providers.py:706: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/anthropic_provider.py:108: in complete
    effective_config = self._merge_config(config)
app/llm/providers/anthropic_provider.py:283: in _merge_config
    default = self.get_default_config()
app/llm/providers/anthropic_provider.py:257: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
___________ TestAnthropicProvider.test_complete_authentication_error ___________

self = <tests.test_llm_providers.TestAnthropicProvider object at 0x1061acfa0>
anthropic_provider = <AnthropicProvider name=anthropic>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_authentication_error(
        self,
        anthropic_provider: AnthropicProvider,
        sample_messages: list[LLMMessage],
    ) -> None:
        """Test that 401 response raises LLMAuthenticationError.
    
        Verifies that authentication failures from the API
        are properly translated to LLMAuthenticationError.
        """
        mock_response = MagicMock(spec=httpx.Response)
        mock_response.status_code = 401
        mock_response.text = "Invalid API key"
    
        with patch("httpx.AsyncClient") as mock_client_class:
            mock_client = AsyncMock()
            mock_client.post.return_value = mock_response
            mock_client.__aenter__.return_value = mock_client
            mock_client.__aexit__.return_value = None
            mock_client_class.return_value = mock_client
    
            with pytest.raises(LLMAuthenticationError) as exc_info:
>               await anthropic_provider.complete(sample_messages)

tests/test_llm_providers.py:740: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/anthropic_provider.py:108: in complete
    effective_config = self._merge_config(config)
app/llm/providers/anthropic_provider.py:283: in _merge_config
    default = self.get_default_config()
app/llm/providers/anthropic_provider.py:257: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
_____________ TestAnthropicProvider.test_complete_rate_limit_error _____________

self = <tests.test_llm_providers.TestAnthropicProvider object at 0x106320400>
anthropic_provider = <AnthropicProvider name=anthropic>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_rate_limit_error(
        self,
        anthropic_provider: AnthropicProvider,
        sample_messages: list[LLMMessage],
    ) -> None:
        """Test that 429 response raises LLMRateLimitError.
    
        Verifies that rate limit errors from the API
        are properly translated to LLMRateLimitError.
        """
        mock_response = MagicMock(spec=httpx.Response)
        mock_response.status_code = 429
        mock_response.text = "Rate limit exceeded"
    
        with patch("httpx.AsyncClient") as mock_client_class:
            mock_client = AsyncMock()
            mock_client.post.return_value = mock_response
            mock_client.__aenter__.return_value = mock_client
            mock_client.__aexit__.return_value = None
            mock_client_class.return_value = mock_client
    
            with pytest.raises(LLMRateLimitError) as exc_info:
>               await anthropic_provider.complete(sample_messages)

tests/test_llm_providers.py:767: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/anthropic_provider.py:108: in complete
    effective_config = self._merge_config(config)
app/llm/providers/anthropic_provider.py:283: in _merge_config
    default = self.get_default_config()
app/llm/providers/anthropic_provider.py:257: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
____________ TestAnthropicProvider.test_complete_provider_error_400 ____________

self = <tests.test_llm_providers.TestAnthropicProvider object at 0x106320280>
anthropic_provider = <AnthropicProvider name=anthropic>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_provider_error_400(
        self,
        anthropic_provider: AnthropicProvider,
        sample_messages: list[LLMMessage],
    ) -> None:
        """Test that 400 response raises LLMProviderError.
    
        Verifies that bad request errors from the API
        are properly translated to LLMProviderError.
        """
        mock_response = MagicMock(spec=httpx.Response)
        mock_response.status_code = 400
        mock_response.text = "Bad request: invalid model"
    
        with patch("httpx.AsyncClient") as mock_client_class:
            mock_client = AsyncMock()
            mock_client.post.return_value = mock_response
            mock_client.__aenter__.return_value = mock_client
            mock_client.__aexit__.return_value = None
            mock_client_class.return_value = mock_client
    
            with pytest.raises(LLMProviderError) as exc_info:
>               await anthropic_provider.complete(sample_messages)

tests/test_llm_providers.py:794: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/anthropic_provider.py:108: in complete
    effective_config = self._merge_config(config)
app/llm/providers/anthropic_provider.py:283: in _merge_config
    default = self.get_default_config()
app/llm/providers/anthropic_provider.py:257: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
____________ TestAnthropicProvider.test_complete_provider_error_500 ____________

self = <tests.test_llm_providers.TestAnthropicProvider object at 0x1061c2880>
anthropic_provider = <AnthropicProvider name=anthropic>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_provider_error_500(
        self,
        anthropic_provider: AnthropicProvider,
        sample_messages: list[LLMMessage],
    ) -> None:
        """Test that 500 response raises LLMProviderError.
    
        Verifies that server errors from the API
        are properly translated to LLMProviderError.
        """
        mock_response = MagicMock(spec=httpx.Response)
        mock_response.status_code = 500
        mock_response.text = "Internal server error"
    
        with patch("httpx.AsyncClient") as mock_client_class:
            mock_client = AsyncMock()
            mock_client.post.return_value = mock_response
            mock_client.__aenter__.return_value = mock_client
            mock_client.__aexit__.return_value = None
            mock_client_class.return_value = mock_client
    
            with pytest.raises(LLMProviderError) as exc_info:
>               await anthropic_provider.complete(sample_messages)

tests/test_llm_providers.py:821: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/anthropic_provider.py:108: in complete
    effective_config = self._merge_config(config)
app/llm/providers/anthropic_provider.py:283: in _merge_config
    default = self.get_default_config()
app/llm/providers/anthropic_provider.py:257: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
______________ TestAnthropicProvider.test_complete_timeout_error _______________

self = <tests.test_llm_providers.TestAnthropicProvider object at 0x1061c2520>
anthropic_provider = <AnthropicProvider name=anthropic>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_timeout_error(
        self,
        anthropic_provider: AnthropicProvider,
        sample_messages: list[LLMMessage],
    ) -> None:
        """Test that timeout raises LLMTimeoutError.
    
        Verifies that request timeouts are properly
        translated to LLMTimeoutError.
        """
        with patch("httpx.AsyncClient") as mock_client_class:
            mock_client = AsyncMock()
            mock_client.post.side_effect = httpx.TimeoutException("Request timed out")
            mock_client.__aenter__.return_value = mock_client
            mock_client.__aexit__.return_value = None
            mock_client_class.return_value = mock_client
    
            with pytest.raises(LLMTimeoutError) as exc_info:
>               await anthropic_provider.complete(sample_messages)

tests/test_llm_providers.py:844: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/anthropic_provider.py:108: in complete
    effective_config = self._merge_config(config)
app/llm/providers/anthropic_provider.py:283: in _merge_config
    default = self.get_default_config()
app/llm/providers/anthropic_provider.py:257: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
________________ TestAnthropicProvider.test_complete_http_error ________________

self = <tests.test_llm_providers.TestAnthropicProvider object at 0x1061ae6d0>
anthropic_provider = <AnthropicProvider name=anthropic>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_http_error(
        self,
        anthropic_provider: AnthropicProvider,
        sample_messages: list[LLMMessage],
    ) -> None:
        """Test that HTTP errors raise LLMProviderError.
    
        Verifies that generic HTTP errors are properly
        translated to LLMProviderError.
        """
        with patch("httpx.AsyncClient") as mock_client_class:
            mock_client = AsyncMock()
            mock_client.post.side_effect = httpx.HTTPError("Connection failed")
            mock_client.__aenter__.return_value = mock_client
            mock_client.__aexit__.return_value = None
            mock_client_class.return_value = mock_client
    
            with pytest.raises(LLMProviderError) as exc_info:
>               await anthropic_provider.complete(sample_messages)

tests/test_llm_providers.py:867: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/anthropic_provider.py:108: in complete
    effective_config = self._merge_config(config)
app/llm/providers/anthropic_provider.py:283: in _merge_config
    default = self.get_default_config()
app/llm/providers/anthropic_provider.py:257: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
_____________ TestAnthropicProvider.test_complete_without_api_key ______________

self = <tests.test_llm_providers.TestAnthropicProvider object at 0x1061d8280>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_without_api_key(
        self,
        sample_messages: list[LLMMessage],
    ) -> None:
        """Test that completion without API key raises LLMAuthenticationError.
    
        Verifies that attempting to complete without a configured
        API key raises LLMAuthenticationError immediately.
        """
>       provider = AnthropicProvider(api_key=None)

tests/test_llm_providers.py:881: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/anthropic_provider.py:70: in __init__
    self.api_key = api_key or settings.anthropic_api_key
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'anthropic_api_key'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'anthropic_api_key'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
__________ TestAnthropicProvider.test_complete_no_content_in_response __________

self = <tests.test_llm_providers.TestAnthropicProvider object at 0x1055cb100>
anthropic_provider = <AnthropicProvider name=anthropic>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_no_content_in_response(
        self,
        anthropic_provider: AnthropicProvider,
        sample_messages: list[LLMMessage],
    ) -> None:
        """Test that response without content raises LLMProviderError.
    
        Verifies that an API response missing the content array
        is properly handled with LLMProviderError.
        """
        mock_response = MagicMock(spec=httpx.Response)
        mock_response.status_code = 200
        mock_response.json.return_value = {
            "id": "msg_123",
            "model": "claude-3-5-sonnet-20241022",
            "content": [],  # Empty content
            "usage": {"input_tokens": 10, "output_tokens": 0},
        }
    
        with patch("httpx.AsyncClient") as mock_client_class:
            mock_client = AsyncMock()
            mock_client.post.return_value = mock_response
            mock_client.__aenter__.return_value = mock_client
            mock_client.__aexit__.return_value = None
            mock_client_class.return_value = mock_client
    
            with pytest.raises(LLMProviderError) as exc_info:
>               await anthropic_provider.complete(sample_messages)

tests/test_llm_providers.py:931: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/providers/anthropic_provider.py:108: in complete
    effective_config = self._merge_config(config)
app/llm/providers/anthropic_provider.py:283: in _merge_config
    default = self.get_default_config()
app/llm/providers/anthropic_provider.py:257: in get_default_config
    temperature=settings.llm_temperature,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_temperature'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_temperature'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
________________ TestLLMClientCompletion.test_complete_success _________________

self = <tests.test_llm_token_client.TestLLMClientCompletion object at 0x1059dc700>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]
sample_response = LLMResponse(content="Hello! I'm doing well, thank you for asking.", model='gpt-4o', provider='openai', usage=LLMUsage(... finish_reason='stop', created_at=datetime.datetime(2026, 2, 17, 15, 4, 9, 732018), request_id=None, raw_response=None)

    @pytest.mark.asyncio
    async def test_complete_success(
        self, sample_messages: list[LLMMessage], sample_response: LLMResponse
    ) -> None:
        """Test successful completion."""
        mock_provider = MockLLMProvider(
            name="mock", response=sample_response
        )
    
        with patch("app.llm.client.LLMProviderFactory") as mock_factory:
            mock_factory_instance = MagicMock()
            mock_factory_instance.available_providers = ["mock"]
            mock_factory_instance.get_provider.return_value = mock_provider
            mock_factory_instance.get_available_provider.return_value = mock_provider
            mock_factory.return_value = mock_factory_instance
    
            client = LLMClient(enable_caching=False, enable_tracking=False)
>           response = await client.complete(sample_messages)

tests/test_llm_token_client.py:641: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/client.py:271: in complete
    merged_config = self._merge_config(config)
app/llm/client.py:213: in _merge_config
    defaults = self._get_default_config()
app/llm/client.py:198: in _get_default_config
    model=settings.llm_default_model,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_default_model'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_default_model'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
__________ TestLLMClientCompletion.test_complete_no_providers_raises ___________

self = <tests.test_llm_token_client.TestLLMClientCompletion object at 0x1059dcc10>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_no_providers_raises(
        self, sample_messages: list[LLMMessage]
    ) -> None:
        """Test completion with no available providers."""
        with patch("app.llm.client.LLMProviderFactory") as mock_factory:
            mock_factory_instance = MagicMock()
            mock_factory_instance.available_providers = []
            mock_factory_instance.get_provider.side_effect = LLMProviderError("No provider")
            mock_factory_instance.get_available_provider.return_value = None
            mock_factory.return_value = mock_factory_instance
    
            client = LLMClient(enable_caching=False, enable_tracking=False)
    
            with pytest.raises(NoProvidersAvailableError):
>               await client.complete(sample_messages)

tests/test_llm_token_client.py:661: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/client.py:271: in complete
    merged_config = self._merge_config(config)
app/llm/client.py:213: in _merge_config
    defaults = self._get_default_config()
app/llm/client.py:198: in _get_default_config
    model=settings.llm_default_model,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_default_model'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_default_model'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
_____________ TestLLMClientCompletion.test_complete_with_cache_hit _____________

self = <tests.test_llm_token_client.TestLLMClientCompletion object at 0x105a6a730>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]
sample_response = LLMResponse(content="Hello! I'm doing well, thank you for asking.", model='gpt-4o', provider='openai', usage=LLMUsage(... finish_reason='stop', created_at=datetime.datetime(2026, 2, 17, 15, 4, 9, 799191), request_id=None, raw_response=None)

    @pytest.mark.asyncio
    async def test_complete_with_cache_hit(
        self, sample_messages: list[LLMMessage], sample_response: LLMResponse
    ) -> None:
        """Test completion with cache hit."""
        mock_provider = MockLLMProvider(name="mock", response=sample_response)
    
        with patch("app.llm.client.LLMProviderFactory") as mock_factory:
            mock_factory_instance = MagicMock()
            mock_factory_instance.available_providers = ["mock"]
            mock_factory_instance.get_provider.return_value = mock_provider
            mock_factory_instance.get_available_provider.return_value = mock_provider
            mock_factory.return_value = mock_factory_instance
    
            client = LLMClient(enable_caching=True, enable_tracking=False)
    
            # Mock cache hit
            client.cache = MagicMock()
            client.cache.generate_cache_key = MagicMock(return_value="test-key")
            client.cache.get = AsyncMock(return_value=sample_response)
    
>           response = await client.complete(sample_messages)

tests/test_llm_token_client.py:684: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/client.py:271: in complete
    merged_config = self._merge_config(config)
app/llm/client.py:213: in _merge_config
    defaults = self._get_default_config()
app/llm/client.py:198: in _get_default_config
    model=settings.llm_default_model,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_default_model'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_default_model'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
____________ TestLLMClientCompletion.test_complete_with_cache_miss _____________

self = <tests.test_llm_token_client.TestLLMClientCompletion object at 0x105a6a610>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]
sample_response = LLMResponse(content="Hello! I'm doing well, thank you for asking.", model='gpt-4o', provider='openai', usage=LLMUsage(... finish_reason='stop', created_at=datetime.datetime(2026, 2, 17, 15, 4, 9, 831534), request_id=None, raw_response=None)

    @pytest.mark.asyncio
    async def test_complete_with_cache_miss(
        self, sample_messages: list[LLMMessage], sample_response: LLMResponse
    ) -> None:
        """Test completion with cache miss."""
        mock_provider = MockLLMProvider(name="mock", response=sample_response)
    
        with patch("app.llm.client.LLMProviderFactory") as mock_factory:
            mock_factory_instance = MagicMock()
            mock_factory_instance.available_providers = ["mock"]
            mock_factory_instance.get_provider.return_value = mock_provider
            mock_factory_instance.get_available_provider.return_value = mock_provider
            mock_factory.return_value = mock_factory_instance
    
            client = LLMClient(enable_caching=True, enable_tracking=False)
    
            # Mock cache miss
            client.cache = MagicMock()
            client.cache.generate_cache_key = MagicMock(return_value="test-key")
            client.cache.get = AsyncMock(return_value=None)
            client.cache.set = AsyncMock()
    
>           response = await client.complete(sample_messages)

tests/test_llm_token_client.py:712: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/client.py:271: in complete
    merged_config = self._merge_config(config)
app/llm/client.py:213: in _merge_config
    defaults = self._get_default_config()
app/llm/client.py:198: in _get_default_config
    model=settings.llm_default_model,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_default_model'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_default_model'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
_______________ TestLLMClientCompletion.test_complete_with_error _______________

self = <tests.test_llm_token_client.TestLLMClientCompletion object at 0x105a6a6d0>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_with_error(
        self, sample_messages: list[LLMMessage]
    ) -> None:
        """Test completion with provider error."""
        mock_provider = MockLLMProvider(
            name="mock",
            error=LLMError("Test error"),
        )
    
        with patch("app.llm.client.LLMProviderFactory") as mock_factory:
            mock_factory_instance = MagicMock()
            mock_factory_instance.available_providers = ["mock"]
            mock_factory_instance.get_provider.return_value = mock_provider
            mock_factory_instance.get_available_provider.return_value = mock_provider
            mock_factory.return_value = mock_factory_instance
    
            client = LLMClient(
                enable_caching=False,
                enable_tracking=False,
                enable_fallback=False,
            )
    
            with pytest.raises(CompletionFailedError) as exc_info:
>               await client.complete(sample_messages)

tests/test_llm_token_client.py:743: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/client.py:271: in complete
    merged_config = self._merge_config(config)
app/llm/client.py:213: in _merge_config
    defaults = self._get_default_config()
app/llm/client.py:198: in _get_default_config
    model=settings.llm_default_model,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_default_model'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_default_model'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
_____________ TestLLMClientStreaming.test_complete_stream_success ______________

self = <tests.test_llm_token_client.TestLLMClientStreaming object at 0x105a6ae80>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_stream_success(
        self, sample_messages: list[LLMMessage]
    ) -> None:
        """Test successful streaming completion."""
        mock_provider = MockLLMProvider(name="mock")
    
        with patch("app.llm.client.LLMProviderFactory") as mock_factory:
            mock_factory_instance = MagicMock()
            mock_factory_instance.available_providers = ["mock"]
            mock_factory_instance.get_provider.return_value = mock_provider
            mock_factory_instance.get_available_provider.return_value = mock_provider
            mock_factory.return_value = mock_factory_instance
    
            client = LLMClient(enable_caching=False, enable_tracking=False)
    
            chunks = []
>           async for chunk in client.complete_stream(sample_messages):

tests/test_llm_token_client.py:773: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/client.py:419: in complete_stream
    merged_config = self._merge_config(config)
app/llm/client.py:213: in _merge_config
    defaults = self._get_default_config()
app/llm/client.py:198: in _get_default_config
    model=settings.llm_default_model,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_default_model'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_default_model'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
___________ TestLLMClientStreaming.test_complete_stream_no_providers ___________

self = <tests.test_llm_token_client.TestLLMClientStreaming object at 0x105a6ac70>
sample_messages = [LLMMessage(role=<LLMRole.SYSTEM: 'system'>, content='You are a helpful assistant.', name=None), LLMMessage(role=<LLMRole.USER: 'user'>, content='Hello, how are you?', name=None)]

    @pytest.mark.asyncio
    async def test_complete_stream_no_providers(
        self, sample_messages: list[LLMMessage]
    ) -> None:
        """Test streaming with no available providers."""
        with patch("app.llm.client.LLMProviderFactory") as mock_factory:
            mock_factory_instance = MagicMock()
            mock_factory_instance.available_providers = []
            mock_factory_instance.get_provider.side_effect = LLMProviderError("No provider")
            mock_factory_instance.get_available_provider.return_value = None
            mock_factory.return_value = mock_factory_instance
    
            client = LLMClient(enable_caching=False, enable_tracking=False)
    
            with pytest.raises(NoProvidersAvailableError):
>               async for _ in client.complete_stream(sample_messages):

tests/test_llm_token_client.py:795: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/llm/client.py:419: in complete_stream
    merged_config = self._merge_config(config)
app/llm/client.py:213: in _merge_config
    defaults = self._get_default_config()
app/llm/client.py:198: in _get_default_config
    model=settings.llm_default_model,
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Settings(postgres_host='localhost', postgres_port=5432, postgres_db='laya_ai', postgres_user='laya', postgres_password...', db_pool_size=10, db_max_overflow=20, db_pool_timeout=30, db_pool_recycle=3600, db_pool_pre_ping=True, db_echo=False)
item = 'llm_default_model'

    def __getattr__(self, item: str) -> Any:
        private_attributes = object.__getattribute__(self, '__private_attributes__')
        if item in private_attributes:
            attribute = private_attributes[item]
            if hasattr(attribute, '__get__'):
                return attribute.__get__(self, type(self))  # type: ignore
    
            try:
                # Note: self.__pydantic_private__ cannot be None if self.__private_attributes__ has items
                return self.__pydantic_private__[item]  # type: ignore
            except KeyError as exc:
                raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
        else:
            # `__pydantic_extra__` can fail to be set if the model is not yet fully initialized.
            # See `BaseModel.__repr_args__` for more details
            try:
                pydantic_extra = object.__getattribute__(self, '__pydantic_extra__')
            except AttributeError:
                pydantic_extra = None
    
            if pydantic_extra and item in pydantic_extra:
                return pydantic_extra[item]
            else:
                if hasattr(self.__class__, item):
                    return super().__getattribute__(item)  # Raises AttributeError if appropriate
                else:
                    # this is the current error
>                   raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
E                   AttributeError: 'Settings' object has no attribute 'llm_default_model'

.venv_test/lib/python3.9/site-packages/pydantic/main.py:1026: AttributeError
_ TestPositiveMessageRecognition.test_positive_message_has_structural_elements _

self = <tests.test_message_quality.TestPositiveMessageRecognition object at 0x10621f550>
message_quality_service = <app.services.message_quality_service.MessageQualityService object at 0x1083ef550>
positive_message_en = "I wanted to share how much we've enjoyed having Emma in our class this week. I noticed that she sometimes needs extra...s. I'd love to discuss strategies we could try together. Please feel free to reach out so we can talk more about this."

    @pytest.mark.asyncio
    async def test_positive_message_has_structural_elements(
        self,
        message_quality_service: MessageQualityService,
        positive_message_en: str,
    ) -> None:
        """Test that positive messages are recognized for structural elements.
    
        Verifies detection of positive opening, factual basis, and
        solution-oriented closing.
        """
        request = MessageAnalysisRequest(
            message_text=positive_message_en,
            language=Language.EN,
            context=MessageContext.BEHAVIOR_CONCERN,
        )
    
        response = await message_quality_service.analyze_message(request)
    
        # Should have positive structural elements
        assert response.has_positive_opening, (
            "Should detect positive opening in well-structured message"
        )
>       assert response.has_solution_focus, (
            "Should detect solution focus in well-structured message"
        )
E       AssertionError: Should detect solution focus in well-structured message
E       assert False
E        +  where False = MessageAnalysisResponse(id=UUID('00000000-0000-0000-0000-000000000000'), created_at=datetime.datetime(2026, 2, 17, 15, 4, 10, 484670), updated_at=datetime.datetime(2026, 2, 17, 15, 4, 10, 484672), message_text="I wanted to share how much we've enjoyed having Emma in our class this week. I noticed that she sometimes needs extra time transitioning between activities. I'd love to discuss strategies we could try together. Please feel free to reach out so we can talk more about this.", language=<Language.EN: 'en'>, quality_score=100, is_acceptable=True, issues=[QualityIssueDetail(issue_type=<QualityIssue.MISSING_SOLUTION: 'missing_solution'>, severity=<IssueSeverity.LOW: 'low'>, description='Missing solution-oriented closing. Messages should end with actionable next steps or an invitation to collaborate.', original_text='[Entire message]', position_start=0, position_end=272, suggestion='End with a specific suggestion or invitation to discuss')], rewrite_suggestions=[RewriteSuggestion(original_text="I wanted to share how much we've enjoyed having Emma in our class this week. I noticed that she sometimes needs extra time transitioning between activities. I'd love to discuss strategies we could try together. Please feel free to reach out so we can talk more about this.", suggested_text="Thank you for taking the time to read this message about your child.\n\nI wanted to share an observation: i wanted to share how much we've enjoyed having Emma in our class this week. I noticed that she sometimes needs extra time transitioning between activities. I'd love to discuss strategies we could try together. Please feel free to reach out so we can talk more about this.\n\nLet's work together to find the best approach. I'm available to discuss this whenever it's convenient for you.", explanation='This rewrite improves the message using the sandwich method (positive opening, factual observation, collaborative closing). Specific improvements: solution-oriented closing added.', uses_i_language=True, has_sandwich_structure=True, confidence_score=0.85)], has_positive_opening=True, has_factual_basis=True, has_solution_focus=False, analysis_notes="Excellent! This message follows 'Bonne Message' standards well.").has_solution_focus

tests/test_message_quality.py:773: AssertionError
_ TestRewriteSandwichMethodStructure.test_rewrite_handles_empty_message_gracefully _

self = <tests.test_message_quality.TestRewriteSandwichMethodStructure object at 0x1062079a0>
message_quality_service = <app.services.message_quality_service.MessageQualityService object at 0x108486b80>

    @pytest.mark.asyncio
    async def test_rewrite_handles_empty_message_gracefully(
        self,
        message_quality_service: MessageQualityService,
    ) -> None:
        """Test that rewrite handles empty or whitespace-only messages."""
        issues = []
    
>       suggestion = message_quality_service.suggest_rewrite(
            message_text="",
            issues=issues,
            language=Language.EN,
        )

tests/test_message_quality.py:1550: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <app.services.message_quality_service.MessageQualityService object at 0x108486b80>
message_text = '', issues = [], language = <Language.EN: 'en'>
child_name = None

    def suggest_rewrite(
        self,
        message_text: str,
        issues: list[QualityIssueDetail],
        language: Language,
        child_name: Optional[str] = None,
    ) -> RewriteSuggestion:
        """Generate a rewrite suggestion using 'I' language and sandwich method.
    
        Transforms problematic messages into positive, constructive communication
        using two key techniques:
        1. 'I' language transformation - replaces accusatory 'you' statements
           with 'I' observations (e.g., "You never..." becomes "I noticed...")
        2. Sandwich method - structures message with:
           - Positive opening (genuine acknowledgment)
           - Factual concern (specific observation without judgment)
           - Solution-oriented closing (collaborative next steps)
    
        Args:
            message_text: The original message text to rewrite
            issues: List of detected quality issues to address
            language: Language for the rewritten message
            child_name: Optional child's name for personalization
    
        Returns:
            RewriteSuggestion with the improved message and explanation
        """
        if not message_text or not message_text.strip():
            # Return minimal suggestion for empty input
>           return RewriteSuggestion(
                original_text=message_text or "",
                suggested_text="",
                explanation="No message text provided to rewrite.",
                uses_i_language=False,
                has_sandwich_structure=False,
                confidence_score=0.0,
            )
E           pydantic_core._pydantic_core.ValidationError: 2 validation errors for RewriteSuggestion
E           original_text
E             String should have at least 1 character [type=string_too_short, input_value='', input_type=str]
E               For further information visit https://errors.pydantic.dev/2.12/v/string_too_short
E           suggested_text
E             String should have at least 1 character [type=string_too_short, input_value='', input_type=str]
E               For further information visit https://errors.pydantic.dev/2.12/v/string_too_short

app/services/message_quality_service.py:1219: ValidationError
__________ TestBilingualSupport.test_french_suggestion_text_in_french __________

self = <tests.test_message_quality.TestBilingualSupport object at 0x105a1ffd0>
message_quality_service = <app.services.message_quality_service.MessageQualityService object at 0x10817f9a0>
accusatory_message_fr = "Vous n'avez jamais envoy les collations  temps. Vous devez tre plus responsable."

    @pytest.mark.asyncio
    async def test_french_suggestion_text_in_french(
        self,
        message_quality_service: MessageQualityService,
        accusatory_message_fr: str,
    ) -> None:
        """Test that issue suggestions are in French for French messages.
    
        Verifies Quebec compliance by ensuring suggestions are localized.
        """
        request = MessageAnalysisRequest(
            message_text=accusatory_message_fr,
            language=Language.FR,
            context=MessageContext.GENERAL_UPDATE,
        )
    
        response = await message_quality_service.analyze_message(request)
    
        for issue in response.issues:
            # French suggestions should contain French words
            french_indicators = [
                "utilisez", "langage", "vitez", "essayez", "remplacez",
                "formulez", "plutt", "prfrez", "je", "nous"
            ]
>           assert any(
                indicator in issue.suggestion.lower()
                for indicator in french_indicators
            ), f"French suggestion should be in French: {issue.suggestion}"
E           AssertionError: French suggestion should be in French: Commencez par une observation positive sincre sur l'enfant
E           assert False
E            +  where False = any(<generator object TestBilingualSupport.test_french_suggestion_text_in_french.<locals>.<genexpr> at 0x108f83e40>)

tests/test_message_quality.py:2061: AssertionError
________ TestBilingualSupport.test_french_structural_elements_detected _________

self = <tests.test_message_quality.TestBilingualSupport object at 0x1059c3850>
message_quality_service = <app.services.message_quality_service.MessageQualityService object at 0x1083cc220>
positive_message_fr = "Je voulais partager combien nous avons apprci avoir Emma dans notre classe cette semaine. J'ai remarqu qu'elle a p...en discuter des stratgies que nous pourrions essayer ensemble. N'hsitez pas  me contacter pour en parler davantage."

    @pytest.mark.asyncio
    async def test_french_structural_elements_detected(
        self,
        message_quality_service: MessageQualityService,
        positive_message_fr: str,
    ) -> None:
        """Test that structural elements are detected in French messages.
    
        Verifies Quebec compliance by ensuring positive opening and
        solution focus are properly detected in French content.
        """
        request = MessageAnalysisRequest(
            message_text=positive_message_fr,
            language=Language.FR,
            context=MessageContext.BEHAVIOR_CONCERN,
        )
    
        response = await message_quality_service.analyze_message(request)
    
        assert response.has_positive_opening, (
            "Should detect positive opening in French message"
        )
>       assert response.has_solution_focus, (
            "Should detect solution focus in French message"
        )
E       AssertionError: Should detect solution focus in French message
E       assert False
E        +  where False = MessageAnalysisResponse(id=UUID('00000000-0000-0000-0000-000000000000'), created_at=datetime.datetime(2026, 2, 17, 15, 4, 10, 813060), updated_at=datetime.datetime(2026, 2, 17, 15, 4, 10, 813062), message_text="Je voulais partager combien nous avons apprci avoir Emma dans notre classe cette semaine. J'ai remarqu qu'elle a parfois besoin de plus de temps pour les transitions entre les activits. J'aimerais en discuter des stratgies que nous pourrions essayer ensemble. N'hsitez pas  me contacter pour en parler davantage.", language=<Language.FR: 'fr'>, quality_score=100, is_acceptable=True, issues=[QualityIssueDetail(issue_type=<QualityIssue.MISSING_SOLUTION: 'missing_solution'>, severity=<IssueSeverity.LOW: 'low'>, description='Conclusion oriente solution manquante. Les messages doivent se terminer par des prochaines tapes concrtes ou une invitation  collaborer.', original_text='[Message entier]', position_start=0, position_end=319, suggestion='Terminez par une suggestion spcifique ou une invitation  discuter')], rewrite_suggestions=[RewriteSuggestion(original_text="Je voulais partager combien nous avons apprci avoir Emma dans notre classe cette semaine. J'ai remarqu...entre les activits. J'aimerais en discuter des stratgies que nous pourrions essayer ensemble. N'hsitez pas  me contacter pour en parler davantage.", suggested_text="Nous apprcions toujours votre collaboration pour le bien-tre de votre enfant.\n\nJ'aimerais partager une observation : je voulais partager combien nous avons apprci avoir Emma dans notre classe cette semaine. J'ai remarqu qu'elle a parfois besoin de plus de temps pour les transitions entre les activits. J'aimerais en discuter des stratgies que nous pourrions essayer ensemble. N'hsitez pas  me contacter pour en parler davantage.\n\nTravaillons ensemble pour trouver la meilleure approche. Je suis disponible pour en discuter quand cela vous convient.", explanation='Cette rcriture amliore le message en utilisant la mthode sandwich (ouverture positive, observation factuelle, conclusion collaborative). Amliorations spcifiques : une conclusion oriente solution a t ajoute.', uses_i_language=True, has_sandwich_structure=True, confidence_score=0.85)], has_positive_opening=True, has_factual_basis=True, has_solution_focus=False, analysis_notes="Excellent! Ce message suit bien les standards 'Bonne Message'.").has_solution_focus

tests/test_message_quality.py:2126: AssertionError
______ TestErrorHandling.test_empty_message_raises_invalid_message_error _______

self = <tests.test_message_quality.TestErrorHandling object at 0x1062078e0>
message_quality_service = <app.services.message_quality_service.MessageQualityService object at 0x1070a8670>

    @pytest.mark.asyncio
    async def test_empty_message_raises_invalid_message_error(
        self,
        message_quality_service: MessageQualityService,
    ) -> None:
        """Test that empty message text raises InvalidMessageError."""
>       request = MessageAnalysisRequest(
            message_text="",
            language=Language.EN,
            context=MessageContext.GENERAL_UPDATE,
        )
E       pydantic_core._pydantic_core.ValidationError: 1 validation error for MessageAnalysisRequest
E       message_text
E         String should have at least 1 character [type=string_too_short, input_value='', input_type=str]
E           For further information visit https://errors.pydantic.dev/2.12/v/string_too_short

tests/test_message_quality.py:2175: ValidationError
_________ TestErrorHandling.test_whitespace_only_message_raises_error __________

self = <tests.test_message_quality.TestErrorHandling object at 0x1059de970>
message_quality_service = <app.services.message_quality_service.MessageQualityService object at 0x1084d73d0>

    @pytest.mark.asyncio
    async def test_whitespace_only_message_raises_error(
        self,
        message_quality_service: MessageQualityService,
    ) -> None:
        """Test that whitespace-only message raises InvalidMessageError."""
>       request = MessageAnalysisRequest(
            message_text="   \t\n  ",
            language=Language.EN,
            context=MessageContext.GENERAL_UPDATE,
        )
E       pydantic_core._pydantic_core.ValidationError: 1 validation error for MessageAnalysisRequest
E       message_text
E         String should have at least 1 character [type=string_too_short, input_value='   \t\n  ', input_type=str]
E           For further information visit https://errors.pydantic.dev/2.12/v/string_too_short

tests/test_message_quality.py:2194: ValidationError
____ TestMessagingServiceThreads.test_create_thread_returns_valid_response _____

self = <sqlalchemy.engine.base.Connection object at 0x108bbdcd0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x108bbde20>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108bbd4c0>
parameters = [('71767b6b40d44936822131540d827c0b', 'Daily Activity Update', 'daily_log', '87654321432143214321cba987654321', '12345...ent User"}, {"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator", "display_name": null}]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_messaging.TestMessagingServiceThreads object at 0x1055b1df0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x108bbdd00>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')
sample_thread_create_request = ThreadCreate(subject='Daily Activity Update', thread_type=<ThreadType.DAILY_LOG: 'daily_log'>, child_id=UUID('87654321...ser_type=<SenderType.PARENT: 'parent'>, display_name='Parent User')], initial_message="Hello! Here is today's update.")

    @pytest.mark.asyncio
    async def test_create_thread_returns_valid_response(
        self,
        db_session: AsyncSession,
        test_user_id: UUID,
        sample_thread_create_request: ThreadCreate,
    ):
        """Test that create_thread returns a valid ThreadResponse."""
        await ensure_messaging_tables(db_session)
        service = MessagingService(db_session)
    
>       response = await service.create_thread(
            request=sample_thread_create_request,
            user_id=test_user_id,
            user_type=SenderType.EDUCATOR,
        )

tests/test_messaging.py:506: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/messaging_service.py:181: in create_thread
    await self.db.commit()
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:4467: in _flush
    transaction.rollback(_capture_exception=True)
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: INSERT INTO message_threads (id, subject, thread_type, child_id, created_by, participants, is_active, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
E               [parameters: ('71767b6b40d44936822131540d827c0b', 'Daily Activity Update', 'daily_log', '87654321432143214321cba987654321', '12345678123412341234123456789abc', '[{"user_id": "22222222-2222-2222-2222-222222222222", "user_type": "parent", "display_name": "Parent User"}, {"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator", "display_name": null}]', 1, '2026-02-17 15:04:16.531287', '2026-02-17 15:04:16.531292')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
__ TestMessagingServiceThreads.test_create_thread_adds_creator_as_participant __

self = <sqlalchemy.engine.base.Connection object at 0x10a83ab80>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x10a83a760>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108bbd4c0>
parameters = [('cad8f53e47aa4ea4bd0600d323edb132', 'Test Subject', 'daily_log', '87654321432143214321cba987654321', '12345678123412...6789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator", "display_name": null}]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_messaging.TestMessagingServiceThreads object at 0x1055b1a60>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10a83a460>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')
test_child_id = UUID('87654321-4321-4321-4321-cba987654321')

    @pytest.mark.asyncio
    async def test_create_thread_adds_creator_as_participant(
        self,
        db_session: AsyncSession,
        test_user_id: UUID,
        test_child_id: UUID,
    ):
        """Test that creator is automatically added as participant if not in list."""
        await ensure_messaging_tables(db_session)
        service = MessagingService(db_session)
    
        request = ThreadCreate(
            subject="Test Subject",
            thread_type=ThreadType.DAILY_LOG,
            child_id=test_child_id,
            participants=[],  # Empty participants list
        )
    
>       response = await service.create_thread(
            request=request,
            user_id=test_user_id,
            user_type=SenderType.EDUCATOR,
        )

tests/test_messaging.py:537: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/messaging_service.py:181: in create_thread
    await self.db.commit()
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:1000: in commit
    await greenlet_spawn(self.sync_session.commit)
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:203: in greenlet_spawn
    result = context.switch(value)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2030: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:1311: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:1286: in _prepare_impl
    self.session.flush()
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:4331: in flush
    self._flush(objects)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:4467: in _flush
    transaction.rollback(_capture_exception=True)
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:4427: in _flush
    flush_context.execute()
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/persistence.py:1233: in _emit_insert_statements
    result = connection.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: INSERT INTO message_threads (id, subject, thread_type, child_id, created_by, participants, is_active, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)]
E               [parameters: ('cad8f53e47aa4ea4bd0600d323edb132', 'Test Subject', 'daily_log', '87654321432143214321cba987654321', '12345678123412341234123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator", "display_name": null}]', 1, '2026-02-17 15:04:17.095249', '2026-02-17 15:04:17.095252')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
______ TestMessagingServiceThreads.test_get_thread_not_found_raises_error ______

self = <sqlalchemy.engine.base.Connection object at 0x109127d60>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109127af0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x109127d00>
parameters = [('40297996-6d6f-4b19-8e61-cc27e49ba9a3',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_messaging.TestMessagingServiceThreads object at 0x1055b1910>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10913f850>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')

    @pytest.mark.asyncio
    async def test_get_thread_not_found_raises_error(
        self,
        db_session: AsyncSession,
        test_user_id: UUID,
    ):
        """Test that get_thread raises ThreadNotFoundError for non-existent thread."""
        await ensure_messaging_tables(db_session)
        service = MessagingService(db_session)
        non_existent_id = uuid4()
    
        with pytest.raises(ThreadNotFoundError):
>           await service.get_thread(
                thread_id=non_existent_id,
                user_id=test_user_id,
                include_messages=False,
            )

tests/test_messaging.py:599: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/messaging_service.py:226: in get_thread
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: SELECT message_threads.id, message_threads.subject, message_threads.thread_type, message_threads.child_id, message_threads.created_by, message_threads.participants, message_threads.is_active, message_threads.created_at, message_threads.updated_at 
E               FROM message_threads 
E               WHERE CAST(message_threads.id AS VARCHAR) = ?]
E               [parameters: ('40297996-6d6f-4b19-8e61-cc27e49ba9a3',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
__ TestMessagingServiceThreads.test_list_threads_excludes_archived_by_default __

self = <sqlalchemy.engine.base.Connection object at 0x10a9aadc0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x10a9aabb0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10a88dbe0>
parameters = [('a51bce2f-eed1-4e6a-a563-7ed560c7b523', 'Archived Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '123...8-1234-1234-1234-123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator"}]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_messaging.TestMessagingServiceThreads object at 0x106488670>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10a9aa250>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')
test_child_id = UUID('87654321-4321-4321-4321-cba987654321')

    @pytest.mark.asyncio
    async def test_list_threads_excludes_archived_by_default(
        self,
        db_session: AsyncSession,
        test_user_id: UUID,
        test_child_id: UUID,
    ):
        """Test that archived threads are excluded by default."""
        await ensure_messaging_tables(db_session)
    
        # Create an archived thread
>       await create_thread_in_db(
            db_session,
            subject="Archived Thread",
            created_by=test_user_id,
            child_id=test_child_id,
            is_active=False,
            participants=[{"user_id": str(test_user_id), "user_type": "educator"}],
        )

tests/test_messaging.py:674: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:239: in create_thread_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: 
E                           INSERT INTO message_threads (
E                               id, subject, thread_type, child_id, created_by,
E                               participants, is_active, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('a51bce2f-eed1-4e6a-a563-7ed560c7b523', 'Archived Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '12345678-1234-1234-1234-123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator"}]', 0, '2026-02-17T15:04:20.524644+00:00', '2026-02-17T15:04:20.524644+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ TestMessagingServiceMessages.test_send_message_to_archived_thread_raises_error _

self = <sqlalchemy.engine.base.Connection object at 0x109f28fa0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109f28d30>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10a88dbe0>
parameters = [('4023aa33-16af-49b1-bcdb-c3662d19d7fc', 'Archived Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '123...8-1234-1234-1234-123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator"}]', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: message_threads

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_messaging.TestMessagingServiceMessages object at 0x106488220>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109f31ac0>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')
test_child_id = UUID('87654321-4321-4321-4321-cba987654321')

    @pytest.mark.asyncio
    async def test_send_message_to_archived_thread_raises_error(
        self,
        db_session: AsyncSession,
        test_user_id: UUID,
        test_child_id: UUID,
    ):
        """Test that sending message to archived thread raises InvalidThreadError."""
        await ensure_messaging_tables(db_session)
    
        # Create an archived thread
>       archived_thread = await create_thread_in_db(
            db_session,
            subject="Archived Thread",
            created_by=test_user_id,
            child_id=test_child_id,
            is_active=False,
            participants=[{"user_id": str(test_user_id), "user_type": "educator"}],
        )

tests/test_messaging.py:773: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:239: in create_thread_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: message_threads
E               [SQL: 
E                           INSERT INTO message_threads (
E                               id, subject, thread_type, child_id, created_by,
E                               participants, is_active, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('4023aa33-16af-49b1-bcdb-c3662d19d7fc', 'Archived Thread', 'daily_log', '87654321-4321-4321-4321-cba987654321', '12345678-1234-1234-1234-123456789abc', '[{"user_id": "12345678-1234-1234-1234-123456789abc", "user_type": "educator"}]', 0, '2026-02-17T15:04:21.996450+00:00', '2026-02-17T15:04:21.996450+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_____ TestMessagingServiceMessages.test_get_message_not_found_raises_error _____

self = <sqlalchemy.engine.base.Connection object at 0x108a6b970>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x108a6b520>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108a6b850>
parameters = [('90d94912-3885-4f96-9feb-dd1690e93f35',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: messages

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_messaging.TestMessagingServiceMessages object at 0x105593be0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1092d1b80>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')

    @pytest.mark.asyncio
    async def test_get_message_not_found_raises_error(
        self,
        db_session: AsyncSession,
        test_user_id: UUID,
    ):
        """Test that get_message raises MessageNotFoundError for non-existent message."""
        await ensure_messaging_tables(db_session)
        service = MessagingService(db_session)
        non_existent_id = uuid4()
    
        with pytest.raises(MessageNotFoundError):
>           await service.get_message(
                message_id=non_existent_id,
                user_id=test_user_id,
            )

tests/test_messaging.py:826: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/messaging_service.py:502: in get_message
    result = await self.db.execute(message_query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: messages
E               [SQL: SELECT messages.id, messages.thread_id, messages.sender_id, messages.sender_type, messages.content, messages.content_type, messages.is_read, messages.created_at, messages.updated_at 
E               FROM messages 
E               WHERE CAST(messages.id AS VARCHAR) = ?]
E               [parameters: ('90d94912-3885-4f96-9feb-dd1690e93f35',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ TestMessagingServiceNotifications.test_create_notification_preference_success _

self = <sqlalchemy.engine.base.Connection object at 0x108b35370>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x108b35220>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108b355e0>
parameters = [('22222222-2222-2222-2222-222222222222', 'daily_log', 'push')]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: notification_preferences

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_messaging.TestMessagingServiceNotifications object at 0x1055932b0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x108b35610>
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest.mark.asyncio
    async def test_create_notification_preference_success(
        self,
        db_session: AsyncSession,
        test_parent_id_messaging: UUID,
    ):
        """Test creating a new notification preference."""
        await ensure_messaging_tables(db_session)
        service = MessagingService(db_session)
    
        request = NotificationPreferenceRequest(
            parent_id=test_parent_id_messaging,
            notification_type=NotificationType.DAILY_LOG,
            channel=NotificationChannelType.PUSH,
            is_enabled=True,
            frequency=NotificationFrequency.IMMEDIATE,
        )
    
>       response = await service.create_notification_preference(request)

tests/test_messaging.py:1045: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/messaging_service.py:1486: in create_notification_preference
    existing_result = await self.db.execute(existing_query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: notification_preferences
E               [SQL: SELECT notification_preferences.id, notification_preferences.parent_id, notification_preferences.notification_type, notification_preferences.channel, notification_preferences.is_enabled, notification_preferences.quiet_hours_start, notification_preferences.quiet_hours_end, notification_preferences.created_at, notification_preferences.updated_at 
E               FROM notification_preferences 
E               WHERE CAST(notification_preferences.parent_id AS VARCHAR) = ? AND notification_preferences.notification_type = ? AND notification_preferences.channel = ?]
E               [parameters: ('22222222-2222-2222-2222-222222222222', 'daily_log', 'push')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ TestMessagingServiceNotifications.test_get_notification_preferences_returns_all _

self = <sqlalchemy.engine.base.Connection object at 0x109fa3ee0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109fa3df0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x1095b0400>
parameters = [('d84c6435-dfd0-44ac-85f2-412491df06b7', '22222222-2222-2222-2222-222222222222', 'message', 'email', 1, 'immediate', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: notification_preferences

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_messaging.TestMessagingServiceNotifications object at 0x1055a2e80>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109f9e220>
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest.mark.asyncio
    async def test_get_notification_preferences_returns_all(
        self,
        db_session: AsyncSession,
        test_parent_id_messaging: UUID,
    ):
        """Test getting all notification preferences for a parent."""
        await ensure_messaging_tables(db_session)
    
        # Create multiple preferences
>       await create_notification_preference_in_db(
            db_session, test_parent_id_messaging, "message", "email"
        )

tests/test_messaging.py:1085: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:344: in create_notification_preference_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: notification_preferences
E               [SQL: 
E                           INSERT INTO notification_preferences (
E                               id, parent_id, notification_type, channel, is_enabled,
E                               frequency, quiet_hours_start, quiet_hours_end, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('d84c6435-dfd0-44ac-85f2-412491df06b7', '22222222-2222-2222-2222-222222222222', 'message', 'email', 1, 'immediate', None, None, '2026-02-17T15:04:27.013391+00:00', '2026-02-17T15:04:27.013391+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ TestMessagingServiceNotifications.test_get_notification_preference_not_found_raises_error _

self = <sqlalchemy.engine.base.Connection object at 0x10aae1e50>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x10aae1b50>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108b355e0>
parameters = [('605704ce-5089-4a0b-af05-52b88db31016', 'message', 'email')]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: notification_preferences

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_messaging.TestMessagingServiceNotifications object at 0x1055a2c70>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10aaeb7c0>

    @pytest.mark.asyncio
    async def test_get_notification_preference_not_found_raises_error(
        self,
        db_session: AsyncSession,
    ):
        """Test that getting non-existent preference raises error."""
        await ensure_messaging_tables(db_session)
        service = MessagingService(db_session)
        non_existent_parent = uuid4()
    
        with pytest.raises(NotificationPreferenceNotFoundError):
>           await service.get_notification_preference(
                parent_id=non_existent_parent,
                notification_type=NotificationType.MESSAGE,
                channel=NotificationChannelType.EMAIL,
            )

tests/test_messaging.py:1109: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/messaging_service.py:1441: in get_notification_preference
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: notification_preferences
E               [SQL: SELECT notification_preferences.id, notification_preferences.parent_id, notification_preferences.notification_type, notification_preferences.channel, notification_preferences.is_enabled, notification_preferences.quiet_hours_start, notification_preferences.quiet_hours_end, notification_preferences.created_at, notification_preferences.updated_at 
E               FROM notification_preferences 
E               WHERE CAST(notification_preferences.parent_id AS VARCHAR) = ? AND notification_preferences.notification_type = ? AND notification_preferences.channel = ?]
E               [parameters: ('605704ce-5089-4a0b-af05-52b88db31016', 'message', 'email')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
___ TestMessagingServiceNotifications.test_get_or_create_default_preferences ___

self = <sqlalchemy.engine.base.Connection object at 0x10930bc40>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x10930b8b0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10930baf0>
parameters = [('221b437d-fdc0-43fd-9503-bc7cb2ff843e',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: notification_preferences

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_messaging.TestMessagingServiceNotifications object at 0x1055a27f0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109827160>

    @pytest.mark.asyncio
    async def test_get_or_create_default_preferences(
        self,
        db_session: AsyncSession,
    ):
        """Test creating default preferences for new parent."""
        await ensure_messaging_tables(db_session)
        service = MessagingService(db_session)
        new_parent_id = uuid4()
    
>       response = await service.get_or_create_default_preferences(new_parent_id)

tests/test_messaging.py:1142: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/messaging_service.py:1677: in get_or_create_default_preferences
    existing_result = await self.db.execute(existing_query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: notification_preferences
E               [SQL: SELECT notification_preferences.id, notification_preferences.parent_id, notification_preferences.notification_type, notification_preferences.channel, notification_preferences.is_enabled, notification_preferences.quiet_hours_start, notification_preferences.quiet_hours_end, notification_preferences.created_at, notification_preferences.updated_at 
E               FROM notification_preferences 
E               WHERE CAST(notification_preferences.parent_id AS VARCHAR) = ?]
E               [parameters: ('221b437d-fdc0-43fd-9503-bc7cb2ff843e',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ TestMessagingServiceNotifications.test_set_quiet_hours_updates_all_preferences _

self = <sqlalchemy.engine.base.Connection object at 0x109e68340>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109e68f10>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x1095b0400>
parameters = [('b0c9f5ec-2bd0-4ad7-95a4-6a01d6098b94', '22222222-2222-2222-2222-222222222222', 'message', 'email', 1, 'immediate', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: notification_preferences

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_messaging.TestMessagingServiceNotifications object at 0x1055a25b0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109e66430>
test_parent_id_messaging = UUID('22222222-2222-2222-2222-222222222222')

    @pytest.mark.asyncio
    async def test_set_quiet_hours_updates_all_preferences(
        self,
        db_session: AsyncSession,
        test_parent_id_messaging: UUID,
    ):
        """Test setting quiet hours across all preferences."""
        await ensure_messaging_tables(db_session)
    
        # Create some preferences first
>       await create_notification_preference_in_db(
            db_session, test_parent_id_messaging, "message", "email"
        )

tests/test_messaging.py:1158: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_messaging.py:344: in create_notification_preference_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: notification_preferences
E               [SQL: 
E                           INSERT INTO notification_preferences (
E                               id, parent_id, notification_type, channel, is_enabled,
E                               frequency, quiet_hours_start, quiet_hours_end, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('b0c9f5ec-2bd0-4ad7-95a4-6a01d6098b94', '22222222-2222-2222-2222-222222222222', 'message', 'email', 1, 'immediate', None, None, '2026-02-17T15:04:28.678060+00:00', '2026-02-17T15:04:28.678060+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ TestMessagingServiceNotifications.test_is_notification_enabled_defaults_to_true _

self = <sqlalchemy.engine.base.Connection object at 0x109fa3df0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109fa3b80>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108b355e0>
parameters = [('70776507-4416-46f3-837e-684072060ce4', 'message', 'email')]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: notification_preferences

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_messaging.TestMessagingServiceNotifications object at 0x1055a2130>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109c83880>

    @pytest.mark.asyncio
    async def test_is_notification_enabled_defaults_to_true(
        self,
        db_session: AsyncSession,
    ):
        """Test that is_notification_enabled defaults to True for missing prefs."""
        await ensure_messaging_tables(db_session)
        service = MessagingService(db_session)
        new_parent_id = uuid4()
    
>       is_enabled = await service.is_notification_enabled(
            parent_id=new_parent_id,
            notification_type=NotificationType.MESSAGE,
            channel=NotificationChannelType.EMAIL,
        )

tests/test_messaging.py:1201: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/messaging_service.py:1809: in is_notification_enabled
    preference = await self.get_notification_preference(
app/services/messaging_service.py:1441: in get_notification_preference
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: notification_preferences
E               [SQL: SELECT notification_preferences.id, notification_preferences.parent_id, notification_preferences.notification_type, notification_preferences.channel, notification_preferences.is_enabled, notification_preferences.quiet_hours_start, notification_preferences.quiet_hours_end, notification_preferences.created_at, notification_preferences.updated_at 
E               FROM notification_preferences 
E               WHERE CAST(notification_preferences.parent_id AS VARCHAR) = ? AND notification_preferences.notification_type = ? AND notification_preferences.channel = ?]
E               [parameters: ('70776507-4416-46f3-837e-684072060ce4', 'message', 'email')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_________ TestMFAEndToEndFlow.test_e2e_step1_admin_initiates_mfa_setup _________

self = <sqlalchemy.engine.base.Connection object at 0x108baea30>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x10a992f10>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('e8db36c25c71433facd2a4644ea16794',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_e2e.TestMFAEndToEndFlow object at 0x106134e20>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10aa68040>
user_id = UUID('e8db36c2-5c71-433f-acd2-a4644ea16794')
user_email = 'admin_2968252d@laya.app'

    @pytest.mark.asyncio
    async def test_e2e_step1_admin_initiates_mfa_setup(
        self, db_session, user_id: UUID, user_email: str
    ):
        """Step 1: Admin user initiates MFA setup via ai-service API.
    
        Verifies:
        - Setup can be initiated for a new user
        - A TOTP secret is generated
        - QR code URI is provided
        - The issuer name is correct
        """
        service = MFAService(db_session)
    
        # Initiate MFA setup
>       result = await service.initiate_setup(
            user_id=user_id,
            user_email=user_email,
            method=MFAMethod.TOTP,
            recovery_email="recovery@example.com",
        )

tests/test_mfa_e2e.py:59: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:209: in initiate_setup
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('e8db36c25c71433facd2a4644ea16794',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_________ TestMFAEndToEndFlow.test_e2e_step2_qr_code_and_secret_stored _________

self = <sqlalchemy.engine.base.Connection object at 0x109c2cfa0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109c2cb50>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('6687b7a68d87406ba0b54da00103f199',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_e2e.TestMFAEndToEndFlow object at 0x106134970>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109c2c490>
user_id = UUID('6687b7a6-8d87-406b-a0b5-4da00103f199')
user_email = 'admin_67aeef6d@laya.app'

    @pytest.mark.asyncio
    async def test_e2e_step2_qr_code_and_secret_stored(
        self, db_session, user_id: UUID, user_email: str
    ):
        """Step 2: QR code is generated and TOTP secret is stored.
    
        Verifies:
        - MFA settings are persisted in database
        - Secret key is stored (encrypted at rest in production)
        - Recovery email is stored
        - MFA is not yet enabled
        """
        service = MFAService(db_session)
    
        # Initiate setup
>       setup_result = await service.initiate_setup(
            user_id=user_id,
            user_email=user_email,
            method=MFAMethod.TOTP,
            recovery_email="recovery@example.com",
        )

tests/test_mfa_e2e.py:93: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:209: in initiate_setup
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('6687b7a68d87406ba0b54da00103f199',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_____ TestMFAEndToEndFlow.test_e2e_step3_user_verifies_totp_to_enable_mfa ______

self = <sqlalchemy.engine.base.Connection object at 0x109b99730>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109b99ca0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('f7846e3d58a44e19b59dbe5258ced39c',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_e2e.TestMFAEndToEndFlow object at 0x105727d30>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109c21250>
user_id = UUID('f7846e3d-58a4-4e19-b59d-be5258ced39c')
user_email = 'admin_1c8041ff@laya.app'

    @pytest.mark.asyncio
    async def test_e2e_step3_user_verifies_totp_to_enable_mfa(
        self, db_session, user_id: UUID, user_email: str
    ):
        """Step 3: User verifies TOTP code to enable MFA.
    
        Verifies:
        - Valid TOTP code enables MFA
        - Invalid TOTP code is rejected
        - MFA status changes after enablement
        """
        service = MFAService(db_session)
    
        # Setup MFA
>       setup_result = await service.initiate_setup(
            user_id=user_id,
            user_email=user_email,
            method=MFAMethod.TOTP,
        )

tests/test_mfa_e2e.py:124: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:209: in initiate_setup
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('f7846e3d58a44e19b59dbe5258ced39c',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
___________ TestMFAEndToEndFlow.test_e2e_step3_invalid_code_rejected ___________

self = <sqlalchemy.engine.base.Connection object at 0x109759460>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109759a00>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('071ae48e200c4dc18328d4fd2c529b05',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_e2e.TestMFAEndToEndFlow object at 0x105727eb0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1097441c0>
user_id = UUID('071ae48e-200c-4dc1-8328-d4fd2c529b05')
user_email = 'admin_a975bac2@laya.app'

    @pytest.mark.asyncio
    async def test_e2e_step3_invalid_code_rejected(
        self, db_session, user_id: UUID, user_email: str
    ):
        """Step 3 (negative): Invalid TOTP code is rejected.
    
        Verifies:
        - Invalid codes are rejected
        - Failed attempts are tracked
        - MFA is not enabled with invalid code
        """
        service = MFAService(db_session)
    
        # Setup MFA
>       await service.initiate_setup(
            user_id=user_id,
            user_email=user_email,
            method=MFAMethod.TOTP,
        )

tests/test_mfa_e2e.py:159: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:209: in initiate_setup
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('071ae48e200c4dc18328d4fd2c529b05',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
______ TestMFAEndToEndFlow.test_e2e_step4_subsequent_logins_require_totp _______

self = <sqlalchemy.engine.base.Connection object at 0x108953e80>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x108953ca0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('5bda6020c7994a94ad32a5bf05f68675',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_e2e.TestMFAEndToEndFlow object at 0x105727730>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109617100>
user_id = UUID('5bda6020-c799-4a94-ad32-a5bf05f68675')
user_email = 'admin_01ccf4e3@laya.app'

    @pytest.mark.asyncio
    async def test_e2e_step4_subsequent_logins_require_totp(
        self, db_session, user_id: UUID, user_email: str
    ):
        """Step 4: Subsequent logins require TOTP verification.
    
        Verifies:
        - After MFA is enabled, TOTP verification is required
        - Valid codes are accepted for verification
        - Invalid codes are rejected during verification
        """
        service = MFAService(db_session)
    
        # Setup and enable MFA
>       setup_result = await service.initiate_setup(
            user_id=user_id,
            user_email=user_email,
            method=MFAMethod.TOTP,
        )

tests/test_mfa_e2e.py:189: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:209: in initiate_setup
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('5bda6020c7994a94ad32a5bf05f68675',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
______ TestMFAEndToEndFlow.test_e2e_step5_backup_codes_generated_and_used ______

self = <sqlalchemy.engine.base.Connection object at 0x109d809a0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109d80f10>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('4f77c3686b464964938718030fd8969b',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_e2e.TestMFAEndToEndFlow object at 0x1057279d0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109591520>
user_id = UUID('4f77c368-6b46-4964-9387-18030fd8969b')
user_email = 'admin_b261cf66@laya.app'

    @pytest.mark.asyncio
    async def test_e2e_step5_backup_codes_generated_and_used(
        self, db_session, user_id: UUID, user_email: str
    ):
        """Step 5: Backup codes can be generated and used.
    
        Verifies:
        - Backup codes can be generated after MFA is enabled
        - Generated codes are unique
        - Backup codes can be used for verification
        - Each backup code can only be used once
        """
        service = MFAService(db_session)
    
        # Setup and enable MFA
>       setup_result = await service.initiate_setup(
            user_id=user_id,
            user_email=user_email,
            method=MFAMethod.TOTP,
        )

tests/test_mfa_e2e.py:232: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:209: in initiate_setup
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('4f77c3686b464964938718030fd8969b',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_________ TestMFAEndToEndFlow.test_e2e_step6_ip_whitelist_bypasses_mfa _________

self = <sqlalchemy.engine.base.Connection object at 0x10899ba60>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x10899bc70>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('c49914f76dcb46e1be55300313859524',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_e2e.TestMFAEndToEndFlow object at 0x105727be0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1092ea490>
user_id = UUID('c49914f7-6dcb-46e1-be55-300313859524')
user_email = 'admin_abb2124e@laya.app'

    @pytest.mark.asyncio
    async def test_e2e_step6_ip_whitelist_bypasses_mfa(
        self, db_session, user_id: UUID, user_email: str
    ):
        """Step 6: IP whitelist allows bypass for trusted IPs.
    
        Verifies:
        - IP addresses can be added to whitelist
        - Whitelisted IPs are recognized
        - Non-whitelisted IPs require MFA
        - CIDR ranges work correctly
        """
        service = MFAService(db_session)
    
        # Setup and enable MFA
>       setup_result = await service.initiate_setup(
            user_id=user_id,
            user_email=user_email,
            method=MFAMethod.TOTP,
        )

tests/test_mfa_e2e.py:293: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:209: in initiate_setup
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('c49914f76dcb46e1be55300313859524',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
______________ TestMFAEndToEndFlow.test_e2e_lockout_and_recovery _______________

self = <sqlalchemy.engine.base.Connection object at 0x1092ea460>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x1092ea1c0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('0cfdca13a7114d758c91de84066f84ec',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_e2e.TestMFAEndToEndFlow object at 0x105727220>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109a00070>
user_id = UUID('0cfdca13-a711-4d75-8c91-de84066f84ec')
user_email = 'admin_d1dab283@laya.app'

    @pytest.mark.asyncio
    async def test_e2e_lockout_and_recovery(
        self, db_session, user_id: UUID, user_email: str
    ):
        """Test account lockout after failed attempts and recovery.
    
        Verifies:
        - Account is locked after MAX_FAILED_ATTEMPTS
        - Lockout prevents further verification attempts
        - Admin can reset lockout
        """
        service = MFAService(db_session, max_failed_attempts=3, lockout_duration_minutes=15)
    
        # Setup and enable MFA
>       setup_result = await service.initiate_setup(
            user_id=user_id,
            user_email=user_email,
            method=MFAMethod.TOTP,
        )

tests/test_mfa_e2e.py:357: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:209: in initiate_setup
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('0cfdca13a7114d758c91de84066f84ec',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
___________________ TestMFAEndToEndFlow.test_e2e_disable_mfa ___________________

self = <sqlalchemy.engine.base.Connection object at 0x10917cbb0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x10917c850>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('a2b0679c765b4e6ba18c35d314c57009',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_e2e.TestMFAEndToEndFlow object at 0x106134a90>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1092ea850>
user_id = UUID('a2b0679c-765b-4e6b-a18c-35d314c57009')
user_email = 'admin_aed5e6f1@laya.app'

    @pytest.mark.asyncio
    async def test_e2e_disable_mfa(
        self, db_session, user_id: UUID, user_email: str
    ):
        """Test disabling MFA after it's been enabled.
    
        Verifies:
        - MFA can be disabled with valid TOTP code
        - Backup codes are deleted when MFA is disabled
        - MFA can be set up again after being disabled
        """
        service = MFAService(db_session)
    
        # Setup and enable MFA
>       setup_result = await service.initiate_setup(
            user_id=user_id,
            user_email=user_email,
            method=MFAMethod.TOTP,
        )

tests/test_mfa_e2e.py:398: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:209: in initiate_setup
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('a2b0679c765b4e6ba18c35d314c57009',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
__________________ TestMFAEndToEndFlow.test_e2e_complete_flow __________________

self = <sqlalchemy.engine.base.Connection object at 0x10875b160>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x10875bd90>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('2294a3c11d7841b681285daf1b4d7d27',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_e2e.TestMFAEndToEndFlow object at 0x10613a190>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10aae9100>
user_id = UUID('2294a3c1-1d78-41b6-8128-5daf1b4d7d27')
user_email = 'admin_a66a8f01@laya.app'

    @pytest.mark.asyncio
    async def test_e2e_complete_flow(
        self, db_session, user_id: UUID, user_email: str
    ):
        """Complete end-to-end flow test covering all 6 verification steps.
    
        This test simulates the complete lifecycle of MFA for an admin user.
        """
        service = MFAService(db_session)
    
        # Step 1 & 2: Admin initiates MFA setup
        print("\n=== Step 1 & 2: Admin initiates MFA setup ===")
>       setup_result = await service.initiate_setup(
            user_id=user_id,
            user_email=user_email,
            method=MFAMethod.TOTP,
            recovery_email="admin-recovery@example.com",
        )

tests/test_mfa_e2e.py:443: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:209: in initiate_setup
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('2294a3c11d7841b681285daf1b4d7d27',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
----------------------------- Captured stdout call -----------------------------

=== Step 1 & 2: Admin initiates MFA setup ===
___________ TestMFASecurityFeatures.test_totp_time_window_tolerance ____________

self = <sqlalchemy.engine.base.Connection object at 0x109c23b80>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109c238e0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('765675a1df4543018fd3a623b8a5f7e1',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_e2e.TestMFASecurityFeatures object at 0x1057394c0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109c23f10>
user_id = UUID('765675a1-df45-4301-8fd3-a623b8a5f7e1')
user_email = 'secure_02a782bb@laya.app'

    @pytest.mark.asyncio
    async def test_totp_time_window_tolerance(
        self, db_session, user_id: UUID, user_email: str
    ):
        """Test that TOTP accepts codes within the valid window.
    
        TOTP codes are valid for a window around the current time to
        account for clock drift between client and server.
        """
        service = MFAService(db_session)
    
        # Setup and enable MFA
>       setup_result = await service.initiate_setup(
            user_id=user_id,
            user_email=user_email,
        )

tests/test_mfa_e2e.py:544: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:209: in initiate_setup
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('765675a1df4543018fd3a623b8a5f7e1',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_______________ TestMFASecurityFeatures.test_backup_code_hashing _______________

self = <sqlalchemy.engine.base.Connection object at 0x10957aee0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x10957aaf0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('2f6fdca289ba4f70976c809ee0fed9f0',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_e2e.TestMFASecurityFeatures object at 0x105739220>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1098a5280>
user_id = UUID('2f6fdca2-89ba-4f70-976c-809ee0fed9f0')
user_email = 'secure_462c8e7f@laya.app'

    @pytest.mark.asyncio
    async def test_backup_code_hashing(
        self, db_session, user_id: UUID, user_email: str
    ):
        """Test that backup codes are stored hashed, not in plaintext.
    
        This verifies that even if the database is compromised, backup
        codes cannot be easily recovered.
        """
        service = MFAService(db_session)
    
        # Setup and enable MFA
>       setup_result = await service.initiate_setup(
            user_id=user_id,
            user_email=user_email,
        )

tests/test_mfa_e2e.py:567: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:209: in initiate_setup
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('2f6fdca289ba4f70976c809ee0fed9f0',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_______ TestMFASecurityFeatures.test_mfa_not_bypassed_without_whitelist ________

self = <sqlalchemy.engine.base.Connection object at 0x1092161f0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109216b80>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('17b49c8fff014fdab1cb7c444f5ab96f',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_e2e.TestMFASecurityFeatures object at 0x105727040>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109fdf790>
user_id = UUID('17b49c8f-ff01-4fda-b1cb-7c444f5ab96f')
user_email = 'secure_baa3165d@laya.app'

    @pytest.mark.asyncio
    async def test_mfa_not_bypassed_without_whitelist(
        self, db_session, user_id: UUID, user_email: str
    ):
        """Test that MFA cannot be bypassed without IP whitelist.
    
        Ensures that only explicitly whitelisted IPs can bypass MFA.
        """
        service = MFAService(db_session)
    
        # Setup and enable MFA (without any whitelist)
>       setup_result = await service.initiate_setup(
            user_id=user_id,
            user_email=user_email,
        )

tests/test_mfa_e2e.py:608: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:209: in initiate_setup
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('17b49c8fff014fdab1cb7c444f5ab96f',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
________________ TestMFASettingsModel.test_create_mfa_settings _________________

self = <sqlalchemy.engine.base.Connection object at 0x10704c1c0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x10958bac0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10704cf10>
parameters = [('b8498f53-a53e-4615-b3c4-571c97d915d2', '340711d6-8c1c-4831-930a-061088ef1844', 1, 'totp', 'VB3YEN6LNDZNFKBFUDUM66UFI25YCHXX', 'recovery@example.com', ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_service.TestMFASettingsModel object at 0x106298e20>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109dc92b0>
mfa_user_id = UUID('340711d6-8c1c-4831-930a-061088ef1844')
totp_secret = 'VB3YEN6LNDZNFKBFUDUM66UFI25YCHXX'

    @pytest.mark.asyncio
    async def test_create_mfa_settings(
        self,
        db_session: AsyncSession,
        mfa_user_id: UUID,
        totp_secret: str,
    ):
        """Test MFASettings can be created with all fields."""
>       settings = await create_mfa_settings_in_db(
            db_session,
            user_id=mfa_user_id,
            is_enabled=True,
            method="totp",
            secret_key=totp_secret,
            recovery_email="recovery@example.com",
        )

tests/test_mfa_service.py:320: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_mfa_service.py:150: in create_mfa_settings_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: 
E                           INSERT INTO mfa_settings (
E                               id, user_id, is_enabled, method, secret_key, recovery_email,
E                               failed_attempts, locked_until, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('b8498f53-a53e-4615-b3c4-571c97d915d2', '340711d6-8c1c-4831-930a-061088ef1844', 1, 'totp', 'VB3YEN6LNDZNFKBFUDUM66UFI25YCHXX', 'recovery@example.com', 0, None, '2026-02-17T15:04:42.751535+00:00', '2026-02-17T15:04:42.751535+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_________________ TestMFASettingsModel.test_mfa_settings_repr __________________

self = <sqlalchemy.engine.base.Connection object at 0x1080a8520>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x1080a8df0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10704cf10>
parameters = [('6b1dab27-0c9f-4c63-bb2c-8879102fdf94', '543cd7e0-c73b-42cc-985c-69e0383a292b', 1, 'totp', None, None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_service.TestMFASettingsModel object at 0x106298910>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x108cb42b0>
mfa_user_id = UUID('543cd7e0-c73b-42cc-985c-69e0383a292b')

    @pytest.mark.asyncio
    async def test_mfa_settings_repr(
        self,
        db_session: AsyncSession,
        mfa_user_id: UUID,
    ):
        """Test MFASettings string representation."""
>       settings = await create_mfa_settings_in_db(
            db_session,
            user_id=mfa_user_id,
            is_enabled=True,
        )

tests/test_mfa_service.py:346: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_mfa_service.py:150: in create_mfa_settings_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: 
E                           INSERT INTO mfa_settings (
E                               id, user_id, is_enabled, method, secret_key, recovery_email,
E                               failed_attempts, locked_until, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('6b1dab27-0c9f-4c63-bb2c-8879102fdf94', '543cd7e0-c73b-42cc-985c-69e0383a292b', 1, 'totp', None, None, 0, None, '2026-02-17T15:04:43.021160+00:00', '2026-02-17T15:04:43.021160+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
____________ TestMFASettingsModel.test_mfa_settings_default_values _____________

self = <sqlalchemy.engine.base.Connection object at 0x109fafac0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109faf6d0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10704cf10>
parameters = [('18051b88-8103-4309-b746-4d02d7e62d7d', 'eafdf8b7-968b-45e8-a3b4-1e59c8619e6a', 0, 'totp', None, None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_service.TestMFASettingsModel object at 0x106298520>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109b97910>
mfa_user_id = UUID('eafdf8b7-968b-45e8-a3b4-1e59c8619e6a')

    @pytest.mark.asyncio
    async def test_mfa_settings_default_values(
        self,
        db_session: AsyncSession,
        mfa_user_id: UUID,
    ):
        """Test MFASettings default values are applied correctly."""
>       settings = await create_mfa_settings_in_db(
            db_session,
            user_id=mfa_user_id,
        )

tests/test_mfa_service.py:364: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_mfa_service.py:150: in create_mfa_settings_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: 
E                           INSERT INTO mfa_settings (
E                               id, user_id, is_enabled, method, secret_key, recovery_email,
E                               failed_attempts, locked_until, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('18051b88-8103-4309-b746-4d02d7e62d7d', 'eafdf8b7-968b-45e8-a3b4-1e59c8619e6a', 0, 'totp', None, None, 0, None, '2026-02-17T15:04:43.508754+00:00', '2026-02-17T15:04:43.508754+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
________________ TestMFABackupCodeModel.test_create_backup_code ________________

self = <sqlalchemy.engine.base.Connection object at 0x108400af0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x108912160>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10704cf10>
parameters = [('494b80a3-14b7-445b-afcd-ec8287690412', 'a0188baa-76ee-4d2e-8df6-280aa2aa8ae9', 1, 'totp', None, None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_service.TestMFABackupCodeModel object at 0x106298d00>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x108400700>
mfa_user_id = UUID('a0188baa-76ee-4d2e-8df6-280aa2aa8ae9')

    @pytest.mark.asyncio
    async def test_create_backup_code(
        self,
        db_session: AsyncSession,
        mfa_user_id: UUID,
    ):
        """Test MFABackupCode can be created."""
>       settings = await create_mfa_settings_in_db(
            db_session,
            user_id=mfa_user_id,
            is_enabled=True,
        )

tests/test_mfa_service.py:387: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_mfa_service.py:150: in create_mfa_settings_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: 
E                           INSERT INTO mfa_settings (
E                               id, user_id, is_enabled, method, secret_key, recovery_email,
E                               failed_attempts, locked_until, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('494b80a3-14b7-445b-afcd-ec8287690412', 'a0188baa-76ee-4d2e-8df6-280aa2aa8ae9', 1, 'totp', None, None, 0, None, '2026-02-17T15:04:43.745639+00:00', '2026-02-17T15:04:43.745639+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_________________ TestMFABackupCodeModel.test_backup_code_repr _________________

self = <sqlalchemy.engine.base.Connection object at 0x1081f0670>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x108936b20>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10704cf10>
parameters = [('c0f0eb56-5adb-4e05-b004-57e3d8a3ea0d', '294e7cc1-9545-42d4-a4bd-3616ac659d9d', 1, 'totp', None, None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_service.TestMFABackupCodeModel object at 0x1062b69d0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x107776c10>
mfa_user_id = UUID('294e7cc1-9545-42d4-a4bd-3616ac659d9d')

    @pytest.mark.asyncio
    async def test_backup_code_repr(
        self,
        db_session: AsyncSession,
        mfa_user_id: UUID,
    ):
        """Test MFABackupCode string representation."""
>       settings = await create_mfa_settings_in_db(
            db_session,
            user_id=mfa_user_id,
            is_enabled=True,
        )

tests/test_mfa_service.py:413: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_mfa_service.py:150: in create_mfa_settings_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: 
E                           INSERT INTO mfa_settings (
E                               id, user_id, is_enabled, method, secret_key, recovery_email,
E                               failed_attempts, locked_until, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('c0f0eb56-5adb-4e05-b004-57e3d8a3ea0d', '294e7cc1-9545-42d4-a4bd-3616ac659d9d', 1, 'totp', None, None, 0, None, '2026-02-17T15:04:44.159796+00:00', '2026-02-17T15:04:44.159796+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
____________ TestMFAIPWhitelistModel.test_create_ip_whitelist_entry ____________

self = <sqlalchemy.engine.base.Connection object at 0x1099cd640>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x1099cdbe0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10704cf10>
parameters = [('021109a6-e409-4757-949f-390c26f0f9de', 'ed297e7c-58ad-4826-9344-ec52a8451500', 1, 'totp', None, None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_service.TestMFAIPWhitelistModel object at 0x1062b6c70>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1099cd5e0>
mfa_user_id = UUID('ed297e7c-58ad-4826-9344-ec52a8451500')

    @pytest.mark.asyncio
    async def test_create_ip_whitelist_entry(
        self,
        db_session: AsyncSession,
        mfa_user_id: UUID,
    ):
        """Test MFAIPWhitelist can be created."""
>       settings = await create_mfa_settings_in_db(
            db_session,
            user_id=mfa_user_id,
            is_enabled=True,
        )

tests/test_mfa_service.py:440: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_mfa_service.py:150: in create_mfa_settings_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: 
E                           INSERT INTO mfa_settings (
E                               id, user_id, is_enabled, method, secret_key, recovery_email,
E                               failed_attempts, locked_until, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('021109a6-e409-4757-949f-390c26f0f9de', 'ed297e7c-58ad-4826-9344-ec52a8451500', 1, 'totp', None, None, 0, None, '2026-02-17T15:04:44.390980+00:00', '2026-02-17T15:04:44.390980+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
________________ TestMFAIPWhitelistModel.test_ip_whitelist_repr ________________

self = <sqlalchemy.engine.base.Connection object at 0x10aae9d00>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x10aae9bb0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x10704cf10>
parameters = [('348d3dce-07d9-447a-89ff-65dcb4a6b2b0', 'aa8e7425-caca-4578-b05a-4651217ad221', 1, 'totp', None, None, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_service.TestMFAIPWhitelistModel object at 0x1062b6ac0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1091c1fd0>
mfa_user_id = UUID('aa8e7425-caca-4578-b05a-4651217ad221')

    @pytest.mark.asyncio
    async def test_ip_whitelist_repr(
        self,
        db_session: AsyncSession,
        mfa_user_id: UUID,
    ):
        """Test MFAIPWhitelist string representation."""
>       settings = await create_mfa_settings_in_db(
            db_session,
            user_id=mfa_user_id,
            is_enabled=True,
        )

tests/test_mfa_service.py:467: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/test_mfa_service.py:150: in create_mfa_settings_in_db
    await session.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2258: in _execute_internal
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: 
E                           INSERT INTO mfa_settings (
E                               id, user_id, is_enabled, method, secret_key, recovery_email,
E                               failed_attempts, locked_until, created_at, updated_at
E                           ) VALUES (
E                               ?, ?, ?, ?, ?, ?,
E                               ?, ?, ?, ?
E                           )
E                       ]
E               [parameters: ('348d3dce-07d9-447a-89ff-65dcb4a6b2b0', 'aa8e7425-caca-4578-b05a-4651217ad221', 1, 'totp', None, None, 0, None, '2026-02-17T15:04:44.711990+00:00', '2026-02-17T15:04:44.711990+00:00')]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
______________ TestMFAServiceStatus.test_get_status_no_mfa_setup _______________

self = <sqlalchemy.engine.base.Connection object at 0x108231370>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x10776e7f0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('4647f62a60194394b7eaa72868bdd57b',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_service.TestMFAServiceStatus object at 0x1062b6760>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109e66400>
mfa_user_id = UUID('4647f62a-6019-4394-b7ea-a72868bdd57b')

    @pytest.mark.asyncio
    async def test_get_status_no_mfa_setup(
        self,
        db_session: AsyncSession,
        mfa_user_id: UUID,
    ):
        """Test get_mfa_status returns disabled status when MFA not set up."""
        service = MFAService(db_session)
>       status = await service.get_mfa_status(mfa_user_id)

tests/test_mfa_service.py:500: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:133: in get_mfa_status
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('4647f62a60194394b7eaa72868bdd57b',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
___________ TestMFAServiceSetup.test_initiate_setup_generates_secret ___________

self = <sqlalchemy.engine.base.Connection object at 0x107addbb0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x108855370>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('75b124b314cb4e44bba52cd492264b25',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_service.TestMFAServiceSetup object at 0x106298c40>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x108d2fa30>
mfa_user_id = UUID('75b124b3-14cb-4e44-bba5-2cd492264b25')
mfa_user_email = 'mfa_test@example.com'

    @pytest.mark.asyncio
    async def test_initiate_setup_generates_secret(
        self,
        db_session: AsyncSession,
        mfa_user_id: UUID,
        mfa_user_email: str,
    ):
        """Test initiate_setup generates a valid TOTP secret."""
        service = MFAService(db_session)
>       response = await service.initiate_setup(
            user_id=mfa_user_id,
            user_email=mfa_user_email,
        )

tests/test_mfa_service.py:524: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:209: in initiate_setup
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('75b124b314cb4e44bba52cd492264b25',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_________ TestMFAServiceSetup.test_initiate_setup_with_recovery_email __________

self = <sqlalchemy.engine.base.Connection object at 0x109a9ba90>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109a9b550>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('9508bb0602af4f37bf5feb0c2cefab02',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_service.TestMFAServiceSetup object at 0x1062b6e80>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1092c2be0>
mfa_user_id = UUID('9508bb06-02af-4f37-bf5f-eb0c2cefab02')
mfa_user_email = 'mfa_test@example.com'

    @pytest.mark.asyncio
    async def test_initiate_setup_with_recovery_email(
        self,
        db_session: AsyncSession,
        mfa_user_id: UUID,
        mfa_user_email: str,
    ):
        """Test initiate_setup stores recovery email."""
        service = MFAService(db_session)
>       await service.initiate_setup(
            user_id=mfa_user_id,
            user_email=mfa_user_email,
            recovery_email="recovery@backup.com",
        )

tests/test_mfa_service.py:547: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:209: in initiate_setup
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('9508bb0602af4f37bf5feb0c2cefab02',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
______ TestMFAServiceVerifyTOTP.test_verify_totp_raises_when_no_settings _______

self = <sqlalchemy.engine.base.Connection object at 0x109bba340>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109bbaf10>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('298efa555d6643ab8dee41c03824622c',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_service.TestMFAServiceVerifyTOTP object at 0x1062b6ca0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109a7b340>
mfa_user_id = UUID('298efa55-5d66-43ab-8dee-41c03824622c')

    @pytest.mark.asyncio
    async def test_verify_totp_raises_when_no_settings(
        self,
        db_session: AsyncSession,
        mfa_user_id: UUID,
    ):
        """Test verify_totp raises error when no MFA settings exist."""
        service = MFAService(db_session)
    
        with pytest.raises(MFANotEnabledError):
>           await service.verify_totp(mfa_user_id, "123456")

tests/test_mfa_service.py:575: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:273: in verify_totp
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('298efa555d6643ab8dee41c03824622c',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_________ TestMFAServiceEnableDisable.test_enable_mfa_with_valid_code __________

self = <sqlalchemy.engine.base.Connection object at 0x108dfb730>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x108dfba60>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('3e8fc5e3ed8944889379c28fa9a5f6a2',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_service.TestMFAServiceEnableDisable object at 0x1062b64c0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1061c27f0>
mfa_user_id = UUID('3e8fc5e3-ed89-4488-9379-c28fa9a5f6a2')
mfa_user_email = 'mfa_test@example.com'

    @pytest.mark.asyncio
    async def test_enable_mfa_with_valid_code(
        self,
        db_session: AsyncSession,
        mfa_user_id: UUID,
        mfa_user_email: str,
    ):
        """Test enable_mfa succeeds with valid TOTP code."""
        service = MFAService(db_session)
    
        # First initiate setup
>       setup_response = await service.initiate_setup(
            user_id=mfa_user_id,
            user_email=mfa_user_email,
        )

tests/test_mfa_service.py:597: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:209: in initiate_setup
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('3e8fc5e3ed8944889379c28fa9a5f6a2',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_____ TestMFAServiceEnableDisable.test_enable_mfa_fails_with_invalid_code ______

self = <sqlalchemy.engine.base.Connection object at 0x108f1b5e0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x108f1bd90>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('0ffebeda07ef400392680f73dc1b6957',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_service.TestMFAServiceEnableDisable object at 0x1062b6100>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109350340>
mfa_user_id = UUID('0ffebeda-07ef-4003-9268-0f73dc1b6957')
mfa_user_email = 'mfa_test@example.com'

    @pytest.mark.asyncio
    async def test_enable_mfa_fails_with_invalid_code(
        self,
        db_session: AsyncSession,
        mfa_user_id: UUID,
        mfa_user_email: str,
    ):
        """Test enable_mfa fails with invalid TOTP code."""
        service = MFAService(db_session)
    
>       await service.initiate_setup(
            user_id=mfa_user_id,
            user_email=mfa_user_email,
        )

tests/test_mfa_service.py:626: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:209: in initiate_setup
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('0ffebeda07ef400392680f73dc1b6957',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_____ TestMFAServiceEnableDisable.test_disable_mfa_raises_when_not_enabled _____

self = <sqlalchemy.engine.base.Connection object at 0x109bdcac0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109bdc3a0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('3ae716aa2da94dbdae2d918f416a8deb',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_service.TestMFAServiceEnableDisable object at 0x1067a4bb0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109bdcdf0>
mfa_user_id = UUID('3ae716aa-2da9-4dbd-ae2d-918f416a8deb')

    @pytest.mark.asyncio
    async def test_disable_mfa_raises_when_not_enabled(
        self,
        db_session: AsyncSession,
        mfa_user_id: UUID,
    ):
        """Test disable_mfa raises error when MFA not enabled."""
        service = MFAService(db_session)
    
        with pytest.raises(MFANotEnabledError):
>           await service.disable_mfa(mfa_user_id, "123456")

tests/test_mfa_service.py:649: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:388: in disable_mfa
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('3ae716aa2da94dbdae2d918f416a8deb',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_ TestMFAServiceLockout.test_reset_lockout_returns_false_for_nonexistent_user __

self = <sqlalchemy.engine.base.Connection object at 0x1091b34c0>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x1091b3d00>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('3b3aaa14b74e42b4a5f34dc0cc3584e7',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_service.TestMFAServiceLockout object at 0x1067a46d0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1097d97c0>

    @pytest.mark.asyncio
    async def test_reset_lockout_returns_false_for_nonexistent_user(
        self,
        db_session: AsyncSession,
    ):
        """Test reset_lockout returns False when user doesn't exist."""
        service = MFAService(db_session)
>       result = await service.reset_lockout(uuid4())

tests/test_mfa_service.py:667: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:798: in reset_lockout
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('3b3aaa14b74e42b4a5f34dc0cc3584e7',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
__ TestMFAServiceBackupCodes.test_generate_backup_codes_requires_mfa_enabled ___

self = <sqlalchemy.engine.base.Connection object at 0x108aa6b80>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x108aa67c0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('4285bf7574e5463c938188f6eceae7fe',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_service.TestMFAServiceBackupCodes object at 0x1067a4340>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1094bc130>
mfa_user_id = UUID('4285bf75-74e5-463c-9381-88f6eceae7fe')

    @pytest.mark.asyncio
    async def test_generate_backup_codes_requires_mfa_enabled(
        self,
        db_session: AsyncSession,
        mfa_user_id: UUID,
    ):
        """Test generate_backup_codes raises error when MFA not enabled."""
        service = MFAService(db_session)
    
        with pytest.raises(MFANotEnabledError):
>           await service.generate_backup_codes(
                user_id=mfa_user_id,
                code="123456",
                count=5,
            )

tests/test_mfa_service.py:690: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:441: in generate_backup_codes
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('4285bf7574e5463c938188f6eceae7fe',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
_______ TestMFAServiceIPWhitelist.test_ip_whitelist_requires_mfa_enabled _______

self = <sqlalchemy.engine.base.Connection object at 0x109f3ef10>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x109f3eca0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('fb83c1c56bee47ae8c13221fbcb8b155',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_service.TestMFAServiceIPWhitelist object at 0x1067a4610>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109f3e3d0>
mfa_user_id = UUID('fb83c1c5-6bee-47ae-8c13-221fbcb8b155')

    @pytest.mark.asyncio
    async def test_ip_whitelist_requires_mfa_enabled(
        self,
        db_session: AsyncSession,
        mfa_user_id: UUID,
    ):
        """Test IP whitelist operations require MFA to be enabled."""
        service = MFAService(db_session)
    
        with pytest.raises(MFANotEnabledError):
>           await service.add_ip_to_whitelist(mfa_user_id, "192.168.1.1")

tests/test_mfa_service.py:715: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:639: in add_ip_to_whitelist
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('fb83c1c56bee47ae8c13221fbcb8b155',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
___________ TestMFAServiceEdgeCases.test_check_ip_whitelisted_no_mfa ___________

self = <sqlalchemy.engine.base.Connection object at 0x10aa58d90>
dialect = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteDialect_aiosqlite object at 0x1044cc670>
context = <sqlalchemy.dialects.sqlite.aiosqlite.SQLiteExecutionContext_aiosqlite object at 0x10aa585e0>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x108baeaf0>
parameters = [('0e94e04f890a456ab442923d99d95013',)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlite3.OperationalError: no such table: mfa_settings

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError

The above exception was the direct cause of the following exception:

self = <tests.test_mfa_service.TestMFAServiceEdgeCases object at 0x106492220>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10aa6c040>
mfa_user_id = UUID('0e94e04f-890a-456a-b442-923d99d95013')

    @pytest.mark.asyncio
    async def test_check_ip_whitelisted_no_mfa(
        self,
        db_session: AsyncSession,
        mfa_user_id: UUID,
    ):
        """Test check_ip_whitelisted when MFA not enabled."""
        service = MFAService(db_session)
    
>       result = await service.check_ip_whitelisted(mfa_user_id, "192.168.1.1")

tests/test_mfa_service.py:778: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
app/services/mfa_service.py:755: in check_ip_whitelisted
    settings = await self.get_mfa_settings(user_id)
app/services/mfa_service.py:121: in get_mfa_settings
    result = await self.db.execute(query)
.venv_test/lib/python3.9/site-packages/sqlalchemy/ext/asyncio/session.py:449: in execute
    result = await greenlet_spawn(
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn
    result = context.throw(*sys.exc_info())
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
.venv_test/lib/python3.9/site-packages/sqlalchemy/sql/elements.py:527: in _execute_on_connection
    return connection._execute_clauseelement(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:2363: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
.venv_test/lib/python3.9/site-packages/sqlalchemy/engine/default.py:952: in do_execute
    cursor.execute(statement, parameters)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:182: in execute
    self._adapt_connection._handle_exception(error)
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:342: in _handle_exception
    raise error
.venv_test/lib/python3.9/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:164: in execute
    self.await_(_cursor.execute(operation, parameters))
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
.venv_test/lib/python3.9/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn
    value = await result
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:40: in execute
    await self._execute(self._cursor.execute, sql, parameters)
.venv_test/lib/python3.9/site-packages/aiosqlite/cursor.py:32: in _execute
    return await self._conn._execute(fn, *args, **kwargs)
.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:160: in _execute
    return await future
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/asyncio/tasks.py:328: in __wakeup
    future.result()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tx = <_queue.SimpleQueue object at 0x107321770>

    def _connection_worker_thread(tx: _TxQueue):
        """
        Execute function calls on a separate thread.
    
        :meta private:
        """
        while True:
            # Continues running until all queue items are processed,
            # even after connection is closed (so we can finalize all
            # futures)
    
            future, function = tx.get()
    
            try:
                LOG.debug("executing %s", function)
>               result = function()
E               sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: mfa_settings
E               [SQL: SELECT mfa_settings.id, mfa_settings.user_id, mfa_settings.is_enabled, mfa_settings.method, mfa_settings.secret_key, mfa_settings.recovery_email, mfa_settings.last_verified_at, mfa_settings.failed_attempts, mfa_settings.locked_until, mfa_settings.created_at, mfa_settings.updated_at 
E               FROM mfa_settings 
E               WHERE mfa_settings.user_id = ?]
E               [parameters: ('0e94e04f890a456ab442923d99d95013',)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8)

.venv_test/lib/python3.9/site-packages/aiosqlite/core.py:63: OperationalError
______________ test_activity_relationships_without_eager_loading _______________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109add9a0>
sample_activities = <coroutine object sample_activities at 0x109ab9340>
sample_recommendations = <coroutine object sample_recommendations at 0x109ab98c0>

    @pytest.mark.asyncio
    async def test_activity_relationships_without_eager_loading(
        db_session: AsyncSession, sample_activities, sample_recommendations
    ):
        """Test that accessing relationships without eager loading causes N+1 queries."""
        # Create query counter
        counter = QueryCounter()
>       event.listen(db_session.sync_session, "before_cursor_execute", counter)

tests/test_query_optimization.py:165: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/event/api.py:121: in listen
    _event_key(target, identifier, fn).listen(*args, **kw)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

target = <sqlalchemy.orm.session.Session object at 0x109add7c0>
identifier = 'before_cursor_execute'
fn = <tests.test_query_optimization.QueryCounter object at 0x109add130>

    def _event_key(
        target: _ET, identifier: str, fn: _ListenerFnType
    ) -> _EventKey[_ET]:
        for evt_cls in _registrars[identifier]:
            tgt = evt_cls._accept_with(target, identifier)
            if tgt is not None:
                return _EventKey(target, identifier, fn, tgt)
        else:
>           raise exc.InvalidRequestError(
                "No such event '%s' for target '%s'" % (identifier, target)
            )
E           sqlalchemy.exc.InvalidRequestError: No such event 'before_cursor_execute' for target '<sqlalchemy.orm.session.Session object at 0x109add7c0>'

.venv_test/lib/python3.9/site-packages/sqlalchemy/event/api.py:34: InvalidRequestError
________________ test_activity_relationships_with_eager_loading ________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1098a5a30>
sample_activities = <coroutine object sample_activities at 0x109a850c0>
sample_recommendations = <coroutine object sample_recommendations at 0x1099dd0c0>

    @pytest.mark.asyncio
    async def test_activity_relationships_with_eager_loading(
        db_session: AsyncSession, sample_activities, sample_recommendations
    ):
        """Test that eager loading prevents N+1 queries when accessing relationships."""
        # Create query counter
        counter = QueryCounter()
>       event.listen(db_session.sync_session, "before_cursor_execute", counter)

tests/test_query_optimization.py:198: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv_test/lib/python3.9/site-packages/sqlalchemy/event/api.py:121: in listen
    _event_key(target, identifier, fn).listen(*args, **kw)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

target = <sqlalchemy.orm.session.Session object at 0x1098a5f70>
identifier = 'before_cursor_execute'
fn = <tests.test_query_optimization.QueryCounter object at 0x1098a5d60>

    def _event_key(
        target: _ET, identifier: str, fn: _ListenerFnType
    ) -> _EventKey[_ET]:
        for evt_cls in _registrars[identifier]:
            tgt = evt_cls._accept_with(target, identifier)
            if tgt is not None:
                return _EventKey(target, identifier, fn, tgt)
        else:
>           raise exc.InvalidRequestError(
                "No such event '%s' for target '%s'" % (identifier, target)
            )
E           sqlalchemy.exc.InvalidRequestError: No such event 'before_cursor_execute' for target '<sqlalchemy.orm.session.Session object at 0x1098a5f70>'

.venv_test/lib/python3.9/site-packages/sqlalchemy/event/api.py:34: InvalidRequestError
_____________ test_participation_relationships_with_eager_loading ______________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10975a4f0>
sample_participations = <coroutine object sample_participations at 0x1099dd2c0>

    @pytest.mark.asyncio
    async def test_participation_relationships_with_eager_loading(
        db_session: AsyncSession, sample_participations
    ):
        """Test that eager loading prevents N+1 queries for participation.activity."""
>       participations, child_id = sample_participations
E       TypeError: cannot unpack non-iterable coroutine object

tests/test_query_optimization.py:227: TypeError
____________ test_coaching_session_relationships_with_eager_loading ____________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10ab214c0>
sample_coaching_sessions = <coroutine object sample_coaching_sessions at 0x1099dd5c0>

    @pytest.mark.asyncio
    async def test_coaching_session_relationships_with_eager_loading(
        db_session: AsyncSession, sample_coaching_sessions
    ):
        """Test that eager loading prevents N+1 queries for nested coaching relationships."""
>       sessions, child_id = sample_coaching_sessions
E       TypeError: cannot unpack non-iterable coroutine object

tests/test_query_optimization.py:262: TypeError
____________ test_activity_service_get_participations_optimization _____________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109c21f10>
sample_participations = <coroutine object sample_participations at 0x1099dd1c0>

    @pytest.mark.asyncio
    async def test_activity_service_get_participations_optimization(
        db_session: AsyncSession, sample_participations
    ):
        """Test that ActivityService.get_participations_for_child uses eager loading."""
>       _, child_id = sample_participations
E       TypeError: cannot unpack non-iterable coroutine object

tests/test_query_optimization.py:296: TypeError
_______________ test_coaching_service_get_sessions_optimization ________________

db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10a9e3970>
sample_coaching_sessions = <coroutine object sample_coaching_sessions at 0x109ab92c0>

    @pytest.mark.asyncio
    async def test_coaching_service_get_sessions_optimization(
        db_session: AsyncSession, sample_coaching_sessions
    ):
        """Test that CoachingService.get_sessions_for_child uses eager loading."""
>       _, child_id = sample_coaching_sessions
E       TypeError: cannot unpack non-iterable coroutine object

tests/test_query_optimization.py:327: TypeError
______________ TestStorageServiceHelpers.test_is_image_file_jpeg _______________

self = <tests.test_storage.TestStorageServiceHelpers object at 0x1069c20d0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1065b7f40>

    @pytest.mark.asyncio
    async def test_is_image_file_jpeg(
        self,
        db_session: AsyncSession,
    ):
        """Test is_image_file returns True for JPEG."""
>       from app.services.storage_service import StorageService

tests/test_storage.py:219: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______________ TestStorageServiceHelpers.test_is_image_file_png _______________

self = <tests.test_storage.TestStorageServiceHelpers object at 0x1069c2a60>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10912ce50>

    @pytest.mark.asyncio
    async def test_is_image_file_png(
        self,
        db_session: AsyncSession,
    ):
        """Test is_image_file returns True for PNG."""
>       from app.services.storage_service import StorageService

tests/test_storage.py:230: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______________ TestStorageServiceHelpers.test_is_image_file_gif _______________

self = <tests.test_storage.TestStorageServiceHelpers object at 0x1069c2880>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109e66f70>

    @pytest.mark.asyncio
    async def test_is_image_file_gif(
        self,
        db_session: AsyncSession,
    ):
        """Test is_image_file returns True for GIF."""
>       from app.services.storage_service import StorageService

tests/test_storage.py:241: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______________ TestStorageServiceHelpers.test_is_image_file_webp _______________

self = <tests.test_storage.TestStorageServiceHelpers object at 0x1069c2d90>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109c21100>

    @pytest.mark.asyncio
    async def test_is_image_file_webp(
        self,
        db_session: AsyncSession,
    ):
        """Test is_image_file returns True for WebP."""
>       from app.services.storage_service import StorageService

tests/test_storage.py:252: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
____________ TestStorageServiceHelpers.test_is_image_file_pdf_false ____________

self = <tests.test_storage.TestStorageServiceHelpers object at 0x106679280>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10905e250>

    @pytest.mark.asyncio
    async def test_is_image_file_pdf_false(
        self,
        db_session: AsyncSession,
    ):
        """Test is_image_file returns False for PDF."""
>       from app.services.storage_service import StorageService

tests/test_storage.py:263: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___________ TestStorageServiceHelpers.test_is_image_file_text_false ____________

self = <tests.test_storage.TestStorageServiceHelpers object at 0x106679a60>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109be2610>

    @pytest.mark.asyncio
    async def test_is_image_file_text_false(
        self,
        db_session: AsyncSession,
    ):
        """Test is_image_file returns False for text."""
>       from app.services.storage_service import StorageService

tests/test_storage.py:274: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_________ TestStorageServiceQuota.test_get_or_create_quota_creates_new _________

self = <tests.test_storage.TestStorageServiceQuota object at 0x1069c24c0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109fea6a0>

    @pytest.mark.asyncio
    async def test_get_or_create_quota_creates_new(
        self,
        db_session: AsyncSession,
    ):
        """Test get_or_create_quota creates a new quota record."""
>       from app.services.storage_service import StorageService

tests/test_storage.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
___________ TestStorageServiceQuota.test_update_quota_changes_limit ____________

self = <tests.test_storage.TestStorageServiceQuota object at 0x1069c2e80>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x1098ddd60>

    @pytest.mark.asyncio
    async def test_update_quota_changes_limit(
        self,
        db_session: AsyncSession,
    ):
        """Test update_quota changes the quota limit."""
>       from app.services.storage_service import StorageService

tests/test_storage.py:402: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
__________ TestStorageServiceQuota.test_update_quota_rejects_negative __________

self = <tests.test_storage.TestStorageServiceQuota object at 0x106679790>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109b05070>

    @pytest.mark.asyncio
    async def test_update_quota_rejects_negative(
        self,
        db_session: AsyncSession,
    ):
        """Test update_quota rejects negative quota."""
>       from app.services.storage_service import StorageService

tests/test_storage.py:423: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_______ TestStorageServiceSignedUrls.test_verify_local_signed_url_valid ________

self = <tests.test_storage.TestStorageServiceSignedUrls object at 0x106679df0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x107bb7400>

    @pytest.mark.asyncio
    async def test_verify_local_signed_url_valid(
        self,
        db_session: AsyncSession,
    ):
        """Test verify_local_signed_url returns True for valid signature."""
        import base64
        import hashlib
        import hmac
    
        from app.config import settings
>       from app.services.storage_service import StorageService

tests/test_storage.py:450: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______ TestStorageServiceSignedUrls.test_verify_local_signed_url_expired _______

self = <tests.test_storage.TestStorageServiceSignedUrls object at 0x106426e20>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x108ab6d30>

    @pytest.mark.asyncio
    async def test_verify_local_signed_url_expired(
        self,
        db_session: AsyncSession,
    ):
        """Test verify_local_signed_url raises SignedUrlExpiredError for expired URL."""
        import base64
        import hashlib
        import hmac
    
        from app.config import settings
>       from app.services.storage_service import SignedUrlExpiredError, StorageService

tests/test_storage.py:481: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_ TestStorageServiceSignedUrls.test_verify_local_signed_url_invalid_signature __

self = <tests.test_storage.TestStorageServiceSignedUrls object at 0x106426fd0>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x108529b20>

    @pytest.mark.asyncio
    async def test_verify_local_signed_url_invalid_signature(
        self,
        db_session: AsyncSession,
    ):
        """Test verify_local_signed_url raises SignedUrlInvalidError for invalid signature."""
>       from app.services.storage_service import SignedUrlInvalidError, StorageService

tests/test_storage.py:507: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
______________ TestStorageServiceConversion.test_file_to_response ______________

self = <tests.test_storage.TestStorageServiceConversion object at 0x106426880>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x109fecfa0>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')

    @pytest.mark.asyncio
    async def test_file_to_response(
        self,
        db_session: AsyncSession,
        test_user_id,
    ):
        """Test file_to_response converts File model to FileResponse."""
        from app.models.storage import File, StorageBackend
>       from app.services.storage_service import StorageService

tests/test_storage.py:560: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
_____________ TestStorageServiceConversion.test_quota_to_response ______________

self = <tests.test_storage.TestStorageServiceConversion object at 0x106426550>
db_session = <sqlalchemy.orm.session.AsyncSession object at 0x10a9e38b0>
test_user_id = UUID('12345678-1234-1234-1234-123456789abc')

    @pytest.mark.asyncio
    async def test_quota_to_response(
        self,
        db_session: AsyncSession,
        test_user_id,
    ):
        """Test quota_to_response converts StorageQuota model to response."""
        from app.models.storage import StorageQuota
>       from app.services.storage_service import StorageService

tests/test_storage.py:599: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    """Storage service for LAYA AI Service.
    
    Provides business logic for file upload, storage, and management.
    Implements local filesystem and S3 backend support with thumbnail generation.
    """
    
    import asyncio
    import base64
    import hashlib
    import hmac
    import io
    import os
    import secrets
    import shutil
    from concurrent.futures import ThreadPoolExecutor
    from datetime import datetime, timedelta, timezone
    from functools import partial
    from pathlib import Path
    from typing import Optional
    from urllib.parse import urlencode
    from uuid import UUID, uuid4
    
>   import boto3
E   ModuleNotFoundError: No module named 'boto3'

app/services/storage_service.py:23: ModuleNotFoundError
=============================== warnings summary ===============================
app/config.py:9
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/app/config.py:9: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class Settings(BaseSettings):

app/auth/audit_logger.py:26
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/app/auth/audit_logger.py:26: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TokenVerificationEvent(BaseModel):

app/schemas/batch.py:65
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/app/schemas/batch.py:65: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    ids: list[UUID] = Field(

app/schemas/batch.py:65
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/app/schemas/batch.py:65: PydanticDeprecatedSince20: `max_items` is deprecated and will be removed, use `max_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    ids: list[UUID] = Field(

app/schemas/batch.py:173
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/app/schemas/batch.py:173: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    child_ids: list[UUID] = Field(

app/schemas/batch.py:173
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/app/schemas/batch.py:173: PydanticDeprecatedSince20: `max_items` is deprecated and will be removed, use `max_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    child_ids: list[UUID] = Field(

app/schemas/batch.py:282
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/app/schemas/batch.py:282: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    items: list[BatchCreateItem] = Field(

app/schemas/batch.py:282
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/app/schemas/batch.py:282: PydanticDeprecatedSince20: `max_items` is deprecated and will be removed, use `max_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    items: list[BatchCreateItem] = Field(

tests/test_makefile_commands.py:210
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_makefile_commands.py:210: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests/test_makefile_commands.py:224
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_makefile_commands.py:224: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests/test_makefile_commands.py:225
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/tests/test_makefile_commands.py:225: PytestUnknownMarkWarning: Unknown pytest.mark.slow - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.slow

tests/auth/test_dependencies.py::TestGetCurrentUser::test_get_current_user_wrong_signature
tests/auth/test_jwt.py::TestDecodeToken::test_decode_token_wrong_signature_raises_401
tests/test_jwt_secret_config.py::TestJWTSecretConfiguration::test_jwt_token_signed_with_different_secret_fails_verification
tests/test_middleware_auth.py::test_token_with_wrong_secret_raises_exception
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/jwt/api_jwt.py:153: InsecureKeyLengthWarning: The HMAC key is 16 bytes long, which is below the minimum recommended length of 32 bytes for SHA256. See RFC 7518 Section 3.2.
    return self._jws.encode(

tests/auth/test_service.py::TestLogout::test_logout_success_access_token_only
tests/auth/test_service.py::TestLogout::test_logout_success_both_tokens
tests/auth/test_service.py::TestLogout::test_logout_ignores_invalid_refresh_token
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/app/auth/service.py:320: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    self.db.add(access_blacklist)
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/auth/test_service.py::TestLogout::test_logout_success_both_tokens
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/app/auth/service.py:337: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    self.db.add(refresh_blacklist)
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/auth/test_service.py::TestRequestPasswordReset::test_request_password_reset_existing_user
tests/auth/test_service.py::TestRequestPasswordReset::test_request_password_reset_email_masking
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/app/auth/service.py:397: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    self.db.add(password_reset)
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/test_auth_audit_logger.py::TestTokenAuditLogger::test_log_verification_success
tests/test_auth_audit_logger.py::TestAuditLoggerIntegration::test_full_success_flow
tests/test_auth_audit_logger.py::TestAuditLoggerIntegration::test_gibbon_token_flow
tests/test_middleware_auth.py::test_verify_ai_service_token
tests/test_middleware_auth.py::test_verify_gibbon_token
tests/test_middleware_auth.py::test_verify_token_accepts_unknown_source
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/app/auth/audit_logger.py:118: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    "event": event.dict(exclude_none=True),

tests/test_auth_audit_logger.py::TestTokenAuditLogger::test_log_verification_failed
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/app/auth/audit_logger.py:157: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    "event": event.dict(exclude_none=True),

tests/test_auth_audit_logger.py::TestTokenAuditLogger::test_log_token_expired
tests/test_auth_audit_logger.py::TestAuditLoggerIntegration::test_full_failure_flow
tests/test_middleware_auth.py::test_expired_token_raises_exception
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/app/auth/audit_logger.py:197: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    "event": event.dict(exclude_none=True),

tests/test_auth_audit_logger.py::TestTokenAuditLogger::test_log_invalid_token
tests/test_auth_audit_logger.py::TestAuditLoggerIntegration::test_full_failure_flow
tests/test_middleware_auth.py::test_invalid_token_raises_exception
tests/test_middleware_auth.py::test_token_with_wrong_secret_raises_exception
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/app/auth/audit_logger.py:231: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    "event": event.dict(exclude_none=True),

tests/test_auth_audit_logger.py::TestTokenAuditLogger::test_log_missing_claims
tests/test_middleware_auth.py::test_token_without_sub_raises_exception
tests/test_middleware_auth.py::test_gibbon_token_without_username_raises_exception
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/app/auth/audit_logger.py:269: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    "event": event.dict(exclude_none=True),

tests/test_migration_verification.py: 27 warnings
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/alembic/config.py:598: DeprecationWarning: No path_separator found in configuration; falling back to legacy splitting on spaces, commas, and colons for prepend_sys_path.  Consider adding path_separator=os to Alembic config.
    util.warn_deprecated(

tests/test_query_optimization.py::test_activity_relationships_without_eager_loading
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/_pytest/fixtures.py:1182: PytestRemovedIn9Warning: 'test_activity_relationships_without_eager_loading' requested an async fixture 'sample_activities', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/test_query_optimization.py::test_activity_relationships_without_eager_loading
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/_pytest/fixtures.py:1182: PytestRemovedIn9Warning: 'test_activity_relationships_without_eager_loading' requested an async fixture 'sample_recommendations', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/test_query_optimization.py::test_activity_relationships_without_eager_loading
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:678: PytestDeprecationWarning: asyncio test 'test_activity_relationships_without_eager_loading' requested async @pytest.fixture 'sample_activities' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/test_query_optimization.py::test_activity_relationships_without_eager_loading
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:678: PytestDeprecationWarning: asyncio test 'test_activity_relationships_without_eager_loading' requested async @pytest.fixture 'sample_recommendations' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/test_query_optimization.py::test_activity_relationships_with_eager_loading
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/_pytest/fixtures.py:1182: PytestRemovedIn9Warning: 'test_activity_relationships_with_eager_loading' requested an async fixture 'sample_activities', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/test_query_optimization.py::test_activity_relationships_with_eager_loading
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/_pytest/fixtures.py:1182: PytestRemovedIn9Warning: 'test_activity_relationships_with_eager_loading' requested an async fixture 'sample_recommendations', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/test_query_optimization.py::test_activity_relationships_with_eager_loading
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:678: PytestDeprecationWarning: asyncio test 'test_activity_relationships_with_eager_loading' requested async @pytest.fixture 'sample_activities' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/test_query_optimization.py::test_activity_relationships_with_eager_loading
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:678: PytestDeprecationWarning: asyncio test 'test_activity_relationships_with_eager_loading' requested async @pytest.fixture 'sample_recommendations' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/test_query_optimization.py::test_participation_relationships_with_eager_loading
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/_pytest/fixtures.py:1182: PytestRemovedIn9Warning: 'test_participation_relationships_with_eager_loading' requested an async fixture 'sample_activities', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/test_query_optimization.py::test_participation_relationships_with_eager_loading
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/_pytest/fixtures.py:1182: PytestRemovedIn9Warning: 'test_participation_relationships_with_eager_loading' requested an async fixture 'sample_participations', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/test_query_optimization.py::test_participation_relationships_with_eager_loading
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:678: PytestDeprecationWarning: asyncio test 'test_participation_relationships_with_eager_loading' requested async @pytest.fixture 'sample_participations' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/test_query_optimization.py::test_participation_relationships_with_eager_loading
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:678: PytestDeprecationWarning: asyncio test 'test_participation_relationships_with_eager_loading' requested async @pytest.fixture 'sample_activities' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/test_query_optimization.py::test_coaching_session_relationships_with_eager_loading
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/_pytest/fixtures.py:1182: PytestRemovedIn9Warning: 'test_coaching_session_relationships_with_eager_loading' requested an async fixture 'sample_coaching_sessions', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/test_query_optimization.py::test_coaching_session_relationships_with_eager_loading
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:678: PytestDeprecationWarning: asyncio test 'test_coaching_session_relationships_with_eager_loading' requested async @pytest.fixture 'sample_coaching_sessions' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/test_query_optimization.py::test_activity_service_get_participations_optimization
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/_pytest/fixtures.py:1182: PytestRemovedIn9Warning: 'test_activity_service_get_participations_optimization' requested an async fixture 'sample_activities', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/test_query_optimization.py::test_activity_service_get_participations_optimization
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/_pytest/fixtures.py:1182: PytestRemovedIn9Warning: 'test_activity_service_get_participations_optimization' requested an async fixture 'sample_participations', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/test_query_optimization.py::test_activity_service_get_participations_optimization
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:678: PytestDeprecationWarning: asyncio test 'test_activity_service_get_participations_optimization' requested async @pytest.fixture 'sample_participations' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/test_query_optimization.py::test_activity_service_get_participations_optimization
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:678: PytestDeprecationWarning: asyncio test 'test_activity_service_get_participations_optimization' requested async @pytest.fixture 'sample_activities' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/test_query_optimization.py::test_coaching_service_get_sessions_optimization
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/_pytest/fixtures.py:1182: PytestRemovedIn9Warning: 'test_coaching_service_get_sessions_optimization' requested an async fixture 'sample_coaching_sessions', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/test_query_optimization.py::test_coaching_service_get_sessions_optimization
  /Users/Koldan/Documents/Abdelkefi Education/Dev/laya-backbone/.auto-claude/worktrees/tasks/087-fix-idor-7-endpoints/ai-service/.venv_test/lib/python3.9/site-packages/pytest_asyncio/plugin.py:678: PytestDeprecationWarning: asyncio test 'test_coaching_service_get_sessions_optimization' requested async @pytest.fixture 'sample_coaching_sessions' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/test_review_reminders.py::test_get_plans_for_review_mixed_overdue_and_upcoming
  /Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/unittest/mock.py:2059: RuntimeWarning: coroutine 'sample_coaching_sessions' was never awaited
    setattr(_type, entry, MagicProxy(entry, self))
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/test_review_reminders.py::test_get_plans_for_review_same_child_multiple_plans
  /Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/unittest/mock.py:2043: RuntimeWarning: coroutine 'sample_activities' was never awaited
    if getattr(self, "_mock_methods", None) is not None:
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/test_review_reminders.py::test_get_plans_for_review_same_child_multiple_plans
  /Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/unittest/mock.py:2043: RuntimeWarning: coroutine 'sample_recommendations' was never awaited
    if getattr(self, "_mock_methods", None) is not None:
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/test_review_reminders.py::test_get_plans_for_review_same_child_multiple_plans
  /Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/unittest/mock.py:2043: RuntimeWarning: coroutine 'sample_participations' was never awaited
    if getattr(self, "_mock_methods", None) is not None:
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/auth/test_security.py::TestHashPassword::test_hash_password_returns_string
FAILED tests/auth/test_security.py::TestHashPassword::test_hash_password_returns_bcrypt_hash
FAILED tests/auth/test_security.py::TestHashPassword::test_hash_password_different_passwords_produce_different_hashes
FAILED tests/auth/test_security.py::TestHashPassword::test_hash_password_same_password_different_hashes
FAILED tests/auth/test_security.py::TestHashPassword::test_hash_password_empty_string
FAILED tests/auth/test_security.py::TestHashPassword::test_hash_password_special_characters
FAILED tests/auth/test_security.py::TestHashPassword::test_hash_password_unicode_characters
FAILED tests/auth/test_security.py::TestHashPassword::test_hash_password_long_password
FAILED tests/auth/test_security.py::TestHashPassword::test_hash_password_hash_length
FAILED tests/auth/test_security.py::TestVerifyPassword::test_verify_password_correct_password
FAILED tests/auth/test_security.py::TestVerifyPassword::test_verify_password_incorrect_password
FAILED tests/auth/test_security.py::TestVerifyPassword::test_verify_password_empty_password_mismatch
FAILED tests/auth/test_security.py::TestVerifyPassword::test_verify_password_empty_password_match
FAILED tests/auth/test_security.py::TestVerifyPassword::test_verify_password_case_sensitive
FAILED tests/auth/test_security.py::TestVerifyPassword::test_verify_password_special_characters
FAILED tests/auth/test_security.py::TestVerifyPassword::test_verify_password_unicode_characters
FAILED tests/auth/test_security.py::TestVerifyPassword::test_verify_password_whitespace_significant
FAILED tests/auth/test_security.py::TestVerifyPassword::test_verify_password_with_precomputed_hash
FAILED tests/auth/test_security.py::TestSecurityIntegration::test_password_roundtrip
FAILED tests/auth/test_security.py::TestSecurityIntegration::test_token_vs_password_hashing
FAILED tests/auth/test_security.py::TestSecurityIntegration::test_hash_formats_are_different
FAILED tests/auth/test_service.py::TestAuthServiceIntegration::test_all_user_roles_can_login
FAILED tests/test_auth_audit_logger.py::TestHelperFunctions::test_get_client_ip_no_client
FAILED tests/test_auth_audit_logger.py::TestHelperFunctions::test_get_endpoint_no_url
FAILED tests/test_auth_endpoints.py::test_password_not_stored_plaintext - Val...
FAILED tests/test_development_profile_authorization.py::TestDevelopmentProfileAuthorization::test_update_profile_authorized
FAILED tests/test_development_profile_authorization.py::TestSkillAssessmentAuthorization::test_update_skill_assessment_authorized
FAILED tests/test_development_profile_authorization.py::TestObservationAuthorization::test_update_observation_authorized
FAILED tests/test_development_profile_authorization.py::TestMonthlySnapshotAuthorization::test_update_monthly_snapshot_authorized
FAILED tests/test_development_profile_authorization.py::TestGrowthTrajectoryAuthorization::test_get_growth_trajectory_authorized
FAILED tests/test_document_service.py::test_get_template_by_id - assert None ...
FAILED tests/test_document_service.py::test_list_templates_pagination - Attri...
FAILED tests/test_document_service.py::test_update_template_increments_version
FAILED tests/test_document_service.py::test_delete_template - assert False is...
FAILED tests/test_document_service.py::test_create_document_from_template - T...
FAILED tests/test_document_service.py::test_get_document_by_id - TypeError: g...
FAILED tests/test_document_service.py::test_list_documents_with_filters - Att...
FAILED tests/test_document_service.py::test_create_signature_updates_document_status
FAILED tests/test_document_service.py::test_get_signatures_for_document - Typ...
FAILED tests/test_document_service.py::test_send_signature_request - TypeErro...
FAILED tests/test_document_service.py::test_mark_request_viewed - TypeError: ...
FAILED tests/test_document_service.py::test_complete_signature_request_flow
FAILED tests/test_document_service.py::test_get_signature_dashboard - Attribu...
FAILED tests/test_document_service.py::test_create_audit_log - TypeError: cre...
FAILED tests/test_document_service.py::test_signature_creates_audit_log - Typ...
FAILED tests/test_llm_providers.py::TestOpenAIProvider::test_is_available_without_api_key
FAILED tests/test_llm_providers.py::TestOpenAIProvider::test_is_available_with_empty_api_key
FAILED tests/test_llm_providers.py::TestOpenAIProvider::test_get_default_config
FAILED tests/test_llm_providers.py::TestOpenAIProvider::test_complete_success
FAILED tests/test_llm_providers.py::TestOpenAIProvider::test_complete_with_custom_config
FAILED tests/test_llm_providers.py::TestOpenAIProvider::test_complete_authentication_error
FAILED tests/test_llm_providers.py::TestOpenAIProvider::test_complete_rate_limit_error
FAILED tests/test_llm_providers.py::TestOpenAIProvider::test_complete_provider_error_400
FAILED tests/test_llm_providers.py::TestOpenAIProvider::test_complete_provider_error_500
FAILED tests/test_llm_providers.py::TestOpenAIProvider::test_complete_timeout_error
FAILED tests/test_llm_providers.py::TestOpenAIProvider::test_complete_http_error
FAILED tests/test_llm_providers.py::TestOpenAIProvider::test_complete_without_api_key
FAILED tests/test_llm_providers.py::TestOpenAIProvider::test_complete_no_choices_in_response
FAILED tests/test_llm_providers.py::TestAnthropicProvider::test_is_available_without_api_key
FAILED tests/test_llm_providers.py::TestAnthropicProvider::test_is_available_with_empty_api_key
FAILED tests/test_llm_providers.py::TestAnthropicProvider::test_get_default_config
FAILED tests/test_llm_providers.py::TestAnthropicProvider::test_complete_success
FAILED tests/test_llm_providers.py::TestAnthropicProvider::test_complete_with_system_message
FAILED tests/test_llm_providers.py::TestAnthropicProvider::test_complete_authentication_error
FAILED tests/test_llm_providers.py::TestAnthropicProvider::test_complete_rate_limit_error
FAILED tests/test_llm_providers.py::TestAnthropicProvider::test_complete_provider_error_400
FAILED tests/test_llm_providers.py::TestAnthropicProvider::test_complete_provider_error_500
FAILED tests/test_llm_providers.py::TestAnthropicProvider::test_complete_timeout_error
FAILED tests/test_llm_providers.py::TestAnthropicProvider::test_complete_http_error
FAILED tests/test_llm_providers.py::TestAnthropicProvider::test_complete_without_api_key
FAILED tests/test_llm_providers.py::TestAnthropicProvider::test_complete_no_content_in_response
FAILED tests/test_llm_token_client.py::TestLLMClientCompletion::test_complete_success
FAILED tests/test_llm_token_client.py::TestLLMClientCompletion::test_complete_no_providers_raises
FAILED tests/test_llm_token_client.py::TestLLMClientCompletion::test_complete_with_cache_hit
FAILED tests/test_llm_token_client.py::TestLLMClientCompletion::test_complete_with_cache_miss
FAILED tests/test_llm_token_client.py::TestLLMClientCompletion::test_complete_with_error
FAILED tests/test_llm_token_client.py::TestLLMClientStreaming::test_complete_stream_success
FAILED tests/test_llm_token_client.py::TestLLMClientStreaming::test_complete_stream_no_providers
FAILED tests/test_message_quality.py::TestPositiveMessageRecognition::test_positive_message_has_structural_elements
FAILED tests/test_message_quality.py::TestRewriteSandwichMethodStructure::test_rewrite_handles_empty_message_gracefully
FAILED tests/test_message_quality.py::TestBilingualSupport::test_french_suggestion_text_in_french
FAILED tests/test_message_quality.py::TestBilingualSupport::test_french_structural_elements_detected
FAILED tests/test_message_quality.py::TestErrorHandling::test_empty_message_raises_invalid_message_error
FAILED tests/test_message_quality.py::TestErrorHandling::test_whitespace_only_message_raises_error
FAILED tests/test_messaging.py::TestMessagingServiceThreads::test_create_thread_returns_valid_response
FAILED tests/test_messaging.py::TestMessagingServiceThreads::test_create_thread_adds_creator_as_participant
FAILED tests/test_messaging.py::TestMessagingServiceThreads::test_get_thread_not_found_raises_error
FAILED tests/test_messaging.py::TestMessagingServiceThreads::test_list_threads_excludes_archived_by_default
FAILED tests/test_messaging.py::TestMessagingServiceMessages::test_send_message_to_archived_thread_raises_error
FAILED tests/test_messaging.py::TestMessagingServiceMessages::test_get_message_not_found_raises_error
FAILED tests/test_messaging.py::TestMessagingServiceNotifications::test_create_notification_preference_success
FAILED tests/test_messaging.py::TestMessagingServiceNotifications::test_get_notification_preferences_returns_all
FAILED tests/test_messaging.py::TestMessagingServiceNotifications::test_get_notification_preference_not_found_raises_error
FAILED tests/test_messaging.py::TestMessagingServiceNotifications::test_get_or_create_default_preferences
FAILED tests/test_messaging.py::TestMessagingServiceNotifications::test_set_quiet_hours_updates_all_preferences
FAILED tests/test_messaging.py::TestMessagingServiceNotifications::test_is_notification_enabled_defaults_to_true
FAILED tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_step1_admin_initiates_mfa_setup
FAILED tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_step2_qr_code_and_secret_stored
FAILED tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_step3_user_verifies_totp_to_enable_mfa
FAILED tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_step3_invalid_code_rejected
FAILED tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_step4_subsequent_logins_require_totp
FAILED tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_step5_backup_codes_generated_and_used
FAILED tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_step6_ip_whitelist_bypasses_mfa
FAILED tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_lockout_and_recovery
FAILED tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_disable_mfa - sql...
FAILED tests/test_mfa_e2e.py::TestMFAEndToEndFlow::test_e2e_complete_flow - s...
FAILED tests/test_mfa_e2e.py::TestMFASecurityFeatures::test_totp_time_window_tolerance
FAILED tests/test_mfa_e2e.py::TestMFASecurityFeatures::test_backup_code_hashing
FAILED tests/test_mfa_e2e.py::TestMFASecurityFeatures::test_mfa_not_bypassed_without_whitelist
FAILED tests/test_mfa_service.py::TestMFASettingsModel::test_create_mfa_settings
FAILED tests/test_mfa_service.py::TestMFASettingsModel::test_mfa_settings_repr
FAILED tests/test_mfa_service.py::TestMFASettingsModel::test_mfa_settings_default_values
FAILED tests/test_mfa_service.py::TestMFABackupCodeModel::test_create_backup_code
FAILED tests/test_mfa_service.py::TestMFABackupCodeModel::test_backup_code_repr
FAILED tests/test_mfa_service.py::TestMFAIPWhitelistModel::test_create_ip_whitelist_entry
FAILED tests/test_mfa_service.py::TestMFAIPWhitelistModel::test_ip_whitelist_repr
FAILED tests/test_mfa_service.py::TestMFAServiceStatus::test_get_status_no_mfa_setup
FAILED tests/test_mfa_service.py::TestMFAServiceSetup::test_initiate_setup_generates_secret
FAILED tests/test_mfa_service.py::TestMFAServiceSetup::test_initiate_setup_with_recovery_email
FAILED tests/test_mfa_service.py::TestMFAServiceVerifyTOTP::test_verify_totp_raises_when_no_settings
FAILED tests/test_mfa_service.py::TestMFAServiceEnableDisable::test_enable_mfa_with_valid_code
FAILED tests/test_mfa_service.py::TestMFAServiceEnableDisable::test_enable_mfa_fails_with_invalid_code
FAILED tests/test_mfa_service.py::TestMFAServiceEnableDisable::test_disable_mfa_raises_when_not_enabled
FAILED tests/test_mfa_service.py::TestMFAServiceLockout::test_reset_lockout_returns_false_for_nonexistent_user
FAILED tests/test_mfa_service.py::TestMFAServiceBackupCodes::test_generate_backup_codes_requires_mfa_enabled
FAILED tests/test_mfa_service.py::TestMFAServiceIPWhitelist::test_ip_whitelist_requires_mfa_enabled
FAILED tests/test_mfa_service.py::TestMFAServiceEdgeCases::test_check_ip_whitelisted_no_mfa
FAILED tests/test_query_optimization.py::test_activity_relationships_without_eager_loading
FAILED tests/test_query_optimization.py::test_activity_relationships_with_eager_loading
FAILED tests/test_query_optimization.py::test_participation_relationships_with_eager_loading
FAILED tests/test_query_optimization.py::test_coaching_session_relationships_with_eager_loading
FAILED tests/test_query_optimization.py::test_activity_service_get_participations_optimization
FAILED tests/test_query_optimization.py::test_coaching_service_get_sessions_optimization
FAILED tests/test_storage.py::TestStorageServiceHelpers::test_is_image_file_jpeg
FAILED tests/test_storage.py::TestStorageServiceHelpers::test_is_image_file_png
FAILED tests/test_storage.py::TestStorageServiceHelpers::test_is_image_file_gif
FAILED tests/test_storage.py::TestStorageServiceHelpers::test_is_image_file_webp
FAILED tests/test_storage.py::TestStorageServiceHelpers::test_is_image_file_pdf_false
FAILED tests/test_storage.py::TestStorageServiceHelpers::test_is_image_file_text_false
FAILED tests/test_storage.py::TestStorageServiceQuota::test_get_or_create_quota_creates_new
FAILED tests/test_storage.py::TestStorageServiceQuota::test_update_quota_changes_limit
FAILED tests/test_storage.py::TestStorageServiceQuota::test_update_quota_rejects_negative
FAILED tests/test_storage.py::TestStorageServiceSignedUrls::test_verify_local_signed_url_valid
FAILED tests/test_storage.py::TestStorageServiceSignedUrls::test_verify_local_signed_url_expired
FAILED tests/test_storage.py::TestStorageServiceSignedUrls::test_verify_local_signed_url_invalid_signature
FAILED tests/test_storage.py::TestStorageServiceConversion::test_file_to_response
FAILED tests/test_storage.py::TestStorageServiceConversion::test_quota_to_response
ERROR ai-service/tests/test_idor_protection_integration.py::TestDocumentIDORProtection::test_get_document_by_id_idor_protection
ERROR ai-service/tests/test_idor_protection_integration.py::TestDocumentIDORProtection::test_update_document_idor_protection
ERROR ai-service/tests/test_idor_protection_integration.py::TestDocumentIDORProtection::test_document_access_isolation_between_users
ERROR ai-service/tests/test_idor_protection_integration.py::TestDocumentIDORProtection::test_cross_resource_idor_protection
ERROR tests/auth/test_routes.py::TestLoginEndpoint::test_login_success - Modu...
ERROR tests/auth/test_routes.py::TestLoginEndpoint::test_login_wrong_password
ERROR tests/auth/test_routes.py::TestLoginEndpoint::test_login_nonexistent_user
ERROR tests/auth/test_routes.py::TestLoginEndpoint::test_login_inactive_user
ERROR tests/auth/test_routes.py::TestLoginEndpoint::test_login_missing_email
ERROR tests/auth/test_routes.py::TestLoginEndpoint::test_login_missing_password
ERROR tests/auth/test_routes.py::TestLoginEndpoint::test_login_invalid_email_format
ERROR tests/auth/test_routes.py::TestLoginEndpoint::test_login_empty_password
ERROR tests/auth/test_routes.py::TestLoginEndpoint::test_login_all_roles - Mo...
ERROR tests/auth/test_routes.py::TestRefreshEndpoint::test_refresh_success - ...
ERROR tests/auth/test_routes.py::TestRefreshEndpoint::test_refresh_with_access_token_fails
ERROR tests/auth/test_routes.py::TestRefreshEndpoint::test_refresh_expired_token
ERROR tests/auth/test_routes.py::TestRefreshEndpoint::test_refresh_invalid_token
ERROR tests/auth/test_routes.py::TestRefreshEndpoint::test_refresh_blacklisted_token
ERROR tests/auth/test_routes.py::TestRefreshEndpoint::test_refresh_nonexistent_user
ERROR tests/auth/test_routes.py::TestRefreshEndpoint::test_refresh_inactive_user
ERROR tests/auth/test_routes.py::TestRefreshEndpoint::test_refresh_missing_token
ERROR tests/auth/test_routes.py::TestLogoutEndpoint::test_logout_success_access_only
ERROR tests/auth/test_routes.py::TestLogoutEndpoint::test_logout_success_both_tokens
ERROR tests/auth/test_routes.py::TestLogoutEndpoint::test_logout_invalid_access_token
ERROR tests/auth/test_routes.py::TestLogoutEndpoint::test_logout_refresh_as_access_fails
ERROR tests/auth/test_routes.py::TestLogoutEndpoint::test_logout_missing_access_token
ERROR tests/auth/test_routes.py::TestLogoutEndpoint::test_logout_expired_access_token
ERROR tests/auth/test_routes.py::TestLogoutEndpoint::test_logout_ignores_invalid_refresh
ERROR tests/auth/test_routes.py::TestPasswordResetRequestEndpoint::test_password_reset_request_existing_user
ERROR tests/auth/test_routes.py::TestPasswordResetRequestEndpoint::test_password_reset_request_nonexistent_user
ERROR tests/auth/test_routes.py::TestPasswordResetRequestEndpoint::test_password_reset_request_inactive_user
ERROR tests/auth/test_routes.py::TestPasswordResetRequestEndpoint::test_password_reset_request_missing_email
ERROR tests/auth/test_routes.py::TestPasswordResetRequestEndpoint::test_password_reset_request_invalid_email
ERROR tests/auth/test_routes.py::TestPasswordResetRequestEndpoint::test_password_reset_email_masking
ERROR tests/auth/test_routes.py::TestPasswordResetConfirmEndpoint::test_password_reset_confirm_success
ERROR tests/auth/test_routes.py::TestPasswordResetConfirmEndpoint::test_password_reset_confirm_invalid_token
ERROR tests/auth/test_routes.py::TestPasswordResetConfirmEndpoint::test_password_reset_confirm_used_token
ERROR tests/auth/test_routes.py::TestPasswordResetConfirmEndpoint::test_password_reset_confirm_expired_token
ERROR tests/auth/test_routes.py::TestPasswordResetConfirmEndpoint::test_password_reset_confirm_missing_token
ERROR tests/auth/test_routes.py::TestPasswordResetConfirmEndpoint::test_password_reset_confirm_missing_password
ERROR tests/auth/test_routes.py::TestPasswordResetConfirmEndpoint::test_password_reset_confirm_empty_password
ERROR tests/auth/test_routes.py::TestGetMeEndpoint::test_get_me_success - Mod...
ERROR tests/auth/test_routes.py::TestGetMeEndpoint::test_get_me_admin - Modul...
ERROR tests/auth/test_routes.py::TestGetMeEndpoint::test_get_me_no_token - Mo...
ERROR tests/auth/test_routes.py::TestGetMeEndpoint::test_get_me_invalid_token
ERROR tests/auth/test_routes.py::TestGetMeEndpoint::test_get_me_expired_token
ERROR tests/auth/test_routes.py::TestGetMeEndpoint::test_get_me_blacklisted_token
ERROR tests/auth/test_routes.py::TestAdminTestEndpoint::test_admin_endpoint_with_admin
ERROR tests/auth/test_routes.py::TestAdminTestEndpoint::test_admin_endpoint_with_teacher_forbidden
ERROR tests/auth/test_routes.py::TestAdminTestEndpoint::test_admin_endpoint_with_parent_forbidden
ERROR tests/auth/test_routes.py::TestAdminTestEndpoint::test_admin_endpoint_with_accountant_forbidden
ERROR tests/auth/test_routes.py::TestAdminTestEndpoint::test_admin_endpoint_no_token
ERROR tests/auth/test_routes.py::TestFinancialTestEndpoint::test_financial_endpoint_with_admin
ERROR tests/auth/test_routes.py::TestFinancialTestEndpoint::test_financial_endpoint_with_accountant
ERROR tests/auth/test_routes.py::TestFinancialTestEndpoint::test_financial_endpoint_with_teacher_forbidden
ERROR tests/auth/test_routes.py::TestFinancialTestEndpoint::test_financial_endpoint_with_parent_forbidden
ERROR tests/auth/test_routes.py::TestFinancialTestEndpoint::test_financial_endpoint_no_token
ERROR tests/auth/test_routes.py::TestAuthFlowIntegration::test_login_then_access_protected_endpoint
ERROR tests/auth/test_routes.py::TestAuthFlowIntegration::test_login_logout_then_access_fails
ERROR tests/auth/test_routes.py::TestAuthFlowIntegration::test_login_refresh_then_access
ERROR tests/auth/test_routes.py::TestAuthFlowIntegration::test_admin_login_access_admin_endpoint
ERROR tests/auth/test_routes.py::TestAuthFlowIntegration::test_password_reset_flow
ERROR tests/auth/test_routes.py::TestAuthFlowIntegration::test_teacher_cannot_access_admin_endpoint
ERROR tests/auth/test_routes.py::TestSecurityEdgeCases::test_sql_injection_in_email
ERROR tests/auth/test_routes.py::TestSecurityEdgeCases::test_very_long_password
ERROR tests/auth/test_routes.py::TestSecurityEdgeCases::test_unicode_in_password
ERROR tests/auth/test_routes.py::TestSecurityEdgeCases::test_case_sensitivity_email
ERROR tests/auth/test_routes.py::TestSecurityEdgeCases::test_token_tampering
ERROR tests/auth/test_routes.py::TestSecurityEdgeCases::test_malformed_authorization_header
ERROR tests/auth/test_routes.py::TestSecurityEdgeCases::test_empty_authorization_header
ERROR tests/auth/test_routes.py::TestSecurityEdgeCases::test_bearer_only_no_token
ERROR tests/auth/test_routes.py::TestSecurityEdgeCases::test_multiple_rapid_login_attempts
ERROR tests/auth/test_service.py::TestAuthenticateUser::test_authenticate_user_success
ERROR tests/auth/test_service.py::TestAuthenticateUser::test_authenticate_user_wrong_password
ERROR tests/auth/test_service.py::TestAuthenticateUser::test_authenticate_user_inactive_user
ERROR tests/auth/test_service.py::TestLogin::test_login_success - ValueError:...
ERROR tests/auth/test_service.py::TestLogin::test_login_wrong_password_raises_401
ERROR tests/auth/test_service.py::TestLogin::test_login_inactive_user_raises_401
ERROR tests/auth/test_service.py::TestLogin::test_login_access_token_contains_user_info
ERROR tests/auth/test_service.py::TestLogin::test_login_refresh_token_has_correct_type
ERROR tests/auth/test_service.py::TestConfirmPasswordReset::test_confirm_password_reset_success
ERROR tests/auth/test_service.py::TestConfirmPasswordReset::test_confirm_password_reset_already_used
ERROR tests/auth/test_service.py::TestConfirmPasswordReset::test_confirm_password_reset_expired_token
ERROR tests/auth/test_service.py::TestAuthServiceIntegration::test_login_logout_flow
ERROR tests/auth/test_service.py::TestAuthServiceIntegration::test_login_refresh_flow
ERROR tests/test_activities.py::TestRecommendationsEndpoint::test_recommendations_endpoint_returns_200
ERROR tests/test_activities.py::TestRecommendationsEndpoint::test_recommendations_endpoint_requires_auth
ERROR tests/test_activities.py::TestRecommendationsEndpoint::test_recommendations_endpoint_with_parameters
ERROR tests/test_activities.py::TestRecommendationsEndpoint::test_recommendations_endpoint_validates_max_recommendations
ERROR tests/test_activities.py::TestRecommendationsEndpoint::test_recommendations_endpoint_validates_age_range
ERROR tests/test_activities.py::TestGetActivityEndpoint::test_get_activity_returns_200
ERROR tests/test_activities.py::TestGetActivityEndpoint::test_get_activity_requires_auth
ERROR tests/test_activities.py::TestGetActivityEndpoint::test_get_activity_not_found
ERROR tests/test_activities.py::TestListActivitiesEndpoint::test_list_activities_returns_200
ERROR tests/test_activities.py::TestListActivitiesEndpoint::test_list_activities_requires_auth
ERROR tests/test_activities.py::TestListActivitiesEndpoint::test_list_activities_pagination
ERROR tests/test_activities.py::TestListActivitiesEndpoint::test_list_activities_type_filter
ERROR tests/test_activities.py::TestEdgeCases::test_invalid_uuid_format - Mod...
ERROR tests/test_activities.py::TestEdgeCases::test_invalid_activity_type_filter
ERROR tests/test_activities.py::TestEdgeCases::test_negative_group_size_rejected
ERROR tests/test_auth_endpoints.py::test_login_success - ModuleNotFoundError:...
ERROR tests/test_auth_endpoints.py::test_login_invalid_email - ModuleNotFound...
ERROR tests/test_auth_endpoints.py::test_login_invalid_password - ModuleNotFo...
ERROR tests/test_auth_endpoints.py::test_login_inactive_user - ModuleNotFound...
ERROR tests/test_auth_endpoints.py::test_refresh_valid_token - ModuleNotFound...
ERROR tests/test_auth_endpoints.py::test_refresh_invalid_token - ModuleNotFou...
ERROR tests/test_auth_endpoints.py::test_refresh_expired_token - ModuleNotFou...
ERROR tests/test_auth_endpoints.py::test_refresh_with_access_token - ModuleNo...
ERROR tests/test_auth_endpoints.py::test_logout_success - ModuleNotFoundError...
ERROR tests/test_auth_endpoints.py::test_logout_blacklisted_token_rejected - ...
ERROR tests/test_auth_endpoints.py::test_password_reset_request - ModuleNotFo...
ERROR tests/test_auth_endpoints.py::test_password_reset_request_nonexistent_email
ERROR tests/test_auth_endpoints.py::test_password_reset_confirm_valid - Modul...
ERROR tests/test_auth_endpoints.py::test_password_reset_confirm_invalid_token
ERROR tests/test_auth_endpoints.py::test_password_reset_confirm_expired_token
ERROR tests/test_auth_endpoints.py::test_password_reset_confirm_used_token - ...
ERROR tests/test_auth_endpoints.py::test_integration_login_to_protected_endpoint
ERROR tests/test_auth_endpoints.py::test_admin_endpoint_as_admin - ModuleNotF...
ERROR tests/test_auth_endpoints.py::test_admin_endpoint_as_teacher - ModuleNo...
ERROR tests/test_auth_endpoints.py::test_financial_endpoint_as_admin - Module...
ERROR tests/test_auth_endpoints.py::test_financial_endpoint_as_accountant - M...
ERROR tests/test_auth_endpoints.py::test_financial_endpoint_as_teacher - Modu...
ERROR tests/test_batch.py::TestBatchGet::test_batch_get_activities_success - ...
ERROR tests/test_batch.py::TestBatchGet::test_batch_get_with_field_selection
ERROR tests/test_batch.py::TestBatchGet::test_batch_get_with_missing_resources
ERROR tests/test_batch.py::TestBatchGet::test_batch_get_all_missing - ModuleN...
ERROR tests/test_batch.py::TestBatchGet::test_batch_get_unsupported_resource_type
ERROR tests/test_batch.py::TestBatchGet::test_batch_get_empty_ids - ModuleNot...
ERROR tests/test_batch.py::TestBatchGet::test_batch_get_too_many_ids - Module...
ERROR tests/test_batch.py::TestBatchGet::test_batch_get_unauthenticated - Mod...
ERROR tests/test_batch.py::TestBatchActivityRecommendations::test_batch_recommendations_success
ERROR tests/test_batch.py::TestBatchActivityRecommendations::test_batch_recommendations_with_filters
ERROR tests/test_batch.py::TestBatchActivityRecommendations::test_batch_recommendations_multiple_children
ERROR tests/test_batch.py::TestBatchActivityRecommendations::test_batch_recommendations_empty_children
ERROR tests/test_batch.py::TestBatchActivityRecommendations::test_batch_recommendations_too_many_children
ERROR tests/test_batch.py::TestBatchActivityRecommendations::test_batch_recommendations_unauthenticated
ERROR tests/test_communication.py::TestReportGenerationEndpoint::test_generate_report_success
ERROR tests/test_communication.py::TestReportGenerationEndpoint::test_generate_report_french
ERROR tests/test_communication.py::TestReportGenerationEndpoint::test_generate_report_requires_auth
ERROR tests/test_communication.py::TestReportGenerationEndpoint::test_generate_report_invalid_child_id
ERROR tests/test_communication.py::TestReportGenerationEndpoint::test_generate_report_future_date_error
ERROR tests/test_communication.py::TestHomeActivitiesEndpoint::test_get_home_activities_success
ERROR tests/test_communication.py::TestHomeActivitiesEndpoint::test_get_home_activities_with_french
ERROR tests/test_communication.py::TestHomeActivitiesEndpoint::test_get_home_activities_with_limit
ERROR tests/test_communication.py::TestHomeActivitiesEndpoint::test_get_home_activities_requires_auth
ERROR tests/test_communication.py::TestHomeActivitiesEndpoint::test_get_home_activities_invalid_limit
ERROR tests/test_communication.py::TestCommunicationPreferencesEndpoint::test_create_preferences_success
ERROR tests/test_communication.py::TestCommunicationPreferencesEndpoint::test_create_preferences_french
ERROR tests/test_communication.py::TestCommunicationPreferencesEndpoint::test_create_preferences_requires_auth
ERROR tests/test_communication.py::TestCommunicationPreferencesEndpoint::test_get_preferences_success
ERROR tests/test_communication.py::TestCommunicationPreferencesEndpoint::test_get_preferences_not_found
ERROR tests/test_communication.py::TestCommunicationPreferencesEndpoint::test_get_preferences_requires_auth
ERROR tests/test_communication.py::TestEdgeCasesAndErrorHandling::test_api_invalid_uuid_format
ERROR tests/test_communication.py::TestEdgeCasesAndErrorHandling::test_api_missing_required_fields
ERROR tests/test_data_integrity.py::TestActivityIntegrity::test_valid_activity
ERROR tests/test_data_integrity.py::TestActivityIntegrity::test_activity_invalid_age_range
ERROR tests/test_data_integrity.py::TestActivityIntegrity::test_activity_negative_age
ERROR tests/test_data_integrity.py::TestActivityIntegrity::test_activity_invalid_duration
ERROR tests/test_data_integrity.py::TestActivityIntegrity::test_activity_empty_name
ERROR tests/test_data_integrity.py::TestActivityParticipationIntegrity::test_valid_participation
ERROR tests/test_data_integrity.py::TestActivityParticipationIntegrity::test_participation_invalid_dates
ERROR tests/test_data_integrity.py::TestActivityParticipationIntegrity::test_participation_invalid_engagement_score
ERROR tests/test_data_integrity.py::TestActivityParticipationIntegrity::test_participation_status_mismatch
ERROR tests/test_data_integrity.py::TestCoachingSessionIntegrity::test_valid_coaching_session
ERROR tests/test_data_integrity.py::TestCoachingSessionIntegrity::test_coaching_session_empty_question
ERROR tests/test_data_integrity.py::TestCoachingRecommendationIntegrity::test_valid_coaching_recommendation
ERROR tests/test_data_integrity.py::TestCoachingRecommendationIntegrity::test_recommendation_invalid_relevance_score
ERROR tests/test_data_integrity.py::TestCoachingRecommendationIntegrity::test_recommendation_invalid_priority
ERROR tests/test_data_integrity.py::TestOrphanedRecords::test_detect_orphaned_participation
ERROR tests/test_data_integrity.py::TestOrphanedRecords::test_detect_orphaned_evidence_source
ERROR tests/test_data_integrity.py::TestOrphanedRecords::test_fix_orphaned_records
ERROR tests/test_data_integrity.py::TestParentReportIntegrity::test_valid_parent_report
ERROR tests/test_data_integrity.py::TestCommunicationPreferenceIntegrity::test_valid_preference
ERROR tests/test_data_integrity.py::TestCommunicationPreferenceIntegrity::test_preference_no_channels_enabled
ERROR tests/test_data_integrity.py::TestFullVerification::test_run_all_checks
ERROR tests/test_data_integrity.py::TestFullVerification::test_run_full_checks
ERROR tests/test_development_profile.py::TestCreateProfileEndpoint::test_create_profile_requires_auth
ERROR tests/test_development_profile.py::TestCreateProfileEndpoint::test_create_duplicate_profile_fails
ERROR tests/test_development_profile.py::TestGetProfileEndpoint::test_get_profile_returns_200
ERROR tests/test_development_profile.py::TestGetProfileEndpoint::test_get_profile_requires_auth
ERROR tests/test_development_profile.py::TestGetProfileEndpoint::test_get_profile_not_found
ERROR tests/test_development_profile.py::TestGetProfileByChildEndpoint::test_get_profile_by_child_returns_200
ERROR tests/test_development_profile.py::TestGetProfileByChildEndpoint::test_get_profile_by_child_not_found
ERROR tests/test_development_profile.py::TestListProfilesEndpoint::test_list_profiles_returns_200
ERROR tests/test_development_profile.py::TestListProfilesEndpoint::test_list_profiles_pagination
ERROR tests/test_development_profile.py::TestSkillAssessmentEndpoints::test_create_assessment_returns_201
ERROR tests/test_development_profile.py::TestSkillAssessmentEndpoints::test_list_assessments_filter_by_domain
ERROR tests/test_development_profile.py::TestObservationEndpoints::test_create_observation_returns_201
ERROR tests/test_development_profile.py::TestMonthlySnapshotEndpoints::test_create_snapshot_returns_201
ERROR tests/test_development_profile.py::TestMonthlySnapshotEndpoints::test_list_snapshots_returns_200
ERROR tests/test_development_profile.py::TestMonthlySnapshotEndpoints::test_get_snapshot_returns_200
ERROR tests/test_development_profile.py::TestMonthlySnapshotEndpoints::test_delete_snapshot_returns_204
ERROR tests/test_development_profile.py::TestGrowthTrajectoryEndpoint::test_get_trajectory_not_found
ERROR tests/test_development_profile.py::TestEdgeCases::test_invalid_uuid_format
ERROR tests/test_development_profile.py::TestEdgeCases::test_profile_id_mismatch_in_assessment
ERROR tests/test_development_profile.py::TestEdgeCases::test_invalid_domain_value
ERROR tests/test_development_profile.py::TestEdgeCases::test_invalid_skill_status
ERROR tests/test_development_profile.py::TestEdgeCases::test_expired_token_rejected
ERROR tests/test_development_profile.py::TestEdgeCases::test_assessment_for_nonexistent_profile
ERROR tests/test_development_profile.py::TestEdgeCases::test_empty_behavior_description_rejected
ERROR tests/test_document_routes.py::test_create_template_success - ModuleNot...
ERROR tests/test_document_routes.py::test_create_template_requires_auth - Mod...
ERROR tests/test_document_routes.py::test_get_template_success - ModuleNotFou...
ERROR tests/test_document_routes.py::test_get_template_not_found - ModuleNotF...
ERROR tests/test_document_routes.py::test_list_templates_pagination - ModuleN...
ERROR tests/test_document_routes.py::test_update_template_success - ModuleNot...
ERROR tests/test_document_routes.py::test_delete_template_success - ModuleNot...
ERROR tests/test_document_routes.py::test_create_document_success - ModuleNot...
ERROR tests/test_document_routes.py::test_create_document_from_template_success
ERROR tests/test_document_routes.py::test_get_document_success - ModuleNotFou...
ERROR tests/test_document_routes.py::test_get_document_not_found - ModuleNotF...
ERROR tests/test_document_routes.py::test_list_documents_with_filters - Modul...
ERROR tests/test_document_routes.py::test_update_document_success - ModuleNot...
ERROR tests/test_document_routes.py::test_create_signature_success - ModuleNo...
ERROR tests/test_document_routes.py::test_get_signatures_for_document - Modul...
ERROR tests/test_document_routes.py::test_send_signature_request_success - Mo...
ERROR tests/test_document_routes.py::test_mark_signature_request_viewed - Mod...
ERROR tests/test_document_routes.py::test_get_signature_requests_for_signer
ERROR tests/test_document_routes.py::test_get_dashboard_success - ModuleNotFo...
ERROR tests/test_document_routes.py::test_get_audit_logs_for_document - Modul...
ERROR tests/test_document_routes.py::test_invalid_document_type_returns_422
ERROR tests/test_document_routes.py::test_missing_required_fields_returns_422
ERROR tests/test_idor_protection_integration.py::TestDocumentIDORProtection::test_get_document_by_id_idor_protection
ERROR tests/test_idor_protection_integration.py::TestDocumentIDORProtection::test_update_document_idor_protection
ERROR tests/test_idor_protection_integration.py::TestDocumentIDORProtection::test_document_access_isolation_between_users
ERROR tests/test_idor_protection_integration.py::TestDocumentIDORProtection::test_cross_resource_idor_protection
ERROR tests/test_intervention_plans_router.py::TestInterventionPlanHealthEndpoint::test_health_check_returns_ok
ERROR tests/test_intervention_plans_router.py::TestInterventionPlanHealthEndpoint::test_health_check_no_auth_required
ERROR tests/test_intervention_plans_router.py::TestEndpointPathIntegration::test_list_plans_endpoint_path
ERROR tests/test_intervention_plans_router.py::TestEndpointPathIntegration::test_single_plan_endpoint_path
ERROR tests/test_intervention_plans_router.py::TestEndpointPathIntegration::test_pending_review_endpoint_path
ERROR tests/test_intervention_plans_router.py::TestEndpointPathIntegration::test_plan_history_endpoint_path
ERROR tests/test_intervention_plans_router.py::TestEndpointPathIntegration::test_plan_progress_endpoint_path
ERROR tests/test_intervention_plans_router.py::TestEndpointPathIntegration::test_plan_sign_endpoint_path
ERROR tests/test_intervention_plans_router.py::TestEndpointPathIntegration::test_plan_version_endpoint_path
ERROR tests/test_intervention_plans_router.py::TestSectionCRUDEndpoints::test_strengths_endpoint_exists
ERROR tests/test_intervention_plans_router.py::TestSectionCRUDEndpoints::test_needs_endpoint_exists
ERROR tests/test_intervention_plans_router.py::TestSectionCRUDEndpoints::test_goals_endpoint_exists
ERROR tests/test_intervention_plans_router.py::TestSectionCRUDEndpoints::test_strategies_endpoint_exists
ERROR tests/test_intervention_plans_router.py::TestSectionCRUDEndpoints::test_monitoring_endpoint_exists
ERROR tests/test_intervention_plans_router.py::TestSectionCRUDEndpoints::test_parent_involvement_endpoint_exists
ERROR tests/test_intervention_plans_router.py::TestSectionCRUDEndpoints::test_consultations_endpoint_exists
ERROR tests/test_intervention_plans_router.py::TestAuthenticationRequired::test_list_plans_requires_auth
ERROR tests/test_intervention_plans_router.py::TestAuthenticationRequired::test_create_plan_requires_auth
ERROR tests/test_intervention_plans_router.py::TestAuthenticationRequired::test_get_plan_requires_auth
ERROR tests/test_intervention_plans_router.py::TestAuthenticationRequired::test_update_plan_requires_auth
ERROR tests/test_intervention_plans_router.py::TestAuthenticationRequired::test_delete_plan_requires_auth
ERROR tests/test_intervention_plans_router.py::TestAuthenticationRequired::test_sign_plan_requires_auth
ERROR tests/test_intervention_plans_router.py::TestAuthenticationRequired::test_pending_review_requires_auth
ERROR tests/test_intervention_plans_router.py::TestErrorHandling::test_invalid_plan_id_returns_404
ERROR tests/test_intervention_plans_router.py::TestErrorHandling::test_malformed_uuid_returns_422
ERROR tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_signature_endpoint_accepts_valid_request_format
ERROR tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_signature_endpoint_matches_parent_portal_client_path
ERROR tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_get_plan_includes_signature_status_field
ERROR tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_list_plans_supports_parent_signed_filter
ERROR tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_list_plans_supports_status_filter
ERROR tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_signature_requires_authentication
ERROR tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_signature_rejects_missing_signature_data
ERROR tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_signature_request_with_base64_image
ERROR tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_signature_request_with_large_base64_data
ERROR tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_signature_response_format_for_gibbon_sync
ERROR tests/test_intervention_plans_router.py::TestParentSignatureWorkflowE2E::test_plan_details_endpoint_supports_gibbon_display
ERROR tests/test_intervention_plans_router.py::TestParentSignatureSchemaValidation::test_signature_request_snake_case_field_names
ERROR tests/test_intervention_plans_router.py::TestParentSignatureSchemaValidation::test_signature_response_contains_expected_fields
ERROR tests/test_intervention_plans_router.py::TestParentSignatureSchemaValidation::test_signature_validates_agreed_to_terms_required
ERROR tests/test_intervention_plans_router.py::TestCrossServiceSignatureIntegration::test_parent_portal_awaiting_signature_flow
ERROR tests/test_intervention_plans_router.py::TestCrossServiceSignatureIntegration::test_parent_portal_child_summary_flow
ERROR tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_create_plan_with_monthly_review_schedule
ERROR tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_create_plan_with_quarterly_review_schedule
ERROR tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_create_plan_with_semi_annual_review_schedule
ERROR tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_create_plan_with_annual_review_schedule
ERROR tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_create_plan_rejects_invalid_review_schedule
ERROR tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_pending_review_endpoint_exists
ERROR tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_pending_review_returns_list_response
ERROR tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_pending_review_accepts_days_ahead_parameter
ERROR tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_pending_review_accepts_30_days_ahead
ERROR tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_pending_review_rejects_invalid_days_ahead
ERROR tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_pending_review_rejects_zero_days_ahead
ERROR tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_pending_review_rejects_too_large_days_ahead
ERROR tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_review_reminder_structure_matches_parent_portal
ERROR tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_review_reminder_days_until_can_be_negative
ERROR tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_overdue_count_in_response
ERROR tests/test_intervention_plans_router.py::TestAutomatedReviewReminderFlowE2E::test_upcoming_count_in_response
ERROR tests/test_intervention_plans_router.py::TestReviewReminderCrossServiceIntegration::test_parent_portal_review_summary_flow
ERROR tests/test_intervention_plans_router.py::TestReviewReminderCrossServiceIntegration::test_pending_review_count_for_badge
ERROR tests/test_intervention_plans_router.py::TestReviewScheduleValidation::test_valid_review_schedules_accepted
ERROR tests/test_intervention_plans_router.py::TestReviewScheduleValidation::test_invalid_review_schedules_rejected
ERROR tests/test_intervention_plans_router.py::TestReviewScheduleValidation::test_plan_list_filter_by_review_schedule
ERROR tests/test_intervention_plans_router.py::TestReviewScheduleValidation::test_plan_list_filter_needs_review
ERROR tests/test_intervention_plans_router.py::TestReviewReminderServiceViaAPI::test_reminder_service_filters_active_plans
ERROR tests/test_intervention_plans_router.py::TestReviewReminderServiceViaAPI::test_reminder_categorizes_overdue_correctly
ERROR tests/test_intervention_plans_router.py::TestReviewReminderServiceViaAPI::test_reminder_categorizes_upcoming_correctly
ERROR tests/test_llm_api.py::TestCompletionsEndpoint::test_completions_returns_200_with_valid_request
ERROR tests/test_llm_api.py::TestCompletionsEndpoint::test_completions_requires_auth
ERROR tests/test_llm_api.py::TestCompletionsEndpoint::test_completions_with_minimal_request
ERROR tests/test_llm_api.py::TestCompletionsEndpoint::test_completions_validates_empty_messages
ERROR tests/test_llm_api.py::TestCompletionsEndpoint::test_completions_validates_message_role
ERROR tests/test_llm_api.py::TestCompletionsEndpoint::test_completions_validates_temperature_range
ERROR tests/test_llm_api.py::TestCompletionsEndpoint::test_completions_returns_503_when_provider_unavailable
ERROR tests/test_llm_api.py::TestCompletionsEndpoint::test_completions_returns_500_on_completion_error
ERROR tests/test_llm_api.py::TestStreamingCompletionsEndpoint::test_streaming_completions_returns_stream
ERROR tests/test_llm_api.py::TestStreamingCompletionsEndpoint::test_streaming_completions_requires_auth
ERROR tests/test_llm_api.py::TestHealthEndpoint::test_health_returns_200_without_auth
ERROR tests/test_llm_api.py::TestHealthEndpoint::test_health_returns_healthy_status
ERROR tests/test_llm_api.py::TestHealthEndpoint::test_health_returns_degraded_status
ERROR tests/test_llm_api.py::TestModelsEndpoint::test_models_returns_200 - Mo...
ERROR tests/test_llm_api.py::TestModelsEndpoint::test_models_requires_auth - ...
ERROR tests/test_llm_api.py::TestModelsEndpoint::test_models_returns_model_details
ERROR tests/test_llm_api.py::TestUsageEndpoint::test_usage_returns_200 - Modu...
ERROR tests/test_llm_api.py::TestUsageEndpoint::test_usage_requires_auth - Mo...
ERROR tests/test_llm_api.py::TestUsageEndpoint::test_usage_with_provider_filter
ERROR tests/test_llm_api.py::TestUsageEndpoint::test_usage_with_model_filter
ERROR tests/test_llm_api.py::TestCacheStatsEndpoint::test_cache_stats_returns_200
ERROR tests/test_llm_api.py::TestCacheStatsEndpoint::test_cache_stats_requires_auth
ERROR tests/test_llm_api.py::TestCacheInvalidateEndpoint::test_cache_invalidate_returns_200
ERROR tests/test_llm_api.py::TestCacheInvalidateEndpoint::test_cache_invalidate_requires_auth
ERROR tests/test_llm_api.py::TestCacheInvalidateEndpoint::test_cache_invalidate_with_cache_key
ERROR tests/test_llm_api.py::TestCacheInvalidateEndpoint::test_cache_invalidate_with_provider_filter
ERROR tests/test_llm_api.py::TestCacheInvalidateEndpoint::test_cache_invalidate_with_model_filter
ERROR tests/test_llm_api.py::TestCacheCleanupEndpoint::test_cache_cleanup_returns_200
ERROR tests/test_llm_api.py::TestCacheCleanupEndpoint::test_cache_cleanup_requires_auth
ERROR tests/test_llm_api.py::TestEdgeCases::test_completions_with_expired_token
ERROR tests/test_llm_api.py::TestEdgeCases::test_completions_with_invalid_token
ERROR tests/test_llm_api.py::TestEdgeCases::test_completions_with_empty_message_content
ERROR tests/test_llm_api.py::TestEdgeCases::test_completions_with_invalid_max_tokens
ERROR tests/test_llm_api.py::TestEdgeCases::test_completions_with_negative_max_tokens
ERROR tests/test_llm_api.py::TestEdgeCases::test_completions_with_invalid_provider
ERROR tests/test_llm_api.py::TestEdgeCases::test_completions_service_error_returns_500
ERROR tests/test_llm_api.py::TestEdgeCases::test_completions_with_all_optional_parameters
ERROR tests/test_llm_api.py::TestResponseStructure::test_completion_response_contains_all_fields
ERROR tests/test_llm_api.py::TestResponseStructure::test_health_response_structure
ERROR tests/test_llm_api.py::TestResponseStructure::test_usage_response_structure
ERROR tests/test_message_quality.py::TestAnalyzeEndpoint::test_analyze_success
ERROR tests/test_message_quality.py::TestAnalyzeEndpoint::test_analyze_french_message
ERROR tests/test_message_quality.py::TestAnalyzeEndpoint::test_analyze_with_issues_detected
ERROR tests/test_message_quality.py::TestAnalyzeEndpoint::test_analyze_with_rewrites
ERROR tests/test_message_quality.py::TestAnalyzeEndpoint::test_analyze_requires_auth
ERROR tests/test_message_quality.py::TestAnalyzeEndpoint::test_analyze_empty_message_returns_400
ERROR tests/test_message_quality.py::TestAnalyzeEndpoint::test_analyze_invalid_language_returns_422
ERROR tests/test_message_quality.py::TestAnalyzeEndpoint::test_analyze_invalid_context_returns_422
ERROR tests/test_message_quality.py::TestAnalyzeEndpoint::test_analyze_response_has_structural_flags
ERROR tests/test_message_quality.py::TestTemplatesEndpoint::test_get_templates_success
ERROR tests/test_message_quality.py::TestTemplatesEndpoint::test_get_templates_with_language_filter
ERROR tests/test_message_quality.py::TestTemplatesEndpoint::test_get_templates_with_category_filter
ERROR tests/test_message_quality.py::TestTemplatesEndpoint::test_get_templates_with_pagination
ERROR tests/test_message_quality.py::TestTemplatesEndpoint::test_get_templates_invalid_limit
ERROR tests/test_message_quality.py::TestTemplatesEndpoint::test_get_templates_requires_auth
ERROR tests/test_message_quality.py::TestTemplatesEndpoint::test_create_template_success
ERROR tests/test_message_quality.py::TestTemplatesEndpoint::test_create_template_french
ERROR tests/test_message_quality.py::TestTemplatesEndpoint::test_create_template_requires_auth
ERROR tests/test_message_quality.py::TestTemplatesEndpoint::test_create_template_missing_required_fields
ERROR tests/test_message_quality.py::TestTemplatesEndpoint::test_create_template_invalid_category
ERROR tests/test_message_quality.py::TestTrainingExamplesEndpoint::test_get_training_examples_success
ERROR tests/test_message_quality.py::TestTrainingExamplesEndpoint::test_get_training_examples_with_language_filter
ERROR tests/test_message_quality.py::TestTrainingExamplesEndpoint::test_get_training_examples_with_issue_type_filter
ERROR tests/test_message_quality.py::TestTrainingExamplesEndpoint::test_get_training_examples_with_difficulty_filter
ERROR tests/test_message_quality.py::TestTrainingExamplesEndpoint::test_get_training_examples_with_pagination
ERROR tests/test_message_quality.py::TestTrainingExamplesEndpoint::test_get_training_examples_invalid_limit
ERROR tests/test_message_quality.py::TestTrainingExamplesEndpoint::test_get_training_examples_requires_auth
ERROR tests/test_message_quality.py::TestTrainingExamplesEndpoint::test_get_training_examples_response_structure
ERROR tests/test_message_quality.py::TestTrainingExamplesEndpoint::test_get_training_examples_multiple_filters
ERROR tests/test_message_quality.py::TestAPIEdgeCasesAndErrorHandling::test_api_invalid_uuid_format
ERROR tests/test_message_quality.py::TestAPIEdgeCasesAndErrorHandling::test_api_whitespace_only_message
ERROR tests/test_message_quality.py::TestAPIEdgeCasesAndErrorHandling::test_api_very_long_message
ERROR tests/test_message_quality.py::TestAPIEdgeCasesAndErrorHandling::test_api_message_exceeds_max_length
ERROR tests/test_message_quality.py::TestAPIEdgeCasesAndErrorHandling::test_api_template_content_exceeds_max_length
ERROR tests/test_message_quality.py::TestAPIEdgeCasesAndErrorHandling::test_api_invalid_offset_returns_422
ERROR tests/test_messaging.py::TestMessagingServiceThreads::test_get_thread_returns_thread
ERROR tests/test_messaging.py::TestMessagingServiceThreads::test_get_thread_unauthorized_raises_error
ERROR tests/test_messaging.py::TestMessagingServiceThreads::test_list_threads_for_user_returns_threads
ERROR tests/test_messaging.py::TestMessagingServiceThreads::test_list_threads_for_user_filters_by_child
ERROR tests/test_messaging.py::TestMessagingServiceThreads::test_update_thread_changes_subject
ERROR tests/test_messaging.py::TestMessagingServiceThreads::test_archive_thread_sets_inactive
ERROR tests/test_messaging.py::TestMessagingServiceMessages::test_send_message_returns_valid_response
ERROR tests/test_messaging.py::TestMessagingServiceMessages::test_get_message_returns_message
ERROR tests/test_messaging.py::TestMessagingServiceMessages::test_list_messages_returns_messages
ERROR tests/test_messaging.py::TestMessagingServiceMessages::test_mark_messages_as_read_updates_status
ERROR tests/test_messaging.py::TestMessagingServiceMessages::test_mark_own_messages_as_read_does_nothing
ERROR tests/test_messaging.py::TestMessagingServiceMessages::test_mark_thread_as_read_updates_all_messages
ERROR tests/test_messaging.py::TestMessagingServiceMessages::test_delete_message_removes_message
ERROR tests/test_messaging.py::TestMessagingServiceMessages::test_delete_message_by_non_sender_raises_error
ERROR tests/test_messaging.py::TestMessagingServiceMessages::test_get_unread_count_returns_correct_counts
ERROR tests/test_messaging.py::TestMessagingServiceNotifications::test_create_notification_preference_updates_existing
ERROR tests/test_messaging.py::TestMessagingServiceNotifications::test_delete_notification_preference_success
ERROR tests/test_messaging.py::TestMessagingServiceNotifications::test_is_notification_enabled_returns_correct_status
ERROR tests/test_messaging.py::TestThreadEndpoints::test_create_thread_endpoint_success
ERROR tests/test_messaging.py::TestThreadEndpoints::test_create_thread_endpoint_requires_auth
ERROR tests/test_messaging.py::TestThreadEndpoints::test_list_threads_endpoint_success
ERROR tests/test_messaging.py::TestThreadEndpoints::test_list_threads_endpoint_with_filters
ERROR tests/test_messaging.py::TestThreadEndpoints::test_get_thread_endpoint_not_found
ERROR tests/test_messaging.py::TestMessageEndpoints::test_send_message_endpoint_thread_not_found
ERROR tests/test_messaging.py::TestMessageEndpoints::test_list_messages_endpoint_thread_not_found
ERROR tests/test_messaging.py::TestMessageEndpoints::test_mark_messages_as_read_endpoint_requires_auth
ERROR tests/test_messaging.py::TestMessageEndpoints::test_get_message_endpoint_not_found
ERROR tests/test_messaging.py::TestNotificationPreferenceEndpoints::test_create_preference_endpoint_success
ERROR tests/test_messaging.py::TestNotificationPreferenceEndpoints::test_get_preferences_endpoint_returns_list
ERROR tests/test_messaging.py::TestNotificationPreferenceEndpoints::test_get_specific_preference_endpoint_not_found
ERROR tests/test_messaging.py::TestNotificationPreferenceEndpoints::test_delete_preference_endpoint_not_found
ERROR tests/test_messaging.py::TestNotificationPreferenceEndpoints::test_create_default_preferences_endpoint
ERROR tests/test_messaging.py::TestNotificationPreferenceEndpoints::test_set_quiet_hours_endpoint
ERROR tests/test_messaging.py::TestThreadEndpointIntegration::test_endpoint_create_thread_with_initial_message
ERROR tests/test_messaging.py::TestThreadEndpointIntegration::test_endpoint_create_question_thread_type
ERROR tests/test_messaging.py::TestThreadEndpointIntegration::test_endpoint_create_urgent_thread_type
ERROR tests/test_messaging.py::TestThreadEndpointIntegration::test_endpoint_get_thread_with_messages
ERROR tests/test_messaging.py::TestThreadEndpointIntegration::test_endpoint_update_thread_subject
ERROR tests/test_messaging.py::TestThreadEndpointIntegration::test_endpoint_archive_thread
ERROR tests/test_messaging.py::TestThreadEndpointIntegration::test_endpoint_list_threads_pagination
ERROR tests/test_messaging.py::TestThreadEndpointIntegration::test_endpoint_list_threads_filter_by_type
ERROR tests/test_messaging.py::TestThreadEndpointIntegration::test_endpoint_create_thread_invalid_thread_type
ERROR tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_send_message_success
ERROR tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_send_message_with_mentions
ERROR tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_list_messages_success
ERROR tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_list_messages_pagination
ERROR tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_get_message_success
ERROR tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_mark_messages_as_read_success
ERROR tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_mark_thread_as_read_success
ERROR tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_delete_message_success
ERROR tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_get_unread_count_success
ERROR tests/test_messaging.py::TestMessageEndpointIntegration::test_endpoint_send_message_empty_content
ERROR tests/test_messaging.py::TestNotificationEndpointIntegration::test_endpoint_create_preference_with_quiet_hours
ERROR tests/test_messaging.py::TestNotificationEndpointIntegration::test_endpoint_update_preference_toggle_enabled
ERROR tests/test_messaging.py::TestNotificationEndpointIntegration::test_endpoint_get_specific_preference_success
ERROR tests/test_messaging.py::TestNotificationEndpointIntegration::test_endpoint_delete_preference_success
ERROR tests/test_messaging.py::TestNotificationEndpointIntegration::test_endpoint_notification_preferences_requires_auth
ERROR tests/test_messaging.py::TestNotificationEndpointIntegration::test_endpoint_batch_update_preferences
ERROR tests/test_messaging.py::TestEndpointErrorHandling::test_endpoint_invalid_uuid_thread
ERROR tests/test_messaging.py::TestEndpointErrorHandling::test_endpoint_invalid_uuid_message
ERROR tests/test_messaging.py::TestEndpointErrorHandling::test_endpoint_invalid_uuid_child
ERROR tests/test_messaging.py::TestEndpointErrorHandling::test_endpoint_missing_required_subject
ERROR tests/test_messaging.py::TestEndpointErrorHandling::test_endpoint_missing_required_content
ERROR tests/test_messaging.py::TestEndpointErrorHandling::test_endpoint_notification_invalid_type
ERROR tests/test_messaging.py::TestEndpointErrorHandling::test_endpoint_notification_invalid_channel
ERROR tests/test_messaging.py::TestEndpointErrorHandling::test_endpoint_send_message_to_archived_thread
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsIngestion::test_ingest_minimal_diagnostics_success
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsIngestion::test_ingest_full_diagnostics_success
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsIngestion::test_ingest_diagnostics_missing_auth
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsIngestion::test_ingest_diagnostics_invalid_token
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsValidation::test_missing_test_run_id
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsValidation::test_invalid_test_run_id_format
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsValidation::test_missing_app_metadata
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsValidation::test_missing_device_metadata
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsValidation::test_invalid_app_version_format
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsValidation::test_invalid_ios_version_format
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsValidation::test_invalid_battery_level
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsValidation::test_invalid_log_level
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsValidation::test_invalid_network_error_type
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsHealthCheck::test_health_check_success
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsHealthCheck::test_health_check_no_auth_required
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsRetrieval::test_get_diagnostics_not_found
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsRetrieval::test_get_diagnostics_by_run_empty
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsRetrieval::test_get_diagnostics_requires_auth
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsSchemaValidation::test_log_message_max_length
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsSchemaValidation::test_status_code_valid_range
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsSchemaValidation::test_null_status_code_allowed
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsSchemaValidation::test_empty_logs_array_allowed
ERROR tests/test_qa_diagnostics.py::TestQADiagnosticsSchemaValidation::test_custom_data_allowed
ERROR tests/test_seed_idempotency.py::TestSeedIdempotency::test_seed_activities_idempotent
ERROR tests/test_seed_idempotency.py::TestSeedIdempotency::test_seed_activity_participations_idempotent
ERROR tests/test_seed_idempotency.py::TestSeedIdempotency::test_seed_activity_recommendations_idempotent
ERROR tests/test_seed_idempotency.py::TestSeedIdempotency::test_seed_coaching_sessions_idempotent
ERROR tests/test_seed_idempotency.py::TestSeedIdempotency::test_seed_parent_reports_idempotent
ERROR tests/test_seed_idempotency.py::TestSeedIdempotency::test_seed_home_activities_idempotent
ERROR tests/test_seed_idempotency.py::TestSeedIdempotency::test_seed_communication_preferences_idempotent
ERROR tests/test_seed_idempotency.py::TestSeedIdempotency::test_full_seed_script_idempotent
ERROR tests/test_seed_idempotency.py::TestSeedIdempotency::test_no_duplicate_activities_by_name
ERROR tests/test_seed_idempotency.py::TestSeedIdempotency::test_data_integrity_after_multiple_runs
ERROR tests/test_seed_idempotency.py::TestSeedEdgeCases::test_seed_with_empty_database
ERROR tests/test_seed_idempotency.py::TestSeedEdgeCases::test_seed_with_partial_data
ERROR tests/test_storage.py::TestFileModel::test_create_file_with_all_fields
ERROR tests/test_storage.py::TestFileModel::test_file_repr
ERROR tests/test_storage.py::TestFileModel::test_create_public_file
ERROR tests/test_storage.py::TestFileModel::test_file_with_thumbnails
ERROR tests/test_storage.py::TestFileThumbnailModel::test_create_thumbnail
ERROR tests/test_storage.py::TestFileThumbnailModel::test_thumbnail_repr
ERROR tests/test_storage.py::TestStorageQuotaModel::test_create_storage_quota
ERROR tests/test_storage.py::TestStorageQuotaModel::test_storage_quota_available_bytes
ERROR tests/test_storage.py::TestStorageQuotaModel::test_storage_quota_usage_percentage
ERROR tests/test_storage.py::TestStorageQuotaModel::test_storage_quota_near_limit
ERROR tests/test_storage.py::TestStorageQuotaModel::test_empty_storage_quota
ERROR tests/test_storage.py::TestStorageQuotaModel::test_storage_quota_repr
ERROR tests/test_storage.py::TestStorageServiceQuota::test_get_or_create_quota_returns_existing
ERROR tests/test_storage.py::TestStorageServiceQuota::test_check_quota_returns_true_when_available
ERROR tests/test_storage.py::TestStorageServiceQuota::test_check_quota_returns_false_when_exceeded
ERROR tests/test_storage.py::TestStorageServiceQuota::test_check_quota_raises_when_exceeded
ERROR tests/test_storage.py::TestStorageServiceQuota::test_get_quota_usage_returns_stats
ERROR tests/test_storage.py::TestStorageServiceSignedUrls::test_generate_secure_url_invalid_expiration
ERROR tests/test_storage.py::TestUploadEndpoint::test_upload_requires_auth - ...
ERROR tests/test_storage.py::TestUploadEndpoint::test_upload_missing_file_returns_422
ERROR tests/test_storage.py::TestGetQuotaEndpoint::test_get_quota_returns_200
ERROR tests/test_storage.py::TestGetQuotaEndpoint::test_get_quota_requires_auth
ERROR tests/test_storage.py::TestListFilesEndpoint::test_list_files_returns_200
ERROR tests/test_storage.py::TestListFilesEndpoint::test_list_files_requires_auth
ERROR tests/test_storage.py::TestListFilesEndpoint::test_list_files_pagination
ERROR tests/test_storage.py::TestListFilesEndpoint::test_list_files_content_type_filter
ERROR tests/test_storage.py::TestListFilesEndpoint::test_list_files_public_filter
ERROR tests/test_storage.py::TestGetFileEndpoint::test_get_file_requires_auth
ERROR tests/test_storage.py::TestGetFileEndpoint::test_get_file_not_found - M...
ERROR tests/test_storage.py::TestDownloadFileEndpoint::test_download_file_requires_auth
ERROR tests/test_storage.py::TestDownloadFileEndpoint::test_download_file_not_found
ERROR tests/test_storage.py::TestDeleteFileEndpoint::test_delete_file_requires_auth
ERROR tests/test_storage.py::TestDeleteFileEndpoint::test_delete_file_not_found
ERROR tests/test_storage.py::TestSecureUrlEndpoint::test_secure_url_requires_auth
ERROR tests/test_storage.py::TestSecureUrlEndpoint::test_secure_url_not_found
ERROR tests/test_storage.py::TestSecureUrlEndpoint::test_secure_url_validates_expiration
ERROR tests/test_storage.py::TestEdgeCases::test_invalid_uuid_format_get_file
ERROR tests/test_storage.py::TestEdgeCases::test_invalid_uuid_format_delete_file
ERROR tests/test_storage.py::TestEdgeCases::test_invalid_uuid_format_download
ERROR tests/test_storage.py::TestEdgeCases::test_negative_skip_rejected - Mod...
ERROR tests/test_storage.py::TestEdgeCases::test_zero_limit_rejected - Module...
ERROR tests/test_storage.py::TestEdgeCases::test_limit_over_100_rejected - Mo...
ERROR tests/test_storage.py::TestFileMetadataFixtures::test_sample_file_data_fixture
ERROR tests/test_storage.py::TestFileMetadataFixtures::test_multiple_files_fixture
ERROR tests/test_storage.py::TestFileMetadataFixtures::test_thumbnail_sizes_fixture
ERROR tests/test_storage.py::TestFileMetadataFixtures::test_image_content_types_fixture
ERROR tests/test_storage.py::TestFileMetadataFixtures::test_allowed_content_types_fixture
ERROR tests/test_webhooks.py::TestWebhookPayloadParsing::test_valid_care_activity_payload
ERROR tests/test_webhooks.py::TestWebhookPayloadParsing::test_valid_meal_logged_payload
ERROR tests/test_webhooks.py::TestWebhookPayloadParsing::test_valid_nap_logged_payload
ERROR tests/test_webhooks.py::TestWebhookPayloadParsing::test_valid_photo_uploaded_payload
ERROR tests/test_webhooks.py::TestWebhookPayloadParsing::test_minimal_valid_payload
ERROR tests/test_webhooks.py::TestWebhookPayloadParsing::test_missing_event_type
ERROR tests/test_webhooks.py::TestWebhookPayloadParsing::test_missing_entity_type
ERROR tests/test_webhooks.py::TestWebhookPayloadParsing::test_missing_entity_id
ERROR tests/test_webhooks.py::TestWebhookPayloadParsing::test_invalid_event_type
ERROR tests/test_webhooks.py::TestWebhookPayloadParsing::test_invalid_entity_type
ERROR tests/test_webhooks.py::TestWebhookPayloadParsing::test_empty_entity_id
ERROR tests/test_webhooks.py::TestWebhookPayloadParsing::test_entity_id_too_long
ERROR tests/test_webhooks.py::TestWebhookPayloadParsing::test_empty_payload_dict
ERROR tests/test_webhooks.py::TestWebhookPayloadParsing::test_invalid_gibbon_sync_log_id
ERROR tests/test_webhooks.py::TestWebhookJWTValidation::test_valid_jwt_token
ERROR tests/test_webhooks.py::TestWebhookJWTValidation::test_missing_jwt_token
ERROR tests/test_webhooks.py::TestWebhookJWTValidation::test_expired_jwt_token
ERROR tests/test_webhooks.py::TestWebhookJWTValidation::test_malformed_jwt_token
ERROR tests/test_webhooks.py::TestWebhookJWTValidation::test_invalid_bearer_format
ERROR tests/test_webhooks.py::TestWebhookJWTValidation::test_wrong_auth_scheme
ERROR tests/test_webhooks.py::TestWebhookJWTValidation::test_empty_bearer_token
ERROR tests/test_webhooks.py::TestWebhookJWTValidation::test_jwt_with_additional_claims
ERROR tests/test_webhooks.py::TestWebhookEventProcessing::test_care_activity_created_processing
ERROR tests/test_webhooks.py::TestWebhookEventProcessing::test_care_activity_updated_processing
ERROR tests/test_webhooks.py::TestWebhookEventProcessing::test_care_activity_deleted_processing
ERROR tests/test_webhooks.py::TestWebhookEventProcessing::test_meal_logged_processing
ERROR tests/test_webhooks.py::TestWebhookEventProcessing::test_nap_logged_processing
ERROR tests/test_webhooks.py::TestWebhookEventProcessing::test_photo_uploaded_processing
ERROR tests/test_webhooks.py::TestWebhookEventProcessing::test_attendance_check_in_processing
ERROR tests/test_webhooks.py::TestWebhookEventProcessing::test_attendance_check_out_processing
ERROR tests/test_webhooks.py::TestWebhookEventProcessing::test_child_profile_updated_processing
ERROR tests/test_webhooks.py::TestWebhookEventProcessing::test_custom_event_processing
ERROR tests/test_webhooks.py::TestWebhookEventProcessing::test_all_event_types_return_processing_time
ERROR tests/test_webhooks.py::TestWebhookResponseStructure::test_response_contains_all_required_fields
ERROR tests/test_webhooks.py::TestWebhookResponseStructure::test_response_status_is_processed
ERROR tests/test_webhooks.py::TestWebhookResponseStructure::test_response_echoes_event_type_and_entity_id
ERROR tests/test_webhooks.py::TestWebhookResponseStructure::test_response_received_at_is_valid_timestamp
ERROR tests/test_webhooks.py::TestWebhookResponseStructure::test_processing_time_is_reasonable
ERROR tests/test_webhooks.py::TestWebhookHealthCheck::test_health_check_returns_200
ERROR tests/test_webhooks.py::TestWebhookHealthCheck::test_health_check_no_auth_required
ERROR tests/test_webhooks.py::TestWebhookHealthCheck::test_health_check_returns_healthy_status
ERROR tests/test_webhooks.py::TestWebhookHealthCheck::test_health_check_timestamp_is_valid
ERROR tests/test_webhooks.py::TestWebhookEdgeCases::test_large_payload_is_accepted
ERROR tests/test_webhooks.py::TestWebhookEdgeCases::test_special_characters_in_entity_id
ERROR tests/test_webhooks.py::TestWebhookEdgeCases::test_unicode_in_payload
ERROR tests/test_webhooks.py::TestWebhookEdgeCases::test_null_optional_fields
ERROR tests/test_webhooks.py::TestWebhookEdgeCases::test_entity_id_at_max_length
ERROR tests/test_webhooks.py::TestWebhookEdgeCases::test_valid_timestamp_format
ERROR tests/test_webhooks.py::TestWebhookEdgeCases::test_payload_with_various_data_types
= 147 failed, 1071 passed, 14 skipped, 89 warnings, 564 errors in 133.36s (0:02:13) =
